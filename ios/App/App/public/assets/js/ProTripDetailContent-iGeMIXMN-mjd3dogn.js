import{j as e}from"./ui-vendor-BO3EQrMK-mjd3dogn.js";import{r as s,R as r}from"./react-vendor-D1R0t5S0-mjd3dogn.js";import{H as a,L as t}from"./tripConverter-C1IUbOIF-mjd3dogn.js";import{c as l,X as i,m as n,u as o,d,B as c,I as m,s as x,t as h,j as u}from"./index-Ta7FH5xW-mjd3dogn.js";import{U as g}from"./users-B07yK8Y7-mjd3dogn.js";import{C as p}from"./calendar-C9K0fVga-mjd3dogn.js";import{u as j}from"./useSuperAdmin-CWSn9Z4T-mjd3dogn.js";import{C as b,g as f,S as v,i as y,f as N,A as w,P as C,j as _,k}from"./TripDetailModals-BpnQZ47b-mjd3dogn.js";import{S as R,g as S,M as A,i as M,j as z,k as I,l as T,m as P,n as O,o as q,p as U}from"./SettingsMenu-DFNATHGY-mjd3dogn.js";import{C as F}from"./camera-AJLsIMdA-mjd3dogn.js";import{D as L}from"./switch-GKuTbu---mjd3dogn.js";import{M as D}from"./map-pin-BtCU-LeS-mjd3dogn.js";import{C as E}from"./chart-column-DOJCLy2J-mjd3dogn.js";import{c as $,U as V}from"./BillingSection-CjHrdMm3-mjd3dogn.js";import{T as B,F as J}from"./TripTabs-C7qFs-l2-mjd3dogn.js";import{GroupCalendar as Y}from"./GroupCalendar-C7tHoqVY-mjd3dogn.js";import{UnifiedMediaHub as H}from"./UnifiedMediaHub-CeKqWQUM-mjd3dogn.js";import{PaymentsTab as G}from"./PaymentsTab-CYY5YmCQ-mjd3dogn.js";import{D as K,a as W,b as Z,c as X,e as Q}from"./dialog-BcLamxvL-mjd3dogn.js";import{I as ee}from"./input-DsI2n-oJ-mjd3dogn.js";import{L as se}from"./label-D_iG0y88-mjd3dogn.js";import{S as re,b as ae,c as te,d as le,e as ie,a as ne}from"./select-CMjqEsxb-mjd3dogn.js";import{B as oe}from"./badge-DyE_ZUPM-mjd3dogn.js";import{A as de,b as ce,a as me}from"./avatar-HCmfb6Ad-mjd3dogn.js";import{a as xe,S as he}from"./user-DFuJ2ZP3-mjd3dogn.js";import{S as ue}from"./save-DwQheero-mjd3dogn.js";import{C as ge}from"./circle-check-big-Bvor9_sf-mjd3dogn.js";import{C as pe}from"./chevron-right-DKRZr0Ps-mjd3dogn.js";import{S as je}from"./eventsMockData-BWXZ-nj7-mjd3dogn.js";import{F as be,T as fe}from"./TripTasksTab-Cb9C55d5-mjd3dogn.js";import{C as ve}from"./circle-alert-CX60mGhN-mjd3dogn.js";import{C as ye}from"./circle-check-CNnkiDfZ-mjd3dogn.js";import{D as Ne,a as we,b as Ce,c as _e,d as ke,e as Re}from"./dropdown-menu-BXaKb4pk-mjd3dogn.js";import{P as Se}from"./zap-LZcBFzwj-mjd3dogn.js";import{M as Ae}from"./mail-BdBVrsyz-mjd3dogn.js";import{T as Me}from"./textarea-BudkfAn8-mjd3dogn.js";import{C as ze}from"./card-jeNxgMYk-mjd3dogn.js";import{S as Ie}from"./shield-DGBvlKQi-mjd3dogn.js";import{U as Te}from"./user-check-D5SE8eAf-mjd3dogn.js";import{C as Pe}from"./clock-CbBGjTQx-mjd3dogn.js";import{f as Oe}from"./utils-DD44zzh--mjd3dogn.js";import{C as qe}from"./checkbox-DB2Rf35T-mjd3dogn.js";import{E as Ue}from"./eye-BNDPAvT6-mjd3dogn.js";import{u as Fe}from"./ProTripDetail-uyrh3ams-mjd3dogn.js";import{S as Le}from"./useSavedRecommendations-DTox9Xl2-mjd3dogn.js";import{B as De}from"./building-QMpp1aWF-mjd3dogn.js";import{c as Ee}from"./calendar-ylgcJK3b-mjd3dogn.js";import{H as $e}from"./heart-NvjcWaZX-mjd3dogn.js";import"./supabase-DyX-XggK-mjd3dogn.js";import"./tripsData-DKwZ96V_-mjd3dogn.js";import"./loader-circle-C0Dqayt8-mjd3dogn.js";import"./progress-D31nnzej-mjd3dogn.js";import"./plus-Dhwa7sZY-mjd3dogn.js";import"./googlePlacesNew-Dl7cAwDK-mjd3dogn.js";import"./external-link-CqAT5ABV-mjd3dogn.js";import"./chevron-left-C1xtDQ_l-mjd3dogn.js";import"./charts-CLK9EMgA-mjd3dogn.js";import"./share-2-DwO-SOoB-mjd3dogn.js";import"./AuthModal-BKw70HSh-mjd3dogn.js";import"./arrow-left-Biq1qnK6-mjd3dogn.js";import"./SavedRecommendations-D-6cIfyL-mjd3dogn.js";import"./pro-CZgaTEEg-mjd3dogn.js";import"./trending-up-B0a-0y1l-mjd3dogn.js";import"./userPreferencesService-DregIO64-mjd3dogn.js";import"./archive-zX2FvEif-mjd3dogn.js";import"./tabs-Dxuz3Y6S-mjd3dogn.js";import"./AddLinkModal-BcpZ7zHk-mjd3dogn.js";import"./trending-down-MCtSAEQe-mjd3dogn.js";import"./sheet-L6YEzMS_-mjd3dogn.js";import"./ProTripNotFound-cUoNZi2a-mjd3dogn.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=l("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),Be=l("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]),Je=l("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),Ye=l("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),He=l("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Ge=l("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]),Ke=l("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),We=({isOpen:r,onClose:t,roomAssignments:l,roster:n,onUpdateAssignments:o})=>{const[d,c]=s.useState(l);if(!r)return null;const m=e=>{const s=n.find(s=>s.id===e);return(null==s?void 0:s.name)||"Unknown"},x=e=>{switch(e){case"suite":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"single":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"double":return"bg-green-500/20 text-green-400 border-green-500/30";case"connecting":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:"text-red-400",size:24}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Room Assignments"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(i,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:d.map(s=>e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-medium",children:s.room}),e.jsx("p",{className:"text-gray-400 text-sm",children:s.hotel})]}),e.jsx("div",{className:`px-2 py-1 rounded-lg border text-xs font-medium ${x(s.roomType)}`,children:s.roomType})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(g,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["Occupants (",s.occupants.length,")"]})]}),e.jsx("div",{className:"space-y-1",children:s.occupants.map(s=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full"}),e.jsx("span",{className:"text-white",children:m(s)})]},s))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(p,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-400 text-xs",children:"Check-in"})]}),e.jsx("p",{className:"text-white text-sm",children:new Date(s.checkIn).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(p,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-400 text-xs",children:"Check-out"})]}),e.jsx("p",{className:"text-white text-sm",children:new Date(s.checkOut).toLocaleDateString()})]})]}),s.specialRequests&&s.specialRequests.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Special Requests:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.specialRequests.map((s,r)=>e.jsx("span",{className:"bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-xs",children:s},r))})]})]})]},s.id))})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-700",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{o(d),t()},className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Save Changes"})]})]})})},Ze=[{id:"chat",label:"Chat",icon:null},{id:"calendar",label:"Calendar",icon:p},{id:"ai-chat",label:"Concierge",icon:R},{id:"media",label:"Media",icon:F},{id:"payments",label:"Payments",icon:L},{id:"places",label:"Places",icon:D},{id:"polls",label:"Polls",icon:E},{id:"tasks",label:"Tasks",icon:b},{id:"team",label:"Team",icon:g,proOnly:!0,requiredPermissions:["read"]}],Xe=(e,s,r,a)=>!a&&(!("finance"!==e&&"compliance"!==e||!["talent","cast","student","artist"].includes(s.toLowerCase()))||!r.includes("write")&&!r.includes("admin")),Qe=({tabs:s,activeTab:r,onTabChange:a,category:l})=>{const{accentColors:i}=n(),{user:c}=o(),{isDemoMode:m}=d(),{isSuperAdmin:x}=j(),h=(null==c?void 0:c.proRole)||"staff",u=(null==c?void 0:c.permissions)||["read"],g=s.length>8;return e.jsx("div",{className:"flex whitespace-nowrap mb-2 overflow-x-auto scrollbar-thin scrollbar-thumb-white/20",children:s.map(s=>{const n=s.icon,o=!x&&Xe(s.id,h,u,m),d="team"===s.id&&"Content"===l?"Cast & Crew":s.label,c=g?"px-3":"px-3.5";return e.jsxs("button",{onClick:()=>a(s.id),className:`flex items-center justify-center gap-1.5 ${c} py-2.5 min-h-[42px] rounded-xl font-medium transition-all duration-200 text-sm flex-1 ${r===s.id?`bg-gradient-to-r ${i.gradient} text-white shadow-md`:"bg-white/10 text-gray-300 hover:bg-white/20 hover:text-white"} ${o?"opacity-75":""}`,children:[n&&e.jsx(n,{size:16}),d,s.proOnly&&e.jsx($,{size:14,className:`text-${i.primary}`}),o&&e.jsx(t,{size:12,className:"text-gray-400"})]},s.id)})})},es=({isOpen:r,onClose:a,member:t,category:l,existingRoles:n,availableRoles:o=[],onUpdateRole:d})=>{const[m,x]=s.useState(""),[h,u]=s.useState(!1),[g,p]=s.useState(!1),[j,b]=s.useState(""),f=o.map(e=>e.roleName);s.useEffect(()=>{t&&r&&(x(t.role),u(!f.includes(t.role)),b(""))},[t,r,f]);return t?e.jsx(K,{open:r,onOpenChange:a,children:e.jsxs(W,{className:"bg-gray-900 border-gray-700 text-white max-w-md",children:[e.jsx(Z,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(xe,{size:20}),"Edit Team Member Role"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white/5 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(de,{className:"w-10 h-10 flex-shrink-0",children:[e.jsx(ce,{src:t.avatar,alt:t.name}),e.jsx(me,{className:"bg-muted text-muted-foreground text-xs font-semibold",children:S(t.name)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400",children:t.email}),e.jsxs(oe,{className:"mt-1 bg-red-600/20 text-red-400",children:["Current: ",t.role]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{htmlFor:"role-type",className:"text-sm font-medium",children:"Role Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{type:"button",variant:h?"outline":"default",size:"sm",onClick:()=>{u(!1),x(f[0]||"")},disabled:0===f.length,className:"flex-1",children:"Predefined"}),e.jsx(c,{type:"button",variant:h?"default":"outline",size:"sm",onClick:()=>{u(!0),x("")},className:"flex-1",children:"Custom"})]}),!h&&f.length>0?e.jsxs(re,{value:m,onValueChange:x,children:[e.jsx(ae,{className:"bg-gray-800 border-gray-600",children:e.jsx(te,{placeholder:"Select a role"})}),e.jsx(le,{className:"bg-gray-800 border-gray-600",children:f.map(s=>e.jsx(ie,{value:s,className:"text-white hover:bg-gray-700",children:s},s))})]}):h||0!==f.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{value:m,onChange:e=>x(e.target.value),placeholder:"Enter custom role (e.g., Production Manager, Lead Vocalist)",className:"bg-gray-800 border-gray-600 text-white"}),n.length>0&&e.jsxs("div",{className:"text-xs text-gray-400",children:[e.jsx("p",{className:"mb-1",children:"Existing roles in roster:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[n.slice(0,5).map(s=>e.jsx("button",{type:"button",onClick:()=>x(s),className:"bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-xs transition-colors",children:s},s)),n.length>5&&e.jsxs("span",{className:"text-gray-500",children:["+",n.length-5," more"]})]})]})]}):e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:e.jsx("p",{className:"text-yellow-400 text-sm",children:'No roles exist yet. Use the "Custom" option to create a new role, or create roles first using the "Create Role" button.'})})]}),j&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:e.jsx("p",{className:"text-red-400 text-sm",children:j})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(c,{onClick:()=>{x((null==t?void 0:t.role)||""),u(!1),b(""),a()},variant:"outline",className:"flex-1",disabled:g,children:[e.jsx(i,{size:16,className:"mr-1"}),"Cancel"]}),e.jsx(c,{onClick:async()=>{if(t&&m.trim()){p(!0),b("");try{await d(t.id,m.trim()),a()}catch(e){b("Failed to update role. Please try again.")}finally{p(!1)}}else b("Role is required")},disabled:g||!m.trim()||m===t.role,className:"flex-1 bg-red-600 hover:bg-red-700",children:g?e.jsx(e.Fragment,{children:"Saving..."}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:16,className:"mr-1"}),"Save Role"]})})]})]})]})}):null},ss=({hasUnassignedRoles:r,onAssignRoles:a,onDismiss:t})=>{const[l,n]=s.useState(!1),[o,d]=s.useState(!1);s.useEffect(()=>{!localStorage.getItem("team-onboarding-dismissed")&&r&&n(!0)},[r]);return l?e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-r from-red-500/10 via-orange-500/10 to-red-500/10 backdrop-blur-sm border border-red-500/20 rounded-xl p-6 mb-6 animate-in fade-in slide-in-from-top duration-500",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.02] pointer-events-none"}),e.jsx("button",{onClick:()=>{o&&localStorage.setItem("team-onboarding-dismissed","true"),n(!1),t()},className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors","aria-label":"Dismiss",children:e.jsx(i,{size:20})}),e.jsxs("div",{className:"relative flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-red-500/20 rounded-full p-3",children:e.jsx(g,{className:"text-red-400",size:24})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(R,{size:18,className:"text-yellow-400"}),"Assign Roles to Your Team"]}),e.jsx("p",{className:"text-gray-300 text-sm mt-1",children:"Help everyone know who's who by assigning roles to your team members. This makes it easier to coordinate and communicate effectively."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"bg-red-500/20 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold text-red-400",children:"1"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Click Member"})]}),e.jsxs("p",{className:"text-xs text-gray-400 ml-8",children:["Click the ",e.jsx(he,{size:12,className:"inline"})," icon next to any team member"]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"bg-red-500/20 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold text-red-400",children:"2"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Choose Role"})]}),e.jsx("p",{className:"text-xs text-gray-400 ml-8",children:"Select from predefined roles or create custom ones"})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"bg-red-500/20 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold text-red-400",children:"3"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Save & Organize"})]}),e.jsx("p",{className:"text-xs text-gray-400 ml-8",children:"Filter and organize by role for better coordination"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsxs(c,{onClick:a,className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(ge,{size:16,className:"mr-2"}),"Start Assigning Roles"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-400 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:e=>d(e.target.checked),className:"rounded border-gray-600 bg-gray-800 text-red-600 focus:ring-red-500"}),"Don't show again"]})]})]})]})]}):null},rs=e=>{const s=e.map(e=>e.role).filter(Boolean);return[...new Set(s)].sort()},as=(e,s)=>f(s).roles.includes(e)?"bg-red-600/20 text-red-400":"bg-blue-600/20 text-blue-400",ts=({isOpen:r,onClose:a,roster:t,category:l,existingRoles:n,availableRoles:o=[],onUpdateMemberRole:d})=>{const[m,x]=s.useState("select"),[h,u]=s.useState(""),[p,j]=s.useState("all"),[b,f]=s.useState(""),[v,y]=s.useState(!1),[N,w]=s.useState(null),{selectedMembers:C,toggleMember:_,selectAll:k,clearSelection:R,selectByRole:A,assignRoleToMultiple:M,isAssigning:z}=(()=>{const[e,r]=s.useState([]),[a,t]=s.useState(!1),l=s.useCallback(e=>{r(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},[]),i=s.useCallback(e=>{r(e)},[]),n=s.useCallback(()=>{r([])},[]),o=s.useCallback((e,s)=>{const a=e.filter(e=>e.role===s).map(e=>e.id);r(a)},[]),d=s.useCallback(async(e,s,r)=>{t(!0);const a=[];let l=0;try{for(const t of e)try{await r(t,s),l++}catch(i){a.push(`Failed to assign role to member ${t}`)}return{success:0===a.length,assignedCount:l,errors:a.length>0?a:void 0}}finally{t(!1),n()}},[n]);return{selectedMembers:e,toggleMember:l,selectAll:i,clearSelection:n,selectByRole:o,assignRoleToMultiple:d,isAssigning:a}})(),I=o.map(e=>e.roleName),T=s.useMemo(()=>{let e=t;return h&&(e=e.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.email.toLowerCase().includes(h.toLowerCase()))),"all"!==p&&(e=e.filter(e=>e.role===p)),e},[t,h,p]),P=s.useMemo(()=>t.filter(e=>C.includes(e.id)),[t,C]),O=()=>{x("select"),u(""),j("all"),f(""),y(!1),w(null),R(),a()};return e.jsx(K,{open:r,onOpenChange:O,children:e.jsxs(W,{className:"bg-gray-900 border-gray-700 text-white max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Z,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(g,{size:20}),"Bulk Role Assignment"]})}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 "+("select"===m?"text-red-400":"text-gray-400"),children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+("select"!==m?"bg-red-600":"bg-red-600/20"),children:"select"!==m?e.jsx(ne,{size:16}):"1"}),e.jsx("span",{className:"text-sm font-medium",children:"Select Members"})]}),e.jsx(pe,{size:20,className:"text-gray-600"}),e.jsxs("div",{className:"flex items-center gap-2 "+("assign"===m?"text-red-400":"text-gray-400"),children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+("confirm"===m?"bg-red-600":"assign"===m?"bg-red-600/20":"bg-gray-700"),children:"confirm"===m?e.jsx(ne,{size:16}):"2"}),e.jsx("span",{className:"text-sm font-medium",children:"Choose Role"})]}),e.jsx(pe,{size:20,className:"text-gray-600"}),e.jsxs("div",{className:"flex items-center gap-2 "+("confirm"===m?"text-red-400":"text-gray-400"),children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+("confirm"===m?"bg-red-600/20":"bg-gray-700"),children:"3"}),e.jsx("span",{className:"text-sm font-medium",children:"Confirm"})]})]}),"select"===m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(je,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx(ee,{value:h,onChange:e=>u(e.target.value),placeholder:"Search by name or email...",className:"pl-10 bg-gray-800 border-gray-600 text-white"})]}),e.jsxs(re,{value:p,onValueChange:j,children:[e.jsxs(ae,{className:"w-40 bg-gray-800 border-gray-600",children:[e.jsx(be,{size:16,className:"mr-2"}),e.jsx(te,{})]}),e.jsxs(le,{className:"bg-gray-800 border-gray-600",children:[e.jsx(ie,{value:"all",children:"All Roles"}),n.map(s=>e.jsx(ie,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:()=>{k(T.map(e=>e.id))},variant:"outline",size:"sm",className:"flex-1",children:["Select All (",T.length,")"]}),e.jsx(c,{onClick:R,variant:"outline",size:"sm",className:"flex-1",disabled:0===C.length,children:"Clear Selection"})]}),C.length>0&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-400 text-sm font-medium",children:[C.length," member",1!==C.length?"s":""," selected"]})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:T.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors "+(C.includes(s.id)?"bg-red-500/10 border-red-500/30":"bg-white/5 border-gray-700 hover:bg-white/10"),children:[e.jsx("input",{type:"checkbox",checked:C.includes(s.id),onChange:()=>_(s.id),className:"rounded border-gray-600 bg-gray-800 text-red-600 focus:ring-red-500"}),e.jsxs(de,{className:"w-10 h-10 flex-shrink-0",children:[e.jsx(ce,{src:s.avatar,alt:s.name}),e.jsx(me,{className:"bg-muted text-muted-foreground text-xs font-semibold",children:S(s.name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400 truncate",children:s.email})]}),e.jsx("span",{className:`${as(s.role,l)} px-2 py-1 rounded text-xs font-medium`,children:s.role})]},s.id))}),0===T.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{size:48,className:"text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No members found"})]})]}),"assign"===m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-gray-700",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Assigning role to:"}),e.jsxs("p",{className:"text-lg font-medium",children:[C.length," selected member",1!==C.length?"s":""]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{className:"text-sm font-medium",children:"Role Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{type:"button",variant:v?"outline":"default",size:"sm",onClick:()=>{y(!1),f(I[0]||"")},disabled:0===I.length,className:"flex-1",children:"Predefined"}),e.jsx(c,{type:"button",variant:v?"default":"outline",size:"sm",onClick:()=>{y(!0),f("")},className:"flex-1",children:"Custom"})]})]}),!v&&I.length>0?e.jsxs(re,{value:b,onValueChange:f,children:[e.jsx(ae,{className:"bg-gray-800 border-gray-600",children:e.jsx(te,{placeholder:"Select a role"})}),e.jsx(le,{className:"bg-gray-800 border-gray-600",children:I.map(s=>e.jsx(ie,{value:s,className:"text-white hover:bg-gray-700",children:s},s))})]}):v||0!==I.length?e.jsx(ee,{value:b,onChange:e=>f(e.target.value),placeholder:"Enter custom role (e.g., Assistant Tour Manager)",className:"bg-gray-800 border-gray-600 text-white"}):e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:e.jsx("p",{className:"text-yellow-400 text-sm",children:'No roles exist yet. Use the "Custom" option to create a new role, or create roles first using the "Create Role" button.'})})]}),"confirm"===m&&!N&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"text-yellow-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-400",children:"Confirm Bulk Assignment"}),e.jsxs("p",{className:"text-sm text-gray-300 mt-1",children:["You are about to assign the role ",e.jsxs("span",{className:"font-bold text-white",children:['"',b,'"']})," to ",e.jsxs("span",{className:"font-bold text-white",children:[C.length," member",1!==C.length?"s":""]}),"."]})]})]})}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[e.jsx(se,{className:"text-sm text-gray-400",children:"Members to update:"}),P.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(de,{className:"w-8 h-8 flex-shrink-0",children:[e.jsx(ce,{src:s.avatar,alt:s.name}),e.jsx(me,{className:"bg-muted text-muted-foreground text-xs font-semibold",children:S(s.name)})]}),e.jsx("span",{className:"text-sm",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:s.role}),e.jsx("span",{className:"text-gray-600",children:"â†’"}),e.jsx("span",{className:"text-red-400 font-medium",children:b})]})]},s.id))]})]}),N&&e.jsx("div",{className:"rounded-lg p-4 "+(N.success?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[N.success?e.jsx(ye,{className:"text-green-400",size:24}):e.jsx(ve,{className:"text-red-400",size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium "+(N.success?"text-green-400":"text-red-400"),children:N.success?"Assignment Complete!":"Assignment Partially Complete"}),e.jsxs("p",{className:"text-sm text-gray-300 mt-1",children:["Successfully assigned role to ",N.assignedCount," member",1!==N.assignedCount?"s":"","."]})]})]})}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-700",children:[!N&&"select"!==m&&e.jsx(c,{onClick:()=>{"confirm"===m?x("assign"):"assign"===m&&x("select")},variant:"outline",disabled:z,children:"Back"}),e.jsxs(c,{onClick:O,variant:"outline",className:"flex-1",disabled:z,children:[e.jsx(i,{size:16,className:"mr-1"}),N?"Done":"Cancel"]}),!N&&("confirm"===m?e.jsx(c,{onClick:async()=>{if(!b.trim())return;const e=await M(C,b.trim(),d);w(e)},disabled:z||!b.trim(),className:"flex-1 bg-red-600 hover:bg-red-700",children:z?e.jsx(e.Fragment,{children:"Assigning..."}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:16,className:"mr-1"}),"Assign to ",C.length]})}):e.jsxs(c,{onClick:()=>{"select"===m?x("assign"):"assign"===m&&x("confirm")},disabled:"select"===m&&0===C.length||"assign"===m&&!b.trim(),className:"flex-1 bg-red-600 hover:bg-red-700",children:["Next",e.jsx(pe,{size:16,className:"ml-1"})]}))]})]})})},ls=({member:s,onDirectMessage:r,showEmergencyContacts:a=!1,children:t})=>e.jsxs(Ne,{children:[e.jsx(we,{asChild:!0,children:t}),e.jsxs(Ce,{className:"bg-gray-800 border-gray-700 text-white w-56",children:[e.jsxs(_e,{className:"text-gray-400",children:["Contact ",s.name]}),e.jsx(ke,{className:"bg-gray-700"}),r&&e.jsxs(Re,{onClick:()=>{r&&r(s.id)},className:"hover:bg-gray-700 cursor-pointer",children:[e.jsx(A,{size:16,className:"mr-2 text-blue-400"}),e.jsx("span",{children:"Send Direct Message"})]}),s.phone&&e.jsxs(Re,{onClick:()=>{s.phone&&(window.location.href=`tel:${s.phone}`)},className:"hover:bg-gray-700 cursor-pointer",children:[e.jsx(Se,{size:16,className:"mr-2 text-green-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:"Call"}),e.jsx("span",{className:"text-xs text-gray-400",children:s.phone})]})]}),e.jsxs(Re,{onClick:()=>{window.location.href=`mailto:${s.email}`},className:"hover:bg-gray-700 cursor-pointer",children:[e.jsx(Ae,{size:16,className:"mr-2 text-purple-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:"Email"}),e.jsx("span",{className:"text-xs text-gray-400 truncate",children:s.email})]})]}),a&&s.emergencyContact&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"bg-gray-700"}),e.jsxs(_e,{className:"text-red-400 flex items-center gap-2",children:[e.jsx(ve,{size:14}),"Emergency Contact"]}),e.jsxs(Re,{onClick:()=>{var e;(null==(e=s.emergencyContact)?void 0:e.phone)&&(window.location.href=`tel:${s.emergencyContact.phone}`)},className:"hover:bg-gray-700 cursor-pointer",children:[e.jsx(Se,{size:16,className:"mr-2 text-red-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.emergencyContact.name}),e.jsx("span",{className:"text-xs text-gray-400",children:s.emergencyContact.relationship}),e.jsx("span",{className:"text-xs text-gray-400",children:s.emergencyContact.phone})]})]})]}),e.jsx(ke,{className:"bg-gray-700"}),e.jsxs(Re,{className:"hover:bg-gray-700 cursor-pointer text-gray-400",children:[e.jsx(xe,{size:16,className:"mr-2"}),e.jsx("span",{children:"View Full Profile"})]})]})]}),is=({isOpen:r,onClose:a,role:t,members:l,category:n,onSendGroupMessage:o})=>{const[d,x]=s.useState(""),[h,u]=s.useState(!1),[p,j]=s.useState(!1),b=l.filter(e=>e.phone);return e.jsx(K,{open:r,onOpenChange:a,children:e.jsxs(W,{className:"bg-gray-900 border-gray-700 text-white max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Z,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(g,{size:20}),"Contact All ",t," (",l.length,")"]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[o&&e.jsxs(c,{variant:"outline",className:"flex-1",disabled:!l.length,children:[e.jsx(A,{size:16,className:"mr-2 text-blue-400"}),"Group Message"]}),b.length>0&&e.jsxs(c,{variant:"outline",className:"flex-1",onClick:()=>{alert(`Calling ${b.length} members with phone numbers`)},children:[e.jsx(Se,{size:16,className:"mr-2 text-green-400"}),"Call All (",b.length,")"]}),e.jsxs(c,{variant:"outline",className:"flex-1",onClick:()=>{const e=l.map(e=>e.email).join(",");window.location.href=`mailto:${e}`},children:[e.jsx(Ae,{size:16,className:"mr-2 text-purple-400"}),"Email All"]})]}),o&&e.jsxs("div",{className:"space-y-3 border-t border-gray-700 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Send Message to All ",t]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:e=>u(e.target.checked),className:"rounded border-gray-600 bg-gray-800 text-red-600 focus:ring-red-500"}),e.jsx(m,{size:14,className:h?"text-red-400":"text-gray-400"}),e.jsx("span",{className:h?"text-red-400":"text-gray-400",children:"Mark as Urgent"})]})]}),e.jsx(Me,{value:d,onChange:e=>x(e.target.value),placeholder:`Message for all ${t} members...${h?"\n\nâš ï¸ This will be marked as URGENT":""}`,className:"bg-gray-800 border-gray-600 text-white min-h-[120px]",disabled:p}),h&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-2",children:[e.jsx(m,{size:16}),"Urgent messages will send push notifications to all recipients"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:async()=>{if(d.trim()&&o){j(!0);try{await o(l.map(e=>e.id),d.trim(),h),x(""),u(!1),a()}catch(e){}finally{j(!1)}}},disabled:!d.trim()||p,className:"flex-1 "+(h?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),children:p?e.jsx(e.Fragment,{children:"Sending..."}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:16,className:"mr-2"}),"Send to ",l.length," Member",1!==l.length?"s":""]})}),e.jsx(c,{onClick:()=>{x(""),u(!1)},variant:"outline",disabled:p,children:"Clear"})]})]}),e.jsxs("div",{className:"space-y-3 border-t border-gray-700 pt-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-400",children:["All ",t," Members:"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:l.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(de,{className:"w-10 h-10 flex-shrink-0",children:[e.jsx(ce,{src:s.avatar,alt:s.name}),e.jsx(me,{className:"bg-muted text-muted-foreground text-xs font-semibold",children:S(s.name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.email}),s.phone&&e.jsx("p",{className:"text-xs text-gray-500",children:s.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.phone&&e.jsx("a",{href:`tel:${s.phone}`,className:"p-2 hover:bg-white/10 rounded transition-colors",title:"Call",children:e.jsx(Se,{size:16,className:"text-green-400"})}),e.jsx("a",{href:`mailto:${s.email}`,className:"p-2 hover:bg-white/10 rounded transition-colors",title:"Email",children:e.jsx(Ae,{size:16,className:"text-purple-400"})})]})]},s.id))})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-700",children:e.jsxs(c,{onClick:a,variant:"outline",children:[e.jsx(i,{size:16,className:"mr-2"}),"Close"]})})]})})},ns=({tripId:a,tripCreatorId:t})=>{const{admins:l,isLoading:n,isProcessing:u,promoteToAdmin:g,demoteFromAdmin:p}=(({tripId:e,enabled:r=!0})=>{const{isDemoMode:a}=d(),{user:t}=o(),[l,i]=s.useState([]),[n,c]=s.useState(!0),[m,u]=s.useState(!1),g=s.useCallback(async()=>{var s;if(r&&e)try{if(c(!0),a&&(null==t?void 0:t.id))return i([{id:`mock-admin-${e}`,trip_id:e,user_id:t.id,granted_by:t.id,granted_at:(new Date).toISOString(),permissions:{can_manage_roles:!0,can_manage_channels:!0,can_designate_admins:!0},profile:{display_name:(null==(s=t.email)?void 0:s.split("@")[0])||"Demo User",avatar_url:void 0,email:t.email}}]),void c(!1);const{data:r,error:l}=await x.from("trip_admins").select("*").eq("trip_id",e).order("granted_at",{ascending:!0});if(l)throw l;const n=await Promise.all((r||[]).map(async e=>{const{data:s}=await x.from("profiles").select("display_name, avatar_url, email").eq("user_id",e.user_id).single();return{...e,profile:s||void 0}}));i(n)}catch(l){h.error("Failed to load admins")}finally{c(!1)}else c(!1)},[e,r,a,null==t?void 0:t.id,null==t?void 0:t.email]);return s.useEffect(()=>{g()},[g]),s.useEffect(()=>{if(!r||!e||a)return;const s=x.channel(`trip_admins:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"trip_admins",filter:`trip_id=eq.${e}`},()=>{g()}).subscribe();return()=>{x.removeChannel(s)}},[e,r,a,g]),{admins:l,isLoading:n,isProcessing:m,promoteToAdmin:s.useCallback(async s=>{u(!0);try{if(a)return h.success("âœ… User promoted to admin"),{success:!0,message:"User promoted"};const{data:r,error:t}=await x.rpc("promote_to_admin",{_trip_id:e,_target_user_id:s});if(t)throw t;const l=r;if(!l.success)throw new Error(l.message);return h.success("âœ… User promoted to admin"),await g(),l}catch(r){throw h.error(r instanceof Error?r.message:"Failed to promote user"),r}finally{u(!1)}},[e,g,a]),demoteFromAdmin:s.useCallback(async s=>{u(!0);try{if(a)return h.success("User demoted from admin"),{success:!0,message:"User demoted"};const{data:r,error:t}=await x.rpc("demote_from_admin",{_trip_id:e,_target_user_id:s});if(t)throw t;const l=r;if(!l.success)throw new Error(l.message);return h.success("User demoted from admin"),await g(),l}catch(r){throw h.error(r instanceof Error?r.message:"Failed to demote user"),r}finally{u(!1)}},[e,g,a]),refetch:g}})({tripId:a}),[j,b]=s.useState([]),[f,v]=s.useState(""),[y,N]=s.useState(!1),[w,C]=s.useState(null),[_,k]=s.useState(null);r.useEffect(()=>{a&&l.length>0&&(async()=>{N(!0);try{const{data:e}=await x.from("trip_members").select("\n            user_id,\n            profiles:user_id(display_name, avatar_url, email)\n          ").eq("trip_id",a),s=l.map(e=>e.user_id),r=(e||[]).filter(e=>!s.includes(e.user_id));b(r)}catch(e){}finally{N(!1)}})()},[a,l]);return n?e.jsx(ze,{className:"p-6 bg-background/40 backdrop-blur-sm border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading admins..."})]})}):e.jsxs(ze,{className:"p-6 bg-background/40 backdrop-blur-sm border-white/10",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"font-semibold text-foreground",children:"Admin Management"}),e.jsx("span",{className:"text-xs bg-blue-500/20 text-blue-500 px-2 py-0.5 rounded-full",children:l.length})]})}),e.jsx("div",{className:"space-y-3 mb-6",children:l.map(s=>{var r,a,l,n,o,d,m,x,h;const g=s.user_id===t;return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-full bg-white/5 border border-white/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(de,{className:"h-10 w-10 border-2 border-white/10",children:[e.jsx(ce,{src:null==(r=s.profile)?void 0:r.avatar_url}),e.jsx(me,{className:"bg-blue-500/20 text-blue-500 text-sm",children:(null==(n=null==(l=null==(a=s.profile)?void 0:a.display_name)?void 0:l[0])?void 0:n.toUpperCase())||(null==(m=null==(d=null==(o=s.profile)?void 0:o.email)?void 0:d[0])?void 0:m.toUpperCase())||"A"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-foreground text-sm",children:(null==(x=s.profile)?void 0:x.display_name)||(null==(h=s.profile)?void 0:h.email)||"Unknown User"}),g&&e.jsx($,{className:"w-4 h-4 text-yellow-500"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:g?"Trip Creator":"Admin"})]})]}),!g&&e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>{var e,r;return k({userId:s.user_id,userName:(null==(e=s.profile)?void 0:e.display_name)||(null==(r=s.profile)?void 0:r.email)||"Unknown User",isCreator:!1})},disabled:u,className:"rounded-full border-white/20 hover:bg-red-500/10 hover:border-red-500/50 hover:text-red-500 h-9 px-4",children:[e.jsx(i,{className:"w-4 h-4 mr-1"}),"Remove"]})]},s.id)})}),e.jsxs("div",{className:"pt-6 border-t border-white/10",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Promote Member to Admin"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(re,{value:f,onValueChange:v,disabled:y||0===j.length,children:[e.jsx(ae,{className:"flex-1 rounded-full bg-white/5 border-white/10",children:e.jsx(te,{placeholder:y?"Loading members...":0===j.length?"All members are admins":"Select a member"})}),e.jsx(le,{children:j.map(s=>{var r,a;return e.jsx(ie,{value:s.user_id,children:(null==(r=s.profiles)?void 0:r.display_name)||(null==(a=s.profiles)?void 0:a.email)||"Unknown User"},s.user_id)})})]}),e.jsxs(c,{onClick:()=>{var e,s;const r=j.find(e=>e.user_id===f);r&&C({userId:f,userName:(null==(e=r.profiles)?void 0:e.display_name)||(null==(s=r.profiles)?void 0:s.email)||"Unknown User"})},disabled:!f||u,className:"rounded-full bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Promote"]})]})]}),e.jsx(M,{open:!!w,onOpenChange:e=>!e&&C(null),children:e.jsxs(z,{className:"bg-background/95 backdrop-blur-xl border-white/10",children:[e.jsxs(I,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-500"}),"Promote to Admin?"]}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("p",{className:"text-foreground",children:["You're about to promote ",e.jsx("strong",{className:"text-blue-500",children:null==w?void 0:w.userName})," to admin."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"They will gain these privileges:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Manage roles and role assignments"}),e.jsx("li",{children:"Create and configure channels"}),e.jsx("li",{children:"Access admin dashboard"}),e.jsx("li",{children:"View all trip management settings"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/20",children:[e.jsx(m,{className:"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-yellow-500",children:[e.jsx("strong",{children:"Note:"})," Admin permissions can only be revoked by the trip creator or other admins with designation rights."]})]})]})]}),e.jsxs(O,{children:[e.jsx(q,{disabled:u,children:"Cancel"}),e.jsx(U,{onClick:async()=>{if(w)try{await g(w.userId),v("")}finally{C(null)}},disabled:u,className:"bg-blue-600 hover:bg-blue-700",children:u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Promoting..."]}):"Confirm Promotion"})]})]})}),e.jsx(M,{open:!!_,onOpenChange:e=>!e&&k(null),children:e.jsxs(z,{className:"bg-background/95 backdrop-blur-xl border-white/10",children:[e.jsxs(I,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-destructive"}),"Remove Admin Privileges?"]}),e.jsx(P,{className:"space-y-3",children:(null==_?void 0:_.isCreator)?e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:[e.jsx(m,{className:"w-4 h-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-red-500",children:[e.jsx("strong",{children:"Cannot remove trip creator:"})," The trip creator cannot be demoted from admin. This protection ensures the trip always has a primary administrator."]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-foreground",children:["You're about to remove admin privileges from ",e.jsx("strong",{className:"text-destructive",children:null==_?void 0:_.userName}),"."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"They will lose access to:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Role and channel management"}),e.jsx("li",{children:"Role assignment capabilities"}),e.jsx("li",{children:"Admin dashboard access"}),e.jsx("li",{children:"Trip management settings"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-blue-500/10 border border-blue-500/20",children:[e.jsx(Ie,{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-blue-500",children:"They will remain a trip member with their current role permissions."})]})]})})]}),e.jsxs(O,{children:[e.jsx(q,{disabled:u,children:"Cancel"}),!(null==_?void 0:_.isCreator)&&e.jsx(U,{onClick:async()=>{if(_&&!_.isCreator)try{await p(_.userId)}finally{k(null)}},disabled:u,className:"bg-destructive hover:bg-destructive/90",children:u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Removing..."]}):"Remove Admin"})]})]})})]})},os=({open:s,onOpenChange:r,tripId:a,tripCreatorId:t})=>e.jsx(K,{open:s,onOpenChange:r,children:e.jsxs(W,{className:"max-w-2xl max-h-[80vh] overflow-y-auto bg-gray-900/95 backdrop-blur-md border-white/20",children:[e.jsx(Z,{children:e.jsxs(X,{className:"text-white flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-400"}),"Manage Administrators"]})}),e.jsx(ns,{tripId:a,tripCreatorId:t})]})}),ds=({tripId:r})=>{const{requests:a,isLoading:t,isProcessing:l,approveRequest:i,rejectRequest:n}=y({tripId:r}),[o,d]=s.useState(null);return t?e.jsx(ze,{className:"p-6 bg-background/40 backdrop-blur-sm border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading requests..."})]})}):0===a.length?e.jsx(ze,{className:"p-6 bg-background/40 backdrop-blur-sm border-white/10",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Te,{className:"w-12 h-12 text-green-500 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending requests ðŸŽ‰"})]})}):e.jsxs(ze,{className:"p-6 bg-background/40 backdrop-blur-sm border-white/10",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-orange-500"}),e.jsx("h3",{className:"font-semibold text-foreground",children:"Pending Join Requests"}),e.jsx("span",{className:"text-xs bg-orange-500/20 text-orange-500 px-2 py-0.5 rounded-full",children:a.length})]})}),e.jsx("div",{className:"space-y-3",children:a.map(s=>{var r,a,t,i,n,o,m,x,h;return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-full bg-white/5 border border-white/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(de,{className:"h-10 w-10 border-2 border-white/10",children:[e.jsx(ce,{src:null==(r=s.profile)?void 0:r.avatar_url}),e.jsx(me,{className:"bg-orange-500/20 text-orange-500 text-sm",children:(null==(i=null==(t=null==(a=s.profile)?void 0:a.display_name)?void 0:t[0])?void 0:i.toUpperCase())||(null==(m=null==(o=null==(n=s.profile)?void 0:n.email)?void 0:o[0])?void 0:m.toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-foreground text-sm",children:(null==(x=s.profile)?void 0:x.display_name)||(null==(h=s.profile)?void 0:h.email)||"Unknown User"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Requested ",Oe(new Date(s.requested_at),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{size:"sm",variant:"default",onClick:()=>{var e,r,a,t;return a=s.id,t=(null==(e=s.profile)?void 0:e.display_name)||(null==(r=s.profile)?void 0:r.email)||"this user",void d({type:"approve",requestId:a,userName:t})},disabled:l,className:"bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(Te,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(c,{size:"sm",variant:"destructive",onClick:()=>{var e,r,a,t;return a=s.id,t=(null==(e=s.profile)?void 0:e.display_name)||(null==(r=s.profile)?void 0:r.email)||"this user",void d({type:"reject",requestId:a,userName:t})},disabled:l,children:[e.jsx(He,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]},s.id)})}),e.jsx(M,{open:!!o,onOpenChange:()=>d(null),children:e.jsxs(z,{className:"bg-background/95 backdrop-blur-xl border-white/10",children:[e.jsxs(I,{children:[e.jsx(T,{className:"flex items-center gap-2",children:"approve"===(null==o?void 0:o.type)?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-5 h-5 text-green-500"}),"Approve Join Request?"]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-5 h-5 text-destructive"}),"Reject Join Request?"]})}),e.jsx(P,{className:"text-muted-foreground",children:"approve"===(null==o?void 0:o.type)?e.jsxs(e.Fragment,{children:["You're about to approve ",e.jsx("strong",{children:o.userName})," to join this trip. They will be added as a member and can access all trip content based on their assigned role."]}):e.jsxs(e.Fragment,{children:["You're about to reject ",e.jsx("strong",{children:null==o?void 0:o.userName}),"'s request to join this trip. They will be notified that their request was not approved."]})})]}),e.jsxs(O,{children:[e.jsx(q,{disabled:l,children:"Cancel"}),e.jsx(U,{onClick:async()=>{if(o)try{"approve"===o.type?await i(o.requestId):await n(o.requestId)}finally{d(null)}},disabled:l,className:"approve"===(null==o?void 0:o.type)?"bg-green-500 hover:bg-green-600 text-white":"bg-destructive hover:bg-destructive/90",children:l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):"approve"===(null==o?void 0:o.type)?"Approve Request":"Reject Request"})]})]})})]})},cs=({open:s,onOpenChange:r,tripId:a})=>e.jsx(K,{open:s,onOpenChange:r,children:e.jsxs(W,{className:"max-w-2xl max-h-[80vh] overflow-y-auto bg-gray-900/95 backdrop-blur-md border-white/20",children:[e.jsx(Z,{children:e.jsxs(X,{className:"text-white flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-orange-400"}),"Join Requests"]})}),e.jsx(ds,{tripId:a})]})}),ms=({roster:r,userRole:a,isReadOnly:t=!1,category:l,onUpdateMemberRole:i,canManageRoles:n=!1,onCreateRole:o,isLoadingRoles:x=!1,adminLoading:h=!1,tripId:u,tripCreatorId:p,trip:b,availableRoles:v=[]})=>{const{isDemoMode:y}=d(),{isSuperAdmin:N}=j(),[w,C]=s.useState("all"),[_,k]=s.useState(null),[R,A]=s.useState(!0),[M,z]=s.useState(!1),[I,T]=s.useState(null),[P,O]=s.useState(""),[q,U]=s.useState(!1),[F,L]=s.useState(!1),[D,E]=s.useState(!1),$=!N&&t,{terminology:{teamLabel:B}}=f(l),J=v.length>0?["all",...v.map(e=>e.roleName)]:["all",...rs(r)],Y=rs(r),H=r.some(e=>!e.role||""===e.role||"Member"===e.role||"Participant"===e.role),G="all"===w?r:r.filter(e=>e.role===w),K=()=>{P.trim()&&(O(""),U(!1),alert(`Role "${P}" created! You can now assign this role to team members.`))},W=N||"admin"===a||"tour manager"===a||"manager"===a;return e.jsxs("div",{className:"space-y-6",children:[R&&H&&!$&&e.jsx(ss,{hasUnassignedRoles:H,onAssignRoles:()=>{const e=r.find(e=>!e.role||""===e.role||"Member"===e.role||"Participant"===e.role);e&&k(e),A(!1)},onDismiss:()=>A(!1)}),$&&!y&&!N&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:e.jsx("p",{className:"text-yellow-400 text-sm",children:"Read-only access for your role"})}),e.jsxs("div",{className:"bg-gradient-to-br from-white/5 via-white/3 to-transparent backdrop-blur-sm border border-gray-700/50 rounded-xl p-3 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"text-red-400",size:20}),e.jsx("h2",{className:"text-lg font-bold text-white",children:B}),e.jsxs("span",{className:"text-gray-400 text-sm",children:[r.length," members"]})]}),(n||N)&&!$&&e.jsx("span",{className:"text-xs text-gray-500",children:"Admin Access"})]}),(n||N)&&!$&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsxs(c,{onClick:o,disabled:h||x,variant:"outline",size:"sm",className:"rounded-full bg-black/40 hover:bg-black/60 text-white border-white/20",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Create Role"]}),e.jsxs(c,{onClick:()=>z(!0),variant:"outline",size:"sm",disabled:0===r.length,className:"rounded-full bg-black/40 hover:bg-black/60 text-white border-white/20",title:"Assign roles to multiple members",children:[e.jsx(Ge,{size:16,className:"mr-2"}),"Assign Roles"]}),e.jsxs(c,{onClick:()=>L(!0),variant:"outline",size:"sm",className:"rounded-full bg-black/40 hover:bg-black/60 text-white border-white/20",title:"Manage trip administrators",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Admins"]}),e.jsxs(c,{onClick:()=>E(!0),variant:"outline",size:"sm",className:"rounded-full bg-black/40 hover:bg-black/60 text-white border-white/20",title:"View join requests",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Requests"]})]}),q&&W&&!$&&e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-purple-300 font-medium mb-3 text-sm",children:"Create New Role"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{type:"text",placeholder:"Enter role name (e.g., 'Stage Manager', 'Chef')",value:P,onChange:e=>O(e.target.value),onKeyDown:e=>{"Enter"===e.key&&K()},className:"flex-1 bg-gray-800 border-gray-600 text-white placeholder:text-gray-500"}),e.jsx(c,{onClick:K,disabled:!P.trim(),className:"bg-purple-600 hover:bg-purple-700 text-white",children:"Create"}),e.jsx(c,{onClick:()=>{U(!1),O("")},variant:"outline",className:"border-gray-600 hover:bg-white/10",children:"Cancel"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Once created, you can assign this role to team members using the edit button on their profile."})]}),(v.length>0||Y.length>0)&&e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex flex-wrap gap-2 justify-center items-center max-w-5xl",children:J.map(s=>{const a=r.filter(e=>e.role===s);return"all"===s||v.some(e=>e.roleName===s)||a.length>0?e.jsxs("button",{onClick:()=>C(s),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 "+(w===s?"bg-red-600 text-white shadow-lg shadow-red-600/30 scale-105":"bg-gray-700/50 text-gray-300 hover:bg-gray-600/50 hover:scale-102 border border-gray-600"),children:["all"===s?"All":s,"all"!==s&&e.jsx("span",{className:"ml-1 text-xs opacity-75",children:a.length})]},s):null})})}),0===v.length&&e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-blue-400 text-sm",children:["Team members can have custom titles entered manually. ",W&&'Use the "Create Role" button above to add new roles.']})})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-3",children:G.map(s=>e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-gray-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsxs(de,{className:"w-10 h-10 border-2 border-gray-600 flex-shrink-0",children:[e.jsx(ce,{src:s.avatar,alt:s.name}),e.jsx(me,{className:"bg-muted text-muted-foreground text-xs font-semibold",children:S(s.name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ls,{member:s,children:e.jsx("h3",{className:"text-white text-sm font-medium truncate cursor-pointer hover:text-blue-400 transition-colors leading-tight",children:s.name})}),e.jsx("p",{className:"text-gray-400 text-xs truncate leading-tight",children:s.email}),s.phone&&e.jsx("p",{className:"text-gray-500 text-xs truncate leading-tight",children:s.phone}),e.jsx("div",{className:"flex items-center gap-1.5 mt-1.5",children:e.jsx("span",{className:`${as(s.role,l)} px-1.5 py-0.5 rounded text-xs font-medium`,children:s.role})})]}),(W||N)&&!$&&i&&e.jsx("button",{onClick:()=>(e=>{!$&&i&&k(e)})(s),className:"text-gray-400 hover:text-white transition-colors p-1 rounded hover:bg-white/10 flex-shrink-0",title:"Edit role",children:e.jsx(he,{size:14})})]}),s.medicalNotes&&e.jsxs("div",{className:"mt-2 p-1.5 bg-yellow-500/10 border border-yellow-500/20 rounded flex items-center gap-1.5",children:[e.jsx(m,{size:12,className:"text-yellow-400 flex-shrink-0"}),e.jsx("span",{className:"text-yellow-400 text-xs font-medium",children:"Medical Alert"})]}),s.dietaryRestrictions&&s.dietaryRestrictions.length>0&&e.jsx("div",{className:"mt-1.5",children:e.jsxs("p",{className:"text-gray-400 text-xs leading-tight",children:["Dietary: ",s.dietaryRestrictions.join(", ")]})})]},s.id))}),0===G.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{size:48,className:"text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No team members found for the selected role."})]}),e.jsx(es,{isOpen:!!_,onClose:()=>k(null),member:_,category:l,existingRoles:Y,availableRoles:v,onUpdateRole:async(e,s)=>{i&&await i(e,s)}}),i&&e.jsx(ts,{isOpen:M,onClose:()=>z(!1),roster:r,category:l,existingRoles:Y,availableRoles:v,onUpdateMemberRole:i}),I&&e.jsx(is,{isOpen:!0,onClose:()=>T(null),role:I.role,members:I.members,category:l}),u&&p&&e.jsxs(e.Fragment,{children:[e.jsx(os,{open:F,onOpenChange:L,tripId:u,tripCreatorId:p}),e.jsx(cs,{open:D,onOpenChange:E,tripId:u})]})]})},xs=({open:r,onOpenChange:a,tripId:t,currentRoleCount:l,onRoleCreated:i})=>{const{toast:n}=u(),{createRole:m,isProcessing:p}=(({tripId:e,enabled:r=!0})=>{const{isDemoMode:a}=d(),{user:t}=o(),[l,i]=s.useState([]),[n,c]=s.useState(!0),[m,u]=s.useState(!1),g=s.useCallback(async()=>{if(r&&e)try{if(c(!0),a){const s=N.getRolesForTrip(e);return i(s||[]),void c(!1)}const{data:s,error:r}=await x.from("trip_roles").select("\n          *,\n          trip_channels:trip_channels!required_role_id(\n            id,\n            channel_name,\n            is_archived\n          )\n        ").eq("trip_id",e).order("created_at",{ascending:!0});if(r)throw r;const t=await Promise.all((s||[]).map(async s=>{const{count:r}=await x.from("user_trip_roles").select("*",{count:"exact",head:!0}).eq("trip_id",e).eq("role_id",s.id);return{id:s.id,tripId:s.trip_id,roleName:s.role_name,description:s.description||"",permissionLevel:s.permission_level,featurePermissions:s.feature_permissions,createdBy:s.created_by,createdAt:s.created_at,updatedAt:s.updated_at,memberCount:r||0,channels:s.trip_channels||[]}}));i(t)}catch(s){h.error("Failed to load roles")}finally{c(!1)}else c(!1)},[e,r,a]);return s.useEffect(()=>{g()},[g]),s.useEffect(()=>{if(!r||!e||a)return;const s=x.channel(`trip_roles:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"trip_roles",filter:`trip_id=eq.${e}`},()=>{g()}).subscribe();return()=>{x.removeChannel(s)}},[e,r,a,g]),{roles:l,isLoading:n,isProcessing:m,createRole:s.useCallback(async(s,r="edit",l)=>{u(!0);try{if(a){const a=N.getRolesForTrip(e)||[],i={id:`mock-role-${e}-${Date.now()}`,tripId:e,roleName:s,description:"",permissionLevel:r,featurePermissions:l,createdBy:(null==t?void 0:t.id)||"demo-user",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),memberCount:0},n=[...a,i];return localStorage.setItem("demo_pro_trip_roles",JSON.stringify({...JSON.parse(localStorage.getItem("demo_pro_trip_roles")||"{}"),[e]:n})),h.success("âœ… Role created successfully"),await g(),{success:!0,message:"Role created",role_id:i.id}}const{data:i,error:n}=await x.rpc("create_trip_role",{_trip_id:e,_role_name:s,_permission_level:r,_feature_permissions:l||null});if(n)throw n;const o=i;if(!o.success)throw new Error(o.message);return h.success("âœ… Role created successfully"),await g(),o}catch(i){throw h.error(i instanceof Error?i.message:"Failed to create role"),i}finally{u(!1)}},[e,g,a,null==t?void 0:t.id]),deleteRole:s.useCallback(async s=>{u(!0);try{if(a){const r=(N.getRolesForTrip(e)||[]).filter(e=>e.id!==s);return localStorage.setItem("demo_pro_trip_roles",JSON.stringify({...JSON.parse(localStorage.getItem("demo_pro_trip_roles")||"{}"),[e]:r})),h.success("Role deleted successfully"),await g(),{success:!0,message:"Role deleted"}}const{data:r,error:t}=await x.rpc("delete_trip_role",{_role_id:s});if(t)throw t;const l=r;if(!l.success)throw new Error(l.message);return h.success("Role deleted successfully"),await g(),l}catch(r){throw h.error(r instanceof Error?r.message:"Failed to delete role"),r}finally{u(!1)}},[a,e,g]),refetch:g}})({tripId:t,enabled:!!t}),[j,b]=s.useState(""),[f,v]=s.useState(""),[y,w]=s.useState("edit"),[C,_]=s.useState(!0);return e.jsx(K,{open:r,onOpenChange:a,children:e.jsxs(W,{className:"sm:max-w-[500px]",children:[e.jsxs(Z,{children:[e.jsx(X,{children:"Create New Role"}),e.jsxs(Q,{children:["Create a custom role for this trip (",l," / ",5," roles used)"]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),l>=5)return void n({title:"Role Limit Reached",description:"Maximum 5 roles allowed per trip for MVP",variant:"destructive"});const s=j.trim().replace(/\s+/g," ");const r=(e=>e&&e.trim()?e.length>50?{isValid:!1,error:"Role name must be 50 characters or less"}:/^[a-zA-Z0-9\s\-&.,()]+$/.test(e)?{isValid:!0}:{isValid:!1,error:"Role contains invalid characters"}:{isValid:!1,error:"Role cannot be empty"})(s);if(r.isValid)try{const e=((e,s)=>{const r="view"===e,a="admin"===e;return{media:{can_view:!0,can_upload:!r,can_delete_own:!r,can_delete_any:a},tasks:{can_view:!0,can_create:!r,can_assign:a,can_complete:!r,can_delete:a},calendar:{can_view:!0,can_create_events:!r,can_edit_events:a,can_delete_events:a},channels:{can_view:!0,can_post:!r,can_edit_messages:a,can_delete_messages:a,can_manage_members:a,has_channel:s},payments:{can_view:!0,can_create:a,can_approve:a}}})(y,C);await m(s,y,e),n({title:"Role Created",description:`Successfully created "${s}" role`}),b(""),v(""),w("edit"),_(!0),a(!1),i()}catch(t){n({title:"Failed to Create Role",description:t instanceof Error?t.message:"An error occurred",variant:"destructive"})}else n({title:"Invalid Role Name",description:r.error,variant:"destructive"})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"roleName",children:"Role Name *"}),e.jsx(ee,{id:"roleName",value:j,onChange:e=>b(e.target.value),placeholder:"e.g., Assistant Coach, Tour Manager",maxLength:50,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(Me,{id:"description",value:f,onChange:e=>v(e.target.value),placeholder:"Describe the responsibilities of this role...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"permissionLevel",children:"Permission Level *"}),e.jsxs(re,{value:y,onValueChange:e=>w(e),children:[e.jsx(ae,{id:"permissionLevel",children:e.jsx(te,{})}),e.jsxs(le,{children:[e.jsx(ie,{value:"admin",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-red-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Admin"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Full control over all features"})]})]})}),e.jsx(ie,{value:"edit",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Edit"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Can create and modify content"})]})]})}),e.jsx(ie,{value:"view",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"View"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Read-only access"})]})]})})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(qe,{id:"createChannel",checked:C,onCheckedChange:e=>_(e)}),e.jsx(se,{htmlFor:"createChannel",className:"text-sm font-normal cursor-pointer",children:"Create a dedicated channel for this role"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:p,children:"Cancel"}),e.jsx(c,{type:"submit",disabled:p,children:p?"Creating...":"Create Role"})]})]})]})})},hs=({open:r,onOpenChange:a,tripId:t,members:l,roles:i,onRoleAssigned:n})=>{const{toast:m}=u(),{assignRole:p,isProcessing:j}=(({tripId:e,enabled:r=!0})=>{const{isDemoMode:a}=d(),{user:t}=o(),[l,i]=s.useState([]),[n,c]=s.useState(!0),[m,u]=s.useState(!1),g=s.useCallback(async()=>{if(r&&e)try{if(c(!0),a){const s=localStorage.getItem("demo_pro_trip_assignments"),r=s?JSON.parse(s):{};return i(r[e]||[]),void c(!1)}const{data:s,error:r}=await x.from("user_trip_roles").select("*").eq("trip_id",e).order("assigned_at",{ascending:!0});if(r)throw r;const t=await Promise.all((s||[]).map(async e=>{const[s,r]=await Promise.all([x.from("profiles").select("display_name, avatar_url, email").eq("user_id",e.user_id).single(),x.from("trip_roles").select("id, role_name, permission_level").eq("id",e.role_id).single()]);return{...e,user_profile:s.data||void 0,role:r.data?{id:r.data.id,roleName:r.data.role_name,permissionLevel:r.data.permission_level}:void 0}}));i(t)}catch(s){h.error("Failed to load role assignments")}finally{c(!1)}else c(!1)},[e,r,a]);return s.useEffect(()=>{g()},[g]),s.useEffect(()=>{if(!r||!e||a)return;const s=x.channel(`user_trip_roles:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"user_trip_roles",filter:`trip_id=eq.${e}`},()=>{g()}).subscribe();return()=>{x.removeChannel(s)}},[e,r,a,g]),{assignments:l,isLoading:n,isProcessing:m,assignRole:s.useCallback(async(s,r)=>{u(!0);try{if(a){const a=localStorage.getItem("demo_pro_trip_assignments"),l=a?JSON.parse(a):{},i=l[e]||[],n={id:`mock-assignment-${Date.now()}`,trip_id:e,user_id:s,role_id:r,is_primary:!0,assigned_at:(new Date).toISOString(),assigned_by:null==t?void 0:t.id};return l[e]=[...i,n],localStorage.setItem("demo_pro_trip_assignments",JSON.stringify(l)),h.success("âœ… Role assigned successfully"),await g(),{success:!0,message:"Role assigned"}}const{data:l,error:i}=await x.rpc("assign_trip_role",{_trip_id:e,_user_id:s,_role_id:r,_set_as_primary:!1});if(i)throw i;const n=l;if(!n.success)throw new Error(n.message);return h.success("âœ… Role assigned successfully"),await g(),n}catch(l){throw h.error(l instanceof Error?l.message:"Failed to assign role"),l}finally{u(!1)}},[e,g,a,null==t?void 0:t.id]),removeRole:s.useCallback(async(s,r)=>{u(!0);try{if(a){const a=localStorage.getItem("demo_pro_trip_assignments"),t=a?JSON.parse(a):{},l=t[e]||[];return t[e]=l.filter(e=>!(e.user_id===s&&e.role_id===r)),localStorage.setItem("demo_pro_trip_assignments",JSON.stringify(t)),h.success("Role removed successfully"),await g(),{success:!0,message:"Role removed"}}const{data:t,error:l}=await x.rpc("remove_user_from_role",{_trip_id:e,_user_id:s,_role_id:r});if(l)throw l;const i=t;if(!i.success)throw new Error(i.message);return h.success("Role removed successfully"),await g(),i}catch(t){throw h.error(t instanceof Error?t.message:"Failed to remove role"),t}finally{u(!1)}},[e,g,a]),refetch:g}})({tripId:t,enabled:!!t}),[b,f]=s.useState(""),[v,y]=s.useState([]);return e.jsx(K,{open:r,onOpenChange:a,children:e.jsxs(W,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(X,{children:"Assign Role to Members"}),e.jsx(Q,{children:"Select members and assign them a role"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),b&&0!==v.length)try{for(const e of v)await p(e,b);m({title:"Roles Assigned",description:`Successfully assigned role to ${v.length} member(s)`}),f(""),y([]),a(!1),n()}catch(s){m({title:"Failed to Assign Roles",description:s instanceof Error?s.message:"An error occurred",variant:"destructive"})}else m({title:"Missing Selection",description:"Please select a role and at least one member",variant:"destructive"})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"role",children:"Role *"}),e.jsxs(re,{value:b,onValueChange:f,children:[e.jsx(ae,{id:"role",children:e.jsx(te,{placeholder:"Select a role..."})}),e.jsx(le,{children:i.map(s=>e.jsx(ie,{value:s.id,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.roleName}),s.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description})]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(se,{children:"Select Members *"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>{v.length===l.length?y([]):y(l.map(e=>e.id))},children:v.length===l.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"border rounded-lg max-h-[300px] overflow-y-auto",children:0===l.length?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(g,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No members to assign"})]}):e.jsx("div",{className:"divide-y",children:l.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-accent/50 cursor-pointer",children:[e.jsx(qe,{checked:v.includes(s.id),onCheckedChange:()=>{return e=s.id,void y(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.role&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Current role: ",s.role]})]})]},s.id))})}),v.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[v.length," member(s) selected"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:j,children:"Cancel"}),e.jsxs(c,{type:"submit",disabled:j||0===v.length,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),j?"Assigning...":`Assign to ${v.length} Member(s)`]})]})]})]})})},us=({roster:r,userRole:a,isReadOnly:t=!1,category:l,tripId:i,onUpdateMemberRole:n,trip:o,tripCreatorId:c})=>{const{isAdmin:m,hasPermission:h,isLoading:u}=Fe(i||""),{isDemoMode:g}=d(),{isSuperAdmin:p}=j(),[b,f]=s.useState([]),[v,y]=s.useState(!0),[N,w]=s.useState(!1),[C,_]=s.useState(!1),k=!p&&t,R=async()=>{if(i){y(!0);try{const{data:e,error:s}=await x.from("trip_roles").select("*").eq("trip_id",i).order("created_at",{ascending:!0});if(s)throw s;const r=(e||[]).map(e=>({id:e.id,tripId:e.trip_id,roleName:e.role_name,description:e.description||void 0,permissionLevel:e.permission_level,featurePermissions:e.feature_permissions,createdBy:e.created_by,createdAt:e.created_at,updatedAt:e.updated_at}));f(r)}catch(e){}finally{y(!1)}}};s.useEffect(()=>{R()},[i]);const S=p||m&&h("can_manage_roles")||g;return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(ms,{roster:r,userRole:p?"admin":a,isReadOnly:k,category:l,onUpdateMemberRole:n,canManageRoles:S,onCreateRole:()=>w(!0),isLoadingRoles:v,adminLoading:u,tripId:i,tripCreatorId:c,trip:o,availableRoles:b}),i&&e.jsxs(e.Fragment,{children:[e.jsx(xs,{open:N,onOpenChange:w,tripId:i,currentRoleCount:b.length,onRoleCreated:()=>{R()}}),e.jsx(hs,{open:C,onOpenChange:_,tripId:i,members:r,roles:b,onRoleAssigned:()=>{R()}})]})]})},gs=({activeTab:s,tripId:r,basecamp:a,tripData:t,category:l,onUpdateRoomAssignments:i,onUpdateMemberRole:n,trip:c,tripCreatorId:m})=>{const{user:x}=o(),{isDemoMode:h}=d(),{isSuperAdmin:u}=j(),g=(null==x?void 0:x.proRole)||"staff",p=(null==x?void 0:x.permissions)||["read"];if(!u&&!((e,s,r)=>{const a=Ze.find(s=>s.id===e);return!!a&&(!a.restrictedRoles||!a.restrictedRoles.includes(s.toLowerCase()))&&(!(a.requiredPermissions&&a.requiredPermissions.length>0)||a.requiredPermissions.some(e=>r.includes(e)))})(s,g,p))return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-red-500/10 backdrop-blur-sm border border-red-500/20 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-red-400 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-300",children:"You don't have permission to access this section."}),e.jsxs("p",{className:"text-red-300/80 text-sm mt-2",children:["Current role: ",g]})]})});const b=!u&&Xe(s,g,p,h);return e.jsx("div",{className:"h-[calc(100vh-320px)] max-h-[1000px] min-h-[500px] overflow-y-auto flex flex-col",children:(()=>{switch(s){case"chat":return e.jsx(J,{featureName:"Trip Chat",children:e.jsx(k,{enableGroupChat:!0,showBroadcasts:!0,tripId:r,isPro:!0,userRole:g,participants:(t.participants||[]).map(e=>({id:String(e.id),name:e.name,role:e.role}))})});case"calendar":return e.jsx(J,{featureName:"Calendar & Events",children:e.jsx(Y,{tripId:r})});case"tasks":return e.jsx(J,{featureName:"Tasks & Todo",children:e.jsx(fe,{tripId:r})});case"polls":return e.jsx(J,{featureName:"Polls & Comments",children:e.jsx(_,{tripId:r})});case"media":return e.jsx(J,{featureName:"Media Hub",children:e.jsx(H,{tripId:r})});case"payments":return e.jsx(J,{featureName:"Payments & Expenses",children:e.jsx(G,{tripId:r})});case"places":return e.jsx(J,{featureName:"Places & Map",children:e.jsx(C,{})});case"team":return e.jsx(J,{featureName:"Team Management",children:e.jsx(us,{roster:t.roster||[],userRole:g,isReadOnly:b,category:l,tripId:r,onUpdateMemberRole:n,trip:c,tripCreatorId:m})});case"finance":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-gray-700 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Financial Management"}),b&&!h&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-yellow-400 text-sm",children:"Read-only access for your role"})}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{size:48,className:"text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"Per-diem & Settlement"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Per-diem automation and settlement tracking coming soon"})]})]})});case"medical":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-gray-700 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Medical & Wellness"}),b&&!h&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-yellow-400 text-sm",children:"Read-only access for your role"})}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{size:48,className:"text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"Health Monitoring"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Injury status tracking and compliance monitoring coming soon"})]})]})});case"compliance":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-gray-700 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Compliance Management"}),b&&!h&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-yellow-400 text-sm",children:"Read-only access for your role"})}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Be,{size:48,className:"text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"Regulatory Compliance"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Visa, union, and safety compliance tracking coming soon"})]})]})});case"sponsors":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-gray-700 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Sponsor Management"}),b&&!h&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-yellow-400 text-sm",children:"Read-only access for your role"})}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ve,{size:48,className:"text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"Partnership Tracking"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Activation checklists and deliverable tracking coming soon"})]})]})});case"ai-chat":return e.jsx(w,{tripId:r,basecamp:a});default:return e.jsx(B,{activeTab:"chat",onTabChange:()=>{},tripId:r})}})()})},ps=({category:r})=>{const{user:a,switchRole:l}=o(),i=f(r);return s.useEffect(()=>{if(!(null==a?void 0:a.isPro)||!a.proRole)return;const e=i.roles.map(e=>e.toLowerCase());e.includes(a.proRole)||l(e[0])},[r]),(null==a?void 0:a.isPro)?e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-gray-700 rounded-xl p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-2",children:["Roles - ",i.name]}),e.jsxs("p",{className:"text-gray-400 text-sm mb-4",children:["Current role: ",e.jsx("span",{className:"text-white font-medium",children:a.proRole})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.roles.map(s=>{const i=((e,s)=>{const r=e.toLowerCase();switch(s){case"Sports â€“ Pro, Collegiate, Youth":return r.includes("player")?Ee:r.includes("coach")?g:r.includes("medical")||r.includes("trainer")?$e:Ie;case"Tour â€“ Music, Comedy, etc.":return r.includes("artist")?Le:r.includes("manager")?g:r.includes("security")?t:r.includes("sound")||r.includes("production")?Ke:F;case"Business Travel":return r.includes("executive")?$:r.includes("manager")?g:De;case"School Trip":return r.includes("teacher")||r.includes("supervisor")?Je:r.includes("student")?g:Ie;case"Content":return r.includes("cast")||r.includes("talent")?Le:r.includes("producer")||r.includes("director")?F:Ke;case"Other":return r.includes("founder")?Ye:r.includes("mentor")?Je:g;default:return g}})(s,r),n=((e,s)=>{const r=e.toLowerCase();switch(s){case"Sports â€“ Pro, Collegiate, Youth":return r.includes("player")?"bg-green-500":r.includes("coach")?"bg-blue-500":r.includes("medical")?"bg-pink-500":"bg-gray-500";case"Tour â€“ Music, Comedy, etc.":return r.includes("artist")?"bg-yellow-500":r.includes("manager")?"bg-blue-500":r.includes("security")?"bg-purple-500":"bg-gray-500";case"Business Travel":return r.includes("executive")?"bg-red-500":"bg-blue-500";case"School Trip":return r.includes("teacher")?"bg-blue-500":r.includes("student")?"bg-green-500":"bg-gray-500";case"Content":return r.includes("cast")?"bg-yellow-500":r.includes("producer")?"bg-red-500":"bg-gray-500";case"Other":return r.includes("founder")?"bg-yellow-500":r.includes("mentor")?"bg-blue-500":"bg-gray-500";default:return"bg-gray-500"}})(s,r);return e.jsxs(c,{onClick:()=>l(s.toLowerCase()),variant:a.proRole===s.toLowerCase()?"default":"outline",size:"sm",className:"flex items-center gap-2 "+(a.proRole===s.toLowerCase()?`${n} text-white`:"bg-white/10 text-gray-300 hover:bg-white/20"),children:[e.jsx(i,{size:14}),s]},s)})})]}):null},js=({activeTab:r,onTabChange:a,onShowTripsPlusModal:t,tripId:l,basecamp:i,tripData:n,selectedCategory:d,onUpdateTripData:c,trip:m,tripCreatorId:x})=>{const[h,u]=s.useState(!1),{user:g}=o(),p=((e,s,r)=>{let a=Ze;if(r){const e=f(r);if(!e)return Ze;a=Ze.filter(s=>!s.proOnly||e.availableTabs.includes(s.id)||["chat","places","ai-chat","media","payments"].includes(s.id))}return a.filter(r=>(!r.restrictedRoles||!r.restrictedRoles.includes(e.toLowerCase()))&&!(r.requiredPermissions&&r.requiredPermissions.length>0&&!r.requiredPermissions.some(e=>s.includes(e))))})((null==g?void 0:g.proRole)||"staff",(null==g?void 0:g.permissions)||["read"],d),j=e=>{};return e.jsxs(e.Fragment,{children:[e.jsx(ps,{category:d}),e.jsx(Qe,{tabs:p,activeTab:r,onTabChange:a,category:d}),e.jsx(gs,{activeTab:r,tripId:l,basecamp:i,tripData:n,category:d,onUpdateRoomAssignments:j,onUpdateMemberRole:async(e,s)=>{var r;try{const a=(null==(r=n.roster)?void 0:r.map(r=>r.id===e?{...r,role:s}:r))||[];c&&c({roster:a})}catch(a){throw a}},trip:m,tripCreatorId:x}),e.jsx(We,{isOpen:h,onClose:()=>u(!1),roomAssignments:n.roomAssignments||[],roster:n.roster||[],onUpdateAssignments:j})]})};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{js as ProTripDetailContent};
