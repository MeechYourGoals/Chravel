import{r}from"./react-vendor-D1R0t5S0-mjd3dogn.js";import{u as t,d as e,s as a}from"./index-Ta7FH5xW-mjd3dogn.js";const n=()=>{const{user:n}=t(),{isDemoMode:o}=e(),[i,s]=r.useState([]),[c,d]=r.useState(null),[l,u]=r.useState([]),[m,g]=r.useState(!0);r.useEffect(()=>{if(o)return s([]),d(null),void g(!1);n&&f()},[n,o]);const f=async()=>{try{if(g(!0),o)return s([]),d(null),void g(!1);if(!n||!n.id)return s([]),d(null),void g(!1);const{data:r,error:t}=await a.from("organization_members").select("organization_id").eq("user_id",n.id).eq("status","active");if(t)throw t;if(r&&r.length>0){const t=r.map(r=>r.organization_id),{data:e,error:n}=await a.from("organizations").select("*").in("id",t);if(n)throw n;s(e||[]),e&&e.length>0&&d(e[0])}}catch(r){}finally{g(!1)}},w=async r=>{try{const{data:t,error:e}=await a.from("organization_members").select("*").eq("organization_id",r).order("joined_at",{ascending:!0});if(e)throw e;u(t||[])}catch(t){}};return{organizations:i,currentOrg:c,setCurrentOrg:d,members:l,loading:m,fetchUserOrganizations:f,fetchOrgMembers:w,createOrganization:async r=>{try{const{data:t,error:e}=await a.from("organizations").insert([r]).select().single();if(e)throw e;return await f(),{data:t,error:null}}catch(t){return{data:null,error:t}}},inviteMember:async(r,t,e)=>{try{const o=crypto.randomUUID(),i=new Date;i.setDate(i.getDate()+7);const{data:s,error:c}=await a.from("organization_invites").insert([{organization_id:r,email:t,invited_by:null==n?void 0:n.id,role:e,token:o,expires_at:i.toISOString()}]).select().single();if(c)throw c;return{data:s,error:null}}catch(o){return{data:null,error:o}}},removeMember:async r=>{try{const{error:t}=await a.from("organization_members").delete().eq("id",r);if(t)throw t;return c&&await w(c.id),{error:null}}catch(t){return{error:t}}},updateMemberRole:async(r,t)=>{try{const{error:e}=await a.from("organization_members").update({role:t}).eq("id",r);if(e)throw e;return c&&await w(c.id),{error:null}}catch(e){return{error:e}}}}};export{n as u};
