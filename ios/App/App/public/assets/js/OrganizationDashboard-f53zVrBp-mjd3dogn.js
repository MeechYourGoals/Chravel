import{j as e}from"./ui-vendor-BO3EQrMK-mjd3dogn.js";import{r as s,u as a,i as t}from"./react-vendor-D1R0t5S0-mjd3dogn.js";import{u as i}from"./useOrganization-BjbSTYDJ-mjd3dogn.js";import{j as r,B as l,u as n,s as d,l as o,f as c}from"./index-Ta7FH5xW-mjd3dogn.js";import{C as m,a as x,b as g,c as h}from"./card-jeNxgMYk-mjd3dogn.js";import{T as j,a as u,b,c as p}from"./tabs-Dxuz3Y6S-mjd3dogn.js";import{D as N,a as v,b as f,c as w}from"./dialog-BcLamxvL-mjd3dogn.js";import{I as y}from"./input-DsI2n-oJ-mjd3dogn.js";import{L as _}from"./label-D_iG0y88-mjd3dogn.js";import{S as z,b as C,c as S,d as M,e as k}from"./select-CMjqEsxb-mjd3dogn.js";import{M as O}from"./mail-BdBVrsyz-mjd3dogn.js";import{L as I}from"./loader-circle-C0Dqayt8-mjd3dogn.js";import{U as T,O as A,B as E}from"./BillingSection-CjHrdMm3-mjd3dogn.js";import{P as U,E as L}from"./progress-D31nnzej-mjd3dogn.js";import{B as R}from"./badge-DyE_ZUPM-mjd3dogn.js";import{U as B}from"./users-B07yK8Y7-mjd3dogn.js";import{a as F,S as D}from"./user-DFuJ2ZP3-mjd3dogn.js";import{S as P}from"./shield-DGBvlKQi-mjd3dogn.js";import{D as $,a as Y,b as q,c as V,e as G,d as W}from"./dropdown-menu-BXaKb4pk-mjd3dogn.js";import{S as H}from"./pro-CZgaTEEg-mjd3dogn.js";import{B as J}from"./building-QMpp1aWF-mjd3dogn.js";import{C as K}from"./chevron-left-C1xtDQ_l-mjd3dogn.js";import{B as Q}from"./briefcase-WtVaig-p-mjd3dogn.js";import"./supabase-DyX-XggK-mjd3dogn.js";import"./utils-DD44zzh--mjd3dogn.js";import"./camera-AJLsIMdA-mjd3dogn.js";import"./chevron-right-DKRZr0Ps-mjd3dogn.js";const X=({open:a,onClose:t,organizationId:n})=>{const{inviteMember:d}=i(),{toast:o}=r(),[c,m]=s.useState(!1),[x,g]=s.useState(""),[h,j]=s.useState("member");return e.jsx(N,{open:a,onOpenChange:t,children:e.jsxs(v,{className:"sm:max-w-md bg-gray-900 border-white/10",children:[e.jsx(f,{children:e.jsxs(w,{className:"text-white flex items-center gap-2",children:[e.jsx(O,{size:20,className:"text-glass-orange"}),"Invite Team Member"]})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!x)return void o({title:"Missing email",description:"Please enter an email address",variant:"destructive"});m(!0);const{error:s}=await d(n,x,h);s?o({title:"Error",description:s.message||"Failed to send invitation",variant:"destructive"}):(o({title:"Invitation sent",description:`Invitation sent to ${x}`}),t(),g(""),j("member")),m(!1)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"email",className:"text-gray-300",children:"Email Address"}),e.jsx(y,{id:"email",type:"email",value:x,onChange:e=>g(e.target.value),className:"bg-gray-800/50 border-gray-600 text-white",placeholder:"colleague@example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"role",className:"text-gray-300",children:"Role"}),e.jsxs(z,{value:h,onValueChange:e=>j(e),children:[e.jsx(C,{className:"bg-gray-800/50 border-gray-600 text-white",children:e.jsx(S,{})}),e.jsxs(M,{className:"bg-gray-800 border-gray-600",children:[e.jsx(k,{value:"member",className:"text-white",children:"Member"}),e.jsx(k,{value:"admin",className:"text-white",children:"Admin"})]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"admin"===h?"Can manage members and organization settings":"Can view and participate in trips"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:t,className:"flex-1",disabled:c,children:"Cancel"}),e.jsx(l,{type:"submit",className:"flex-1 bg-glass-orange hover:bg-glass-orange/80",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):"Send Invitation"})]})]})]})})},Z=()=>{var a;const{currentOrg:t,members:r,fetchOrgMembers:o,removeMember:c,updateMemberRole:m}=i(),{user:x}=n(),[g,h]=s.useState(!1),[j,u]=s.useState([]),[b,p]=s.useState(!0);if(s.useEffect(()=>{t&&o(t.id)},[t]),s.useEffect(()=>{(async()=>{if(0===r.length)return void p(!1);const e=r.map(e=>e.user_id),{data:s}=await d.from("profiles").select("user_id, display_name, email, avatar_url").in("user_id",e),a=r.map(e=>({...e,profile:null==s?void 0:s.find(s=>s.user_id===e.user_id)}));u(a),p(!1)})()},[r]),!t)return null;const N=t.seats_used/t.seat_limit*100,v="owner"===(null==(a=r.find(e=>e.user_id===(null==x?void 0:x.id)))?void 0:a.role),f=s=>{switch(s){case"owner":return e.jsx(P,{size:14,className:"text-yellow-500"});case"admin":return e.jsx(P,{size:14,className:"text-blue-500"});default:return e.jsx(F,{size:14,className:"text-gray-400"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(B,{size:24}),"Seat Management"]}),e.jsxs(l,{onClick:()=>h(!0),className:"bg-glass-orange hover:bg-glass-orange/80",disabled:t.seats_used>=t.seat_limit,children:[e.jsx(T,{size:16,className:"mr-2"}),"Invite Member"]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-300",children:"Seat Usage"}),e.jsxs("span",{className:"text-white font-semibold",children:[t.seats_used," / ",t.seat_limit]})]}),e.jsx(U,{value:N,className:"h-2"}),N>90&&e.jsx("p",{className:"text-sm text-orange-400 mt-2",children:"You're approaching your seat limit. Consider upgrading your plan."})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h4",{className:"text-lg font-semibold text-white",children:["Team Members (",j.length,")"]})}),e.jsx("div",{className:"divide-y divide-white/10",children:b?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading members..."}):0===j.length?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"No members yet"}):j.map(s=>{var a,t,i;return e.jsx("div",{className:"p-4 hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[(null==(a=s.profile)?void 0:a.avatar_url)?e.jsx("img",{src:s.profile.avatar_url,alt:"",className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-glass-orange/20 flex items-center justify-center",children:e.jsx(F,{size:20,className:"text-glass-orange"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:(null==(t=s.profile)?void 0:t.display_name)||(null==(i=s.profile)?void 0:i.email)||"Unknown"}),e.jsxs(R,{variant:"outline",className:"flex items-center gap-1 border-white/20",children:[f(s.role),s.role]})]}),e.jsx("span",{className:"text-sm text-gray-400",children:s.seat_id})]})]}),v&&"owner"!==s.role&&e.jsx("div",{className:"flex gap-2",children:e.jsx(l,{variant:"outline",size:"sm",onClick:()=>c(s.id),className:"text-red-400 border-red-400/30 hover:bg-red-400/10",children:"Remove"})})]})},s.id)})})]}),t&&e.jsx(X,{open:g,onClose:()=>h(!1),organizationId:t.id})]})},ee=({member:s,onChangeRole:a,onRemove:t,isCurrentUser:i})=>{return e.jsx(m,{className:"bg-white/5 border-white/10",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium truncate",children:s.name}),i&&e.jsx("span",{className:"text-xs text-gray-400",children:"(You)"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:`flex items-center gap-1 text-xs px-2 py-0.5 rounded-full ${(e=>{const s=e.toLowerCase();return"owner"===s?"text-yellow-400 bg-yellow-400/10":"admin"===s?"text-blue-400 bg-blue-400/10":"text-gray-400 bg-gray-400/10"})(s.role)}`,children:[(s=>{const a=s.toLowerCase();return"owner"===a?e.jsx(P,{size:16,className:"text-yellow-400"}):"admin"===a?e.jsx(P,{size:16,className:"text-blue-400"}):e.jsx(F,{size:16,className:"text-gray-400"})})(s.role),s.role]}),(r=s.status,r&&"active"!==r?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full "+("pending"===r?"bg-yellow-500/20 text-yellow-400":"invited"===r?"bg-blue-500/20 text-blue-400":"bg-gray-500/20 text-gray-400"),children:r.charAt(0).toUpperCase()+r.slice(1)}):null)]})]})]}),(a||t)&&!i&&e.jsxs($,{children:[e.jsx(Y,{className:"text-gray-400 hover:text-white",children:e.jsx(L,{size:20})}),e.jsxs(q,{className:"bg-gray-900 border-white/10",children:[a&&e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"text-gray-400",children:"Change Role"}),e.jsxs(G,{onClick:()=>a("admin"),className:"text-white hover:bg-white/10",children:[e.jsx(P,{size:16,className:"mr-2"}),"Make Admin"]}),e.jsxs(G,{onClick:()=>a("member"),className:"text-white hover:bg-white/10",children:[e.jsx(F,{size:16,className:"mr-2"}),"Make Member"]}),e.jsx(W,{className:"bg-white/10"})]}),t&&e.jsxs(G,{onClick:t,className:"text-red-400 hover:bg-red-500/10",children:[e.jsx(o,{size:16,className:"mr-2"}),"Remove from Organization"]})]})]})]})})});var r},se=()=>{const{orgId:o}=a(),N=t(),v=c(),{user:f}=n(),{toast:w}=r(),{organizations:y,currentOrg:_,members:z,loading:C,fetchOrgMembers:S,updateMemberRole:M,removeMember:k,setCurrentOrg:O,fetchUserOrganizations:I}=i(),[U,L]=s.useState("overview"),[R,F]=s.useState(!1),[P,$]=s.useState([]),[Y,q]=s.useState(!1);s.useEffect(()=>{I()},[]),s.useEffect(()=>{if(o){S(o),V(o);const e=y.find(e=>e.id===o);e&&O(e)}},[o,y]);const V=async e=>{try{q(!0);const{data:s,error:a}=await d.from("pro_trip_organizations").select("\n          trip_id,\n          trips:trip_id (\n            id,\n            name,\n            description,\n            destination,\n            start_date,\n            end_date,\n            trip_type,\n            cover_image_url\n          )\n        ").eq("organization_id",e);if(a)throw a;const t=(null==s?void 0:s.map(e=>e.trips).filter(Boolean))||[];$(t)}catch(s){}finally{q(!1)}};if(C)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-glass-orange border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading organization..."})]})});if(!_)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{size:64,className:"text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Organization Not Found"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"This organization doesn't exist or you don't have access."}),e.jsx(l,{onClick:()=>N("/organizations"),children:"View My Organizations"})]})});const G=z.find(e=>e.user_id===(null==f?void 0:f.id)),W="admin"===(null==G?void 0:G.role)||"owner"===(null==G?void 0:G.role),se=H[_.subscription_tier],ae=_.seats_used/_.seat_limit*100;return v?e.jsxs("div",{className:"min-h-screen bg-black text-white p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>N("/organizations"),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-4",children:[e.jsx(K,{size:20}),"Back to Organizations"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(J,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:_.display_name}),e.jsx("p",{className:"text-sm text-gray-400",children:se.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(m,{className:"bg-white/5 border-white/10",children:e.jsxs(x,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:z.length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Team Members"})]})}),e.jsx(m,{className:"bg-white/5 border-white/10",children:e.jsxs(x,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:_.seat_limit-_.seats_used}),e.jsx("div",{className:"text-xs text-gray-400",children:"Available Seats"})]})})]}),W&&e.jsxs(l,{onClick:()=>F(!0),className:"w-full bg-glass-orange hover:bg-glass-orange/80",children:[e.jsx(T,{size:16,className:"mr-2"}),"Invite Team Member"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Team Members"}),z.map(s=>e.jsx(ee,{member:{id:s.user_id||s.id,name:s.user_id||"Pending",role:s.role.charAt(0).toUpperCase()+s.role.slice(1),avatar:"",status:s.status},onChangeRole:W?e=>(async(e,s)=>{const{error:a}=await M(e,s);a?w({title:"Error",description:"Failed to update member role",variant:"destructive"}):(w({title:"Success",description:"Member role updated"}),o&&S(o))})(s.id,e.toLowerCase()):void 0,onRemove:W?()=>(async e=>{const{error:s}=await k(e);s?w({title:"Error",description:"Failed to remove member",variant:"destructive"}):(w({title:"Success",description:"Member removed from organization"}),o&&S(o))})(s.id):void 0,isCurrentUser:s.user_id===(null==f?void 0:f.id)},s.id))]}),e.jsx(X,{open:R,onClose:()=>F(!1),organizationId:o})]}):e.jsx("div",{className:"min-h-screen bg-black text-white",children:e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>N("/organizations"),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-4",children:[e.jsx(K,{size:20}),"Back to Organizations"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(J,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:_.display_name}),e.jsx("p",{className:"text-gray-400",children:_.name})]})]}),W&&e.jsxs(l,{onClick:()=>F(!0),className:"bg-glass-orange hover:bg-glass-orange/80",children:[e.jsx(T,{size:16,className:"mr-2"}),"Invite Member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs(m,{className:"bg-white/5 border-white/10",children:[e.jsx(g,{className:"pb-3",children:e.jsx(h,{className:"text-sm font-medium text-gray-400",children:"Subscription"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:se.name}),e.jsxs("div",{className:"text-sm text-gray-400",children:["$",se.price,"/month"]})]})]}),e.jsxs(m,{className:"bg-white/5 border-white/10",children:[e.jsx(g,{className:"pb-3",children:e.jsx(h,{className:"text-sm font-medium text-gray-400",children:"Team Members"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:z.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Active members"})]})]}),e.jsxs(m,{className:"bg-white/5 border-white/10",children:[e.jsx(g,{className:"pb-3",children:e.jsx(h,{className:"text-sm font-medium text-gray-400",children:"Seat Usage"})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[_.seats_used,"/",_.seat_limit]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-glass-orange h-2 rounded-full transition-all",style:{width:`${ae}%`}})})]})]}),e.jsxs(m,{className:"bg-white/5 border-white/10",children:[e.jsx(g,{className:"pb-3",children:e.jsx(h,{className:"text-sm font-medium text-gray-400",children:"Active Trips"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:"0"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Pro trips"})]})]})]}),e.jsxs(j,{value:U,onValueChange:L,className:"w-full",children:[e.jsxs(u,{className:"bg-white/5 border border-white/10",children:[e.jsxs(b,{value:"overview",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(J,{size:16,className:"mr-2"}),"Overview"]}),e.jsxs(b,{value:"team",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(B,{size:16,className:"mr-2"}),"Team (",z.length,")"]}),e.jsxs(b,{value:"trips",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(Q,{size:16,className:"mr-2"}),"Trips"]}),W&&e.jsxs(b,{value:"settings",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(D,{size:16,className:"mr-2"}),"Settings"]})]}),e.jsx(p,{value:"overview",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(A,{organization:{id:_.id,name:_.name,displayName:_.display_name,billingEmail:_.billing_email}}),e.jsx(E,{organization:{subscriptionTier:_.subscription_tier,subscriptionEndsAt:_.subscription_ends_at||"N/A",seatsUsed:_.seats_used,seatLimit:_.seat_limit}})]})}),e.jsx(p,{value:"team",className:"mt-6",children:e.jsx(Z,{})}),e.jsx(p,{value:"trips",className:"mt-6",children:Y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-glass-orange border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading trips..."})]}):0===P.length?e.jsx(m,{className:"bg-white/5 border-white/10",children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(Q,{size:64,className:"text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No Pro Trips Yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Create your first Pro trip and link it to this organization"}),e.jsx(l,{onClick:()=>N("/"),children:"Create Pro Trip"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P.map(s=>e.jsxs(m,{className:"bg-white/5 border-white/10 hover:bg-white/10 transition-all cursor-pointer group",onClick:()=>N(`/tour/pro/${s.id}`),children:[s.cover_image_url&&e.jsx("div",{className:"h-32 bg-cover bg-center rounded-t-lg",style:{backgroundImage:`url(${s.cover_image_url})`}}),e.jsxs(g,{children:[e.jsx(h,{className:"text-white group-hover:text-glass-orange transition-colors",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.destination})]}),e.jsxs(x,{children:[s.start_date&&s.end_date&&e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]}),s.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-2 line-clamp-2",children:s.description})]})]},s.id))})}),W&&e.jsx(p,{value:"settings",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{organization:{id:_.id,name:_.name,displayName:_.display_name,billingEmail:_.billing_email}}),e.jsx(E,{organization:{subscriptionTier:_.subscription_tier,subscriptionEndsAt:_.subscription_ends_at||"N/A",seatsUsed:_.seats_used,seatLimit:_.seat_limit}})]})})]}),e.jsx(X,{open:R,onClose:()=>F(!1),organizationId:o})]})})};export{se as OrganizationDashboard};
