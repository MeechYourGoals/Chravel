import{j as e}from"./ui-vendor-BO3EQrMK-mjd3dogn.js";import{C as t}from"./calendar-ylgcJK3b-mjd3dogn.js";import{r as s}from"./react-vendor-D1R0t5S0-mjd3dogn.js";import{c as n,B as i,a as r,j as a,q as d,l as o,d as l}from"./index-Ta7FH5xW-mjd3dogn.js";import{C as c,b as m,c as p,a as g}from"./card-jeNxgMYk-mjd3dogn.js";import{B as h}from"./badge-DyE_ZUPM-mjd3dogn.js";import{C as x}from"./calendar-C9K0fVga-mjd3dogn.js";import{S as v}from"./share-2-DwO-SOoB-mjd3dogn.js";import{n as u}from"./tripConverter-C1IUbOIF-mjd3dogn.js";import{C as j}from"./clock-CbBGjTQx-mjd3dogn.js";import{M as f}from"./map-pin-BtCU-LeS-mjd3dogn.js";import{a as y,s as b,g as N,H as w,F as E,M,e as S,d as C,i as D,h as T,j as _}from"./utils-DD44zzh--mjd3dogn.js";import{P as k}from"./plus-Dhwa7sZY-mjd3dogn.js";import{G as A,l as I,m as U}from"./TripDetailModals-BpnQZ47b-mjd3dogn.js";import{C as z}from"./chevron-left-C1xtDQ_l-mjd3dogn.js";import{C as R}from"./chevron-right-DKRZr0Ps-mjd3dogn.js";import{D as O,a as L,b as P,c as $,f as F}from"./dialog-BcLamxvL-mjd3dogn.js";import{I as V}from"./input-DsI2n-oJ-mjd3dogn.js";import{T as Y}from"./textarea-BudkfAn8-mjd3dogn.js";import{L as H}from"./label-D_iG0y88-mjd3dogn.js";import"./supabase-DyX-XggK-mjd3dogn.js";import"./tripsData-DKwZ96V_-mjd3dogn.js";import"./select-CMjqEsxb-mjd3dogn.js";import"./SettingsMenu-DFNATHGY-mjd3dogn.js";import"./SavedRecommendations-D-6cIfyL-mjd3dogn.js";import"./useSavedRecommendations-DTox9Xl2-mjd3dogn.js";import"./pro-CZgaTEEg-mjd3dogn.js";import"./BillingSection-CjHrdMm3-mjd3dogn.js";import"./building-QMpp1aWF-mjd3dogn.js";import"./camera-AJLsIMdA-mjd3dogn.js";import"./user-DFuJ2ZP3-mjd3dogn.js";import"./shield-DGBvlKQi-mjd3dogn.js";import"./zap-LZcBFzwj-mjd3dogn.js";import"./trending-up-B0a-0y1l-mjd3dogn.js";import"./switch-GKuTbu---mjd3dogn.js";import"./loader-circle-C0Dqayt8-mjd3dogn.js";import"./mail-BdBVrsyz-mjd3dogn.js";import"./userPreferencesService-DregIO64-mjd3dogn.js";import"./archive-zX2FvEif-mjd3dogn.js";import"./AuthModal-BKw70HSh-mjd3dogn.js";import"./arrow-left-Biq1qnK6-mjd3dogn.js";import"./eye-BNDPAvT6-mjd3dogn.js";import"./users-B07yK8Y7-mjd3dogn.js";import"./dropdown-menu-BXaKb4pk-mjd3dogn.js";import"./eventsMockData-BWXZ-nj7-mjd3dogn.js";import"./progress-D31nnzej-mjd3dogn.js";import"./googlePlacesNew-Dl7cAwDK-mjd3dogn.js";import"./external-link-CqAT5ABV-mjd3dogn.js";import"./circle-check-big-Bvor9_sf-mjd3dogn.js";import"./avatar-HCmfb6Ad-mjd3dogn.js";import"./circle-alert-CX60mGhN-mjd3dogn.js";import"./chart-column-DOJCLy2J-mjd3dogn.js";import"./circle-check-CNnkiDfZ-mjd3dogn.js";import"./charts-CLK9EMgA-mjd3dogn.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=n("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),G=({events:t,tripName:n="Trip Itinerary"})=>{const[a,d]=s.useState(!1),o=s.useMemo(()=>{const e=(a?t:t.filter(e=>e.include_in_itinerary)).reduce((e,t)=>{const s=y(t.date,"yyyy-MM-dd");return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.entries(e).map(([e,t])=>({date:new Date(e),events:t.sort((e,t)=>e.time.localeCompare(t.time))})).sort((e,t)=>e.date.getTime()-t.date.getTime())},[t,a]),l=e=>({dining:"bg-red-500/20 text-red-300",lodging:"bg-blue-500/20 text-blue-300",activity:"bg-green-500/20 text-green-300",transportation:"bg-yellow-500/20 text-yellow-300",entertainment:"bg-purple-500/20 text-purple-300",other:"bg-slate-500/20 text-slate-300"}[e]||"bg-slate-500/20 text-slate-300");return 0===o.length?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(x,{size:48,className:"mx-auto text-slate-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No Itinerary Events"}),e.jsx("p",{className:"text-slate-400 mb-4",children:a?"No events have been added to the calendar yet.":"No events are marked for inclusion in the itinerary."}),e.jsx(i,{variant:"outline",onClick:()=>d(!a),children:a?"Show Only Itinerary Events":"Show All Events"})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:n}),e.jsxs("p",{className:"text-slate-400 text-sm",children:[o.length," ",1===o.length?"day":"days"," â€¢ "," ",o.reduce((e,t)=>e+t.events.length,0)," events"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>d(!a),children:a?"Itinerary Only":"All Events"}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{navigator.share&&navigator.share({title:n,text:"Check out our trip itinerary!",url:window.location.href})},children:[e.jsx(v,{size:16,className:"mr-1"}),"Share"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{},children:[e.jsx(u,{size:16,className:"mr-1"}),"Export PDF"]})]})]}),e.jsx("div",{className:"space-y-6",children:o.map((t,s)=>e.jsxs(c,{className:"bg-slate-800/30 border-slate-700/50",children:[e.jsx(m,{className:"pb-4",children:e.jsxs(p,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-bold",children:s+1}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:y(t.date,"EEEE, MMMM d")}),e.jsxs("div",{className:"text-sm text-slate-400",children:[t.events.length," ",1===t.events.length?"event":"events"]})]})]})}),e.jsx(g,{className:"space-y-3",children:t.events.map((s,n)=>{var i,a;return e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-slate-900/30 rounded-lg border border-slate-700/30",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-primary rounded-full"}),n<t.events.length-1&&e.jsx("div",{className:"w-0.5 h-8 bg-slate-600 mt-2"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:(a=s.event_category,{dining:"ðŸ½ï¸",lodging:"ðŸ¨",activity:"ðŸŽ¯",transportation:"ðŸš—",entertainment:"ðŸŽ­",other:"ðŸ“…"}[a]||"ðŸ“…")}),e.jsx("h4",{className:"font-semibold text-white",children:s.title}),e.jsx(h,{className:r("text-xs",l(s.event_category)),children:s.event_category})]}),e.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-1",children:[e.jsx(j,{size:14}),s.time]})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-400 mb-2",children:[e.jsx(f,{size:14}),s.location]}),s.description&&e.jsx("p",{className:"text-sm text-slate-300",children:s.description}),(null==(i=s.source_data)?void 0:i.confirmation_number)&&e.jsx("div",{className:"mt-2",children:e.jsxs(h,{variant:"outline",className:"text-xs",children:["Confirmation: ",s.source_data.confirmation_number]})})]})]},s.id)})})]},t.date.toISOString()))})]})},W=({viewMode:t,onToggleView:s,onAddEvent:n,onExport:r})=>e.jsxs("div",{className:"grid grid-cols-8 gap-2 mb-6 items-center",children:[e.jsx("h2",{className:"col-span-5 text-2xl font-bold text-foreground",children:"Group Calendar"}),e.jsxs(i,{variant:"outline",onClick:r,size:"sm",className:"col-span-1 w-full flex items-center justify-center gap-1.5",disabled:!r,children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Export"})]}),e.jsxs(i,{variant:"outline",onClick:s,size:"sm",className:"col-span-1 w-full flex items-center justify-center gap-1.5",children:[(()=>{switch(t){case"grid":return e.jsx(B,{className:"h-4 w-4"});case"itinerary":return e.jsx(x,{className:"h-4 w-4"});default:return e.jsx(A,{className:"h-4 w-4"})}})(),e.jsx("span",{className:"hidden lg:inline",children:(()=>{switch(t){case"grid":return"Itinerary";case"itinerary":return"Day View";default:return"Month Grid"}})()})]}),e.jsxs(i,{variant:"outline",onClick:n,size:"sm",className:"col-span-1 w-full flex items-center justify-center gap-1.5",disabled:!n,children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Add Event"})]})]}),q=({events:t,selectedDate:n,onSelectDate:a,onAddEvent:d,currentMonth:o,onMonthChange:l})=>{const c=s.useMemo(()=>{const e=b(o),t=N(o),s=w(e),n=E(t);return M({start:s,end:n})},[o]),m=s.useMemo(()=>{const e=new Map;return t.forEach(t=>{const s=y(t.date,"yyyy-MM-dd");e.has(s)||e.set(s,[]),e.get(s).push(t)}),e},[t]);return e.jsxs("div",{className:"bg-card border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>{l(T(o,1))},className:"hover:bg-accent",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-lg font-semibold",children:y(o,"MMMM yyyy")}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>{l(_(o,1))},className:"hover:bg-accent",children:e.jsx(R,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-border",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-muted-foreground",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7",children:c.map((t,s)=>{const i=(e=>{const t=y(e,"yyyy-MM-dd");return m.get(t)||[]})(t),l=S(t,o),c=C(t,n),p=D(t);return e.jsxs("button",{onClick:()=>(e=>{a(e),d&&S(e,o)&&d(e)})(t),className:r("min-h-[100px] md:min-h-[120px] p-2 border-b border-r border-border text-left transition-colors","hover:bg-accent/50 focus:outline-none focus:ring-2 focus:ring-primary/50",!l&&"bg-muted/20 text-muted-foreground",c&&"ring-2 ring-primary",p&&"bg-primary/5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:r("text-sm font-medium",p&&"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center",!l&&"opacity-50"),children:y(t,"d")}),l&&0===i.length&&e.jsx(k,{className:"h-3 w-3 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"space-y-1 overflow-hidden",children:[i.slice(0,3).map((s,n)=>e.jsxs("div",{className:r("text-xs px-1.5 py-0.5 rounded truncate","bg-primary/10 text-primary border border-primary/20","hover:bg-primary/20 transition-colors"),onClick:e=>{e.stopPropagation(),a(t)},children:[s.time&&e.jsx("span",{className:"font-medium mr-1",children:s.time}),e.jsx("span",{className:"truncate",children:s.title})]},s.id)),i.length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground px-1.5",children:["+",i.length-3," more"]})]})]},s)})})]})};function Z({open:t,onClose:s,newEvent:n,onUpdateField:r,onSubmit:a,isSubmitting:d=!1,isEditing:o=!1,selectedDate:l}){return e.jsx(O,{open:t,onOpenChange:s,children:e.jsxs(L,{className:"bg-gray-900/95 border border-white/10 rounded-2xl p-6 max-w-md mx-auto",children:[e.jsx(P,{children:e.jsx($,{className:"text-white text-lg font-semibold",children:o?"Edit Event"+(l?` for ${y(l,"EEEE, MMM d")}`:""):"Add Event"+(l?` for ${y(l,"EEEE, MMM d")}`:"")})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"modal-title",className:"text-gray-300 text-sm",children:"Title"}),e.jsx(V,{id:"modal-title",className:"mt-1.5 bg-gray-800 border-white/10 text-white",value:n.title,onChange:e=>r("title",e.target.value),placeholder:"Event title",disabled:d})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"modal-time",className:"text-gray-300 text-sm",children:"Time"}),e.jsx(V,{id:"modal-time",type:"time",className:"mt-1.5 bg-gray-800 border-white/10 text-white",value:n.time,onChange:e=>r("time",e.target.value),disabled:d})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"modal-location",className:"text-gray-300 text-sm",children:"Location"}),e.jsx(V,{id:"modal-location",className:"mt-1.5 bg-gray-800 border-white/10 text-white",value:n.location,onChange:e=>r("location",e.target.value),placeholder:"e.g., Central Park, NYC",disabled:d})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"modal-description",className:"text-gray-300 text-sm",children:"Description"}),e.jsx(Y,{id:"modal-description",className:"mt-1.5 bg-gray-800 border-white/10 text-white resize-none",rows:3,value:n.description,onChange:e=>r("description",e.target.value),placeholder:"Event details (optional)",disabled:d})]})]}),e.jsxs(F,{className:"mt-6 flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",onClick:s,disabled:d,className:"bg-gray-700 text-gray-300 border-gray-600 hover:bg-gray-600",children:"Cancel"}),e.jsx(i,{onClick:()=>{a()},disabled:!n.title||d,className:"bg-indigo-600 text-white hover:bg-indigo-500",children:d?"Saving...":o?"Update Event":"Save Event"})]})]})})}const X=({event:t,onEdit:s,onDelete:n,isDeleting:r=!1})=>e.jsx("div",{className:"bg-card border border-border rounded-lg p-4 hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:{dining:"ðŸ½ï¸",lodging:"ðŸ¨",activity:"ðŸŽ¯",transportation:"ðŸš—",entertainment:"ðŸŽ­",other:"ðŸ“Œ"}[t.event_category]||"ðŸ“Œ"}),e.jsx("h4",{className:"font-medium text-foreground",children:t.title})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{children:t.time})]}),t.location&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx("span",{children:t.location})]})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:t.description})]}),e.jsxs("div",{className:"flex gap-1",children:[s&&e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>s(t),className:"hover:bg-primary/10 hover:text-primary",title:"Edit event",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>n(t.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10",disabled:r,title:"Delete event",children:r?e.jsx("span",{className:"h-4 w-4 inline-flex items-center justify-center",children:e.jsx("span",{className:"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full"})}):e.jsx(o,{className:"h-4 w-4"})})]})]})}),J=({events:t,onEdit:s,onDelete:n,emptyMessage:i="No events for this date",isDeleting:r=!1})=>0===t.length?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground text-sm",children:i})}):e.jsx("div",{className:"space-y-3",children:t.map(t=>e.jsx(X,{event:t,onEdit:s,onDelete:n,isDeleting:r},t.id))});function Q(e,t){const s=(new Date).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";let n="BEGIN:VCALENDAR\r\n";return n+="VERSION:2.0\r\n",n+="PRODID:-//Chravel//Trip Calendar//EN\r\n",n+="CALSCALE:GREGORIAN\r\n",n+="METHOD:PUBLISH\r\n",n+=`X-WR-CALNAME:${t}\r\n`,n+="X-WR-TIMEZONE:UTC\r\n",e.forEach(e=>{const t=function(e){const t=new Date(e.date),[s,n]=e.time.split(":");let i;t.setHours(parseInt(s,10),parseInt(n,10)),e.end_time?i=e.end_time:e.time&&(i=new Date(t),i.setHours(i.getHours()+1));const r="tentative"===e.availability_status||"free"===e.availability_status?"TENTATIVE":"CONFIRMED";return{uid:`chravel-${e.id}@chravel.app`,dtstart:t,dtend:i,summary:e.title,description:e.description||"",location:e.location||"",rrule:e.recurrence_rule,status:r}}(e);n+="BEGIN:VEVENT\r\n",n+=`UID:${t.uid}\r\n`,n+=`DTSTAMP:${s}\r\n`;const i=t.dtstart.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";if(n+=`DTSTART:${i}\r\n`,t.dtend){const e=t.dtend.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";n+=`DTEND:${e}\r\n`}n+=`SUMMARY:${K(t.summary)}\r\n`,t.description&&(n+=`DESCRIPTION:${K(t.description)}\r\n`),t.location&&(n+=`LOCATION:${K(t.location)}\r\n`),t.rrule&&(n+=`RRULE:${t.rrule}\r\n`),t.status&&(n+=`STATUS:${t.status}\r\n`),n+="END:VEVENT\r\n"}),n+="END:VCALENDAR\r\n",n}function K(e){return e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n").replace(/\r/g,"")}async function ee(e,t){try{const s=await d.getTripEvents(e);!function(e,t){const s=Q(e,t),n=new Blob([s],{type:"text/calendar;charset=utf-8"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=`${t.replace(/[^a-z0-9]/gi,"_")}_calendar.ics`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}(s.map(d.convertToCalendarEvent),t)}catch(s){throw s}}const te=({tripId:n})=>{const{selectedDate:i,setSelectedDate:r,currentMonth:o,setCurrentMonth:c,events:m,showAddEvent:p,setShowAddEvent:g,editingEvent:h,setEditingEvent:x,viewMode:v,toggleViewMode:u,newEvent:j,updateEventField:f,getEventsForDate:b,handleAddEvent:N,updateEvent:w,deleteEvent:E,resetForm:M,isLoading:S,isSaving:C}=(e=>{const[t,n]=s.useState(new Date),[i,r]=s.useState(new Date),[o,l]=s.useState([]),[c,m]=s.useState(!1),[p,g]=s.useState(null),[h,x]=s.useState("calendar"),[v,u]=s.useState({title:"",date:new Date,time:"12:00",location:"",description:"",category:"other",include_in_itinerary:!0}),[j,f]=s.useState(!1),[y,b]=s.useState(!1),{toast:N}=a();s.useEffect(()=>{if(!e)return l([]),void f(!1);const t=setTimeout(()=>{f(!1)},1e4);return(async()=>{f(!0);try{const t=(await d.getTripEvents(e)).map(d.convertToCalendarEvent);l(t)}catch(t){N({title:"Unable to load events",description:"We had trouble retrieving the calendar. Please try again.",variant:"destructive"}),l([])}finally{f(!1)}})(),()=>clearTimeout(t)},[e,N]);const w=()=>{u({title:"",date:t||new Date,time:"12:00",location:"",description:"",category:"other",include_in_itinerary:!0}),m(!1)};return{selectedDate:t,setSelectedDate:n,currentMonth:i,setCurrentMonth:r,events:o,setEvents:l,showAddEvent:c,setShowAddEvent:m,editingEvent:p,setEditingEvent:g,viewMode:h,setViewMode:x,toggleViewMode:()=>{x(e=>"calendar"===e?"grid":"grid"===e?"itinerary":"calendar")},newEvent:v,updateEventField:(e,t)=>{u(s=>({...s,[e]:t}))},getEventsForDate:e=>o.filter(t=>t.date.toDateString()===e.toDateString()),handleAddEvent:async()=>{if(v.title&&t&&e)try{b(!0);const s=new Date(t),[n,i]=v.time.split(":");s.setHours(parseInt(n,10),parseInt(i,10));const r=await d.createEvent({trip_id:e,title:v.title,description:v.description,start_time:s.toISOString(),end_time:void 0,location:v.location,event_category:v.category,include_in_itinerary:v.include_in_itinerary??!0,source_type:"manual",source_data:{}});if(r.event){const e=d.convertToCalendarEvent(r.event);l(t=>[...t,e].sort((e,t)=>e.date.getTime()-t.date.getTime())),m(!1),w(),r.conflicts.length>0?N({title:"Event added with overlap",description:`Note: This event overlaps with "${r.conflicts[0]}"${r.conflicts.length>1?` and ${r.conflicts.length-1} other event(s)`:""}.`}):N({title:"Event added",description:"Your event has been added to the shared calendar."})}else N({title:"Unable to create event",description:"Something went wrong. Please try again.",variant:"destructive"})}catch(s){const e=s instanceof Error?s.message:"Unknown error";N({title:"Unable to create event",description:e.includes("permission")||e.includes("RLS")?"You may not have permission to add events to this trip.":e,variant:"destructive"})}finally{b(!1)}else N({title:"Missing required fields",description:"Please enter a title for the event.",variant:"destructive"})},updateEvent:async(t,s)=>{if(!e)return N({title:"Unable to update event",description:"Trip ID is missing.",variant:"destructive"}),!1;try{b(!0);const n=new Date(s.date),[i,r]=s.time.split(":");if(n.setHours(parseInt(i,10),parseInt(r,10)),await d.updateEvent(t,{title:s.title,description:s.description,start_time:n.toISOString(),location:s.location,event_category:s.category,include_in_itinerary:s.include_in_itinerary??!0})){const t=(await d.getTripEvents(e)).map(d.convertToCalendarEvent);return l(t),g(null),m(!1),N({title:"Event updated",description:"Your changes have been saved."}),!0}return N({title:"Unable to update event",description:"The update did not complete. Please try again.",variant:"destructive"}),!1}catch(n){const e=n instanceof Error?n.message:"Unknown error";return N({title:"Unable to update event",description:e.includes("permission")||e.includes("RLS")?"You may not have permission to edit this event.":e,variant:"destructive"}),!1}finally{b(!1)}},deleteEvent:async t=>{if(e)try{b(!0),await d.deleteEvent(t,e)&&(l(e=>e.filter(e=>e.id!==t)),N({title:"Event removed",description:"The event has been removed from the calendar."}))}catch(s){N({title:"Unable to delete event",description:"Please try again later.",variant:"destructive"})}finally{b(!1)}},resetForm:w,isLoading:j,isSaving:y}})(n),{toast:D}=a(),{canPerformAction:T}=U(n);l();const _=async()=>{if(h){await w(h.id,j)&&M()}else await N()},k=async()=>{try{await ee(n,"Trip Calendar"),D({title:"Calendar exported",description:"Your calendar has been downloaded as an .ics file."})}catch(e){D({title:"Export failed",description:"Unable to export calendar. Please try again.",variant:"destructive"})}},A=i?b(i):[],I=m.map(e=>e.date);return n?"grid"===v?e.jsxs("div",{className:"p-6",children:[e.jsx(W,{viewMode:v,onToggleView:u,onAddEvent:()=>g(!p),onExport:k}),S?e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx(q,{events:m,selectedDate:i||new Date,onSelectDate:r,onAddEvent:e=>{r(e),g(!0)},currentMonth:o,onMonthChange:c}),e.jsx(Z,{open:p,onClose:()=>{g(!1),x(null),M()},newEvent:j,onUpdateField:f,onSubmit:_,isSubmitting:C,isEditing:!!h,selectedDate:i})]}):"itinerary"===v?e.jsxs("div",{className:"p-6",children:[e.jsx(W,{viewMode:v,onToggleView:u,onAddEvent:()=>g(!p),onExport:k}),e.jsx(G,{events:m,tripName:"Trip Itinerary"})]}):e.jsxs("div",{className:"px-0 py-6",children:[e.jsx(W,{viewMode:v,onToggleView:u,onAddEvent:()=>g(!p),onExport:k}),S?e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:h-[420px]",children:[e.jsx("div",{className:"bg-gray-900/80 border border-white/10 rounded-2xl p-2 flex items-center h-full",children:e.jsx(t,{mode:"single",selected:i,onSelect:r,className:"w-full",modifiers:{hasEvents:I},modifiersStyles:{hasEvents:{backgroundColor:"hsl(var(--primary) / 0.3)",color:"hsl(var(--primary-foreground))",fontWeight:"bold"}}})}),e.jsxs("div",{className:"bg-gray-900/80 border border-white/10 rounded-2xl p-4 flex flex-col h-full",children:[e.jsx("h3",{className:"text-white font-medium mb-3",children:i?`Events for ${y(i,"EEEE, MMM d")}`:"Select a date to view events"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:A.length>0?e.jsx(J,{events:A,onEdit:e=>{T("calendar","can_edit_events")?(x(e),g(!0),f("title",e.title),f("time",e.time),f("location",e.location||""),f("description",e.description||""),f("category",e.event_category||"other"),f("include_in_itinerary",e.include_in_itinerary??!0)):D({title:"Permission denied",description:"You do not have permission to edit events",variant:"destructive"})},onDelete:E,emptyMessage:"",isDeleting:C}):e.jsx("p",{className:"text-gray-400 text-sm mt-6 text-center",children:i?"No events scheduled for this day.":"Select a date to view events."})})]})]}),e.jsx(Z,{open:p,onClose:()=>{x(null),M()},newEvent:j,onUpdateField:f,onSubmit:_,isSubmitting:C,isEditing:!!h,selectedDate:i})]}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-card/50 backdrop-blur-sm border border-border rounded-lg p-6 text-center text-muted-foreground",children:"Trip calendar is unavailable without a valid trip."})})};export{te as GroupCalendar};
