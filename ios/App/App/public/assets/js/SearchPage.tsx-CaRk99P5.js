import{j as e}from"./chunk-DE8J_P3a.js";import{r as s,u as t}from"./chunk-CHPtWMTz.js";import{I as a}from"./chunk-D3Z6_DOi.js";import{B as r}from"./chunk-CKgI9q5n.js";import{B as i}from"./chunk-Bc1XvzR8.js";import{f as l,X as n,j as c,s as o,u as d,i as m}from"../index-C69Cv9fm.js";import{u}from"./chunk-Ccyq873b.js";import{d as p}from"./chunk-DGLf2uCM.js";import{F as h}from"./chunk-CeA63noh.js";import{L as x}from"./chunk-BIY1ublO.js";import{M as g}from"./chunk-ByyMTJWo.js";import{C as v}from"./chunk-D53qnCh4.js";import{U as j}from"./chunk-D5WpN7K-.js";import{A as y}from"./chunk-DkxHCs8B.js";import"./chunk-DN5ISW2H.js";import"./chunk-CbEMFF6w.js";const f=({isOpen:t,onClose:a,title:r,children:i,className:c})=>(s.useEffect(()=>(document.body.style.overflow=t?"hidden":"",()=>{document.body.style.overflow=""}),[t]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&a()};return t&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,a]),t?e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:l("absolute inset-x-0 top-0 bottom-0 bg-background","flex flex-col animate-slide-in-bottom","shadow-enterprise-lg",c),style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border bg-background/95 backdrop-blur-md sticky top-0 z-10",children:[r&&e.jsx("h2",{className:"text-h2 font-semibold text-foreground",children:r}),e.jsx("button",{onClick:a,className:"flex items-center justify-center w-10 h-10 rounded-full hover:bg-muted transition-colors ml-auto",children:e.jsx(n,{size:20,className:"text-muted-foreground"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:i})]})]}):null),b=()=>{const[l,n]=s.useState(""),[b,N]=s.useState(!1),[k,w]=s.useState({status:"all",type:"all",dateRange:"all"}),C=t();d();const{results:z,isLoading:L}=((e,t)=>{const[a,r]=s.useState([]),[i,l]=s.useState(!1),{toast:n}=c(),{isDemoMode:d}=u();return s.useEffect(()=>{const s=setTimeout(async()=>{if(!e.trim()||e.length<2)r([]);else{l(!0);try{if(d){const s=await p.getMockTrips(),a=e.toLowerCase(),i=s.filter(e=>{var s;const r=e.name.toLowerCase().includes(a)||(null==(s=e.destination)?void 0:s.toLowerCase().includes(a)),i="all"===t.type||"regular"===t.type&&"consumer"===e.trip_type||t.type===e.trip_type,l="all"===t.status||"upcoming"===t.status&&!e.is_archived||"archived"===t.status&&e.is_archived;return r&&i&&l}).map(e=>({id:e.id,type:"consumer"===e.trip_type?"regular":e.trip_type,title:e.name,location:e.destination||"Unknown",dateRange:e.start_date&&e.end_date?`${e.start_date} - ${e.end_date}`:"",status:e.is_archived?"archived":"upcoming",participants:5,matchScore:.9,deepLink:`/trip/${e.id}`}));return r(i),void l(!1)}const{data:s,error:a}=await o.functions.invoke("search",{body:{query:e.trim(),scope:"global",limit:50,tripType:"all"!==t.type?t.type:void 0}});if(a)throw a;if(null==s?void 0:s.results){const e=s.results.map(e=>{var s,t,a,r,i,l,n,c;const o=(null==(s=e.deepLink)?void 0:s.includes("/tour/pro/"))?"pro":(null==(t=e.deepLink)?void 0:t.includes("/event/"))?"event":"regular",d=null==(r=null==(a=e.snippet)?void 0:a.match(/\(.*?-\s*(.*?)\)/))?void 0:r[1],m=d?new Date(d):null,u=m&&m<new Date?"archived":"upcoming";return{id:e.objectId||e.tripId,type:o,title:e.tripName||e.content,location:(null==(l=null==(i=e.snippet)?void 0:i.split(" - ")[1])?void 0:l.split(" (")[0])||"Unknown",dateRange:(null==(c=null==(n=e.snippet)?void 0:n.match(/\((.*?)\)/))?void 0:c[1])||"",status:u,participants:0,matchScore:e.score||.5,deepLink:e.deepLink||`/trip/${e.tripId}`}}).filter(e=>"all"===t.status||e.status===t.status);r(e)}else r([])}catch(s){n({title:"Search Error",description:"Unable to search trips. Please try again.",variant:"destructive"}),r([])}finally{l(!1)}}},300);return()=>clearTimeout(s)},[e,t,n,d]),{results:a,isLoading:i}})(l,k),S=s=>{switch(s){case"active":return e.jsx(i,{className:"bg-green-500/20 text-green-400",children:"Active"});case"archived":return e.jsxs(i,{className:"bg-gray-500/20 text-gray-400",children:[e.jsx(y,{size:12,className:"mr-1"}),"Archived"]});case"upcoming":return e.jsx(i,{className:"bg-blue-500/20 text-blue-400",children:"Upcoming"});default:return null}},T=s=>{switch(s){case"pro":return e.jsx(i,{className:"bg-yellow-500/20 text-yellow-400",children:"Pro"});case"event":return e.jsx(i,{className:"bg-purple-500/20 text-purple-400",children:"Event"});default:return e.jsx(i,{className:"bg-blue-500/20 text-blue-400",children:"Trip"})}};return e.jsxs("div",{className:"min-h-screen bg-black text-white p-4 md:p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Search Trips"}),e.jsx("p",{className:"text-gray-400",children:"Find any trip, active or archived"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx(a,{type:"text",placeholder:"Search by trip name or location...",value:l,onChange:e=>n(e.target.value),className:"pl-10 pr-12 bg-gray-900/80 border-gray-700 text-white placeholder-gray-400 h-12"}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>N(!0),className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx(h,{size:18})})]}),("all"!==k.status||"all"!==k.type)&&e.jsxs("div",{className:"flex gap-2 mb-4 flex-wrap",children:["all"!==k.status&&e.jsxs(i,{variant:"secondary",className:"bg-gray-800",children:["Status: ",k.status]}),"all"!==k.type&&e.jsxs(i,{variant:"secondary",className:"bg-gray-800",children:["Type: ",k.type]})]}),e.jsxs("div",{className:"space-y-3",children:[L?e.jsxs("div",{className:"text-center py-8 text-gray-400 flex items-center justify-center gap-2",children:[e.jsx(x,{className:"animate-spin",size:20}),"Searching..."]}):l&&0===z.length&&!L?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:['No trips found for "',l,'"']}):l?null:e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Start typing to search your trips..."}),z.map(s=>e.jsxs("div",{onClick:()=>(e=>{C(e.deepLink)})(s),className:"bg-gray-900/50 border border-gray-800 rounded-lg p-4 cursor-pointer hover:bg-gray-800/50 transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-white mb-1",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{size:14}),s.location]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{size:14}),s.dateRange]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{size:14}),s.participants]})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[T(s.type),S(s.status)]})]},`${s.type}-${s.id}`))]}),e.jsx(f,{isOpen:b,onClose:()=>N(!1),title:"Filter Results",children:e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-3 block",children:"Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["all","active","upcoming","archived"].map(s=>e.jsx(r,{variant:k.status===s?"default":"outline",size:"sm",onClick:()=>w(e=>({...e,status:s})),className:"capitalize",children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-3 block",children:"Trip Type"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["all","regular","pro","event"].map(s=>e.jsx(r,{variant:k.type===s?"default":"outline",size:"sm",onClick:()=>w(e=>({...e,type:s})),className:"capitalize",children:"regular"===s?"Trip":s},s))})]}),e.jsx(r,{onClick:()=>{w({status:"all",type:"all",dateRange:"all"}),N(!1)},variant:"outline",className:"w-full",children:"Clear Filters"})]})})]})};export{b as default};
