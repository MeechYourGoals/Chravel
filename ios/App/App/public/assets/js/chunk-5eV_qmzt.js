import{r}from"./chunk-CHPtWMTz.js";import{e as t,s as e}from"../index-C69Cv9fm.js";const a=()=>{const{user:a}=t(),[n,i]=r.useState([]),[o,s]=r.useState(null),[c,l]=r.useState([]),[d,u]=r.useState(!0);r.useEffect(()=>{a&&m()},[a]);const m=async()=>{try{if(u(!0),!a||!a.id)return i([]),s(null),void u(!1);const{data:r,error:t}=await e.from("organization_members").select("organization_id").eq("user_id",a.id).eq("status","active");if(t)throw t;if(r&&r.length>0){const t=r.map(r=>r.organization_id),{data:a,error:n}=await e.from("organizations").select("*").in("id",t);if(n)throw n;i(a||[]),a&&a.length>0&&s(a[0])}}catch(r){}finally{u(!1)}},g=async r=>{try{const{data:t,error:a}=await e.from("organization_members").select("*").eq("organization_id",r).order("joined_at",{ascending:!0});if(a)throw a;l(t||[])}catch(t){}};return{organizations:n,currentOrg:o,setCurrentOrg:s,members:c,loading:d,fetchUserOrganizations:m,fetchOrgMembers:g,createOrganization:async r=>{try{const{data:t,error:a}=await e.from("organizations").insert([r]).select().single();if(a)throw a;return await m(),{data:t,error:null}}catch(t){return{data:null,error:t}}},inviteMember:async(r,t,n)=>{try{const i=crypto.randomUUID(),o=new Date;o.setDate(o.getDate()+7);const{data:s,error:c}=await e.from("organization_invites").insert([{organization_id:r,email:t,invited_by:null==a?void 0:a.id,role:n,token:i,expires_at:o.toISOString()}]).select().single();if(c)throw c;return{data:s,error:null}}catch(i){return{data:null,error:i}}},removeMember:async r=>{try{const{error:t}=await e.from("organization_members").delete().eq("id",r);if(t)throw t;return o&&await g(o.id),{error:null}}catch(t){return{error:t}}},updateMemberRole:async(r,t)=>{try{const{error:a}=await e.from("organization_members").update({role:t}).eq("id",r);if(a)throw a;return o&&await g(o.id),{error:null}}catch(a){return{error:a}}}}};export{a as u};
