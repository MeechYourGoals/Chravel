import{j as e,A as Z,u as ee,e as se,k as ae,n as te,r as h,s as ie,S as re}from"./index-CAsyng-G.js";import{u as le}from"./useOrganization-SBfay-F2.js";import{B as v}from"./button-_Pv0MPf0.js";import{C as o,a as c,b as p,c as b}from"./card-BWfXNMJp.js";import{T as ne,a as oe,b as w,c as y}from"./tabs-Ba-WFkQA.js";import{I}from"./InviteMemberModal-DBcmPnoT.js";import{d as ce,e as L,O as A,B as O,i as de}from"./SeatManagementSection-BFc4Xk5u.js";import{D as me,a as xe,b as ge,e as he,d as T,f as je}from"./dropdown-menu-DesE2wBT.js";import{E as pe}from"./ellipsis-vertical-CzHInxXT.js";import{S as U}from"./select-XMWUKs4c.js";import{U as E}from"./user-D5s9iwuG.js";import{C as be}from"./crown-DXGOoHaJ.js";import{S as ue}from"./pro-DyZQNKrs.js";import{B as _}from"./building-Br_mTkeH.js";import{C as B}from"./chevron-left-DBJ6HR3b.js";import{U as Ne}from"./users-DV9oPzUN.js";import{B as D}from"./briefcase-BpzHL5HO.js";import"./dialog-Cx8-WJ72.js";import"./input-CkF3ltBX.js";import"./loader-circle-CkOmKk2l.js";import"./camera-CpfyDuxc.js";import"./badge-J4HoHOpX.js";import"./clock-z7hIZNmF.js";import"./circle-check-big-DmirYwTN.js";import"./calendar-B2WMmvpa.js";import"./chevron-right-ubVvME2N.js";const fe=({member:t,onChangeRole:l,onRemove:j,isCurrentUser:n})=>{const m=i=>{const d=i.toLowerCase();return d==="owner"?e.jsx(be,{size:16,className:"text-yellow-400"}):d==="admin"?e.jsx(U,{size:16,className:"text-blue-400"}):e.jsx(E,{size:16,className:"text-gray-400"})},u=i=>{const d=i.toLowerCase();return d==="owner"?"text-yellow-400 bg-yellow-400/10":d==="admin"?"text-blue-400 bg-blue-400/10":"text-gray-400 bg-gray-400/10"},a=i=>!i||i==="active"?null:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${i==="pending"?"bg-yellow-500/20 text-yellow-400":i==="invited"?"bg-blue-500/20 text-blue-400":"bg-gray-500/20 text-gray-400"}`,children:i.charAt(0).toUpperCase()+i.slice(1)});return e.jsx(o,{className:"bg-white/5 border-white/10",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium truncate",children:t.name}),n&&e.jsx("span",{className:"text-xs text-gray-400",children:"(You)"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:`flex items-center gap-1 text-xs px-2 py-0.5 rounded-full ${u(t.role)}`,children:[m(t.role),t.role]}),a(t.status)]})]})]}),(l||j)&&!n&&e.jsxs(me,{children:[e.jsx(xe,{className:"text-gray-400 hover:text-white",children:e.jsx(pe,{size:20})}),e.jsxs(ge,{className:"bg-gray-900 border-white/10",children:[l&&e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"text-gray-400",children:"Change Role"}),e.jsxs(T,{onClick:()=>l("admin"),className:"text-white hover:bg-white/10",children:[e.jsx(U,{size:16,className:"mr-2"}),"Make Admin"]}),e.jsxs(T,{onClick:()=>l("member"),className:"text-white hover:bg-white/10",children:[e.jsx(E,{size:16,className:"mr-2"}),"Make Member"]}),e.jsx(je,{className:"bg-white/10"})]}),j&&e.jsxs(T,{onClick:j,className:"text-red-400 hover:bg-red-500/10",children:[e.jsx(ce,{size:16,className:"mr-2"}),"Remove from Organization"]})]})]})]})})})},Ge=()=>{const{orgId:t}=Z(),l=ee(),j=se(),{user:n}=ae(),{toast:m}=te(),{organizations:u,currentOrg:a,members:i,loading:d,fetchOrgMembers:z,updateMemberRole:R,removeMember:P,setCurrentOrg:$,fetchUserOrganizations:F}=le(),[V,Y]=h.useState("overview"),[S,N]=h.useState(!1),[M,q]=h.useState([]),[H,k]=h.useState(!1);h.useEffect(()=>{F()},[]),h.useEffect(()=>{if(t){z(t),G(t);const s=u.find(r=>r.id===t);s&&$(s)}},[t,u]);const G=async s=>{try{k(!0);const{data:r,error:f}=await ie.from("pro_trip_organizations").select(`
          trip_id,
          trips:trip_id (
            id,
            name,
            description,
            destination,
            start_date,
            end_date,
            trip_type,
            cover_image_url
          )
        `).eq("organization_id",s);if(f)throw f;const W=(r==null?void 0:r.map(X=>X.trips).filter(Boolean))||[];q(W)}catch(r){console.error("Error fetching linked trips:",r)}finally{k(!1)}},J=async(s,r)=>{const{error:f}=await R(s,r);f?m({title:"Error",description:"Failed to update member role",variant:"destructive"}):(m({title:"Success",description:"Member role updated"}),t&&z(t))},K=async s=>{const{error:r}=await P(s);r?m({title:"Error",description:"Failed to remove member",variant:"destructive"}):(m({title:"Success",description:"Member removed from organization"}),t&&z(t))};if(d)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-glass-orange border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading organization..."})]})});if(!a)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{size:64,className:"text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Organization Not Found"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"This organization doesn't exist or you don't have access."}),e.jsx(v,{onClick:()=>l("/organizations"),children:"View My Organizations"})]})});const x=i.find(s=>s.user_id===(n==null?void 0:n.id)),g=(x==null?void 0:x.role)==="admin"||(x==null?void 0:x.role)==="owner",C=ue[a.subscription_tier],Q=a.seats_used/a.seat_limit*100;return j?e.jsxs("div",{className:"min-h-screen bg-black text-white p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>l("/organizations"),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-4",children:[e.jsx(B,{size:20}),"Back to Organizations"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(_,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:a.display_name}),e.jsx("p",{className:"text-sm text-gray-400",children:C.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(o,{className:"bg-white/5 border-white/10",children:e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:i.length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Team Members"})]})}),e.jsx(o,{className:"bg-white/5 border-white/10",children:e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:a.seat_limit-a.seats_used}),e.jsx("div",{className:"text-xs text-gray-400",children:"Available Seats"})]})})]}),g&&e.jsxs(v,{onClick:()=>N(!0),className:"w-full bg-glass-orange hover:bg-glass-orange/80",children:[e.jsx(L,{size:16,className:"mr-2"}),"Invite Team Member"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Team Members"}),i.map(s=>e.jsx(fe,{member:{id:s.user_id||s.id,name:s.user_id||"Pending",role:s.role.charAt(0).toUpperCase()+s.role.slice(1),avatar:"",status:s.status},onChangeRole:g?r=>J(s.id,r.toLowerCase()):void 0,onRemove:g?()=>K(s.id):void 0,isCurrentUser:s.user_id===(n==null?void 0:n.id)},s.id))]}),e.jsx(I,{open:S,onClose:()=>N(!1),organizationId:t})]}):e.jsx("div",{className:"min-h-screen bg-black text-white",children:e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>l("/organizations"),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-4",children:[e.jsx(B,{size:20}),"Back to Organizations"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(_,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:a.display_name}),e.jsx("p",{className:"text-gray-400",children:a.name})]})]}),g&&e.jsxs(v,{onClick:()=>N(!0),className:"bg-glass-orange hover:bg-glass-orange/80",children:[e.jsx(L,{size:16,className:"mr-2"}),"Invite Member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs(o,{className:"bg-white/5 border-white/10",children:[e.jsx(p,{className:"pb-3",children:e.jsx(b,{className:"text-sm font-medium text-gray-400",children:"Subscription"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:C.name}),e.jsxs("div",{className:"text-sm text-gray-400",children:["$",C.price,"/month"]})]})]}),e.jsxs(o,{className:"bg-white/5 border-white/10",children:[e.jsx(p,{className:"pb-3",children:e.jsx(b,{className:"text-sm font-medium text-gray-400",children:"Team Members"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:i.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Active members"})]})]}),e.jsxs(o,{className:"bg-white/5 border-white/10",children:[e.jsx(p,{className:"pb-3",children:e.jsx(b,{className:"text-sm font-medium text-gray-400",children:"Seat Usage"})}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[a.seats_used,"/",a.seat_limit]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-glass-orange h-2 rounded-full transition-all",style:{width:`${Q}%`}})})]})]}),e.jsxs(o,{className:"bg-white/5 border-white/10",children:[e.jsx(p,{className:"pb-3",children:e.jsx(b,{className:"text-sm font-medium text-gray-400",children:"Active Trips"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:"0"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Pro trips"})]})]})]}),e.jsxs(ne,{value:V,onValueChange:Y,className:"w-full",children:[e.jsxs(oe,{className:"bg-white/5 border border-white/10",children:[e.jsxs(w,{value:"overview",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(_,{size:16,className:"mr-2"}),"Overview"]}),e.jsxs(w,{value:"team",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(Ne,{size:16,className:"mr-2"}),"Team (",i.length,")"]}),e.jsxs(w,{value:"trips",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(D,{size:16,className:"mr-2"}),"Trips"]}),g&&e.jsxs(w,{value:"settings",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(re,{size:16,className:"mr-2"}),"Settings"]})]}),e.jsx(y,{value:"overview",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(A,{organization:{id:a.id,name:a.name,displayName:a.display_name,billingEmail:a.billing_email}}),e.jsx(O,{organization:{subscriptionTier:a.subscription_tier,subscriptionEndsAt:a.subscription_ends_at||"N/A",seatsUsed:a.seats_used,seatLimit:a.seat_limit}})]})}),e.jsx(y,{value:"team",className:"mt-6",children:e.jsx(de,{organization:{seatLimit:a.seat_limit,seatsUsed:a.seats_used}})}),e.jsx(y,{value:"trips",className:"mt-6",children:H?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-glass-orange border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading trips..."})]}):M.length===0?e.jsx(o,{className:"bg-white/5 border-white/10",children:e.jsxs(c,{className:"p-12 text-center",children:[e.jsx(D,{size:64,className:"text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No Pro Trips Yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Create your first Pro trip and link it to this organization"}),e.jsx(v,{onClick:()=>l("/"),children:"Create Pro Trip"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:M.map(s=>e.jsxs(o,{className:"bg-white/5 border-white/10 hover:bg-white/10 transition-all cursor-pointer group",onClick:()=>l(`/tour/pro/${s.id}`),children:[s.cover_image_url&&e.jsx("div",{className:"h-32 bg-cover bg-center rounded-t-lg",style:{backgroundImage:`url(${s.cover_image_url})`}}),e.jsxs(p,{children:[e.jsx(b,{className:"text-white group-hover:text-glass-orange transition-colors",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.destination})]}),e.jsxs(c,{children:[s.start_date&&s.end_date&&e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]}),s.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-2 line-clamp-2",children:s.description})]})]},s.id))})}),g&&e.jsx(y,{value:"settings",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{organization:{id:a.id,name:a.name,displayName:a.display_name,billingEmail:a.billing_email}}),e.jsx(O,{organization:{subscriptionTier:a.subscription_tier,subscriptionEndsAt:a.subscription_ends_at||"N/A",seatsUsed:a.seats_used,seatLimit:a.seat_limit}})]})})]}),e.jsx(I,{open:S,onClose:()=>N(!1),organizationId:t})]})})};export{Ge as OrganizationDashboard};
