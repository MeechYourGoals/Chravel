import{a8 as e,s as t}from"./index-Ta7FH5xW-mjd3dogn.js";import{p as a}from"./eventsMockData-BWXZ-nj7-mjd3dogn.js";import"./ui-vendor-BO3EQrMK-mjd3dogn.js";import"./react-vendor-D1R0t5S0-mjd3dogn.js";import"./supabase-DyX-XggK-mjd3dogn.js";import"./utils-DD44zzh--mjd3dogn.js";import"./tripsData-DKwZ96V_-mjd3dogn.js";async function s(s,i){var n;const r={trip:{title:"Trip"}},o=e.getState().isDemoMode,d=a[s];if(o&&d)return r.trip={title:d.title,destination:d.location,dateRange:d.dateRange,description:d.description},i.includes("calendar")&&d.schedule&&(r.calendar=d.schedule.map(e=>({title:e.title||"Event",start_time:e.startTime||(new Date).toISOString(),end_time:e.endTime,location:e.location,description:e.notes}))),i.includes("payments")&&d.settlement&&d.settlement.length>0&&(r.payments={items:d.settlement.map(e=>({description:e.venue||"Payment",amount:e.finalPayout||0,currency:"USD",split_count:1,is_settled:"paid"===e.status,created_at:e.date})),total:d.settlement.reduce((e,t)=>e+(t.finalPayout||0),0),currency:"USD"}),i.includes("tasks")&&d.tasks&&(r.tasks=d.tasks.map(e=>({title:e.title,description:e.description,completed:e.completed,due_date:e.due_at,assigned_to:e.assigned_to}))),i.includes("polls")&&d.polls&&(r.polls=d.polls.map(e=>({question:e.question,options:e.options,total_votes:e.total_votes,status:e.status}))),i.includes("places")&&d.links&&(r.places=d.links.map(e=>({name:e.title,url:e.url,description:e.description,votes:0}))),i.includes("broadcasts")&&d.broadcasts&&(r.broadcasts=d.broadcasts.map(e=>{var t;return{message:e.message,priority:e.priority,timestamp:e.timestamp,sender:"Team Member",read_count:(null==(t=e.readBy)?void 0:t.length)||0}})),i.includes("roster")&&d.roster&&(r.roster=d.roster.map(e=>({name:e.name,email:e.email,role:e.role,avatar_url:e.avatar}))),r;try{const{data:e}=await t.from("trips").select("name, destination, start_date, end_date, description").eq("id",s).single();if(e&&(r.trip={title:e.name||"Trip",destination:e.destination||void 0,dateRange:e.start_date&&e.end_date?`${new Date(e.start_date).toLocaleDateString()} - ${new Date(e.end_date).toLocaleDateString()}`:void 0,description:e.description||void 0}),i.includes("calendar")){const{data:e}=await t.from("trip_events").select("title, start_time, end_time, location, description").eq("trip_id",s).order("start_time",{ascending:!0});r.calendar=e||[]}if(i.includes("payments")){const{data:e}=await t.from("trip_payment_messages").select("description, amount, currency, split_count, is_settled, created_at").eq("trip_id",s).order("created_at",{ascending:!1});if(e&&e.length>0){const t=e.reduce((e,t)=>e+(t.amount||0),0);r.payments={items:e,total:t,currency:(null==(n=e[0])?void 0:n.currency)||"USD"}}}if(i.includes("polls")){const{data:e}=await t.from("trip_polls").select("question, options, total_votes, status").eq("trip_id",s).order("created_at",{ascending:!1});r.polls=e||[]}if(i.includes("tasks")){const{data:e}=await t.from("trip_tasks").select("title, description, completed").eq("trip_id",s).order("created_at",{ascending:!1});r.tasks=(null==e?void 0:e.map(e=>({title:e.title,description:e.description||void 0,completed:e.completed})))||[]}if(i.includes("places")){const e=[],{data:a}=await t.from("trips").select("basecamp_name, basecamp_address").eq("id",s).single();(null==a?void 0:a.basecamp_address)&&e.push({name:`ðŸ“ Trip Base Camp: ${a.basecamp_name||"Main Location"}`,url:`https://maps.google.com/?q=${encodeURIComponent(a.basecamp_address)}`,description:a.basecamp_address,votes:0});const{data:{user:i}}=await t.auth.getUser();if(i){const{data:a}=await t.from("trip_personal_basecamps").select("name, address").eq("trip_id",s).eq("user_id",i.id).maybeSingle();(null==a?void 0:a.address)&&e.push({name:`ðŸ  Personal Base Camp: ${a.name||"My Location"}`,url:`https://maps.google.com/?q=${encodeURIComponent(a.address)}`,description:`${a.address} (Private)`,votes:0})}const{data:n}=await t.from("trip_links").select("title, url, description, category, votes").eq("trip_id",s).order("votes",{ascending:!1});n&&e.push(...n.map(e=>({name:e.title,url:e.url,description:e.category?`[${e.category}] ${e.description||""}`:e.description||void 0,votes:e.votes||0}))),r.places=e}if(i.includes("roster")){const{data:e}=await t.from("trip_members").select("\n          role,\n          profiles:user_id (\n            display_name,\n            email,\n            avatar_url\n          )\n        ").eq("trip_id",s);r.roster=(null==e?void 0:e.map(e=>{var t,a,s;return{name:(null==(t=e.profiles)?void 0:t.display_name)||"Unknown",email:null==(a=e.profiles)?void 0:a.email,role:e.role||"member",avatar_url:null==(s=e.profiles)?void 0:s.avatar_url}}))||[]}if(i.includes("broadcasts")){const{data:e}=await t.from("broadcasts").select("\n          message,\n          priority,\n          created_at,\n          is_sent,\n          created_by,\n          profiles:created_by (\n            display_name\n          )\n        ").eq("trip_id",s).eq("is_sent",!0).order("created_at",{ascending:!0});e&&e.length>0&&(r.broadcasts=e.map(e=>{var t;return{message:e.message,priority:e.priority||"fyi",timestamp:e.created_at,sender:(null==(t=e.profiles)?void 0:t.display_name)||"Team Member",read_count:0}}))}if(i.includes("attachments")){const{data:e}=await t.from("trip_files").select("\n          id,\n          name,\n          file_type,\n          created_at,\n          uploaded_by,\n          profiles:uploaded_by (\n            display_name\n          )\n        ").eq("trip_id",s).order("created_at",{ascending:!1});r.attachments=(null==e?void 0:e.map(e=>{var t;return{name:e.name,type:e.file_type,uploaded_at:e.created_at,uploaded_by:(null==(t=e.profiles)?void 0:t.display_name)||"Unknown"}}))||[]}return r}catch(l){return r}}export{s as getExportData};
