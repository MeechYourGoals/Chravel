import{j as e}from"./chunk-DE8J_P3a.js";import{j as t,u as i,r as s}from"./chunk-CHPtWMTz.js";import{e as r,s as a,t as n}from"../index-C69Cv9fm.js";import{L as o}from"./chunk-BIY1ublO.js";import{U as l}from"./chunk-D5WpN7K-.js";import{M as c}from"./chunk-ByyMTJWo.js";import{C as d}from"./chunk-D53qnCh4.js";import{C as m}from"./chunk-DJZXZyJn.js";import"./chunk-DN5ISW2H.js";import"./chunk-CbEMFF6w.js";const u=()=>{const{token:u}=t(),p=i(),{user:x}=r(),[h,v]=s.useState(!0),[b,j]=s.useState(!1),[f,g]=s.useState(null),[w,y]=s.useState(""),[N,_]=s.useState(!1);s.useEffect(()=>{document.title="Join Trip - Chravel";const e=(e,t)=>{let i=document.querySelector(`meta[property="${e}"]`);i||(i=document.createElement("meta"),i.setAttribute("property",e),document.head.appendChild(i)),i.content=t},t=(e,t)=>{let i=document.querySelector(`meta[name="${e}"]`);i||(i=document.createElement("meta"),i.setAttribute("name",e),document.head.appendChild(i)),i.content=t};e("og:title","Join an Amazing Trip!"),e("og:description","You've been invited to join a trip. Click to see details and join the adventure!"),e("og:type","website"),e("og:image","https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=1200&h=630&fit=crop"),t("twitter:card","summary_large_image"),t("twitter:title","Join an Amazing Trip!"),t("twitter:description","You've been invited to join a trip. Click to see details and join the adventure!"),t("twitter:image","https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=1200&h=630&fit=crop")},[]),s.useEffect(()=>{u?k():(y("Invalid invite link"),v(!1))},[u]);const k=async()=>{if(!u)return;const e=`chravel://join-trip/${u}`;if(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const t=Date.now();window.location.href=e,setTimeout(()=>{Date.now()-t<2e3&&C()},1500)}else C()},C=async()=>{if(u)try{const{data:e,error:t}=await a.from("trip_invites").select("*").eq("code",u).single();if(t||!e)return y("Invalid invite link"),void v(!1);if(!e.is_active)return y("This invite link has been deactivated"),void v(!1);if(e.expires_at&&new Date(e.expires_at)<new Date)return y("This invite link has expired"),void v(!1);if(e.max_uses&&e.current_uses>=e.max_uses)return y("This invite link has reached its maximum number of uses"),void v(!1);_(!1),g({trip_id:e.trip_id,invite_token:u,created_at:e.created_at,require_approval:!1,expires_at:e.expires_at,max_uses:e.max_uses,current_uses:e.current_uses,is_active:e.is_active,code:e.code,id:e.id,created_by:e.created_by}),v(!1)}catch(e){y("Failed to load invite details"),v(!1)}};return h?e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{className:"h-8 w-8 animate-spin text-white mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading invite details..."})]})}):w?e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Invalid Invite"}),e.jsx("p",{className:"text-gray-400 mb-6",children:w}),e.jsx("button",{onClick:()=>p("/"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl transition-colors",children:"Go to Dashboard"})]})}):e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl p-8 max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(l,{className:"h-8 w-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"You're Invited!"}),e.jsx("p",{className:"text-gray-400",children:"Join this amazing trip with your friends"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-600/20 via-yellow-500/10 to-transparent border border-yellow-500/20 rounded-2xl p-4 mb-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&h=200&fit=crop')] bg-cover bg-center opacity-10 rounded-2xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Trip Invitation"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{size:16,className:"text-yellow-400"}),e.jsxs("span",{children:["Trip ID: ",null==f?void 0:f.trip_id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:16,className:"text-yellow-400"}),e.jsxs("span",{children:["Invited ",(null==f?void 0:f.created_at)?new Date(f.created_at).toLocaleDateString():"Recently"]})]}),(null==f?void 0:f.expires_at)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:16,className:"text-yellow-400"}),e.jsxs("span",{children:["Expires: ",new Date(f.expires_at).toLocaleDateString()]})]}),(null==f?void 0:f.max_uses)&&e.jsx("div",{className:"flex items-center gap-2 text-gray-400 text-xs",children:e.jsxs("span",{children:["Uses: ",f.current_uses||0," / ",f.max_uses]})})]})]})]}),x?e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:async()=>{if(x){if(u&&f){j(!0);try{const{data:e,error:t}=await a.functions.invoke("join-trip",{body:{inviteCode:u}});if(t)return n.error(t.message||"Failed to join trip"),void j(!1);if(!e.success)return n.error(e.message||"Failed to join trip"),void j(!1);if(e.requires_approval)return n.success(e.message||"Join request submitted!"),j(!1),void g(e=>e?{...e,require_approval:!0}:null);n.success(e.message||"Successfully joined the trip!"),setTimeout(()=>{"pro"===e.trip_type?p(`/tour/pro/${e.trip_id}`):"event"===e.trip_type?p(`/event/${e.trip_id}`):p(`/trip/${e.trip_id}`)},1e3)}catch(e){n.error("An unexpected error occurred. Please try again.")}finally{j(!1)}}}else n.error("Please log in to join this trip")},disabled:b,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white py-4 px-6 rounded-xl transition-all duration-200 font-medium disabled:opacity-50 flex items-center justify-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"h-4 w-4 animate-spin"}),"Joining..."]}):"Join Trip"}),e.jsx("button",{onClick:()=>p("/"),className:"w-full bg-white/10 hover:bg-white/20 border border-white/20 text-white py-3 px-6 rounded-xl transition-colors",children:"Go to Dashboard"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300 text-center",children:"Please log in to join this trip"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>p("/login"),className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white py-3 px-6 rounded-xl transition-all duration-200 font-medium",children:"Log In"}),e.jsx("button",{onClick:()=>p("/signup"),className:"w-full bg-white/10 hover:bg-white/20 border border-white/20 text-white py-3 px-6 rounded-xl transition-colors",children:"Sign Up"})]})]}),(null==f?void 0:f.require_approval)&&!b&&e.jsxs("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(m,{className:"h-5 w-5 text-yellow-400"}),e.jsx("p",{className:"font-medium text-yellow-400",children:"Approval Required"})]}),e.jsx("p",{className:"text-yellow-400/80 text-sm",children:"This trip requires approval from the organizer. Your request will be reviewed once submitted."})]})]})})};export{u as default};
