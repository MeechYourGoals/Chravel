import{j as e}from"./chunk-DE8J_P3a.js";import{j as s,u as a,r as t}from"./chunk-CHPtWMTz.js";import{u as i}from"./chunk-5eV_qmzt.js";import{u as r,e as l,j as n,s as c,S as o}from"../index-C69Cv9fm.js";import{B as m}from"./chunk-CKgI9q5n.js";import{C as d,a as x,b as h,c as g}from"./chunk-30ZbY-F3.js";import{T as j,a as u,b as p,c as b}from"./chunk-ObNbiZMt.js";import{I as N}from"./chunk-D6XY44pl.js";import{U as v,O as f,B as w,e as y}from"./chunk-D_Hxdxtf.js";import{D as k,a as _,b as z,d as C,c as S,e as M}from"./chunk-DtLDND_v.js";import{E as T}from"./chunk-D393L8yP.js";import{S as U}from"./chunk-DILfnUIk.js";import{U as A}from"./chunk-CkE6zG_x.js";import{a as O}from"./chunk-BxvRdxTs.js";import{C as L}from"./chunk-D_Qk7JHd.js";import{S as E}from"./chunk-DyZQNKrs.js";import{B as I}from"./chunk--pMnkzaH.js";import{C as R}from"./chunk-DV21tWlK.js";import{U as B}from"./chunk-D5WpN7K-.js";import{B as P}from"./chunk-HOXgbvHi.js";import"./chunk-DN5ISW2H.js";import"./chunk-CbEMFF6w.js";import"./chunk-YjRoWQ3-.js";import"./chunk-D3Z6_DOi.js";import"./chunk-LoZVIojA.js";import"./chunk-CD10_Lnj.js";import"./chunk-DgElOEdu.js";import"./chunk-BIY1ublO.js";import"./chunk-C0eak1NN.js";import"./chunk-Bc1XvzR8.js";import"./chunk-DJZXZyJn.js";import"./chunk-A2g_dVj8.js";import"./chunk-DeuaeHUI.js";import"./chunk-D53qnCh4.js";import"./chunk-DuSQr7KO.js";const D=({member:s,onChangeRole:a,onRemove:t,isCurrentUser:i})=>{return e.jsx(d,{className:"bg-white/5 border-white/10",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium truncate",children:s.name}),i&&e.jsx("span",{className:"text-xs text-gray-400",children:"(You)"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:`flex items-center gap-1 text-xs px-2 py-0.5 rounded-full ${(e=>{const s=e.toLowerCase();return"owner"===s?"text-yellow-400 bg-yellow-400/10":"admin"===s?"text-blue-400 bg-blue-400/10":"text-gray-400 bg-gray-400/10"})(s.role)}`,children:[(s=>{const a=s.toLowerCase();return"owner"===a?e.jsx(L,{size:16,className:"text-yellow-400"}):"admin"===a?e.jsx(U,{size:16,className:"text-blue-400"}):e.jsx(A,{size:16,className:"text-gray-400"})})(s.role),s.role]}),(r=s.status,r&&"active"!==r?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full "+("pending"===r?"bg-yellow-500/20 text-yellow-400":"invited"===r?"bg-blue-500/20 text-blue-400":"bg-gray-500/20 text-gray-400"),children:r.charAt(0).toUpperCase()+r.slice(1)}):null)]})]})]}),(a||t)&&!i&&e.jsxs(k,{children:[e.jsx(_,{className:"text-gray-400 hover:text-white",children:e.jsx(T,{size:20})}),e.jsxs(z,{className:"bg-gray-900 border-white/10",children:[a&&e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"text-gray-400",children:"Change Role"}),e.jsxs(S,{onClick:()=>a("admin"),className:"text-white hover:bg-white/10",children:[e.jsx(U,{size:16,className:"mr-2"}),"Make Admin"]}),e.jsxs(S,{onClick:()=>a("member"),className:"text-white hover:bg-white/10",children:[e.jsx(A,{size:16,className:"mr-2"}),"Make Member"]}),e.jsx(M,{className:"bg-white/10"})]}),t&&e.jsxs(S,{onClick:t,className:"text-red-400 hover:bg-red-500/10",children:[e.jsx(O,{size:16,className:"mr-2"}),"Remove from Organization"]})]})]})]})})});var r},$=()=>{const{orgId:k}=s(),_=a(),z=r(),{user:C}=l(),{toast:S}=n(),{organizations:M,currentOrg:T,members:U,loading:A,fetchOrgMembers:O,updateMemberRole:L,removeMember:$,setCurrentOrg:F,fetchUserOrganizations:V}=i(),[Y,q]=t.useState("overview"),[H,J]=t.useState(!1),[K,W]=t.useState([]),[G,Q]=t.useState(!1);t.useEffect(()=>{V()},[]),t.useEffect(()=>{if(k){O(k),X(k);const e=M.find(e=>e.id===k);e&&F(e)}},[k,M]);const X=async e=>{try{Q(!0);const{data:s,error:a}=await c.from("pro_trip_organizations").select("\n          trip_id,\n          trips:trip_id (\n            id,\n            name,\n            description,\n            destination,\n            start_date,\n            end_date,\n            trip_type,\n            cover_image_url\n          )\n        ").eq("organization_id",e);if(a)throw a;const t=(null==s?void 0:s.map(e=>e.trips).filter(Boolean))||[];W(t)}catch(s){}finally{Q(!1)}};if(A)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-glass-orange border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading organization..."})]})});if(!T)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(I,{size:64,className:"text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Organization Not Found"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"This organization doesn't exist or you don't have access."}),e.jsx(m,{onClick:()=>_("/organizations"),children:"View My Organizations"})]})});const Z=U.find(e=>e.user_id===(null==C?void 0:C.id)),ee="admin"===(null==Z?void 0:Z.role)||"owner"===(null==Z?void 0:Z.role),se=E[T.subscription_tier],ae=T.seats_used/T.seat_limit*100;return z?e.jsxs("div",{className:"min-h-screen bg-black text-white p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>_("/organizations"),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-4",children:[e.jsx(R,{size:20}),"Back to Organizations"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(I,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:T.display_name}),e.jsx("p",{className:"text-sm text-gray-400",children:se.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(d,{className:"bg-white/5 border-white/10",children:e.jsxs(x,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:U.length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Team Members"})]})}),e.jsx(d,{className:"bg-white/5 border-white/10",children:e.jsxs(x,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:T.seat_limit-T.seats_used}),e.jsx("div",{className:"text-xs text-gray-400",children:"Available Seats"})]})})]}),ee&&e.jsxs(m,{onClick:()=>J(!0),className:"w-full bg-glass-orange hover:bg-glass-orange/80",children:[e.jsx(v,{size:16,className:"mr-2"}),"Invite Team Member"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Team Members"}),U.map(s=>e.jsx(D,{member:{id:s.user_id||s.id,name:s.user_id||"Pending",role:s.role.charAt(0).toUpperCase()+s.role.slice(1),avatar:"",status:s.status},onChangeRole:ee?e=>(async(e,s)=>{const{error:a}=await L(e,s);a?S({title:"Error",description:"Failed to update member role",variant:"destructive"}):(S({title:"Success",description:"Member role updated"}),k&&O(k))})(s.id,e.toLowerCase()):void 0,onRemove:ee?()=>(async e=>{const{error:s}=await $(e);s?S({title:"Error",description:"Failed to remove member",variant:"destructive"}):(S({title:"Success",description:"Member removed from organization"}),k&&O(k))})(s.id):void 0,isCurrentUser:s.user_id===(null==C?void 0:C.id)},s.id))]}),e.jsx(N,{open:H,onClose:()=>J(!1),organizationId:k})]}):e.jsx("div",{className:"min-h-screen bg-black text-white",children:e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>_("/organizations"),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-4",children:[e.jsx(R,{size:20}),"Back to Organizations"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(I,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:T.display_name}),e.jsx("p",{className:"text-gray-400",children:T.name})]})]}),ee&&e.jsxs(m,{onClick:()=>J(!0),className:"bg-glass-orange hover:bg-glass-orange/80",children:[e.jsx(v,{size:16,className:"mr-2"}),"Invite Member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs(d,{className:"bg-white/5 border-white/10",children:[e.jsx(h,{className:"pb-3",children:e.jsx(g,{className:"text-sm font-medium text-gray-400",children:"Subscription"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:se.name}),e.jsxs("div",{className:"text-sm text-gray-400",children:["$",se.price,"/month"]})]})]}),e.jsxs(d,{className:"bg-white/5 border-white/10",children:[e.jsx(h,{className:"pb-3",children:e.jsx(g,{className:"text-sm font-medium text-gray-400",children:"Team Members"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:U.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Active members"})]})]}),e.jsxs(d,{className:"bg-white/5 border-white/10",children:[e.jsx(h,{className:"pb-3",children:e.jsx(g,{className:"text-sm font-medium text-gray-400",children:"Seat Usage"})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[T.seats_used,"/",T.seat_limit]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-glass-orange h-2 rounded-full transition-all",style:{width:`${ae}%`}})})]})]}),e.jsxs(d,{className:"bg-white/5 border-white/10",children:[e.jsx(h,{className:"pb-3",children:e.jsx(g,{className:"text-sm font-medium text-gray-400",children:"Active Trips"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:"0"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Pro trips"})]})]})]}),e.jsxs(j,{value:Y,onValueChange:q,className:"w-full",children:[e.jsxs(u,{className:"bg-white/5 border border-white/10",children:[e.jsxs(p,{value:"overview",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(I,{size:16,className:"mr-2"}),"Overview"]}),e.jsxs(p,{value:"team",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(B,{size:16,className:"mr-2"}),"Team (",U.length,")"]}),e.jsxs(p,{value:"trips",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(P,{size:16,className:"mr-2"}),"Trips"]}),ee&&e.jsxs(p,{value:"settings",className:"data-[state=active]:bg-glass-orange",children:[e.jsx(o,{size:16,className:"mr-2"}),"Settings"]})]}),e.jsx(b,{value:"overview",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(f,{organization:{id:T.id,name:T.name,displayName:T.display_name,billingEmail:T.billing_email}}),e.jsx(w,{organization:{subscriptionTier:T.subscription_tier,subscriptionEndsAt:T.subscription_ends_at||"N/A",seatsUsed:T.seats_used,seatLimit:T.seat_limit}})]})}),e.jsx(b,{value:"team",className:"mt-6",children:e.jsx(y,{organization:{seatLimit:T.seat_limit,seatsUsed:T.seats_used}})}),e.jsx(b,{value:"trips",className:"mt-6",children:G?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-glass-orange border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading trips..."})]}):0===K.length?e.jsx(d,{className:"bg-white/5 border-white/10",children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(P,{size:64,className:"text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No Pro Trips Yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Create your first Pro trip and link it to this organization"}),e.jsx(m,{onClick:()=>_("/"),children:"Create Pro Trip"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:K.map(s=>e.jsxs(d,{className:"bg-white/5 border-white/10 hover:bg-white/10 transition-all cursor-pointer group",onClick:()=>_(`/tour/pro/${s.id}`),children:[s.cover_image_url&&e.jsx("div",{className:"h-32 bg-cover bg-center rounded-t-lg",style:{backgroundImage:`url(${s.cover_image_url})`}}),e.jsxs(h,{children:[e.jsx(g,{className:"text-white group-hover:text-glass-orange transition-colors",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.destination})]}),e.jsxs(x,{children:[s.start_date&&s.end_date&&e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]}),s.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-2 line-clamp-2",children:s.description})]})]},s.id))})}),ee&&e.jsx(b,{value:"settings",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{organization:{id:T.id,name:T.name,displayName:T.display_name,billingEmail:T.billing_email}}),e.jsx(w,{organization:{subscriptionTier:T.subscription_tier,subscriptionEndsAt:T.subscription_ends_at||"N/A",seatsUsed:T.seats_used,seatLimit:T.seat_limit}})]})})]}),e.jsx(N,{open:H,onClose:()=>J(!1),organizationId:k})]})})};export{$ as OrganizationDashboard};
