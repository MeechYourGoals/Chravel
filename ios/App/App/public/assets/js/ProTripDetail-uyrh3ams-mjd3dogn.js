const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/exportPdfClient-BlEK9_X8-mjd3dogn.js","assets/js/pdf-G87Ow8VM-mjd3dogn.js","assets/js/supabase-DyX-XggK-mjd3dogn.js","assets/js/react-vendor-D1R0t5S0-mjd3dogn.js","assets/js/tripExportDataService-DiA2Alf2-mjd3dogn.js","assets/js/index-Ta7FH5xW-mjd3dogn.js","assets/js/ui-vendor-BO3EQrMK-mjd3dogn.js","assets/js/utils-DD44zzh--mjd3dogn.js","assets/index-Bc63Wok3.css","assets/js/eventsMockData-BWXZ-nj7-mjd3dogn.js","assets/js/tripsData-DKwZ96V_-mjd3dogn.js","assets/js/TripDetailModals-BpnQZ47b-mjd3dogn.js","assets/js/tripConverter-C1IUbOIF-mjd3dogn.js","assets/js/select-CMjqEsxb-mjd3dogn.js","assets/js/SettingsMenu-DFNATHGY-mjd3dogn.js","assets/js/SavedRecommendations-D-6cIfyL-mjd3dogn.js","assets/js/card-jeNxgMYk-mjd3dogn.js","assets/js/badge-DyE_ZUPM-mjd3dogn.js","assets/js/useSavedRecommendations-DTox9Xl2-mjd3dogn.js","assets/js/map-pin-BtCU-LeS-mjd3dogn.js","assets/js/plus-Dhwa7sZY-mjd3dogn.js","assets/js/pro-CZgaTEEg-mjd3dogn.js","assets/js/BillingSection-CjHrdMm3-mjd3dogn.js","assets/js/building-QMpp1aWF-mjd3dogn.js","assets/js/camera-AJLsIMdA-mjd3dogn.js","assets/js/user-DFuJ2ZP3-mjd3dogn.js","assets/js/shield-DGBvlKQi-mjd3dogn.js","assets/js/zap-LZcBFzwj-mjd3dogn.js","assets/js/trending-up-B0a-0y1l-mjd3dogn.js","assets/js/input-DsI2n-oJ-mjd3dogn.js","assets/js/label-D_iG0y88-mjd3dogn.js","assets/js/switch-GKuTbu---mjd3dogn.js","assets/js/loader-circle-C0Dqayt8-mjd3dogn.js","assets/js/mail-BdBVrsyz-mjd3dogn.js","assets/js/userPreferencesService-DregIO64-mjd3dogn.js","assets/js/calendar-C9K0fVga-mjd3dogn.js","assets/js/archive-zX2FvEif-mjd3dogn.js","assets/js/AuthModal-BKw70HSh-mjd3dogn.js","assets/js/arrow-left-Biq1qnK6-mjd3dogn.js","assets/js/eye-BNDPAvT6-mjd3dogn.js","assets/js/users-B07yK8Y7-mjd3dogn.js","assets/js/dropdown-menu-BXaKb4pk-mjd3dogn.js","assets/js/chevron-right-DKRZr0Ps-mjd3dogn.js","assets/js/dialog-BcLamxvL-mjd3dogn.js","assets/js/calendar-ylgcJK3b-mjd3dogn.js","assets/js/chevron-left-C1xtDQ_l-mjd3dogn.js","assets/js/progress-D31nnzej-mjd3dogn.js","assets/js/textarea-BudkfAn8-mjd3dogn.js","assets/js/googlePlacesNew-Dl7cAwDK-mjd3dogn.js","assets/js/external-link-CqAT5ABV-mjd3dogn.js","assets/js/circle-check-big-Bvor9_sf-mjd3dogn.js","assets/js/avatar-HCmfb6Ad-mjd3dogn.js","assets/js/circle-alert-CX60mGhN-mjd3dogn.js","assets/js/clock-CbBGjTQx-mjd3dogn.js","assets/js/chart-column-DOJCLy2J-mjd3dogn.js","assets/js/circle-check-CNnkiDfZ-mjd3dogn.js","assets/js/charts-CLK9EMgA-mjd3dogn.js","assets/js/share-2-DwO-SOoB-mjd3dogn.js","assets/TripDetailModals-D8Md-CES.css","assets/js/ProTripDetailContent-iGeMIXMN-mjd3dogn.js","assets/js/useSuperAdmin-CWSn9Z4T-mjd3dogn.js","assets/js/TripTabs-C7qFs-l2-mjd3dogn.js","assets/js/GroupCalendar-C7tHoqVY-mjd3dogn.js","assets/js/UnifiedMediaHub-CeKqWQUM-mjd3dogn.js","assets/js/tabs-Dxuz3Y6S-mjd3dogn.js","assets/js/AddLinkModal-BcpZ7zHk-mjd3dogn.js","assets/js/PaymentsTab-CYY5YmCQ-mjd3dogn.js","assets/js/trending-down-MCtSAEQe-mjd3dogn.js","assets/js/checkbox-DB2Rf35T-mjd3dogn.js","assets/js/save-DwQheero-mjd3dogn.js","assets/js/TripTasksTab-Cb9C55d5-mjd3dogn.js","assets/js/sheet-L6YEzMS_-mjd3dogn.js","assets/js/user-check-D5SE8eAf-mjd3dogn.js","assets/js/heart-NvjcWaZX-mjd3dogn.js","assets/js/ProTripNotFound-cUoNZi2a-mjd3dogn.js"])))=>i.map(i=>d[i]);
import{j as e}from"./ui-vendor-BO3EQrMK-mjd3dogn.js";import{u as t,d as i,t as a,k as s,m as n,s as r,p as o,L as l,f as d}from"./index-Ta7FH5xW-mjd3dogn.js";import{_ as c}from"./supabase-DyX-XggK-mjd3dogn.js";import{u as p,i as m,r as u,R as g}from"./react-vendor-D1R0t5S0-mjd3dogn.js";import{u as h,a as x,f,h as v,M as b,b as y,c as j,d as w,e as _,T}from"./TripDetailModals-BpnQZ47b-mjd3dogn.js";import{u as S,j as C,o as P,e as I,T as N,I as k,c as D,t as E}from"./tripConverter-C1IUbOIF-mjd3dogn.js";import{d as F}from"./SettingsMenu-DFNATHGY-mjd3dogn.js";import{p as R}from"./eventsMockData-BWXZ-nj7-mjd3dogn.js";import{A as O}from"./arrow-left-Biq1qnK6-mjd3dogn.js";import{E as M}from"./progress-D31nnzej-mjd3dogn.js";import{P as A}from"./ProTripNotFound-cUoNZi2a-mjd3dogn.js";import{u as z}from"./useSuperAdmin-CWSn9Z4T-mjd3dogn.js";const L=()=>{var n;const{proTripId:r}=p(),o=m(),{user:l}=t(),{isDemoMode:d,isLoading:_}=i(),{trips:T,loading:E}=S(),{tripMembers:A,loading:z}=h(r),[L,$]=u.useState(()=>{if("undefined"==typeof window)return"chat";return sessionStorage.getItem(`protrip_${r}_activeTab`)||"chat"}),[U,V]=u.useState(""),[B,J]=u.useState(!1),[G,q]=u.useState(!1),[H,Y]=u.useState(!1),[Z,W]=u.useState(!1),[Q,X]=u.useState(!1),[K,ee]=u.useState(!1),te=g.useRef(null);g.useEffect(()=>{r&&sessionStorage.setItem(`protrip_${r}_activeTab`,L)},[L,r]),x({preventZoom:!0,adjustViewport:!0});const ie=u.useMemo(()=>{if(!r)return null;if(d)return r in R?R[r]:null;const e=T.find(e=>String(e.id)===r&&"pro"===e.trip_type);if(!e)return null;const t=C(e),i=A.map(e=>({id:e.id,name:e.name,avatar:e.avatar,role:"member",email:"",credentialLevel:"Guest",permissions:[]}));return{...t,participants:i,roster:i,proTripCategory:"Sports – Pro, Collegiate, Youth",enabled_features:e.enabled_features||["chat","calendar","concierge","media","payments","places","polls","tasks"]}},[d,r,T,A]);g.useEffect(()=>{if(d&&r&&r in R){const e=R[r];if(!f.getRolesForTrip(r)){const t=f.seedRolesForTrip(r,e.proTripCategory,(null==l?void 0:l.id)||"demo-user");f.seedChannelsForRoles(r,t,(null==l?void 0:l.id)||"demo-user")}}},[d,r,null==l?void 0:l.id]),g.useEffect(()=>{ie&&!U&&V(ie.description||"")},[ie,U]),g.useEffect(()=>{const e=()=>{var e;const t=(null==(e=te.current)?void 0:e.offsetHeight)||73;document.documentElement.style.setProperty("--mobile-header-h",`${t}px`)},t=((e,t=100)=>{let i;return()=>{clearTimeout(i),i=setTimeout(e,t)}})(e,100);return e(),window.addEventListener("resize",t),window.addEventListener("orientationchange",t),()=>{window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}},[]);const ae=u.useCallback(async e=>{var t;const i=r||"1",n=!i.includes("-");a.info("Generating PDF",{description:`Creating summary for "${(null==ie?void 0:ie.title)||"Pro Trip"}"...`});try{let r;if(d||n){const a=s.getMockPayments(i),n=s.getMockPolls(i),o=s.getMockTasks(i),l=s.getMockPlaces(i),{generateClientPDF:d}=await c(async()=>{const{generateClientPDF:e}=await import("./exportPdfClient-BlEK9_X8-mjd3dogn.js");return{generateClientPDF:e}},__vite__mapDeps([0,1,2,3]));r=await d({tripId:i,tripTitle:(null==ie?void 0:ie.title)||"Pro Trip",destination:null==ie?void 0:ie.location,dateRange:null==ie?void 0:ie.dateRange,calendar:e.includes("calendar")?[]:void 0,payments:e.includes("payments")&&a.length>0?{items:a,total:a.reduce((e,t)=>e+t.amount,0),currency:(null==(t=a[0])?void 0:t.currency)||"USD"}:void 0,polls:e.includes("polls")?n:void 0,tasks:e.includes("tasks")?o.map(e=>({title:e.title,description:e.description,completed:e.completed})):void 0,places:e.includes("places")?l:void 0},e,{customization:{compress:!0,maxItemsPerSection:100}})}else{const{getExportData:t}=await c(async()=>{const{getExportData:e}=await import("./tripExportDataService-DiA2Alf2-mjd3dogn.js");return{getExportData:e}},__vite__mapDeps([4,5,6,3,2,7,8,9,10])),a=await t(i,e);if(!a)throw new Error("Could not fetch trip data for export");const{generateClientPDF:s}=await c(async()=>{const{generateClientPDF:e}=await import("./exportPdfClient-BlEK9_X8-mjd3dogn.js");return{generateClientPDF:e}},__vite__mapDeps([0,1,2,3]));r=await s({tripId:i,tripTitle:a.trip.title,destination:a.trip.destination,dateRange:a.trip.dateRange,description:a.trip.description,calendar:a.calendar,payments:a.payments,polls:a.polls,tasks:a.tasks,places:a.places,roster:a.roster},e,{customization:{compress:!0,maxItemsPerSection:100}})}const o=`ProTrip_${((null==ie?void 0:ie.title)||"Pro Trip").replace(/[^a-zA-Z0-9]/g,"_")}_${Date.now()}.pdf`;await P(r,o,{mimeType:"application/pdf"}),a.success("Export complete",{description:`PDF ready: ${o}`})}catch(o){throw a.error("Export failed",{description:o instanceof Error?o.message:"Failed to generate PDF. Please try again."}),o}},[r,ie,d]),se=u.useCallback(async()=>{var e;if(!ie)return;const t=`https://p.chravel.app/t/${encodeURIComponent(String(r))}`,i=(null==(e=ie.participants)?void 0:e.length)||0,s=`Check out ${ie.title} - a trip to ${ie.location}! ${i} team members are going.`;if(navigator.share)try{await navigator.share({title:ie.title,text:s,url:t}),a.success("Share sheet opened")}catch(n){if("AbortError"!==n.name)try{await navigator.clipboard.writeText(t),a.success("Share link copied to clipboard")}catch{a.error("Failed to share")}}else try{await navigator.clipboard.writeText(t),a.success("Share link copied to clipboard")}catch{a.error("Failed to copy share link")}},[r,ie]),ne=u.useCallback(async()=>{if((null==l?void 0:l.id)&&r){ee(!0);try{await F(r,l.id),a.success("Trip deleted",{description:`"${null==ie?void 0:ie.title}" has been removed from your account.`}),X(!1),o("/")}catch(e){"CREATOR_CANNOT_DELETE"===(e instanceof Error?e.message:"Unknown error")?a.error("Cannot delete trip",{description:"As the trip creator, you cannot delete this trip for yourself. Consider archiving it instead."}):a.error("Failed to delete trip",{description:"There was an error deleting your trip. Please try again."})}finally{ee(!1)}}else a.error("You must be logged in to delete a trip")},[null==l?void 0:l.id,r,null==ie?void 0:ie.title,o]);if(_)return e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Initializing..."})]})});if(!r)return e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trip Not Found"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"No trip ID provided."}),e.jsx("button",{onClick:()=>{v.light(),o("/")},className:"bg-blue-600 text-white px-6 py-3 rounded-xl transition-colors active:scale-95",children:"Back to My Trips"})]})});if(E&&!d)return e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading trip..."})]})});if(!ie){const t=d?"The demo trip you're looking for doesn't exist.":"This Pro trip doesn't exist or you don't have access.";return e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Pro Trip Not Found"}),e.jsx("p",{className:"text-gray-400 mb-2",children:t}),d&&e.jsxs("p",{className:"text-xs text-gray-500 mb-6",children:["Trip ID: ",r]}),e.jsx("button",{onClick:()=>{v.light(),o("/")},className:"bg-blue-600 text-white px-6 py-3 rounded-xl transition-colors active:scale-95",children:"Back to My Trips"})]})})}const re={id:parseInt(ie.id)||0,title:ie.title,location:ie.location,dateRange:ie.dateRange,description:U||ie.description||"",participants:ie.participants||[]},oe={name:ie.basecamp_name||"Team Base",address:ie.basecamp_address||ie.location};return e.jsx(b,{children:e.jsxs("div",{className:"flex flex-col min-h-screen bg-black",children:[e.jsx("div",{ref:te,className:"sticky top-0 z-50 bg-black/95 backdrop-blur-md border-b border-white/10 mobile-safe-header",children:e.jsx("div",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("button",{onClick:()=>{v.light(),o("/")},className:"flex-shrink-0 min-w-[44px] min-h-[44px] p-2 -ml-2 active:scale-95 transition-transform touch-manipulation flex items-center justify-center",style:{touchAction:"manipulation"},children:e.jsx(O,{size:22,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-center",children:[e.jsx("h1",{className:"text-base font-semibold text-white leading-tight truncate",children:ie.title}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-xs text-gray-400",children:[e.jsxs("span",{className:"truncate",children:[ie.location," • ",(null==(n=ie.participants)?void 0:n.length)||0," team members"]}),e.jsxs("button",{onClick:()=>{v.light(),J(!0)},className:"flex-shrink-0 flex items-center gap-0.5 active:scale-95 transition-transform text-blue-400 hover:text-blue-300","aria-label":"View trip details",children:[e.jsx(I,{size:14}),e.jsx("span",{className:"font-medium",children:"More"})]})]})]}),e.jsx("button",{onClick:()=>{v.light(),Y(!0)},className:"flex-shrink-0 min-w-[44px] min-h-[44px] p-2 -mr-2 active:scale-95 transition-transform touch-manipulation flex items-center justify-center",style:{touchAction:"manipulation"},children:e.jsx(M,{size:22,className:"text-white"})})]})})}),e.jsx(y,{activeTab:L,onTabChange:e=>{v.light(),$(e)},tripId:r,basecamp:oe,variant:"pro",participants:(ie.participants||[]).map(e=>({id:String(e.id),name:e.name,role:e.role})),tripData:ie}),e.jsx(j,{trip:re,isOpen:B,onClose:()=>{v.light(),J(!1)},onDescriptionUpdate:V,onShowExport:()=>{J(!1),setTimeout(()=>q(!0),200)},category:ie.proTripCategory,tags:ie.tags}),e.jsx(w,{isOpen:H,onClose:()=>Y(!1),tripTitle:null==ie?void 0:ie.title,onShare:se,onExport:()=>q(!0),onInvite:()=>W(!0),onDelete:()=>X(!0)}),e.jsx(N,{isOpen:G,onClose:()=>q(!1),onExport:ae,tripName:(null==ie?void 0:ie.title)||"Pro Trip",tripId:r||"1"}),e.jsx(k,{isOpen:Z,onClose:()=>W(!1),tripName:(null==ie?void 0:ie.title)||"Pro Trip",proTripId:r}),e.jsx(D,{isOpen:Q,onClose:()=>X(!1),onConfirm:ne,tripTitle:(null==ie?void 0:ie.title)||"Pro Trip",isLoading:K})]})})},$=({tripContext:i,showInbox:a,onToggleInbox:s,onShowInvite:r,onShowTripSettings:o,onShowAuth:l})=>{const d=m();t();const{accentColors:c}=n();return e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:()=>d("/"),className:"flex items-center gap-3 text-gray-300 hover:text-white transition-colors group",children:[e.jsx("div",{className:"bg-gray-800 p-2 rounded-lg shadow-lg group-hover:shadow-yellow-500/20 transition-all border border-gray-700 hover:border-yellow-500/50",children:e.jsx(O,{size:20})}),e.jsx("span",{className:"font-medium",children:"Back to Trips"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:`bg-gradient-to-r ${c.gradient} backdrop-blur-sm border border-yellow-500/30 rounded-xl px-4 py-2 flex items-center gap-2`,children:e.jsx("span",{className:"text-white font-medium",children:"PRO"})})})]})},U=e=>{const{user:a}=t(),{isDemoMode:s}=i(),{isSuperAdmin:n}=z(),[o,l]=u.useState(!1),[d,c]=u.useState(null),[p,m]=u.useState(!0),g=u.useCallback(async()=>{if((null==a?void 0:a.id)&&e)try{if(m(!0),n)return l(!0),c({can_manage_roles:!0,can_manage_channels:!0,can_designate_admins:!0}),void m(!1);if(s)return l(!0),c({can_manage_roles:!0,can_manage_channels:!0,can_designate_admins:!0}),void m(!1);const{data:t,error:i}=await r.from("trip_admins").select("permissions").eq("trip_id",e).eq("user_id",a.id).single();if(i||!t)return l(!1),void c(null);l(!0),c(t.permissions)}catch(t){l(!1),c(null)}finally{m(!1)}else m(!1)},[null==a?void 0:a.id,e,s,n]);u.useEffect(()=>{g()},[g]);const h=u.useCallback(e=>!(!o||!d)&&!0===d[e],[o,d]);return{isAdmin:o,permissions:d,isLoading:p,hasPermission:h,refreshAdminStatus:g}},V=u.lazy(()=>c(()=>import("./TripDetailModals-BpnQZ47b-mjd3dogn.js").then(e=>e.U),__vite__mapDeps([11,6,3,5,2,7,8,12,10,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,9,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58])).then(e=>({default:e.TripHeader}))),B=u.lazy(()=>c(()=>import("./ProTripDetailContent-iGeMIXMN-mjd3dogn.js"),__vite__mapDeps([59,6,3,12,5,2,7,8,10,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,60,11,41,42,43,9,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,61,62,63,64,65,66,67,68,69,70,71,72,73,74])).then(e=>({default:e.ProTripDetailContent}))),J=()=>{var s,n;const{proTripId:d}=p(),{user:m}=t(),{isDemoMode:h,isLoading:x}=i(),{trips:v,loading:b}=S(),[y,j]=u.useState("chat"),[w,I]=u.useState(!1),[k,D]=u.useState(!1),[F,O]=u.useState(!1),[M,z]=u.useState(!1),[L,J]=u.useState(!1),[G,q]=u.useState(!1),[H,Y]=u.useState(!1),[Z,W]=u.useState([]);U(d||"");const Q=u.useMemo(()=>{if(!d)return null;if(h)return d in R?R[d]:null;const e=v.find(e=>e.id===d&&"pro"===e.trip_type);if(!e)return null;return{...C(e),participants:Z.length>0?Z:[],roster:Z.length>0?Z:[],proTripCategory:"Sports – Pro, Collegiate, Youth",enabled_features:e.enabled_features||["chat","calendar","concierge","media","payments","places","polls","tasks"]}},[h,d,v,Z]);g.useEffect(()=>{if(h&&d&&d in R){const e=R[d];if(!f.getRolesForTrip(d)){const t=f.seedRolesForTrip(d,e.proTripCategory,(null==m?void 0:m.id)||"demo-user");f.seedChannelsForRoles(d,t,(null==m?void 0:m.id)||"demo-user")}}},[h,d,null==m?void 0:m.id]),g.useEffect(()=>{if(!h&&d){(async()=>{try{const e=await E.getTripMembers(d);W(e.map(e=>{var t,i,a;return{id:e.user_id,name:(null==(t=e.profiles)?void 0:t.display_name)||"Unknown",avatar:null==(i=e.profiles)?void 0:i.avatar_url,role:e.role||"member",email:(null==(a=e.profiles)?void 0:a.email)||"",credentialLevel:"Guest",permissions:[]}}))}catch(e){}})()}},[h,d]);const X=g.useMemo(()=>{var e,t;if(!Q)return null;const i=v.find(e=>e.id===Q.id),a=h?"demo-user":(null==i?void 0:i.created_by)||(null==m?void 0:m.id)||"";return{...{id:Q.id,name:Q.title,description:Q.description||"",destination:Q.location,start_date:(null==(e=Q.dateRange)?void 0:e.split(" - ")[0])||"",end_date:(null==(t=Q.dateRange)?void 0:t.split(" - ")[1])||"",created_by:a,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_archived:!1,trip_type:"pro"},basecamp:{name:Q.basecamp_name||"",address:Q.basecamp_address||""},broadcasts:Q.broadcasts||[],links:Q.links||[],participants:Q.participants||[],proTripCategory:Q.proTripCategory,budget:Q.budget,schedule:Q.schedule,roster:Q.roster,roomAssignments:Q.roomAssignments,perDiem:Q.perDiem,settlement:Q.settlement,medical:Q.medical,compliance:Q.compliance,media:Q.media,sponsors:Q.sponsors}},[Q]);if(g.useEffect(()=>{if(!Q)return;setTimeout(()=>{const e=document.querySelector("[data-chat-container]");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},300)},[Q]),x||b&&!h)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Initializing..."})]})});if(!d)return e.jsx(A,{message:"No trip ID provided."});if(!Q||!X){const t=h?"The requested trip could not be found in demo data.":"This Pro trip doesn't exist or you don't have access.";return e.jsx(A,{message:t,details:h?`Trip ID: ${d}`:void 0,availableIds:h?Object.keys(R):void 0})}Q.participants;const K=v.find(e=>e.id===Q.id),ee=h?"demo-user":(null==K?void 0:K.created_by)||(null==m?void 0:m.id)||"",te={id:Q.id,name:Q.title,description:Q.description||"",destination:Q.location,start_date:(null==(s=Q.dateRange)?void 0:s.split(" - ")[0])||"",end_date:(null==(n=Q.dateRange)?void 0:n.split(" - ")[1])||"",created_by:ee,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_archived:!1,trip_type:"pro"},ie={name:Q.basecamp_name||"",address:Q.basecamp_address||""};Q.broadcasts,Q.links;return e.jsx(o,{variant:"pro",children:e.jsxs("div",{className:"min-h-screen bg-black text-white",children:[e.jsxs("div",{className:"container mx-auto px-6 py-4 pb-8 max-w-7xl",children:[e.jsx($,{tripContext:X,showInbox:w,onToggleInbox:()=>I(!w),onShowInvite:()=>O(!0),onShowTripSettings:()=>J(!0),onShowAuth:()=>z(!0)}),w&&e.jsx(_,{}),e.jsx(u.Suspense,{fallback:e.jsxs("div",{className:"mb-8 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-white/5 rounded w-2/3 mb-4"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("div",{className:"h-6 bg-white/5 rounded w-24"}),e.jsx("div",{className:"h-6 bg-white/5 rounded w-24"})]}),e.jsx("div",{className:"h-32 bg-white/5 rounded"})]}),children:e.jsx(V,{trip:{id:Q.id,title:Q.title,location:Q.location,dateRange:Q.dateRange,description:Q.description||"",participants:Q.participants,created_by:ee,trip_type:"pro"},category:Q.proTripCategory,tags:Q.tags,onCategoryChange:()=>{},onShowExport:()=>Y(!0)})}),e.jsx(u.Suspense,{fallback:e.jsx(l,{className:"my-12"}),children:e.jsx(B,{activeTab:y,onTabChange:j,onShowTripsPlusModal:()=>q(!1),tripId:d,basecamp:ie,tripData:{...Q,enabled_features:Q.enabled_features,trip_type:"pro"},selectedCategory:Q.proTripCategory,trip:te,tripCreatorId:te.created_by})})]}),e.jsx(T,{showSettings:k,onCloseSettings:()=>D(!1),showInvite:F,onCloseInvite:()=>O(!1),showAuth:M,onCloseAuth:()=>z(!1),showTripSettings:L,onCloseTripSettings:()=>J(!1),showTripsPlusModal:G,onCloseTripsPlusModal:()=>q(!1),tripName:Q.title,tripId:d,userId:null==m?void 0:m.id}),e.jsx(N,{isOpen:H,onClose:()=>Y(!1),onExport:async e=>{var t,i,s,n,o,l,p,m,u;try{let g,x=null;try{const e=navigator.userAgent||"",t=/iPad|iPhone|iPod/.test(e)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,i=/^((?!chrome|android|crios|fxios|edgios).)*safari/i.test(e);t&&i&&(x=window.open("","_blank"),x&&x.document.write('<html><head><title>Generating PDF…</title><meta name="viewport" content="width=device-width, initial-scale=1"></head><body style="font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial; padding: 16px; color: #e5e7eb; background: #111827"><div>Generating PDF…</div></body></html>'))}catch{}if(a.info("Generating PDF..."),h){const{generateClientPDF:a}=await c(async()=>{const{generateClientPDF:e}=await import("./exportPdfClient-BlEK9_X8-mjd3dogn.js");return{generateClientPDF:e}},__vite__mapDeps([0,1,2,3])),r={tripId:d||"",tripTitle:Q.title,destination:Q.location,dateRange:Q.dateRange,description:Q.description||""};e.includes("calendar")&&(r.calendar=(null==(t=Q.schedule)?void 0:t.map(e=>({title:e.title||"Event",start_time:e.startTime||(new Date).toISOString(),location:e.location,description:e.notes})))||[]),e.includes("payments")&&Q.settlement&&Q.settlement.length>0&&(r.payments={items:Q.settlement.map(e=>({description:e.venue||"Payment",amount:e.finalPayout||0,currency:"USD",split_count:1,is_settled:"paid"===e.status,created_at:e.date})),total:Q.settlement.reduce((e,t)=>e+(t.finalPayout||0),0),currency:"USD"}),e.includes("tasks")&&(r.tasks=(null==(i=Q.tasks)?void 0:i.map(e=>({title:e.title,description:e.description,completed:e.completed,due_date:e.due_at,assigned_to:e.assigned_to})))||[]),e.includes("polls")&&(r.polls=(null==(s=Q.polls)?void 0:s.map(e=>({question:e.question,options:e.options,total_votes:e.total_votes,status:e.status})))||[]),e.includes("places")&&(r.places=(null==(n=Q.links)?void 0:n.map(e=>({name:e.title,url:e.url,description:e.description,votes:0})))||[]),e.includes("broadcasts")&&(r.broadcasts=(null==(o=Q.broadcasts)?void 0:o.map(e=>{var t;return{message:e.message,priority:e.priority,timestamp:e.timestamp,sender:"Tour Manager",read_count:(null==(t=e.readBy)?void 0:t.length)||0}}))||[]),e.includes("roster")&&(r.roster=(null==(l=Q.roster)?void 0:l.map(e=>({name:e.name,email:e.email,role:e.role})))||[]),g=await a(r,e)}else{const{data:t}=await r.auth.getSession(),i=(null==(p=null==t?void 0:t.session)?void 0:p.access_token)||"",s=await fetch("https://jmjiyekmxwsxkfnqwyaa.supabase.co/functions/v1/export-trip",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imptaml5ZWtteHdzeGtmbnF3eWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MjEwMDgsImV4cCI6MjA2OTQ5NzAwOH0.SAas0HWvteb9TbYNJFDf8Itt8mIsDtKOK6QwBcwINhI"},body:JSON.stringify({tripId:d,sections:e,layout:"pro",paper:"letter",privacyRedaction:!0})});if(s.ok)g=await s.blob();else{const t=await s.text();let i="Export failed";try{i=JSON.parse(t).error||i}catch{i=t||i}a.error("Live export failed, generating offline PDF.");const{generateClientPDF:n}=await c(async()=>{const{generateClientPDF:e}=await import("./exportPdfClient-BlEK9_X8-mjd3dogn.js");return{generateClientPDF:e}},__vite__mapDeps([0,1,2,3]));g=await n({tripId:d||"",tripTitle:Q.title,destination:Q.location,dateRange:Q.dateRange,description:Q.description||"",calendar:(null==(m=Q.schedule)?void 0:m.map(e=>({title:e.title||"Event",start_time:e.startTime||(new Date).toISOString(),location:e.location,description:e.notes})))||[],payments:Q.settlement&&Q.settlement.length>0?{items:Q.settlement.map(e=>({description:e.venue||"Payment",amount:e.finalPayout||0,currency:"USD",split_count:1,is_settled:"paid"===e.status})),total:Q.settlement.reduce((e,t)=>e+(t.finalPayout||0),0),currency:"USD"}:void 0,roster:(null==(u=Q.roster)?void 0:u.map(e=>({name:e.name,email:e.email,role:e.role})))||[]},e)}}const f=`Trip_${Q.title.replace(/[^a-z0-9]/gi,"_")}_${Date.now()}.pdf`;await P(g,f,{preOpenedWindow:x,mimeType:"application/pdf"}),a.success("PDF exported successfully!")}catch(g){throw a.error(g instanceof Error?`Export failed: ${g.message}`:"Failed to export PDF"),g}},tripName:Q.title,tripId:d||""})]})})},G=Object.freeze(Object.defineProperty({__proto__:null,default:()=>d()?e.jsx(L,{}):e.jsx(J,{})},Symbol.toStringTag,{value:"Module"}));export{G as P,U as u};
