import{j as e}from"./ui-vendor-BO3EQrMK-mjd3dogn.js";import{u as i,k as a,i as t,r as n}from"./react-vendor-D1R0t5S0-mjd3dogn.js";import{c as s,u as r,s as l,B as o}from"./index-Ta7FH5xW-mjd3dogn.js";import{C as d,a as c,b as m,c as x}from"./card-jeNxgMYk-mjd3dogn.js";import{L as h}from"./loader-circle-C0Dqayt8-mjd3dogn.js";import{C as g}from"./circle-check-big-Bvor9_sf-mjd3dogn.js";import{B as j}from"./building-QMpp1aWF-mjd3dogn.js";import"./supabase-DyX-XggK-mjd3dogn.js";import"./utils-DD44zzh--mjd3dogn.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=s("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),v=()=>{const{token:s}=i(),[v]=a(),f=v.get("token"),b=s||f,p=t(),{user:w}=r(),[y,N]=n.useState(!0),[z,_]=n.useState(!1),[k,I]=n.useState(null),[C,T]=n.useState(null),[S,$]=n.useState(!1);n.useEffect(()=>{if(!b)return T("Invalid invitation link"),void N(!1);if(!w){return void p(`/auth?returnTo=${encodeURIComponent(`/accept-invite/${b}`)}`)}q()},[b,w]);const q=async()=>{var e;try{N(!0);const{data:i,error:a}=await l.from("organization_invites").select("\n          organization_id,\n          email,\n          role,\n          status,\n          expires_at,\n          organizations:organization_id (\n            display_name\n          ),\n          invited_by_profile:invited_by (\n            id\n          )\n        ").eq("token",b).single();if(a||!i)return T("Invitation not found or has expired"),void N(!1);if("pending"!==i.status)return T("This invitation has already been used"),void N(!1);if(new Date(i.expires_at)<new Date)return T("This invitation has expired"),void N(!1);if((null==w?void 0:w.email)!==i.email)return T(`This invitation was sent to ${i.email}. Please log in with that email address.`),void N(!1);const{data:t}=await l.from("organization_members").select("id").eq("organization_id",i.organization_id).eq("user_id",w.id).single();if(t)return T("You are already a member of this organization"),setTimeout(()=>{p(`/organization/${i.organization_id}`)},2e3),void N(!1);I({organization_id:i.organization_id,organization_name:(null==(e=i.organizations)?void 0:e.display_name)||"Unknown Organization",invited_by_name:"Team Admin",role:i.role,email:i.email})}catch(i){T("Failed to load invitation details")}finally{N(!1)}};return y?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{className:"w-12 h-12 text-glass-orange animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading invitation..."})]})}):C?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:e.jsx(d,{className:"bg-white/5 border-white/10 max-w-md w-full",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(u,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Invalid Invitation"}),e.jsx("p",{className:"text-gray-400 mb-6",children:C}),e.jsx(o,{onClick:()=>p("/organizations"),children:"View My Organizations"})]})})}):S?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:e.jsx(d,{className:"bg-white/5 border-white/10 max-w-md w-full",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(g,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Welcome Aboard!"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["You've successfully joined ",null==k?void 0:k.organization_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Redirecting to organization..."})]})})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:e.jsxs(d,{className:"bg-white/5 border-white/10 max-w-md w-full",children:[e.jsxs(m,{children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(j,{size:32,className:"text-white"})})}),e.jsx(x,{className:"text-center text-2xl",children:"Organization Invitation"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 mb-2",children:"You've been invited to join"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:null==k?void 0:k.organization_name}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Role:"}),e.jsx("span",{className:"text-white font-medium capitalize",children:null==k?void 0:k.role})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Invited by:"}),e.jsx("span",{className:"text-white font-medium",children:null==k?void 0:k.invited_by_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Email:"}),e.jsx("span",{className:"text-white font-medium",children:null==k?void 0:k.email})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{onClick:async()=>{if(b&&w)try{_(!0);const{data:e,error:i}=await l.functions.invoke("accept-organization-invite",{body:{token:b}});if(i)throw i;if(e.error)return void T(e.error);$(!0),setTimeout(()=>{p(`/organization/${null==k?void 0:k.organization_id}`)},2e3)}catch(e){T("Failed to accept invitation. Please try again.")}finally{_(!1)}},disabled:z,className:"w-full bg-glass-orange hover:bg-glass-orange/80",children:z?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4 mr-2 animate-spin"}),"Accepting..."]}):"Accept Invitation"}),e.jsx(o,{variant:"outline",onClick:()=>p("/"),className:"w-full border-white/20 text-white hover:bg-white/10",children:"Decline"})]})]})]})})};export{v as AcceptOrganizationInvite};
