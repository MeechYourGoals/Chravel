import{A,ax as T,u as E,k as S,r as c,s as m,j as e}from"./index-CAsyng-G.js";import{B as d}from"./button-_Pv0MPf0.js";import{C as x,a as h,b as B,c as P}from"./card-BWfXNMJp.js";import{L as j}from"./loader-circle-CkOmKk2l.js";import{C as $}from"./circle-x-Bb3qOLS2.js";import{C as F}from"./circle-check-big-DmirYwTN.js";import{B as L}from"./building-Br_mTkeH.js";const Q=()=>{const{token:p}=A(),[b]=T(),w=b.get("token"),o=p||w,l=E(),{user:r}=S(),[N,n]=c.useState(!0),[g,u]=c.useState(!1),[t,v]=c.useState(null),[f,s]=c.useState(null),[y,z]=c.useState(!1);c.useEffect(()=>{if(!o){s("Invalid invitation link"),n(!1);return}if(!r){const i=`/accept-invite/${o}`;l(`/auth?returnTo=${encodeURIComponent(i)}`);return}_()},[o,r]);const _=async()=>{var i;try{n(!0);const{data:a,error:C}=await m.from("organization_invites").select(`
          organization_id,
          email,
          role,
          status,
          expires_at,
          organizations:organization_id (
            display_name
          ),
          invited_by_profile:invited_by (
            id
          )
        `).eq("token",o).single();if(C||!a){s("Invitation not found or has expired"),n(!1);return}if(a.status!=="pending"){s("This invitation has already been used"),n(!1);return}if(new Date(a.expires_at)<new Date){s("This invitation has expired"),n(!1);return}if((r==null?void 0:r.email)!==a.email){s(`This invitation was sent to ${a.email}. Please log in with that email address.`),n(!1);return}const{data:I}=await m.from("organization_members").select("id").eq("organization_id",a.organization_id).eq("user_id",r.id).single();if(I){s("You are already a member of this organization"),setTimeout(()=>{l(`/organization/${a.organization_id}`)},2e3),n(!1);return}v({organization_id:a.organization_id,organization_name:((i=a.organizations)==null?void 0:i.display_name)||"Unknown Organization",invited_by_name:"Team Admin",role:a.role,email:a.email})}catch(a){console.error("Error fetching invite details:",a),s("Failed to load invitation details")}finally{n(!1)}},k=async()=>{if(!(!o||!r))try{u(!0);const{data:i,error:a}=await m.functions.invoke("accept-organization-invite",{body:{token:o}});if(a)throw a;if(i.error){s(i.error);return}z(!0),setTimeout(()=>{l(`/organization/${t==null?void 0:t.organization_id}`)},2e3)}catch(i){console.error("Error accepting invite:",i),s("Failed to accept invitation. Please try again.")}finally{u(!1)}};return N?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"w-12 h-12 text-glass-orange animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading invitation..."})]})}):f?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:e.jsx(x,{className:"bg-white/5 border-white/10 max-w-md w-full",children:e.jsxs(h,{className:"p-8 text-center",children:[e.jsx($,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Invalid Invitation"}),e.jsx("p",{className:"text-gray-400 mb-6",children:f}),e.jsx(d,{onClick:()=>l("/organizations"),children:"View My Organizations"})]})})}):y?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:e.jsx(x,{className:"bg-white/5 border-white/10 max-w-md w-full",children:e.jsxs(h,{className:"p-8 text-center",children:[e.jsx(F,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Welcome Aboard!"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["You've successfully joined ",t==null?void 0:t.organization_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Redirecting to organization..."})]})})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:e.jsxs(x,{className:"bg-white/5 border-white/10 max-w-md w-full",children:[e.jsxs(B,{children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(L,{size:32,className:"text-white"})})}),e.jsx(P,{className:"text-center text-2xl",children:"Organization Invitation"})]}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 mb-2",children:"You've been invited to join"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:t==null?void 0:t.organization_name}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Role:"}),e.jsx("span",{className:"text-white font-medium capitalize",children:t==null?void 0:t.role})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Invited by:"}),e.jsx("span",{className:"text-white font-medium",children:t==null?void 0:t.invited_by_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Email:"}),e.jsx("span",{className:"text-white font-medium",children:t==null?void 0:t.email})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{onClick:k,disabled:g,className:"w-full bg-glass-orange hover:bg-glass-orange/80",children:g?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4 mr-2 animate-spin"}),"Accepting..."]}):"Accept Invitation"}),e.jsx(d,{variant:"outline",onClick:()=>l("/"),className:"w-full border-white/20 text-white hover:bg-white/10",children:"Decline"})]})]})]})})};export{Q as AcceptOrganizationInvite};
