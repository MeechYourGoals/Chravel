var e=Object.defineProperty,t=(t,a,i)=>((t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i)(t,"symbol"!=typeof a?a+"":a,i);import{s as a,t as i}from"./index-Ta7FH5xW-mjd3dogn.js";function s(){var e,t;const a=null==(t=null==(e=import.meta)?void 0:e.env)?void 0:t.VITE_GOOGLE_MAPS_API_KEY;return a&&"placeholder"!==a?a:"AIzaSyAz3raJADWR86fJEV5Hx1_6V_Pgyj3ozw4"}function n(e,t,a,i){return new(a||(a=Promise))(function(t,s){function n(e){try{o(i.next(e))}catch(t){s(t)}}function r(e){try{o(i.throw(e))}catch(t){s(t)}}function o(e){var i;e.done?t(e.value):(i=e.value,i instanceof a?i:new a(function(e){e(i)})).then(n,r)}o((i=i.apply(e,[])).next())})}function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,l;s(),"function"==typeof SuppressedError&&SuppressedError;var c=r(l?o:(l=1,o=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var i,s,n;if(Array.isArray(t)){if((i=t.length)!=a.length)return!1;for(s=i;0!==s--;)if(!e(t[s],a[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((i=(n=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(s=i;0!==s--;)if(!Object.prototype.hasOwnProperty.call(a,n[s]))return!1;for(s=i;0!==s--;){var r=n[s];if(!e(t[r],a[r]))return!1}return!0}return t!=t&&a!=a}));const u="__googleMapsScriptId";var d,h;(h=d||(d={}))[h.INITIALIZED=0]="INITIALIZED",h[h.LOADING=1]="LOADING",h[h.SUCCESS=2]="SUCCESS",h[h.FAILURE=3]="FAILURE";class p{constructor({apiKey:e,authReferrerPolicy:t,channel:a,client:i,id:s=u,language:n,libraries:r=[],mapIds:o,nonce:l,region:d,retries:h=3,url:g="https://maps.googleapis.com/maps/api/js",version:m}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=a,this.client=i,this.id=s||u,this.language=n,this.libraries=r,this.mapIds=o,this.nonce=l,this.region=d,this.retries=h,this.url=g,this.version=m,p.instance){if(!c(this.options,p.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(p.instance.options)}`);return p.instance}p.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?d.FAILURE:this.done?d.SUCCESS:this.loading?d.LOADING:d.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(a=>{a?t(a.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id))return void this.callback();const a={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(a).forEach(e=>!a[e]&&delete a[e]),(null===(t=null===(e=null===window||void 0===window?void 0:window.google)||void 0===e?void 0:e.maps)||void 0===t?void 0:t.importLibrary)||(e=>{let t,a,i,s="google",r="importLibrary",o="__ib__",l=document,c=window;c=c[s]||(c[s]={});const u=c.maps||(c.maps={}),d=new Set,h=new URLSearchParams,p=()=>t||(t=new Promise((r,c)=>n(this,0,void 0,function*(){var n;for(i in yield a=l.createElement("script"),a.id=this.id,h.set("libraries",[...d]+""),e)h.set(i.replace(/[A-Z]/g,e=>"_"+e[0].toLowerCase()),e[i]);h.set("callback",s+".maps."+o),a.src=this.url+"?"+h,u[o]=r,a.onerror=()=>t=c(Error("The Google Maps JavaScript API could not load.")),a.nonce=this.nonce||(null===(n=l.querySelector("script[nonce]"))||void 0===n?void 0:n.nonce)||"",l.head.append(a)})));u[r]||(u[r]=(e,...t)=>d.add(e)&&p().then(()=>u[r](e,...t)))})(a);const i=this.libraries.map(e=>this.importLibrary(e));i.length||i.push(this.importLibrary("core")),Promise.all(i).then(()=>this.callback(),e=>{const t=new ErrorEvent("error",{error:e});this.loadErrorCallback(t)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const e=this.errors.length*Math.pow(2,this.errors.length);setTimeout(()=>{this.deleteScript(),this.setScript()},e)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version)return void this.callback();this.loading=!0,this.setScript()}}}function g(e,t,a,i){const s=[e,t.toLowerCase().trim(),a?`${a.lat.toFixed(6)},${a.lng.toFixed(6)}`:"no-origin",...i?Object.entries(i).map(([e,t])=>`${e}:${t}`):[]].join("|");let n=0;for(let r=0;r<s.length;r++){n=(n<<5)-n+s.charCodeAt(r),n&=n}return`places_cache_${Math.abs(n).toString(36)}`}async function m(e){try{const{data:t,error:i}=await a.rpc("get_places_cache",{p_cache_key:e});return i?null:t||null}catch(t){return null}}async function f(e,t,i,s,n,r){try{const{error:o}=await a.rpc("set_places_cache",{p_cache_key:e,p_query_text:i,p_api_endpoint:t,p_response_data:s,p_place_id:n||null,p_origin_lat:(null==r?void 0:r.lat)||null,p_origin_lng:(null==r?void 0:r.lng)||null})}catch(o){}}async function y(e,t){const i={autocomplete:.017,"text-search":.017,"place-details":.017,"nearby-search":.032,geocode:.005}[e]||.017;try{const{error:s}=await a.rpc("record_api_usage",{p_api_endpoint:e,p_user_id:t||null,p_estimated_cost_usd:i})}catch(s){}}async function w(e,t=5){try{const a=new URL("https://nominatim.openstreetmap.org/search");a.searchParams.set("q",e),a.searchParams.set("format","json"),a.searchParams.set("limit",t.toString()),a.searchParams.set("addressdetails","1"),a.searchParams.set("extratags","1");const i=await fetch(a.toString(),{headers:{"User-Agent":"Chravel/1.0 (https://chravel.com)"}});if(!i.ok)throw new Error(`OSM API error: ${i.status}`);return await i.json()}catch(a){return[]}}function _(e){return{place_id:`osm_${e.place_id}`,name:e.name||e.display_name,formatted_address:e.display_name,geometry:{location:new google.maps.LatLng(parseFloat(e.lat),parseFloat(e.lon))}}}function v(e){if(!(e instanceof Error))return!1;const t=e.message.toLowerCase();return!(!t.includes("quota")&&!t.includes("over_query_limit"))||(!(!t.includes("api key")&&!t.includes("invalid key"))||!!(t.includes("network")||t.includes("timeout")||t.includes("service unavailable")))}let b=null,I=null;const R=new class{constructor(){t(this,"dailyRequests",new Map),t(this,"hourlyRequests",new Map),t(this,"cachedResults",new Map),t(this,"CACHE_TTL",36e5),t(this,"DAILY_LIMIT",1e4),t(this,"HOURLY_LIMIT",1e3)}checkQuota(){const e=(new Date).toISOString().split("T")[0],t=(new Date).toISOString().slice(0,13),a=this.dailyRequests.get(e)||0,i=this.hourlyRequests.get(t)||0;return a>=this.DAILY_LIMIT?{canProceed:!1,reason:"Daily quota exceeded"}:i>=this.HOURLY_LIMIT?{canProceed:!1,reason:"Hourly quota exceeded"}:{canProceed:!0}}recordRequest(){const e=(new Date).toISOString().split("T")[0],t=(new Date).toISOString().slice(0,13);this.dailyRequests.set(e,(this.dailyRequests.get(e)||0)+1),this.hourlyRequests.set(t,(this.hourlyRequests.get(t)||0)+1);const a=new Date;a.setDate(a.getDate()-7);for(const[i]of this.dailyRequests)i<a.toISOString().split("T")[0]&&this.dailyRequests.delete(i)}cacheResult(e,t){this.cachedResults.set(e,{data:t,timestamp:Date.now()});for(const[a,i]of this.cachedResults)Date.now()-i.timestamp>this.CACHE_TTL&&this.cachedResults.delete(a)}getCachedResult(e){const t=this.cachedResults.get(e);return t?Date.now()-t.timestamp>this.CACHE_TTL?(this.cachedResults.delete(e),null):t.data:null}generateCacheKey(e,t){const a=t?`${t.lat},${t.lng}`:"no-origin";return`query:${e.toLowerCase().trim()}:origin:${a}`}getQuotaStats(){const e=(new Date).toISOString().split("T")[0],t=(new Date).toISOString().slice(0,13);return{daily:this.dailyRequests.get(e)||0,hourly:this.hourlyRequests.get(t)||0,dailyLimit:this.DAILY_LIMIT,hourlyLimit:this.HOURLY_LIMIT}}};async function L(e,t=2,a=500){var i,s;let n;for(let o=0;o<=t;o++)try{return await e()}catch(r){if(n=r,(null==(i=null==r?void 0:r.message)?void 0:i.includes("quota"))||(null==(s=null==r?void 0:r.message)?void 0:s.includes("OVER_QUERY_LIMIT")))throw r;if(o===t)break;const e=a*Math.pow(2,o)+1e3*Math.random();await new Promise(t=>setTimeout(t,e))}throw n}async function P(e,t=5e3,a="API request timed out"){return Promise.race([e,new Promise((e,i)=>setTimeout(()=>i(new Error(a)),t))])}async function k(){if(b)return b;if(!I){const e=s();if(!e||"placeholder"===e){const e="Google Maps API key is not configured. Check environment settings.";throw i.error("Maps API key not configured"),new Error(e)}const t=new p({apiKey:e,version:"weekly",libraries:["places","geocoding","marker"]});I=t.load().then(e=>(b=e.maps,b)).catch(e=>{var t,a,s;let n="Failed to load Google Maps";throw(null==(t=e.message)?void 0:t.includes("ApiNotActivatedMapError"))?n="Maps API not enabled - check Google Cloud Console":(null==(a=e.message)?void 0:a.includes("RefererNotAllowedMapError"))?n="Domain not authorized for this API key":(null==(s=e.message)?void 0:s.includes("InvalidKeyMapError"))&&(n="Invalid API key"),i.error(n),I=null,new Error(`Google Maps API failed to load: ${e.message}`)})}return I}function S(e,t=3,a=800){return e&&0!==e.length?e.slice(0,t).map(e=>"function"==typeof e.getURI?e.getURI({maxWidth:a}):e.uri||"").filter(Boolean):[]}function A(e){return{place_id:e.id,name:e.displayName||"Unknown Place",formatted_address:e.formattedAddress,geometry:e.location?{location:e.location,viewport:e.viewport}:void 0,rating:e.rating,website:e.websiteURI,url:e.googleMapsURI,types:e.types,photos:e.photos}}function E(e){const t={centre:"center",theatre:"theater",shoppe:"shop"};let a=e.toLowerCase();for(const[i,s]of Object.entries(t))a=a.replace(new RegExp(i,"g"),s);return a}async function C(e,t=5e3,a=[],i=10){await k();const s=g("nearby-search",`${e.lat},${e.lng}`,null,{radius:t,types:a.join(","),maxResults:i}),n=await m(s);if(n)return n;const{Place:r}=await google.maps.importLibrary("places"),o={locationRestriction:{circle:{center:{latitude:e.lat,longitude:e.lng},radius:t}},fields:["id","displayName","formattedAddress","location","viewport","rating","websiteURI","googleMapsURI","types","userRatingCount","priceLevel","photos"],maxResultCount:Math.min(i,20),languageCode:"en"};a.length>0&&(o.includedTypes=a);try{await y("nearby-search");const{places:t}=await r.searchNearby(o);if(!t||0===t.length)return[];const a=t.map(e=>{var t;return A({id:e.id,displayName:null==(t=e.displayName)?void 0:t.text,formattedAddress:e.formattedAddress,location:e.location,viewport:e.viewport,rating:e.rating,websiteURI:e.websiteURI,googleMapsURI:e.googleMapsURI,types:e.types,photos:e.photos?S(e.photos,3):void 0})}).sort((e,t)=>(t.rating||0)-(e.rating||0));return await f(s,"nearby-search",`${e.lat},${e.lng}`,a,void 0,{lat:e.lat,lng:e.lng}),a}catch(l){if(v(l)){const e=a.length>0?a[0]:"place";return(await w(e,i)).map(e=>{const t=_(e);return{place_id:t.place_id,name:t.name,formatted_address:t.formatted_address,geometry:t.geometry}})}return[]}}async function M(e,t=null,a=5){await k();const i=g("text-search",e,t,{maxResults:a}),s=await m(i);if(s)return s;const{Place:n}=await google.maps.importLibrary("places"),r={textQuery:e,fields:["id","displayName","formattedAddress","location","viewport","rating","websiteURI","googleMapsURI","types","photos"],maxResultCount:a,languageCode:"en"};t&&(r.locationBias={circle:{center:{latitude:t.lat,longitude:t.lng},radius:5e4}});try{await y("text-search");const{places:a}=await n.searchByText(r);if(!a||0===a.length)return[];const s=a.map(e=>{var t;return A({id:e.id,displayName:null==(t=e.displayName)?void 0:t.text,formattedAddress:e.formattedAddress,location:e.location,viewport:e.viewport,rating:e.rating,websiteURI:e.websiteURI,googleMapsURI:e.googleMapsURI,types:e.types,photos:e.photos?S(e.photos,3):void 0})});return await f(i,"text-search",e,s,void 0,t),s}catch(o){if(v(o)){return(await w(e,a)).map(e=>{const t=_(e);return{place_id:t.place_id,name:t.name,formatted_address:t.formatted_address,geometry:t.geometry}})}return[]}}async function x(e,t,a){var i,s;await k();const n=g("autocomplete",e,a),r=await m(n);if(r)return r;const o=R.generateCacheKey(`autocomplete:${e}`,a),l=R.getCachedResult(o);if(l)return l;if(!R.checkQuota().canProceed){const e=R.getCachedResult(o);return e||[]}const{AutocompleteSuggestion:c}=await google.maps.importLibrary("places"),u={input:e,sessionToken:t,languageCode:"en"};a&&(u.locationBias={circle:{center:{latitude:a.lat,longitude:a.lng},radius:5e4}},u.origin={latitude:a.lat,longitude:a.lng});try{R.recordRequest(),await y("autocomplete");const{suggestions:t}=await L(async()=>await c.fetchAutocompleteSuggestions(u));if(!t||0===t.length)return[];const i=t.filter(e=>e.placePrediction).map(e=>{var t;return{place_id:e.placePrediction.placeId,description:e.placePrediction.text.text,structured_formatting:e.placePrediction.structuredFormat?{main_text:e.placePrediction.structuredFormat.mainText.text,secondary_text:null==(t=e.placePrediction.structuredFormat.secondaryText)?void 0:t.text}:void 0}});return R.cacheResult(o,i),await f(n,"autocomplete",e,i,void 0,a),i}catch(d){if((null==(i=null==d?void 0:d.message)?void 0:i.includes("quota"))||(null==(s=null==d?void 0:d.message)?void 0:s.includes("OVER_QUERY_LIMIT"))){const e=R.getCachedResult(o);if(e)return e}return[]}}async function U(e,t){var a;await k();const i=g("place-details",e,null),s=await m(i);if(s)return s;const{Place:n}=await google.maps.importLibrary("places");try{await y("place-details");const t=new n({id:e,requestedLanguage:"en"});await t.fetchFields({fields:["id","displayName","formattedAddress","location","viewport","rating","websiteURI","googleMapsURI","types","userRatingCount","priceLevel"]});const s=A({id:t.id,displayName:(null==(a=t.displayName)?void 0:a.text)||"Unknown",formattedAddress:t.formattedAddress,location:t.location,viewport:t.viewport,rating:t.rating,websiteURI:t.websiteURI,googleMapsURI:t.googleMapsURI,types:t.types});return await f(i,"place-details",e,s,e),s}catch(r){return v(r),null}}async function O(e,t,a){var i,s;await k();const n=g("text-search",e,t),r=await m(n);if(r)return r;const o=R.generateCacheKey(`resolve:${e}`,t),l=R.getCachedResult(o);if(l)return l;if(!R.checkQuota().canProceed){const t=R.getCachedResult(o);return t||await T(e)}try{if(R.recordRequest(),await y("text-search"),function(e){const t=e.toLowerCase();return["near me","nearby","close to me","around me","closest","nearest"].some(e=>t.includes(e))}(e)&&t){const a=function(e){const t=E(e);return t.includes("coffee")||t.includes("cafe")?["cafe","coffee_shop"]:t.includes("restaurant")||t.includes("food")||t.includes("dining")?["restaurant"]:t.includes("pizza")?["pizza_restaurant"]:t.includes("bar")||t.includes("pub")?["bar","night_club"]:t.includes("bakery")?["bakery"]:t.includes("hotel")||t.includes("lodging")?["lodging","hotel"]:t.includes("gym")||t.includes("fitness")?["gym"]:t.includes("park")?["park"]:t.includes("museum")?["museum"]:t.includes("movie")||t.includes("cinema")||t.includes("theater")?["movie_theater"]:t.includes("shopping")||t.includes("mall")?["shopping_mall"]:t.includes("gas")||t.includes("fuel")?["gas_station"]:t.includes("pharmacy")||t.includes("drugstore")?["pharmacy"]:t.includes("atm")||t.includes("bank")?["atm","bank"]:t.includes("hospital")||t.includes("clinic")?["hospital"]:t.includes("parking")?["parking"]:t.includes("airport")?["airport"]:t.includes("station")?["transit_station"]:t.includes("attraction")?["tourist_attraction"]:t.includes("store")||t.includes("shop")?["store"]:[]}(e),i=await L(async()=>C(t,5e3,a,5));if(i.length>0){const a=i[0];return R.cacheResult(o,a),await f(n,"text-search",e,a,a.place_id,t),a}}(function(e){const t=E(e);t.includes("restaurant")||t.includes("food")||t.includes("dining")||t.includes("cafe")||t.includes("coffee")||(t.includes("hotel")||t.includes("lodging")||t.includes("motel")||t.includes("inn")||(t.includes("stadium")||t.includes("arena")||t.includes("center")||t.includes("coliseum")||t.includes("amphitheater")||(t.includes("theater")||t.includes("cinema")||t.includes("movie")||(t.includes("museum")||(t.includes("park")||(t.includes("landmark")||t.includes("monument")||(t.includes("attraction")||(t.includes("airport")||(t.includes("train")||t.includes("station")||(t.includes("shop")||t.includes("store")||t.includes("mall")||(t.includes("bar")||t.includes("pub")||t.includes("nightclub")||(t.includes("gym")||t.includes("fitness")||(t.includes("spa")||(t.includes("bank")||(t.includes("hospital")||t.includes("clinic")||(t.includes("office")||t.includes("building")||t.match(/\d{3,}/)))))))))))))))))})(e);const a=await L(async()=>M(e,t,1));if(a.length>0){const i=await L(async()=>U(a[0].place_id))||a[0];return R.cacheResult(o,i),await f(n,"text-search",e,i,i.place_id,t),i}await y("geocode");const i=new google.maps.Geocoder,s=await L(async()=>{var a;const s=null==(a=(await i.geocode({address:e,...t&&{bounds:new google.maps.LatLngBounds(new google.maps.LatLng(t.lat-.4,t.lng-.4),new google.maps.LatLng(t.lat+.4,t.lng+.4))}})).results)?void 0:a[0];return s?{place_id:s.place_id,name:s.formatted_address||"Unknown",formatted_address:s.formatted_address,geometry:{location:s.geometry.location,viewport:s.geometry.viewport}}:null});if(s)return R.cacheResult(o,s),await f(n,"text-search",e,s,s.place_id,t),s}catch(c){if((null==(i=null==c?void 0:c.message)?void 0:i.includes("quota"))||(null==(s=null==c?void 0:c.message)?void 0:s.includes("OVER_QUERY_LIMIT"))){const e=R.getCachedResult(o);if(e)return e}if(v(c))return await T(e)}return await T(e)}async function T(e,t){try{const t=await w(e,1);if(t.length>0){const e=_(t[0]);return{place_id:e.place_id,name:e.name,formatted_address:e.formatted_address,geometry:e.geometry}}const a=await async function(e){try{const t=new URL("https://nominatim.openstreetmap.org/search");t.searchParams.set("q",e),t.searchParams.set("format","json"),t.searchParams.set("limit","1"),t.searchParams.set("addressdetails","1");const a=await fetch(t.toString(),{headers:{"User-Agent":"Chravel/1.0 (https://chravel.com)"}});if(!a.ok)throw new Error(`OSM API error: ${a.status}`);const i=await a.json();if(!i||0===i.length)return null;const s=i[0];return{place_id:s.place_id,lat:s.lat,lon:s.lon,display_name:s.display_name,address:s.address}}catch(t){return null}}(e);if(a)return{place_id:`osm_${a.place_id}`,name:a.display_name,formatted_address:a.display_name,geometry:{location:new google.maps.LatLng(parseFloat(a.lat),parseFloat(a.lon))}}}catch(a){}return null}function $(e,t){const a=t.geometry;a&&(a.viewport?e.fitBounds(a.viewport):a.location&&(e.setCenter(a.location),e.setZoom(15)))}function q(){return`session_${Date.now()}_${Math.random().toString(36).substring(7)}`}const j=Object.freeze(Object.defineProperty({__proto__:null,apiQuotaMonitor:R,autocomplete:x,centerMapOnPlace:$,convertPlaceToLegacy:A,extractPhotoUris:S,fetchPlaceDetails:U,generateSessionToken:q,loadMaps:k,resolveQuery:O,retryWithBackoff:L,searchByText:M,searchNearby:C,withTimeout:P},Symbol.toStringTag,{value:"Module"}));export{x as a,q as b,$ as c,j as d,s as g,k as l,O as r,P as w};
