import{j as e,a as s,Z as t,T as a,O as r,u as i,$ as n,L as l,f as o,S as d,N as c,Q as m,M as h,W as x,U as p}from"./ui-vendor-BO3EQrMK-mjd3dogn.js";import{r as u,R as g,i as f}from"./react-vendor-D1R0t5S0-mjd3dogn.js";import{c as b,f as y,X as j,s as v,a6 as w,t as N,k as _,j as k,B as C,l as P,u as S,e as A,a as z,a7 as M,o as E,d as D,m as q}from"./index-Ta7FH5xW-mjd3dogn.js";import{S as I,a as U,b as T}from"./SavedRecommendations-D-6cIfyL-mjd3dogn.js";import{S as R}from"./pro-CZgaTEEg-mjd3dogn.js";import{c as O,O as F,B as $,C as L,a as B,b as H,U as G}from"./BillingSection-CjHrdMm3-mjd3dogn.js";import{B as Y}from"./building-QMpp1aWF-mjd3dogn.js";import{S as V}from"./shield-DGBvlKQi-mjd3dogn.js";import{Z as W,P as K}from"./zap-LZcBFzwj-mjd3dogn.js";import{T as J}from"./trending-up-B0a-0y1l-mjd3dogn.js";import{S as Q,B as Z}from"./useSavedRecommendations-DTox9Xl2-mjd3dogn.js";import{I as X}from"./input-DsI2n-oJ-mjd3dogn.js";import{L as ee}from"./label-D_iG0y88-mjd3dogn.js";import{S as se,D as te,G as ae,L as re}from"./switch-GKuTbu---mjd3dogn.js";import{S as ie,b as ne,c as le,d as oe,e as de,C as ce}from"./select-CMjqEsxb-mjd3dogn.js";import{C as me,b as he,c as xe,d as pe,a as ue}from"./card-jeNxgMYk-mjd3dogn.js";import{L as ge}from"./loader-circle-C0Dqayt8-mjd3dogn.js";import{P as fe}from"./plus-Dhwa7sZY-mjd3dogn.js";import{M as be}from"./mail-BdBVrsyz-mjd3dogn.js";import{S as ye,a as je,U as ve}from"./user-DFuJ2ZP3-mjd3dogn.js";import{C as we}from"./camera-AJLsIMdA-mjd3dogn.js";import{userPreferencesService as Ne}from"./userPreferencesService-DregIO64-mjd3dogn.js";import{C as _e}from"./calendar-C9K0fVga-mjd3dogn.js";import{M as ke}from"./map-pin-BtCU-LeS-mjd3dogn.js";import{B as Ce}from"./badge-DyE_ZUPM-mjd3dogn.js";import{A as Pe}from"./archive-zX2FvEif-mjd3dogn.js";import{E as Se,A as Ae}from"./AuthModal-BKw70HSh-mjd3dogn.js";import{U as ze}from"./users-B07yK8Y7-mjd3dogn.js";import{E as Me}from"./eye-BNDPAvT6-mjd3dogn.js";import{a as Ee}from"./utils-DD44zzh--mjd3dogn.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=b("ArchiveRestore",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]]),qe=b("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Ie=b("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),Ue=b("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),Te=b("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Re=b("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),Oe=b("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),Fe=b("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]),$e=b("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),Le=b("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),Be=b("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),He=b("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Ge=b("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ye=b("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),Ve=["Vegetarian","Vegan","Halal","Kosher","Gluten-free","Dairy-free","Nut-free","Pescatarian","Keto","No restrictions"],We=["Chill","Party","Outdoorsy","Family-friendly","Romantic","Adventure","Cultural","Luxury","Budget-friendly","Nightlife","High Energy","Cozy","Date Night","Good for Groups"],Ke=["Differently Abled Accessible","EV Charging Nearby","Pet Friendly","Family Friendly","Women Owned","LGBTQ+ Friendly"],Je=["Business Appropriate","Corporate","Formal","Chains","Franchises"],Qe=["Live Music","Comedy","Theater","Sports","Art","Historic","Shopping","Tourist Attraction","Landmark","Must-See"],Ze=["After Hours","Late Night","Early Morning Risers","Locally Owned","Black Owned","Cannabis Friendly","Casual","Fine Dining","Healthy Eats","Brunch","Lounges","Outdoors","Physical Adventure","Sightseeing","Volunteering","Night Owls","Farmer's Markets"],Xe={explorer:{monthly:9.99,annual:99,trips:1/0,aiQueries:10,savings:20,savingsPercent:17},"frequent-chraveler":{monthly:19.99,annual:199,trips:1/0,aiQueries:1/0,proTripsPerMonth:1,proTripSeats:50,savings:40,savingsPercent:17}},es=({isOpen:s,onClose:t})=>{const[a,r]=u.useState("growing"),[i,n]=u.useState(!1),l=y();if(!s)return null;const o={starter:e.jsx(W,{size:l?20:24,className:"text-blue-400"}),growing:e.jsx(J,{size:l?20:24,className:"text-green-400"}),enterprise:e.jsx(Y,{size:l?20:24,className:"text-purple-400"}),"enterprise-plus":e.jsx(Q,{size:l?20:24,className:"text-yellow-400"})},d={starter:"from-blue-500/20 to-blue-600/20 border-blue-500/30",growing:"from-green-500/20 to-green-600/20 border-green-500/30",enterprise:"from-purple-500/20 to-purple-600/20 border-purple-500/30","enterprise-plus":"from-yellow-500/20 to-yellow-600/20 border-yellow-500/30"};return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl shadow-2xl "+(l?"w-full h-full overflow-y-auto p-4":"p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-glass-orange to-glass-yellow rounded-2xl flex items-center justify-center "+(l?"w-10 h-10":"w-12 h-12"),children:e.jsx(O,{size:l?20:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-white "+(l?"text-xl":"text-3xl"),children:"Upgrade to Chravel Pro"}),e.jsx("p",{className:"text-gray-400 "+(l?"text-sm":""),children:"Enterprise software for professional trip management"})]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(j,{size:24})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-glass-orange/10 to-glass-yellow/10 backdrop-blur-sm border border-white/20 rounded-2xl p-4 sm:p-6 mb-6",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2 "+(l?"text-lg":"text-xl"),children:[e.jsx(Y,{size:l?20:24,className:"text-glass-orange"}),"Enterprise Software as a Service"]}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 text-gray-300 "+(l?"grid-cols-1":"md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"Organization-Based Subscriptions"}),e.jsx("p",{className:"text-sm",children:"Your organization pays once and invites team members to seats. Individual users don't need separate subscriptions."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"Seat-Based Pricing"}),e.jsx("p",{className:"text-sm",children:"Pay only for the seats you need. Easily invite drivers, crew, players, or staff without additional per-user costs."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"Flexible Team Management"}),e.jsx("p",{className:"text-sm",children:"Add or remove team members as needed. Perfect for tours, sports teams, conferences, and corporate travel."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"Enterprise Features"}),e.jsx("p",{className:"text-sm",children:"Advanced permissions, travel wallet integration, broadcast messaging, and dedicated support."})]})]})]}),e.jsx("div",{className:"grid gap-4 sm:gap-6 mb-6 "+(l?"grid-cols-1":"md:grid-cols-2 xl:grid-cols-4"),children:Object.entries(R).map(([s,t])=>e.jsxs("div",{className:`relative bg-gradient-to-br ${d[s]} backdrop-blur-sm border rounded-2xl p-4 sm:p-6 cursor-pointer transition-all hover:scale-105 ${a===s?"ring-2 ring-white/40":""}`,onClick:()=>r(s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o[s],a===s&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})]}),e.jsx("h3",{className:"font-bold text-white mb-2 "+(l?"text-base":"text-lg"),children:t.name}),e.jsxs("div",{className:"font-bold text-white mb-1 "+(l?"text-xl":"text-2xl"),children:["$",t.price,"/month"]}),e.jsxs("div",{className:"text-sm text-gray-400 mb-4",children:["Up to ",t.seatLimit," seats"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-300",children:[t.features.slice(0,l?3:4).map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-glass-orange rounded-full mt-2 flex-shrink-0"}),s]},t)),t.features.length>(l?3:4)&&e.jsxs("li",{className:"text-xs text-gray-400 italic",children:["+",t.features.length-(l?3:4)," more features"]})]})]},s))}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-4 sm:p-6 mb-6",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 "+(l?"text-lg":"text-xl"),children:[R[a].name," - Complete Feature List"]}),e.jsx("div",{className:"grid gap-4 "+(l?"grid-cols-1":"md:grid-cols-2"),children:R[a].features.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(V,{size:16,className:"text-glass-orange mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-gray-300 text-sm",children:s})]},t))})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-glass-yellow mb-4",children:"14-day free trial • No credit card required • Cancel anytime"}),e.jsx("div",{className:"flex justify-center ",children:e.jsx("button",{onClick:()=>(async e=>{n(!0);try{const{data:s,error:t}=await v.functions.invoke("create-checkout",{body:{tier:w[e]}});if(t)throw t;s.url&&window.open(s.url,"_blank")}catch(s){N.error("Failed to start checkout")}finally{n(!1)}})(a),disabled:i,className:"px-8 py-3 bg-gradient-to-r from-glass-orange to-glass-yellow hover:from-glass-orange/80 hover:to-glass-yellow/80 text-white font-medium rounded-2xl transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Processing...":`Start Free Trial - ${R[a].name}`})})]})]})})},ss=[{id:"mock-payment-1",trip_id:"1",amount:150,currency:"USD",description:"Dinner split",split_count:4,split_participants:["user-1","user-2","user-3","user-4"],payment_methods:["venmo:@sarahchen"],created_by:"mock-user-1",is_settled:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),version:1}];
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */async function ts(e,s,t){try{const{data:r,error:i}=await v.from("trip_members").select("user_id").eq("trip_id",s);if(i||!r||0===r.length)return{suggestedParticipants:[],confidence:0};const n=r.map(e=>e.user_id),{data:l,error:o}=await v.from("profiles").select("user_id, display_name").in("user_id",n);if(o||!l)return{suggestedParticipants:[],confidence:0};let d=null;try{d=await async function(e,s,t,a){try{const i=`You are a payment parsing assistant. Extract payment information from user messages.\n\nGiven a message about a payment or expense, identify:\n1. Payment amount and currency\n2. Description of what the payment is for\n3. Participants who should split the payment (based on names mentioned or context)\n\nReturn a JSON object with:\n{\n  "amount": number (optional),\n  "currency": "USD" | "EUR" | "GBP" | "CAD" (optional, default USD),\n  "description": string (optional),\n  "participants": string[] (array of participant names mentioned),\n  "confidence": number (0-1, how confident you are this is a payment)\n}\n\nExamples:\n- "Sam owes me $50" → {"amount": 50, "currency": "USD", "participants": ["Sam"], "confidence": 0.9}\n- "Dinner split between me, Sarah, and Mike" → {"participants": ["Sarah", "Mike"], "confidence": 0.85}\n- "I paid $100 for the hotel room" → {"amount": 100, "currency": "USD", "description": "hotel room", "confidence": 0.7}\n- "Just had lunch" → {"confidence": 0.2} (not a payment request)\n\nBe conservative - only suggest participants if explicitly mentioned or strongly implied.\n\nAvailable trip members: ${t.filter(e=>e.user_id!==a).map(e=>e.display_name||"Unknown").join(", ")}\n\nMessage to parse: "${e}"\n\nReturn ONLY valid JSON, no other text.`,{data:n,error:l}=await v.functions.invoke("lovable-concierge",{body:{message:i,tripId:s,config:{systemPrompt:"You are a payment parsing assistant. Return only valid JSON.",temperature:.3}}});if(l||!n)return null;let o=n.response||n.content||"";const d=o.match(/```(?:json)?\s*(\{[\s\S]*\})\s*```/)||o.match(/(\{[\s\S]*\})/);let c;d&&(o=d[1]);try{c=JSON.parse(o)}catch(r){return null}const m=[];if(c.participants&&Array.isArray(c.participants))for(const e of c.participants){const s=t.find(s=>{const t=(s.display_name||"").toLowerCase(),a=e.toLowerCase();return t===a||t.includes(a)||a.includes(t)||t.split(" ").some(e=>e===a)});s&&s.user_id!==a&&m.push({userId:s.user_id,userName:s.display_name||"Unknown",confidence:c.confidence||.7,reason:`AI detected: "${e}"`})}return{amount:c.amount,currency:c.currency||"USD",description:c.description,suggestedParticipants:m,confidence:c.confidence||.5}}catch(i){return null}}(e,s,l,t)}catch(a){0}const c=e.toLowerCase().trim(),m=[],h=[/(?:split|split between|split with|owes|owe|paid for|pay)\s+(?:me\s*,\s*)?(?:and\s*)?(@?\w+(?:\s*,\s*(?:and\s*)?@?\w+)*)/gi,/(@?\w+)\s+(?:owes|owe|paid|split)/gi,/(?:with|between)\s+(@?\w+(?:\s*,\s*(?:and\s*)?@?\w+)*)/gi];for(const e of h){const s=Array.from(c.matchAll(e));for(const e of s){const s=(e[1]||e[0]).split(/\s*,\s*(?:and\s*)?/).map(e=>e.replace(/^@/,"").trim()).filter(e=>e&&"me"!==e&&"i"!==e);for(const e of s){const s=l.find(s=>{const t=(s.display_name||"").toLowerCase(),a=e.toLowerCase();return t.includes(a)||a.includes(t)||t.split(" ").some(e=>e===a)});s&&s.user_id!==t&&!m.find(e=>e.userId===s.user_id)&&m.push({userId:s.user_id,userName:s.display_name||"Unknown",confidence:.8,reason:`Mentioned in payment context: "${e}"`})}}}/\b(we|us|everyone|all)\b/i.test(c)&&l.forEach(e=>{e.user_id===t||m.find(s=>s.userId===e.user_id)||m.push({userId:e.user_id,userName:e.display_name||"Unknown",confidence:.7,reason:'Included in group reference ("we", "us", "everyone")'})}),d&&d.confidence>.5&&d.suggestedParticipants.forEach(e=>{const s=m.find(s=>s.userId===e.userId);s?(s.confidence=Math.min(1,s.confidence+.15),s.reason=`${s.reason} (AI confirmed)`):m.push({...e,confidence:.9*e.confidence})});(await as(s,t,l.filter(e=>e.user_id!==t))).forEach(e=>{const s=m.find(s=>s.userId===e.userId);s?s.confidence=Math.min(1,s.confidence+.1):m.push({...e,confidence:Math.max(.3,e.confidence-.2)})});let x=null==d?void 0:d.amount,p=(null==d?void 0:d.currency)||"USD";if(!x){const e=[/(?:^|\s)(\$|€|£|usd|eur|gbp|cad)?\s*(\d+(?:\.\d{2})?)/i,/(\d+(?:\.\d{2})?)\s*(?:dollars?|euros?|pounds?|usd|eur|gbp|cad)/i];for(const s of e){const e=c.match(s);if(e){x=parseFloat(e[2]||e[1]);const s=(e[1]||e[3]||"").toLowerCase();if(s){p={$:"USD",dollar:"USD",dollars:"USD","€":"EUR",euro:"EUR",euros:"EUR","£":"GBP",pound:"GBP",pounds:"GBP",usd:"USD",eur:"EUR",gbp:"GBP",cad:"CAD"}[s]||"USD"}break}}}let u=null==d?void 0:d.description;if(!u){const s=["dinner","lunch","breakfast","food","meal","restaurant","taxi","uber","lyft","ride","transport","car","hotel","accommodation","airbnb","room","lodging","tickets","concert","show","event","movie","theater","groceries","shopping","gas","fuel","parking","drinks","bar","coffee","snacks"];for(const t of s)if(c.includes(t)){const s=c.indexOf(t),a=Math.max(0,s-20),r=Math.min(c.length,s+t.length+20);u=e.substring(a,r).trim();break}}const g=(null==d?void 0:d.confidence)||0,f=m.length>0?Math.min(1,.5+.1*m.length+(x?.2:0)):0,b=d&&f>.5?Math.min(1,Math.max(g,f)+.1):Math.max(g,f);return{amount:x,currency:p,description:u,suggestedParticipants:m.slice(0,10),confidence:b}}catch(r){return{suggestedParticipants:[],confidence:0}}}async function as(e,s,t){try{try{const{data:a,error:r}=await v.from("payment_split_patterns").select("participant_id, frequency, last_split_at").eq("trip_id",e).eq("user_id",s).order("frequency",{ascending:!1}).limit(10);if(!r&&a&&a.length>0){const e=[];return a.forEach(s=>{const a=t.find(e=>e.user_id===s.participant_id);if(a){const t=Math.min(.7,s.frequency/10),r=s.last_split_at?Math.min(.3,(Date.now()-new Date(s.last_split_at).getTime())/2592e6*.3):0;e.push({userId:a.user_id,userName:a.display_name||"Unknown",confidence:Math.min(.9,.5+t-r),reason:`Frequently splits together (${s.frequency} times)`})}}),e.sort((e,s)=>s.confidence-e.confidence)}}catch(a){0}const{data:r,error:i}=await v.from("trip_payment_messages").select("id, split_participants").eq("trip_id",e).or(`created_by.eq.${s},split_participants.cs.{${s}}`).order("created_at",{ascending:!1}).limit(10);if(i||!r)return[];const n=new Map;r.forEach(e=>{(Array.isArray(e.split_participants)?e.split_participants:[]).forEach(e=>{e!==s&&n.set(e,(n.get(e)||0)+1)})});const l=[];return t.forEach(e=>{const s=n.get(e.user_id)||0;s>0&&l.push({userId:e.user_id,userName:e.display_name||"Unknown",confidence:Math.min(.9,.5+.1*s),reason:`Frequently splits payments together (${s} recent payments)`})}),l.sort((e,s)=>s.confidence-e.confidence)}catch(r){return[]}}async function rs(e,s,t=!0){try{const{data:a,error:r}=await v.from("trip_members").select("user_id").eq("trip_id",e);if(r||!a||0===a.length)return[];const i=a.map(e=>e.user_id).filter(e=>!t||e!==s),{data:n,error:l}=await v.from("profiles").select("user_id, display_name").in("user_id",i);if(l||!n)return[];const o=await as(e,s,n);return o.length>0&&o[0].confidence>=.6?o:n.map(e=>({userId:e.user_id,userName:e.display_name||"Unknown",confidence:.5,reason:"Trip member"}))}catch(a){return[]}}const is={async getUserPaymentMethods(e){try{const{data:s,error:t}=await v.from("user_payment_methods").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw t;return s.map(e=>({id:e.id,type:e.method_type,identifier:e.identifier,displayName:e.display_name,isPreferred:e.is_preferred,isVisible:e.is_visible}))}catch(s){return[]}},async savePaymentMethod(e,s){try{const{error:t}=await v.from("user_payment_methods").insert({user_id:e,method_type:s.type,identifier:s.identifier,display_name:s.displayName,is_preferred:s.isPreferred,is_visible:s.isVisible});return!t}catch(t){return!1}},async updatePaymentMethod(e,s){try{const{error:t}=await v.from("user_payment_methods").update({method_type:s.type,identifier:s.identifier,display_name:s.displayName,is_preferred:s.isPreferred,is_visible:s.isVisible}).eq("id",e);return!t}catch(t){return!1}},async deletePaymentMethod(e){try{const{error:s}=await v.from("user_payment_methods").delete().eq("id",e);return!s}catch(s){return!1}},async createPaymentMessage(e,s,t){try{const{data:a,error:r}=await v.rpc("create_payment_with_splits_v2",{p_trip_id:e,p_amount:t.amount,p_currency:t.currency,p_description:t.description,p_split_count:t.splitCount,p_split_participants:t.splitParticipants,p_payment_methods:t.paymentMethods,p_created_by:s});if(r)throw r;return a&&t.splitParticipants.length>0&&async function(e,s,t){try{const{error:a}=await v.from("payment_split_patterns").select("id").limit(1);if(a)return;for(const r of t){if(r===s)continue;const{data:t}=await v.from("payment_split_patterns").select("id, frequency").eq("trip_id",e).eq("user_id",s).eq("participant_id",r).single(),a=t;a?await v.from("payment_split_patterns").update({frequency:(a.frequency||0)+1,last_split_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",a.id):await v.from("payment_split_patterns").insert({trip_id:e,user_id:s,participant_id:r,frequency:1,last_split_at:(new Date).toISOString()})}}catch(r){}}(e,s,t.splitParticipants).catch(e=>{}),a}catch(a){return null}},async getTripPaymentMessages(e){try{const s=parseInt(e),t=await _.isDemoModeEnabled(),a=!isNaN(s)&&s>=1&&s<=12;if(t&&a)return ss.filter(s=>s.trip_id===e).map(e=>({id:e.id,tripId:e.trip_id,messageId:null,amount:e.amount,currency:e.currency,description:e.description,splitCount:e.split_count,splitParticipants:e.split_participants,paymentMethods:e.payment_methods,createdBy:e.created_by,createdAt:e.created_at,isSettled:e.is_settled}));const{data:r,error:i}=await v.from("trip_payment_messages").select("*").eq("trip_id",e).order("created_at",{ascending:!1});if(i)throw i;return r.map(e=>({id:e.id,tripId:e.trip_id,messageId:e.message_id,amount:parseFloat(e.amount.toString()),currency:e.currency,description:e.description,splitCount:e.split_count,splitParticipants:Array.isArray(e.split_participants)?e.split_participants:[],paymentMethods:Array.isArray(e.payment_methods)?e.payment_methods:[],createdBy:e.created_by,createdAt:e.created_at,isSettled:e.is_settled}))}catch(s){return[]}},async settlePayment(e,s){try{const{data:t,error:a}=await v.from("payment_splits").select("is_settled, payment_message_id").eq("id",e).single();if(a)throw a;if(t.is_settled)throw new Error("Payment has already been settled by another user.");const{error:r}=await v.from("payment_splits").update({is_settled:!0,settled_at:(new Date).toISOString(),settlement_method:s}).eq("id",e).eq("is_settled",!1);return!r&&(await this.updateParentPaymentSettledStatus(t.payment_message_id),!0)}catch(t){return!1}},async unsettlePayment(e){try{const{data:s,error:t}=await v.from("payment_splits").select("is_settled, payment_message_id").eq("id",e).single();if(t)throw t;if(!s.is_settled)return!0;const{error:a}=await v.from("payment_splits").update({is_settled:!1,settled_at:null,settlement_method:null}).eq("id",e);return!a&&(await this.updateParentPaymentSettledStatus(s.payment_message_id),!0)}catch(s){return!1}},async updateParentPaymentSettledStatus(e){try{const{data:s,error:t}=await v.from("payment_splits").select("is_settled").eq("payment_message_id",e);if(t||!s)return;const a=s.length>0&&s.every(e=>e.is_settled);await v.from("trip_payment_messages").update({is_settled:a}).eq("id",e)}catch(s){}},async updatePaymentMessage(e,s){try{const t={};void 0!==s.amount&&(t.amount=s.amount),void 0!==s.description&&(t.description=s.description),t.updated_at=(new Date).toISOString();const{error:a}=await v.from("trip_payment_messages").update(t).eq("id",e);if(a)throw a;if(void 0!==s.amount){const{data:t}=await v.from("trip_payment_messages").select("split_count").eq("id",e).single();if(t){const a=s.amount/t.split_count;await v.from("payment_splits").update({amount_owed:a}).eq("payment_message_id",e)}}return!0}catch(t){return!1}},async deletePaymentMessage(e){try{await v.from("payment_splits").delete().eq("payment_message_id",e),await v.from("payment_audit_log").delete().eq("payment_message_id",e);const{error:s}=await v.from("trip_payment_messages").delete().eq("id",e);return!s}catch(s){return!1}},async getTripPaymentSummary(e){try{const s=await this.getTripPaymentMessages(e),{data:t,error:a}=await v.from("payment_splits").select("\n          *,\n          payment_message:trip_payment_messages!inner(trip_id, created_by, amount)\n        ").eq("payment_message.trip_id",e);if(a)throw a;const r={};let i=0;s.forEach(e=>{i+=e.amount,r[e.createdBy]||(r[e.createdBy]=0),r[e.createdBy]+=e.amount}),t.forEach(e=>{r[e.debtor_user_id]||(r[e.debtor_user_id]=0),r[e.debtor_user_id]-=parseFloat(e.amount_owed.toString())});const n=[],l=Object.entries(r).filter(([e,s])=>s<0),o=Object.entries(r).filter(([e,s])=>s>0);return l.forEach(([e,s])=>{o.forEach(([t,a])=>{if(Math.abs(s)>0&&a>0){const r=Math.min(Math.abs(s),a);n.push({from:e,to:t,amount:r})}})}),{totalExpenses:i,userBalances:r,settlementSuggestions:n}}catch(s){return{totalExpenses:0,userBalances:{},settlementSuggestions:[]}}}},ns=({userId:s})=>{const{toast:t}=k(),[a,r]=u.useState([]),[i,n]=u.useState(!0),[l,o]=u.useState(!1),[d,c]=u.useState(!1),[m,h]=u.useState(null);u.useEffect(()=>{(async()=>{if(s){n(!0);try{const e=await is.getUserPaymentMethods(s);r(e)}catch(e){}finally{n(!1)}}})()},[s]);const[x,p]=u.useState({type:"venmo",identifier:"",displayName:"",isPreferred:!1,isVisible:!0}),g=[{value:"venmo",label:"Venmo",icon:Le,placeholder:"@username"},{value:"zelle",label:"Zelle",icon:be,placeholder:"email@example.com or phone"},{value:"cashapp",label:"Cash App",icon:te,placeholder:"$cashtag"},{value:"applepay",label:"Apple Pay",icon:K,placeholder:"phone number"},{value:"paypal",label:"PayPal",icon:be,placeholder:"email@example.com"},{value:"applecash",label:"Apple Cash",icon:K,placeholder:"phone number"},{value:"cash",label:"Cash",icon:te,placeholder:"Prefer cash payments"},{value:"other",label:"Other",icon:Te,placeholder:"Custom payment method"}],f=()=>{p({type:"venmo",identifier:"",displayName:"",isPreferred:!1,isVisible:!0}),c(!1),h(null)},b=e=>{const s=g.find(s=>s.value===e);return(null==s?void 0:s.label)||e},y=s=>{const t=g.find(e=>e.value===s),a=(null==t?void 0:t.icon)||Te;return e.jsx(a,{size:20})};return e.jsxs(me,{className:"bg-background border-muted",children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Te,{size:20,className:"text-primary"}),"Payment Methods"]}),e.jsx(pe,{children:"Manage how you want to receive payments from trip members"})]}),e.jsx(ue,{className:"space-y-6",children:i?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ge,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading payment methods..."})]}):e.jsxs(e.Fragment,{children:[d&&e.jsxs(me,{className:"bg-muted/50",children:[e.jsx(he,{children:e.jsx(xe,{className:"text-lg",children:m?"Edit Payment Method":"Add Payment Method"})}),e.jsx(ue,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),s){o(!0);try{const e={...x,displayName:x.displayName||b(x.type)};if(null==m?void 0:m.id){if(!(await is.updatePaymentMethod(m.id,e)))throw new Error("Failed to update");r(s=>s.map(s=>s.id===m.id?{...s,...e}:s)),t({title:"Payment method updated",description:"Your changes have been saved."})}else{if(!(await is.savePaymentMethod(s,e)))throw new Error("Failed to save");{const e=await is.getUserPaymentMethods(s);r(e),t({title:"Payment method added",description:"Your new payment method has been saved."})}}f()}catch(a){t({title:"Error",description:"Failed to save payment method. Please try again.",variant:"destructive"})}finally{o(!1)}}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"type",children:"Payment Method"}),e.jsxs(ie,{value:x.type,onValueChange:e=>p(s=>({...s,type:e})),children:[e.jsx(ne,{children:e.jsx(le,{})}),e.jsx(oe,{children:g.map(s=>e.jsx(de,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{size:16}),s.label]})},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"identifier",children:"Identifier"}),e.jsx(X,{id:"identifier",value:x.identifier,onChange:e=>p(s=>({...s,identifier:e.target.value})),placeholder:(e=>{const s=g.find(s=>s.value===e);return(null==s?void 0:s.placeholder)||"Enter identifier"})(x.type),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"displayName",children:"Display Name (Optional)"}),e.jsx(X,{id:"displayName",value:x.displayName,onChange:e=>p(s=>({...s,displayName:e.target.value})),placeholder:`Custom name for ${x.type}`})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{id:"preferred",checked:x.isPreferred,onCheckedChange:e=>p(s=>({...s,isPreferred:e}))}),e.jsx(ee,{htmlFor:"preferred",children:"Set as preferred method"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{id:"visible",checked:x.isVisible,onCheckedChange:e=>p(s=>({...s,isVisible:e}))}),e.jsx(ee,{htmlFor:"visible",children:"Visible to trip members"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{type:"submit",className:"bg-primary",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:16,className:"mr-2 animate-spin"}),"Saving..."]}):m?"Update Method":"Add Method"}),e.jsx(C,{type:"button",variant:"outline",onClick:f,disabled:l,children:"Cancel"})]})]})})]}),e.jsx("div",{className:"space-y-3",children:a.map(s=>e.jsx(me,{className:"bg-background border-muted",children:e.jsx(ue,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-primary",children:y(s.type)}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-foreground",children:[s.displayName||b(s.type),s.isPreferred&&e.jsx("span",{className:"ml-2 text-xs bg-primary text-primary-foreground px-2 py-1 rounded-full",children:"Preferred"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.identifier,!s.isVisible&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Private)"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{size:"sm",variant:"outline",onClick:()=>(e=>{p({type:e.type,identifier:e.identifier,displayName:e.displayName||"",isPreferred:e.isPreferred||!1,isVisible:!1!==e.isVisible}),h(e),c(!0)})(s),children:e.jsx(Ge,{size:14})}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>(async e=>{try{if(!(await is.deletePaymentMethod(e)))throw new Error("Failed to delete");r(s=>s.filter(s=>s.id!==e)),t({title:"Payment method removed",description:"The payment method has been deleted."})}catch(s){t({title:"Error",description:"Failed to delete payment method. Please try again.",variant:"destructive"})}})(s.id),children:e.jsx(P,{size:14})})]})]})})},s.id))}),0===a.length&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Te,{size:48,className:"mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"mb-4",children:"No payment methods added yet"}),e.jsxs(C,{onClick:()=>c(!0),children:[e.jsx(fe,{size:16,className:"mr-2"}),"Add Your First Payment Method"]})]}),!d&&a.length>0&&e.jsxs(C,{onClick:()=>c(!0),className:"w-full",children:[e.jsx(fe,{size:16,className:"mr-2"}),"Add Payment Method"]})]})})]})},ls=new Map,os={getUserPrograms:async e=>ls.get(e)||[],async getProgramsByType(e,s){return(await this.getUserPrograms(e)).filter(e=>e.program_type===s)},async saveProgram(e,s){const t={id:`lp-${Date.now()}-${Math.random().toString(36).substring(7)}`,user_id:e,...s,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},a=ls.get(e)||[];return a.push(t),ls.set(e,a),t},async updateProgram(e,s){for(const[t,a]of ls.entries()){const r=a.findIndex(s=>s.id===e);if(-1!==r)return a[r]={...a[r],...s,updated_at:(new Date).toISOString()},ls.set(t,a),!0}return!1},async deleteProgram(e){for(const[s,t]of ls.entries()){const a=t.findIndex(s=>s.id===e);if(-1!==a)return t.splice(a,1),ls.set(s,t),!0}return!1},toAirlineProgram:e=>({id:e.id,airline:e.company_name,programName:e.program_name,membershipNumber:e.membership_number,tier:e.tier,isPreferred:e.is_preferred}),toHotelProgram:e=>({id:e.id,hotelChain:e.company_name,programName:e.program_name,membershipNumber:e.membership_number,tier:e.tier,isPreferred:e.is_preferred}),toRentalCarProgram:e=>({id:e.id,company:e.company_name,programName:e.program_name,membershipNumber:e.membership_number,tier:e.tier,isPreferred:e.is_preferred})},ds=({userId:s})=>{const{toast:t}=k(),[a,r]=u.useState("airlines"),[i,n]=u.useState(!1),[l,o]=u.useState(!0),[d,c]=u.useState(!1),[m,h]=u.useState([]),[x,p]=u.useState([]),[g,f]=u.useState([]);u.useEffect(()=>{(async()=>{if(s){o(!0);try{const e=await os.getUserPrograms(s);h(e.filter(e=>"airline"===e.program_type).map(os.toAirlineProgram)),p(e.filter(e=>"hotel"===e.program_type).map(os.toHotelProgram)),f(e.filter(e=>"rental"===e.program_type).map(os.toRentalCarProgram))}catch(e){}finally{o(!1)}}})()},[s]);const b=({type:s,onSave:t,onCancel:a})=>{const[r,i]=u.useState({company:"",programName:"",membershipNumber:"",tier:"",isPreferred:!1}),n=(()=>{switch(s){case"airlines":return{company:"Delta, American, United, etc.",program:"SkyMiles, AAdvantage, MileagePlus, etc.",number:"Your frequent flyer number"};case"hotels":return{company:"Marriott, Hilton, Hyatt, etc.",program:"Bonvoy, Honors, World of Hyatt, etc.",number:"Your rewards number"};case"rentals":return{company:"Hertz, Avis, Enterprise, etc.",program:"Gold Plus Rewards, Preferred, etc.",number:"Your membership number"};default:return{company:"",program:"",number:""}}})();return e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-6",children:[e.jsxs("h4",{className:"text-white font-semibold mb-4",children:["Add New ",s.slice(0,-1)," Program"]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),t({id:Date.now().toString(),...r,["airlines"===s?"airline":"hotels"===s?"hotelChain":"company"]:r.company}),i({company:"",programName:"",membershipNumber:"",tier:"",isPreferred:!1})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"airlines"===s?"Airline":"hotels"===s?"Hotel Chain":"Rental Company"}),e.jsx("input",{type:"text",value:r.company,onChange:e=>i({...r,company:e.target.value}),placeholder:n.company,className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Program Name"}),e.jsx("input",{type:"text",value:r.programName,onChange:e=>i({...r,programName:e.target.value}),placeholder:n.program,className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Membership Number"}),e.jsx("input",{type:"text",value:r.membershipNumber,onChange:e=>i({...r,membershipNumber:e.target.value}),placeholder:n.number,className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Tier/Status (Optional)"}),e.jsx("input",{type:"text",value:r.tier,onChange:e=>i({...r,tier:e.target.value}),placeholder:"Gold, Platinum, etc.",className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"preferred",checked:r.isPreferred,onChange:e=>i({...r,isPreferred:e.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"preferred",className:"text-sm text-gray-300",children:"Set as preferred"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"bg-glass-orange hover:bg-glass-orange/80 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Save Program"}),e.jsx("button",{type:"button",onClick:a,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"})]})]})]})},y=({program:s,type:t,onEdit:a,onDelete:r})=>e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[(()=>{switch(t){case"airlines":return e.jsx(Fe,{size:20,className:"text-blue-400"});case"hotels":return e.jsx(Y,{size:20,className:"text-green-400"});case"rentals":return e.jsx(Ie,{size:20,className:"text-purple-400"});default:return e.jsx(Te,{size:20,className:"text-gray-400"})}})(),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold",children:"airline"in s?s.airline:"hotelChain"in s?s.hotelChain:s.company}),e.jsx("p",{className:"text-gray-400 text-sm",children:s.programName})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.isPreferred&&e.jsx(Q,{size:16,className:"text-yellow-500 fill-current"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white p-1",children:e.jsx(Ge,{size:14})}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-red-400 p-1",children:e.jsx(P,{size:14})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Number:"}),e.jsx("span",{className:"text-white font-mono",children:s.membershipNumber})]}),s.tier&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:"text-glass-orange font-medium",children:s.tier})]})]})]}),j=()=>{switch(a){case"airlines":return m;case"hotels":return x;case"rentals":return g;default:return[]}},v=[{id:"airlines",label:"Airlines",icon:Fe,count:m.length},{id:"hotels",label:"Hotels",icon:Y,count:x.length},{id:"rentals",label:"Car Rentals",icon:Ie,count:g.length}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Ye,{size:24,className:"text-glass-orange"}),"Loyalty Programs"]}),e.jsxs("button",{onClick:()=>n(!0),className:"bg-glass-orange hover:bg-glass-orange/80 text-white px-4 py-2 rounded-lg flex items-center gap-2 font-medium transition-colors",children:[e.jsx(fe,{size:16}),"Add Program"]})]}),e.jsx("div",{className:"flex border-b border-white/20 mb-6",children:v.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>r(s.id),className:"flex items-center gap-2 px-4 py-3 font-medium transition-colors "+(a===s.id?"text-glass-orange border-b-2 border-glass-orange":"text-gray-400 hover:text-white"),children:[e.jsx(t,{size:18}),s.label,e.jsx("span",{className:"bg-white/10 text-xs px-2 py-1 rounded-full",children:s.count})]},s.id)})}),i&&e.jsx("div",{className:"mb-6",children:e.jsx(b,{type:a,onSave:async e=>{if(s){c(!0);try{const r="airlines"===a?"airline":"hotels"===a?"hotel":"rental",i=e.airline||e.hotelChain||e.company,n=await os.saveProgram(s,{program_type:r,company_name:i,program_name:e.programName,membership_number:e.membershipNumber,tier:e.tier,is_preferred:e.isPreferred||!1});if(!n)throw new Error("Failed to save program");switch(a){case"airlines":h(e=>[...e,os.toAirlineProgram(n)]);break;case"hotels":p(e=>[...e,os.toHotelProgram(n)]);break;case"rentals":f(e=>[...e,os.toRentalCarProgram(n)])}t({title:"Program added",description:"Your loyalty program has been saved."})}catch(r){t({title:"Error",description:"Failed to save loyalty program. Please try again.",variant:"destructive"})}finally{c(!1),n(!1)}}},onCancel:()=>n(!1)})}),l?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ge,{className:"h-6 w-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-400",children:"Loading programs..."})]}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:j().map(s=>e.jsx(y,{program:s,type:a,onEdit:()=>{},onDelete:()=>(async e=>{try{if(!(await os.deleteProgram(e)))throw new Error("Failed to delete");switch(a){case"airlines":h(s=>s.filter(s=>s.id!==e));break;case"hotels":p(s=>s.filter(s=>s.id!==e));break;case"rentals":f(s=>s.filter(s=>s.id!==e))}t({title:"Program removed",description:"The loyalty program has been deleted."})}catch(s){t({title:"Error",description:"Failed to delete loyalty program. Please try again.",variant:"destructive"})}})(s.id)},s.id))}),!l&&0===j().length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("div",{className:"text-gray-400 mb-4",children:["No ",a," programs added yet"]}),e.jsx("button",{onClick:()=>n(!0),className:"bg-glass-orange hover:bg-glass-orange/80 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Add Your First Program"})]})]}),e.jsx(ns,{userId:s})]})},cs=()=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Notification Preferences"}),e.jsx("div",{className:"space-y-3",children:[{key:"orgAnnouncements",label:"Organization Announcements",desc:"Important updates from organization administrators"},{key:"tripInvites",label:"Trip Invitations",desc:"When you are invited to join a trip"},{key:"teamUpdates",label:"Team Updates",desc:"Changes to team members and permissions"},{key:"billingAlerts",label:"Billing Alerts",desc:"Subscription and payment notifications"},{key:"emailDigest",label:"Weekly Email Digest",desc:"Summary of activity across all your trips"}].map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{size:16,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:s.label}),e.jsx("p",{className:"text-sm text-gray-400",children:s.desc})]})]}),e.jsx("button",{className:"relative w-12 h-6 bg-glass-orange rounded-full transition-colors",children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 translate-x-6 transition-transform"})})]},s.key))})]}),ms=()=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Privacy & Security"}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Display Name Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Use Real Name"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Show your real name to organization members"})]}),e.jsx("button",{className:"relative w-12 h-6 bg-glass-orange rounded-full transition-colors",children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 translate-x-6 transition-transform"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Show Job Title"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Display your job title in organization directory"})]}),e.jsx("button",{className:"relative w-12 h-6 bg-glass-orange rounded-full transition-colors",children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 translate-x-6 transition-transform"})})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Share Phone Number"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Allow organization members to see your phone number"})]}),e.jsx("button",{className:"relative w-12 h-6 bg-gray-600 rounded-full transition-colors",children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 translate-x-0.5 transition-transform"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Allow Direct Messages"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Let organization members send you direct messages"})]}),e.jsx("button",{className:"relative w-12 h-6 bg-glass-orange rounded-full transition-colors",children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 translate-x-6 transition-transform"})})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Account Security"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white font-medium",children:"Change Password"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Update your account password"})]}),e.jsx("div",{className:"text-glass-orange",children:"→"})]}),e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white font-medium",children:"Two-Factor Authentication"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Add an extra layer of security to your account"})]}),e.jsx("div",{className:"text-glass-orange",children:"Set Up"})]})]})]})]}),hs=({organizationId:s,currentUserId:t,defaultSection:a="organization"})=>{const[r,i]=u.useState(a),[n,l]=u.useState(!1),o=y(),d={id:s,name:"Acme Entertainment Group",displayName:"Acme Entertainment",subscriptionTier:"growing",subscriptionStatus:"active",seatLimit:25,seatsUsed:18,billingEmail:"billing@acme.com",subscriptionEndsAt:"2025-12-15",currentUserRole:"owner",contactName:"",contactEmail:"",contactPhone:""},c=[{id:"organization",label:"Organization Profile",icon:Y},{id:"billing",label:"Subscriptions",icon:Te},{id:"travel-wallet",label:"Travel Wallet",icon:Ye},{id:"notifications",label:"Notifications",icon:qe},{id:"privacy",label:"General & Privacy",icon:ye}],m=()=>{switch(r){case"organization":default:return e.jsx(F,{organization:d});case"billing":return e.jsx($,{organization:d});case"travel-wallet":return e.jsx("div",{children:e.jsx(ds,{userId:t})});case"notifications":return e.jsx(cs,{});case"privacy":return e.jsx(ms,{})}},h=c.find(e=>e.id===r);return"organization"!==a?e.jsx("div",{className:"w-full",children:m()}):o?e.jsxs("div",{className:"flex flex-col h-full w-full min-w-0",children:[e.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-white/20",children:[e.jsxs("button",{onClick:()=>l(!n),className:"w-full flex items-center justify-between p-3 bg-white/10 rounded-xl text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h&&e.jsx(h.icon,{size:20}),e.jsx("span",{className:"text-sm",children:null==h?void 0:h.label})]}),e.jsx(ce,{size:20,className:"transform transition-transform "+(n?"rotate-180":"")})]}),n&&e.jsx("div",{className:"mt-2 bg-white/10 rounded-xl overflow-hidden",children:c.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>{i(s.id),l(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-left transition-colors "+(r===s.id?"bg-glass-orange/20 text-glass-orange":"text-gray-300 hover:text-white hover:bg-white/10"),children:[e.jsx(t,{size:20}),e.jsx("span",{className:"text-sm",children:s.label})]},s.id)})})]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-y-auto",children:e.jsx("div",{className:"p-4",children:m()})})]}):e.jsxs("div",{className:"flex h-full w-full min-w-0",children:[e.jsxs("div",{className:"w-64 flex-shrink-0 bg-white/5 backdrop-blur-md border-r border-white/10 p-4 overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Enterprise Settings"}),e.jsx("div",{className:"space-y-2",children:c.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>i(s.id),className:"w-full flex items-center gap-3 px-3 py-2 rounded-xl transition-colors "+(r===s.id?"bg-glass-orange/20 text-glass-orange border border-glass-orange/30":"text-gray-300 hover:text-white hover:bg-white/10"),children:[e.jsx(t,{size:20}),e.jsx("span",{className:"text-sm",children:s.label})]},s.id)})})]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-y-auto",children:e.jsx("div",{className:"p-4 pb-16",children:m()})})]})},xs=e=>{if(!e||"string"!=typeof e)return"U";const s=e.trim().split(" ").filter(Boolean);return 0===s.length?"U":1===s.length?s[0][0].toUpperCase():(s[0][0]+s[s.length-1][0]).toUpperCase()},ps=e=>{if(!e)return!1;if(e.startsWith("/"))return!0;if(e.startsWith("data:"))return!0;try{const s=new URL(e);return"http:"===s.protocol||"https:"===s.protocol}catch{return!1}},us=e=>((e,s=128)=>{e&&"string"==typeof e||(e="User");const t=xs(e),a=(e=>{const s=["3b82f6","8b5cf6","ec4899","f59e0b","10b981","ef4444","06b6d4","a855f7","f97316","14b8a6"];return s[e.split("").reduce((e,s)=>e+s.charCodeAt(0),0)%s.length]})(e),r=`\n    <svg width="${s}" height="${s}" xmlns="http://www.w3.org/2000/svg">\n      <rect width="${s}" height="${s}" fill="#${a}" rx="${s/2}"/>\n      <text \n        x="50%" \n        y="50%" \n        font-family="system-ui, -apple-system, sans-serif" \n        font-size="${.4*s}" \n        font-weight="bold" \n        fill="#ffffff" \n        text-anchor="middle" \n        dominant-baseline="central"\n      >\n        ${t}\n      </text>\n    </svg>\n  `.trim();return`data:image/svg+xml;base64,${btoa(r)}`})(e),gs=()=>{const{user:s,updateProfile:t}=S(),{toast:a}=k(),r=u.useRef(null),[i,n]=u.useState((null==s?void 0:s.displayName)||""),[l,o]=u.useState((null==s?void 0:s.bio)||""),[d,c]=u.useState((null==s?void 0:s.phone)||""),[m,h]=u.useState(!1),[x,p]=u.useState(!1);u.useEffect(()=>{s&&(n(s.displayName||""),o(s.bio||""),c(s.phone||""))},[s]);const g={id:"demo-user-123",email:"demo@example.com",displayName:"Demo User",avatar:us("Demo User")},f=s||g,b=()=>{var e;null==(e=r.current)||e.click()};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-xl flex items-center justify-center",children:e.jsx(je,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Profile Settings"}),e.jsx("p",{className:"text-gray-400",children:"Manage your personal profile and preferences"})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-2",children:"Profile Photo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-glass-orange to-glass-yellow rounded-full flex items-center justify-center overflow-hidden",children:f.avatar?e.jsx("img",{src:f.avatar,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(je,{size:24,className:"text-white"})}),e.jsx("button",{onClick:b,disabled:x||!s,className:"absolute -bottom-2 -right-2 bg-glass-orange hover:bg-glass-orange/80 text-white p-2 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsx(ge,{size:16,className:"animate-spin"}):e.jsx(we,{size:16})})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:r,className:"hidden",accept:"image/*",onChange:async e=>{var i;const n=null==(i=e.target.files)?void 0:i[0];if(n&&s)if(n.type.startsWith("image/"))if(n.size>5242880)a({title:"File too large",description:"Image size must be less than 5MB.",variant:"destructive"});else{p(!0);try{const e=n.name.includes(".")?n.name.split(".").pop():n.type.split("/")[1]||"jpg",r=`${s.id}/${Date.now()}.${e}`,{error:i}=await v.storage.from("avatars").upload(r,n,{cacheControl:"3600",contentType:n.type,upsert:!0});if(i)throw i;const{data:{publicUrl:l}}=v.storage.from("avatars").getPublicUrl(r),{error:o}=await t({avatar_url:l});if(o)throw o;a({title:"Photo uploaded",description:"Your profile photo has been updated."})}catch(l){a({title:"Upload failed",description:"Failed to upload profile photo. Please try again.",variant:"destructive"})}finally{p(!1),r.current&&(r.current.value="")}}else a({title:"Invalid file type",description:"Please upload an image file (JPG, PNG, GIF).",variant:"destructive"})}}),e.jsx("button",{onClick:b,disabled:x||!s,className:"flex items-center gap-2 bg-white/10 hover:bg-white/20 border border-white/20 text-white px-3 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:16,className:"animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:16}),"Upload Photo"]})}),e.jsx("p",{className:"text-sm text-gray-400 mt-1.5",children:"JPG, PNG or GIF. Max size 5MB."})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-2",children:"Personal Information"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1.5",children:"Display Name"}),e.jsx("input",{type:"text",value:i,onChange:e=>n(e.target.value),className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50",placeholder:"Enter your display name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1.5",children:"Email"}),e.jsx("input",{type:"email",value:f.email||"",disabled:!0,className:"w-full bg-gray-700/50 border border-gray-600 text-gray-400 rounded-lg px-4 py-2 cursor-not-allowed"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"block text-sm text-gray-300 mb-1.5 flex items-center gap-2",children:[e.jsx(K,{size:14}),"Phone Number"]}),e.jsx("input",{type:"tel",value:d,onChange:e=>c(e.target.value),className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50",placeholder:"+1 (555) 123-4567"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Used for SMS notifications and trip member contact (if enabled in Privacy settings)"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Bio"}),e.jsx("textarea",{value:l,onChange:e=>o(e.target.value),placeholder:"Tell people a bit about yourself...",className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50 resize-none",rows:3})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:async()=>{if(s){h(!0);try{const{error:e}=await t({display_name:i,bio:l});if(e)throw e;a({title:"Profile updated",description:"Your profile changes have been saved successfully."})}catch(e){a({title:"Error",description:"Failed to save profile changes. Please try again.",variant:"destructive"})}finally{h(!1)}}},disabled:m||!s,className:"bg-glass-orange hover:bg-glass-orange/80 text-white font-medium px-6 py-2 rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:18,className:"animate-spin"}),"Saving..."]}):"Save Changes"})})]})]})},fs=()=>{const{subscription:s,tier:t,isSubscribed:a,upgradeToTier:r,isLoading:i}=A(),[n,l]=u.useState(t),[o,d]=u.useState("monthly"),c={free:{name:"Free",price:0,icon:O,features:["Up to 3 active trips","Unlimited participants","Core group chat","Shared calendar (manual)","Photo & video sharing","Basic itinerary planning","Expense tracking","AI Trip Assistant (5 queries per trip)"]},explorer:{name:"Explorer",price:Xe.explorer.monthly,annualPrice:Xe.explorer.annual,icon:ae,features:["Unlimited saved trips","10 AI queries per trip","Location-aware AI suggestions","Smart notifications","Search past trips","Priority support","Custom trip categories & tagging"]},"frequent-chraveler":{name:"Frequent Chraveler",price:Xe["frequent-chraveler"].monthly,annualPrice:Xe["frequent-chraveler"].annual,icon:Be,features:["Everything in Explorer","Unlimited AI queries","Calendar sync (Google, Apple, Outlook)","PDF trip export","Create 1 Chravel Pro trip per month (50-seat limit)","Role-based channels on Pro trips","Custom trip categories & tagging","Early feature access"]}};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Subscriptions"}),e.jsxs("div",{className:"rounded-xl p-4 "+(a?"bg-gradient-to-r from-glass-orange/10 to-glass-yellow/10 border border-glass-orange/20":"bg-gradient-to-r from-blue-500/10 to-blue-600/10 border border-blue-500/20"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xl font-bold text-white flex items-center gap-2 capitalize",children:[t,a&&e.jsx(O,{size:20,className:"text-glass-orange"})]}),e.jsx("p",{className:a?"text-glass-orange":"text-blue-400",children:a?"Premium Features Active":"Free Forever"})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:["$",c[t].price,"/month"]}),a&&"trial"===(null==s?void 0:s.status)&&e.jsx("div",{className:"text-sm text-glass-yellow",children:"Trial Active"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-semibold text-white mb-2",children:"Current Plan Features"}),e.jsx("ul",{className:"space-y-1.5 text-sm text-gray-300",children:c[t].features.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-2 flex-shrink-0 "+(a?"bg-glass-orange":"bg-blue-400")}),s]},t))})]}),!a&&e.jsx("button",{onClick:()=>r("explorer",o),disabled:i,className:"bg-gradient-to-r from-glass-orange to-glass-yellow hover:from-glass-orange/80 hover:to-glass-yellow/80 text-white px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50",children:i?"Processing...":"View Upgrade Options"}),a&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:async()=>{try{const{data:e,error:s}=await v.functions.invoke("customer-portal");if(s)throw s;(null==e?void 0:e.url)?window.open(e.url,"_blank"):N.error("No portal URL received")}catch(e){N.error(`Failed to open customer portal: ${e.message}`)}},className:"bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Manage Subscription"}),e.jsx("button",{onClick:async()=>{if(window.confirm("Are you sure you want to cancel your subscription? You will lose access to premium features at the end of your billing period."))try{const{data:e,error:s}=await v.functions.invoke("customer-portal");if(s)throw s;(null==e?void 0:e.url)?window.open(e.url,"_blank"):N.error("No portal URL received")}catch(e){N.error(`Failed to open cancellation page: ${e.message}`)}},className:"bg-red-500/20 hover:bg-red-500/30 text-red-400 px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel Subscription"})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Billing Period"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>d("monthly"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("monthly"===o?"bg-glass-orange text-white":"bg-white/10 text-gray-300 hover:bg-white/20"),children:"Monthly"}),e.jsxs("button",{onClick:()=>d("annual"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("annual"===o?"bg-glass-orange text-white":"bg-white/10 text-gray-300 hover:bg-white/20"),children:["Annual ",e.jsx("span",{className:"text-xs opacity-75",children:"(Save 17%)"})]})]}),e.jsx("div",{className:"text-sm text-gray-400 mb-4",children:"monthly"===o?e.jsx("span",{children:"Explorer: $9.99/mo • Frequent Chraveler: $19.99/mo"}):e.jsx("span",{children:"Explorer: $99/yr ($8.25/mo) • Frequent Chraveler: $199/yr ($16.58/mo)"})})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Available Plans"}),e.jsx("div",{className:"space-y-3",children:Object.entries(c).map(([s,a])=>{const d=a.icon;return e.jsxs(L,{open:n===s,onOpenChange:()=>l(n===s?null:s),children:[e.jsx(B,{className:"w-full",children:e.jsx("div",{className:"border rounded-lg p-3 transition-colors hover:bg-white/5 "+(s===t?"border-glass-orange/50 bg-glass-orange/10":"border-white/10 bg-white/5"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left flex items-center gap-3",children:[e.jsx(d,{size:20,className:s===t?"text-glass-orange":"text-gray-400"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-white flex items-center gap-2 capitalize",children:a.name}),e.jsxs("div",{className:"text-xl font-bold text-white",children:["$",a.price,"/month"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s===t&&e.jsx("div",{className:"text-sm text-glass-orange font-medium",children:"Current Plan"}),e.jsx("div",{className:"text-gray-400",children:n===s?"−":"+"})]})]})})}),e.jsx(H,{className:"mt-2",children:e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 ml-4",children:[e.jsx("h6",{className:"font-medium text-white mb-2",children:"Features Included:"}),e.jsx("ul",{className:"space-y-1.5 text-sm text-gray-300",children:a.features.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-glass-orange rounded-full mt-2 flex-shrink-0"}),s]},t))}),"free"!==s&&s!==t&&e.jsx("button",{onClick:()=>r(s,o),disabled:i,className:"mt-4 bg-gradient-to-r from-glass-orange to-glass-yellow hover:from-glass-orange/80 hover:to-glass-yellow/80 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:i?"Processing...":`Upgrade to ${a.name}`})]})})]},s)})})]})]})},bs=[{key:"messages",dbKey:"chat_messages",label:"Messages",description:"Get notified when someone sends you a message",icon:e.jsx(Oe,{size:16,className:"text-blue-400"})},{key:"broadcasts",dbKey:"broadcasts",label:"Broadcasts",description:"Receive important announcements from trip organizers",icon:e.jsx($e,{size:16,className:"text-red-400"})},{key:"calendar",dbKey:"calendar_events",label:"Calendar Events",description:"Get notified when events are added or updated",icon:e.jsx(_e,{size:16,className:"text-purple-400"})},{key:"payments",dbKey:"payments",label:"Payments",description:"Get notified about payment requests and settlements",icon:e.jsx(te,{size:16,className:"text-green-400"})},{key:"tasks",dbKey:"tasks",label:"Tasks",description:"Get notified when tasks are assigned or completed",icon:e.jsx(He,{size:16,className:"text-yellow-400"})},{key:"polls",dbKey:"polls",label:"Polls",description:"Get notified when new polls are created",icon:e.jsx(Ue,{size:16,className:"text-cyan-400"})},{key:"joinRequests",dbKey:"join_requests",label:"Join Requests",description:"Get notified when someone requests to join your trip",icon:e.jsx(G,{size:16,className:"text-orange-400"})},{key:"basecampUpdates",dbKey:"basecamp_updates",label:"Basecamp Updates",description:"Get notified when trip basecamp location changes",icon:e.jsx(ke,{size:16,className:"text-pink-400"})}],ys=()=>{const{user:s}=S(),{toast:t}=k(),[a,r]=u.useState(!0),[i,n]=u.useState({messages:!0,broadcasts:!0,calendar:!0,payments:!0,tasks:!0,polls:!0,joinRequests:!0,basecampUpdates:!0,email:!0,push:!1,sms:!1,quietHours:!1}),[l,o]=u.useState({start:"22:00",end:"08:00"});u.useEffect(()=>{(async()=>{if(null==s?void 0:s.id)try{const e=await Ne.getNotificationPreferences(s.id);n({messages:e.chat_messages??!1,broadcasts:e.broadcasts??!0,calendar:e.calendar_events??!0,payments:e.payments??!0,tasks:e.tasks??!0,polls:e.polls??!0,joinRequests:e.join_requests??!0,basecampUpdates:e.basecamp_updates??!0,email:e.email_enabled??!0,push:e.push_enabled??!1,sms:e.sms_enabled??!1,quietHours:e.quiet_hours_enabled??!1}),o({start:e.quiet_start||"22:00",end:e.quiet_end||"08:00"})}catch(e){}finally{r(!1)}else r(!1)})()},[null==s?void 0:s.id]);const d=async(e,t)=>{if(o(s=>({...s,[e]:t})),null==s?void 0:s.id)try{const a={["start"===e?"quiet_start":"quiet_end"]:t};await Ne.updateNotificationPreferences(s.id,a)}catch(a){}},c=(a,r)=>e.jsx("button",{onClick:()=>(async e=>{const a=!i[e];if(n(s=>({...s,[e]:a})),null==s?void 0:s.id)try{const t={},r={messages:"chat_messages",broadcasts:"broadcasts",calendar:"calendar_events",payments:"payments",tasks:"tasks",polls:"polls",joinRequests:"join_requests",basecampUpdates:"basecamp_updates",email:"email_enabled",push:"push_enabled",sms:"sms_enabled",quietHours:"quiet_hours_enabled"}[e];r&&(t[r]=a),await Ne.updateNotificationPreferences(s.id,t)}catch(r){n(s=>({...s,[e]:!a})),t({title:"Error",description:"Failed to save preference. Please try again.",variant:"destructive"})}})(a),className:"relative w-12 h-6 rounded-full transition-colors "+(r?"bg-glass-orange":"bg-gray-600"),children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 transition-transform "+(r?"translate-x-6":"translate-x-0.5")})});return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(qe,{size:24,className:"text-glass-orange"}),"Notification Preferences"]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"App Notifications"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Choose which types of notifications you want to receive"}),e.jsx("div",{className:"space-y-3",children:bs.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.icon,e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:s.label}),e.jsx("p",{className:"text-sm text-gray-400",children:s.description})]})]}),c(s.key,i[s.key]??!0)]},s.key))})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Delivery Methods"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{size:16,className:"text-glass-orange"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"Push Notifications"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Real-time notifications on your device"})]})]}),c("push",i.push)]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{size:16,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Receive notifications via email"})]})]}),c("email",i.email)]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Le,{size:16,className:"text-green-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"SMS Notifications"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Get text messages for urgent updates"})]})]}),c("sms",i.sms)]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Quiet Hours"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-white font-medium",children:"Enable Quiet Hours"}),c("quietHours",i.quietHours)]}),i.quietHours&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Start Time"}),e.jsx("input",{type:"time",value:l.start,onChange:e=>d("start",e.target.value),className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"End Time"}),e.jsx("input",{type:"time",value:l.end,onChange:e=>d("end",e.target.value),className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50"})]})]})]})})]})]})},js=()=>{const{user:s,updateProfile:t}=S(),{toast:a}=k(),[r,i]=u.useState({useRealName:!1,useDisplayNameOnly:!0,sharePhoneNumber:!1});u.useEffect(()=>{s&&i(e=>({...e,sharePhoneNumber:s.showPhone||!1,useDisplayNameOnly:!s.showEmail,useRealName:s.showEmail||!1}))},[s]);const n=async e=>{const n=!r[e];let l={...r};if("useRealName"===e?l={...r,useRealName:n,useDisplayNameOnly:!n}:"useDisplayNameOnly"===e?l={...r,useDisplayNameOnly:n,useRealName:!n}:l[e]=n,i(l),null==s?void 0:s.id)try{const s={};"useRealName"!==e&&"useDisplayNameOnly"!==e||(s.show_email=l.useRealName),"sharePhoneNumber"===e&&(s.show_phone=n);const{error:r}=await t(s);if(r)throw r;a({title:"Settings updated",description:"Your privacy settings have been saved."})}catch(o){i(r),a({title:"Error",description:"Failed to save privacy settings. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Privacy & Security"}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Display Name Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Use Real Name"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Show your real name to other users"})]}),e.jsx("button",{onClick:()=>n("useRealName"),className:"relative w-12 h-6 rounded-full transition-colors "+(r.useRealName?"bg-glass-orange":"bg-gray-600"),children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 transition-transform "+(r.useRealName?"translate-x-6":"translate-x-0.5")})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Use Display Name Only"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Show only your chosen display name"})]}),e.jsx("button",{onClick:()=>n("useDisplayNameOnly"),className:"relative w-12 h-6 rounded-full transition-colors "+(r.useDisplayNameOnly?"bg-glass-orange":"bg-gray-600"),children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 transition-transform "+(r.useDisplayNameOnly?"translate-x-6":"translate-x-0.5")})})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Contact Information"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Share Phone Number with Trip Members"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Allow trip members to see your phone number for direct contact"})]}),e.jsx("button",{onClick:()=>n("sharePhoneNumber"),className:"relative w-12 h-6 rounded-full transition-colors "+(r.sharePhoneNumber?"bg-glass-orange":"bg-gray-600"),children:e.jsx("div",{className:"absolute w-5 h-5 bg-white rounded-full top-0.5 transition-transform "+(r.sharePhoneNumber?"translate-x-6":"translate-x-0.5")})})]})})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Account Security"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white font-medium",children:"Change Password"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Update your account password"})]}),e.jsx("div",{className:"text-glass-orange",children:"→"})]}),e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white font-medium",children:"Two-Factor Authentication"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Add an extra layer of security to your account"})]}),e.jsx("div",{className:"text-glass-orange",children:"Set Up"})]}),e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white font-medium",children:"Login History"}),e.jsx("div",{className:"text-sm text-gray-400",children:"View recent login activity"})]}),e.jsx("div",{className:"text-glass-orange",children:"→"})]})]})]})]})},vs=()=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"General Settings"}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"App Preferences"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Language"}),e.jsxs("select",{className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50",children:[e.jsx("option",{children:"English"}),e.jsx("option",{children:"Spanish"}),e.jsx("option",{children:"French"}),e.jsx("option",{children:"German"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Time Zone"}),e.jsxs("select",{className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50",children:[e.jsx("option",{children:"Pacific Time (PT)"}),e.jsx("option",{children:"Mountain Time (MT)"}),e.jsx("option",{children:"Central Time (CT)"}),e.jsx("option",{children:"Eastern Time (ET)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Date Format"}),e.jsxs("select",{className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-glass-orange/50",children:[e.jsx("option",{children:"MM/DD/YYYY"}),e.jsx("option",{children:"DD/MM/YYYY"}),e.jsx("option",{children:"YYYY-MM-DD"})]})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Data & Storage"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white font-medium",children:"Clear Cache"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Clear stored app data to free up space"})]}),e.jsx("div",{className:"text-glass-orange",children:"Clear"})]})})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-3",children:"Account Management"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white font-medium",children:"Deactivate Account"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Temporarily disable your account"})]}),e.jsx("div",{className:"text-yellow-500",children:"Deactivate"})]}),e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-lg transition-colors",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-red-400 font-medium",children:"Delete Account"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Permanently delete your account and all data"})]}),e.jsx("div",{className:"text-red-400",children:"Delete"})]})]})]})]});var ws="AlertDialog",[Ns,_s]=s(ws,[t]),ks=t(),Cs=s=>{const{__scopeAlertDialog:t,...a}=s,r=ks(t);return e.jsx(p,{...r,...a,modal:!0})};Cs.displayName=ws;u.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...i}=s,n=ks(r);return e.jsx(a,{...n,...i,ref:t})}).displayName="AlertDialogTrigger";var Ps=s=>{const{__scopeAlertDialog:t,...a}=s,r=ks(t);return e.jsx(x,{...r,...a})};Ps.displayName="AlertDialogPortal";var Ss=u.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...i}=s,n=ks(a);return e.jsx(r,{...n,...i,ref:t})});Ss.displayName="AlertDialogOverlay";var As="AlertDialogContent",[zs,Ms]=Ns(As),Es=u.forwardRef((s,t)=>{const{__scopeAlertDialog:a,children:r,...c}=s,m=ks(a),h=u.useRef(null),x=i(t,h),p=u.useRef(null);return e.jsx(n,{contentName:As,titleName:Ds,docsSlug:"alert-dialog",children:e.jsx(zs,{scope:a,cancelRef:p,children:e.jsxs(l,{role:"alertdialog",...m,...c,ref:x,onOpenAutoFocus:o(c.onOpenAutoFocus,e=>{var s;e.preventDefault(),null==(s=p.current)||s.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[e.jsx(d,{children:r}),e.jsx(Fs,{contentRef:h})]})})})});Es.displayName=As;var Ds="AlertDialogTitle",qs=u.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...r}=s,i=ks(a);return e.jsx(c,{...i,...r,ref:t})});qs.displayName=Ds;var Is="AlertDialogDescription",Us=u.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...r}=s,i=ks(a);return e.jsx(m,{...i,...r,ref:t})});Us.displayName=Is;var Ts=u.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...r}=s,i=ks(a);return e.jsx(h,{...i,...r,ref:t})});Ts.displayName="AlertDialogAction";var Rs="AlertDialogCancel",Os=u.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...r}=s,{cancelRef:n}=Ms(Rs,a),l=ks(a),o=i(t,n);return e.jsx(h,{...l,...r,ref:o})});Os.displayName=Rs;var Fs=({contentRef:e})=>{const s=`\`${As}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${As}\` by passing a \`${Is}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${As}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return u.useEffect(()=>{var s;document.getElementById(null==(s=e.current)?void 0:s.getAttribute("aria-describedby"))},[s,e]),null},$s=Ss,Ls=Es,Bs=Ts,Hs=Os,Gs=qs,Ys=Us;const Vs=Cs,Ws=Ps,Ks=u.forwardRef(({className:s,...t},a)=>e.jsx($s,{className:z("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Ks.displayName=$s.displayName;const Js=u.forwardRef(({className:s,...t},a)=>e.jsxs(Ws,{children:[e.jsx(Ks,{}),e.jsx(Ls,{ref:a,className:z("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));Js.displayName=Ls.displayName;const Qs=({className:s,...t})=>e.jsx("div",{className:z("flex flex-col space-y-2 text-center sm:text-left",s),...t});Qs.displayName="AlertDialogHeader";const Zs=({className:s,...t})=>e.jsx("div",{className:z("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});Zs.displayName="AlertDialogFooter";const Xs=u.forwardRef(({className:s,...t},a)=>e.jsx(Gs,{ref:a,className:z("text-lg font-semibold",s),...t}));Xs.displayName=Gs.displayName;const et=u.forwardRef(({className:s,...t},a)=>e.jsx(Ys,{ref:a,className:z("text-sm text-muted-foreground",s),...t}));et.displayName=Ys.displayName;const st=u.forwardRef(({className:s,...t},a)=>e.jsx(Bs,{ref:a,className:z(M(),s),...t}));st.displayName=Bs.displayName;const tt=u.forwardRef(({className:s,...t},a)=>e.jsx(Hs,{ref:a,className:z(M({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));tt.displayName=Hs.displayName;const at=({isOpen:s,onClose:t,onConfirm:a,tripTitle:r,isArchiving:i})=>e.jsx(Vs,{open:s,onOpenChange:t,children:e.jsxs(Js,{className:"bg-background border-border",children:[e.jsxs(Qs,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i?e.jsx(Pe,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(De,{className:"h-5 w-5 text-primary"}),e.jsx(Xs,{children:i?"Archive Trip":"Restore Trip"})]}),e.jsx(et,{className:"text-muted-foreground",children:i?e.jsxs(e.Fragment,{children:['Are you sure you want to archive "',e.jsx("strong",{children:r}),'"?',e.jsx("br",{}),e.jsx("br",{}),"This will hide the trip from your main list, but you can restore it anytime from Settings → Archived Trips."]}):e.jsxs(e.Fragment,{children:['Are you sure you want to restore "',e.jsx("strong",{children:r}),'"?',e.jsx("br",{}),e.jsx("br",{}),"This will return the trip to your main trips list."]})})]}),e.jsxs(Zs,{children:[e.jsx(tt,{onClick:t,children:"Cancel"}),e.jsx(st,{onClick:()=>{a(),t()},className:i?"bg-muted-foreground hover:bg-muted-foreground/80":"bg-primary hover:bg-primary/80",children:i?"Archive Trip":"Restore Trip"})]})]})}),rt=async(e,s)=>{const{data:t,error:a}=await v.from("trips").select("created_by").eq("id",e).single();if(a)throw new Error("TRIP_NOT_FOUND");if(t.created_by===s)throw new Error("CREATOR_CANNOT_DELETE");const{error:r}=await v.from("trip_members").delete().eq("trip_id",e).eq("user_id",s);if(r)throw r},it=async e=>{const{error:s}=await v.from("trips").update({is_hidden:!0}).eq("id",e);if(s)throw s},nt=async e=>{const{error:s}=await v.from("trips").update({is_hidden:!1}).eq("id",e);if(s)throw s},lt=async(e,s,t)=>{const{error:a}=await v.from("trips").update({is_archived:!0}).eq("id",e);if(a)throw a},ot=async(e,s,t)=>{var a;if(t){const{data:e}=await v.from("profiles").select("subscription_status, subscription_product_id").eq("user_id",t).single(),s="active"===(null==e?void 0:e.subscription_status)?(null==(a=e.subscription_product_id)?void 0:a.includes("explorer"))?"explorer":"frequent-chraveler":"free",{count:r,error:i}=await v.from("trips").select("*",{count:"exact",head:!0}).eq("created_by",t).eq("is_archived",!1);if(i)throw i;const n="free"===s?3:-1;if(-1!==n&&(r||0)>=n)throw new Error("TRIP_LIMIT_REACHED")}const{error:r}=await v.from("trips").update({is_archived:!1}).eq("id",e);if(r)throw r},dt=async e=>{const{data:s,error:t}=await v.from("trips").select("*").eq("is_archived",!0).eq("is_hidden",!1).eq("created_by",e||"");if(t)return{consumer:[],pro:[],events:[],total:0};return{consumer:(null==s?void 0:s.filter(e=>"consumer"===e.trip_type))||[],pro:(null==s?void 0:s.filter(e=>"pro"===e.trip_type))||[],events:(null==s?void 0:s.filter(e=>"event"===e.trip_type))||[],total:(null==s?void 0:s.length)||0}},ct=({icon:s,title:t,description:a,actionLabel:r,onAction:i,illustration:n,className:l=""})=>e.jsxs("div",{className:`text-center py-12 px-4 ${l}`,children:[n?e.jsx("div",{className:"w-32 h-32 mx-auto mb-6 bg-muted/20 rounded-full flex items-center justify-center",children:e.jsx("img",{src:n,alt:"",className:"w-24 h-24 opacity-60"})}):e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(s,{size:32,className:"text-primary"})}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-3",children:t}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto leading-relaxed",children:a}),r&&i&&e.jsx(C,{onClick:i,className:"animate-fade-in transition-all duration-200 hover:scale-105",children:r})]}),mt={consumer:[{id:"demo-archived-1",name:"Phoenix Golf Outing 2024",destination:"Phoenix, Arizona",start_date:"2024-02-20",end_date:"2024-02-23",description:"Annual guys' golf trip with tournaments and poker nights",participants:[{id:"1"},{id:"2"},{id:"3"},{id:"4"}]}],pro:[],events:[],total:1},ht=[{id:"demo-hidden-1",name:"Kristen's Bachelorette Party",destination:"Nashville, TN",start_date:"2025-11-08",end_date:"2025-11-10",description:"Epic bachelorette celebration - keeping this one private!",is_hidden:!0}],xt=()=>{const[s,t]=u.useState("archived"),[a,r]=u.useState({isOpen:!1,tripId:"",tripTitle:"",tripType:"consumer"}),{toast:i}=k(),n=E(),{isDemoMode:l}=D(),[o,d]=u.useState({consumer:[],pro:[],events:[],total:0}),[c,m]=u.useState([]),[h,x]=u.useState(!0),p=async()=>{if(x(!0),l)return d(mt),m(ht),void x(!1);try{const{data:{user:e}}=await v.auth.getUser();if(!e)return void x(!1);const s=await dt(e.id);d(s);const t=await(async e=>{const{data:s,error:t}=await v.from("trips").select("*").eq("is_hidden",!0).eq("created_by",e);return t?[]:s||[]})(e.id);m(t||[])}catch(e){}finally{x(!1)}};u.useEffect(()=>{p()},[a.isOpen,l]);const g=(e,s)=>{if(!e)return"No dates";try{const t=Ee(new Date(e),"MMM d"),a=s?Ee(new Date(s),"MMM d, yyyy"):"";return a?`${t} - ${a}`:t}catch{return"Invalid date"}},f=(s,t)=>e.jsxs(me,{className:"bg-card border-border",children:[e.jsx(he,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(xe,{className:"text-lg font-semibold text-foreground mb-2",children:s.name||s.title||"Untitled Trip"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-4 w-4"}),s.destination||s.location||"No location"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-4 w-4"}),g(s.start_date,s.end_date)]}),s.participants&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"h-4 w-4"}),s.participants.length]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Ce,{variant:"secondary",className:"text-xs",children:"consumer"===t?"Personal":"pro"===t?"Professional":"Event"})})]})}),e.jsx(ue,{className:"pt-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description||"No description"}),e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>r({isOpen:!0,tripId:s.id.toString(),tripTitle:s.name||s.title||"Untitled Trip",tripType:t}),className:"ml-4 flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Restore"]})]})})]},`${t}-${s.id}`),b=s=>e.jsxs(me,{className:"bg-card border-border",children:[e.jsx(he,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(xe,{className:"text-lg font-semibold text-foreground mb-2",children:s.name||"Untitled Trip"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-4 w-4"}),s.destination||"No location"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-4 w-4"}),g(s.start_date,s.end_date)]})]})]}),e.jsxs(Ce,{variant:"secondary",className:"text-xs bg-muted",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),"Hidden"]})]})}),e.jsx(ue,{className:"pt-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description||"No description"}),e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>(async(e,s)=>{try{await nt(e),n.invalidateQueries({queryKey:["trips"]}),i({title:"Trip unhidden",description:`"${s}" is now visible in your trips list.`}),p()}catch(t){i({title:"Error",description:"Failed to unhide trip",variant:"destructive"})}})(s.id,s.name||"Untitled Trip"),className:"ml-4 flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4"}),"Unhide"]})]})})]},`hidden-${s.id}`),y=o.total>0,j=c.length>0;return y||j||h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-2 border-b border-border pb-2",children:[e.jsxs("button",{onClick:()=>t("archived"),className:"px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 "+("archived"===s?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-muted"),children:[e.jsx(Pe,{className:"h-4 w-4"}),"Archived (",o.total,")"]}),e.jsxs("button",{onClick:()=>t("hidden"),className:"px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 "+("hidden"===s?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-muted"),children:[e.jsx(Se,{className:"h-4 w-4"}),"Hidden (",c.length,")"]})]}),"archived"===s?e.jsx("div",{className:"space-y-4",children:y?e.jsxs("div",{className:"grid gap-4",children:[o.consumer.map(e=>f(e,"consumer")),o.pro.map(e=>f(e,"pro")),o.events.map(e=>f(e,"event"))]}):e.jsx(ct,{icon:Pe,title:"No archived trips",description:"Trips you archive will appear here."})}):e.jsx("div",{className:"space-y-4",children:j?e.jsx("div",{className:"grid gap-4",children:c.map(e=>b(e))}):e.jsx(ct,{icon:Se,title:"No hidden trips",description:"Trips you hide will appear here. Hidden trips are kept private but remain accessible."})}),e.jsx(at,{isOpen:a.isOpen,onClose:()=>r(e=>({...e,isOpen:!1})),onConfirm:()=>{(async(e,s)=>{try{const{data:{user:t}}=await v.auth.getUser();if(!t)return;await ot(e,0,t.id),n.invalidateQueries({queryKey:["trips"]}),i({title:"Trip restored",description:`"${s}" has been restored to your trips list.`}),p()}catch(t){t instanceof Error&&"TRIP_LIMIT_REACHED"===t.message?i({title:"Trip Limit Reached",description:"You have 3 active trips (free tier limit). Archive a trip or upgrade to Explorer for unlimited trips.",variant:"destructive",duration:6e3}):i({title:"Error",description:"Failed to restore trip",variant:"destructive"})}})(a.tripId,a.tripTitle,a.tripType)},tripTitle:a.tripTitle,isArchiving:!1})]}):e.jsx(ct,{icon:Pe,title:"No archived or hidden trips",description:"Trips you archive or hide will appear here. You can archive trips to keep your main list organized while preserving access to old trips."})},pt=({tripId:s,onPreferencesChange:t,initialPreferences:a})=>{const{isDemoMode:r}=D(),{accentColors:i}=q(),[n,l]=u.useState({dietary:(null==a?void 0:a.dietary)||[],vibe:(null==a?void 0:a.vibe)||[],accessibility:(null==a?void 0:a.accessibility)||[],business:(null==a?void 0:a.business)||[],entertainment:(null==a?void 0:a.entertainment)||[],lifestyle:(null==a?void 0:a.lifestyle)||[],budgetMin:(null==a?void 0:a.budgetMin)||0,budgetMax:(null==a?void 0:a.budgetMax)||1e3,timePreference:(null==a?void 0:a.timePreference)||"flexible"});g.useEffect(()=>{a&&l({dietary:a.dietary||[],vibe:a.vibe||[],accessibility:a.accessibility||[],business:a.business||[],entertainment:a.entertainment||[],lifestyle:a.lifestyle||[],budgetMin:a.budgetMin||0,budgetMax:a.budgetMax||1e3,timePreference:a.timePreference||"flexible"})},[a]);const o=(e,s)=>{if("object"==typeof n[e]&&Array.isArray(n[e])){const a=n[e],r=a.includes(s)?a.filter(e=>e!==s):[...a,s],i={...n,[e]:r};l(i),t(i)}},d=(e,s)=>{const a=parseInt(s)||0,r={...n,[e]:a};l(r),t(r)};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`bg-gradient-to-r from-${i.primary}/30 to-${i.secondary}/30 p-2 rounded-xl`,children:e.jsx(Be,{size:20,className:`text-${i.primary}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Trip Preferences"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Help our AI make better recommendations"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:`bg-gradient-to-r from-${i.primary}/20 to-${i.secondary}/20 px-3 py-1 rounded-full`,children:e.jsx("span",{className:`text-${i.primary} text-sm font-medium`,children:r?"DEMO MODE":"PLUS"})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Dietary Preferences"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ve.map(s=>e.jsx("button",{onClick:()=>(e=>{const s=n.dietary.includes(e)?n.dietary.filter(s=>s!==e):[...n.dietary,e],a={...n,dietary:s};l(a),t(a)})(s),className:"px-3 py-2 rounded-full text-sm transition-colors "+(n.dietary.includes(s)?`bg-${i.primary} text-white`:"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:s},s))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Vibe & Activities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:We.map(s=>e.jsx("button",{onClick:()=>(e=>{const s=n.vibe.includes(e)?n.vibe.filter(s=>s!==e):[...n.vibe,e],a={...n,vibe:s};l(a),t(a)})(s),className:"px-3 py-2 rounded-full text-sm transition-colors "+(n.vibe.includes(s)?`bg-${i.primary} text-white`:"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:s},s))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Accessibility & Inclusivity"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ke.map(s=>e.jsx("button",{onClick:()=>o("accessibility",s),className:"px-3 py-2 rounded-full text-sm transition-colors "+(n.accessibility.includes(s)?`bg-${i.primary} text-white`:"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:s},s))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Business & Professional"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Je.map(s=>e.jsx("button",{onClick:()=>o("business",s),className:"px-3 py-2 rounded-full text-sm transition-colors "+(n.business.includes(s)?`bg-${i.primary} text-white`:"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:s},s))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Entertainment & Culture"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Qe.map(s=>e.jsx("button",{onClick:()=>o("entertainment",s),className:"px-3 py-2 rounded-full text-sm transition-colors "+(n.entertainment.includes(s)?`bg-${i.primary} text-white`:"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:s},s))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Lifestyle & Timing"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ze.map(s=>e.jsx("button",{onClick:()=>o("lifestyle",s),className:"px-3 py-2 rounded-full text-sm transition-colors "+(n.lifestyle.includes(s)?`bg-${i.primary} text-white`:"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:s},s))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Budget Range (USD)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Minimum"}),e.jsx(X,{type:"number",placeholder:"0",value:n.budgetMin,onChange:e=>d("budgetMin",e.target.value),className:"bg-gray-700 border-gray-600 text-white placeholder-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Maximum"}),e.jsx(X,{type:"number",placeholder:"1000",value:n.budgetMax,onChange:e=>d("budgetMax",e.target.value),className:"bg-gray-700 border-gray-600 text-white placeholder-gray-400"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Time Preference"}),e.jsx("div",{className:"flex gap-2",children:["early-riser","night-owl","flexible"].map(s=>e.jsx("button",{onClick:()=>(e=>{const s={...n,timePreference:e};l(s),t(s)})(s),className:"px-4 py-2 rounded-xl text-sm transition-colors capitalize "+(n.timePreference===s?`bg-${i.primary} text-white`:"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:s.replace("-"," ")},s))})]})]})]})},ut=()=>{A();const{user:s}=S(),{isDemoMode:t}=D(),[a,r]=u.useState(null),[i,n]=u.useState(!0);u.useEffect(()=>{t?(r({dietary:["Vegan","Gluten-Free"],vibe:["Adventure","Cultural"],accessibility:["Wheelchair Access","EV Charging"],business:[],entertainment:["Live Music"],lifestyle:["Eco-Friendly"],budgetMin:50,budgetMax:200,timePreference:"early-riser"}),n(!1)):s?l():n(!1)},[s,t]);const l=async()=>{if(s)try{const e=await Ne.getAIPreferences(s.id);r(e)}catch(e){}finally{n(!1)}};return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-400"})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Be,{size:24,className:"text-yellow-400"}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"AI Concierge Settings"})]}),e.jsx("p",{className:"text-gray-400",children:"Configure your preferences once - AI uses them across all trips for personalized recommendations"})]}),e.jsx("div",{className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 px-4 py-2 rounded-full",children:e.jsx("span",{className:"text-green-400 font-semibold text-sm",children:t?"DEMO MODE":"FREE"})})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ye,{size:20}),"How AI Concierge Works"]}),e.jsxs("ul",{className:"space-y-1.5 text-gray-300 text-sm",children:[e.jsx("li",{children:"✨ Set your preferences below (dietary, vibe, budget, accessibility)"}),e.jsx("li",{children:"🤖 AI remembers them across ALL your trips"}),e.jsx("li",{children:"🎯 Get personalized suggestions filtered to YOUR needs"}),e.jsx("li",{children:"⚡ No need to repeat preferences for each trip"})]})]}),e.jsx(pt,{tripId:"global-user-preferences",onPreferencesChange:async e=>{if(r(e),t)N.success("Demo: Preferences preview updated");else if(s)try{await Ne.setAIPreferences(s.id,e)?N.success("AI preferences saved"):N.error("Failed to save preferences")}catch(a){N.error("Failed to save preferences")}},initialPreferences:a||void 0}),a&&e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Active AI Filters"}),e.jsx("p",{className:"text-gray-400 text-sm mb-3",children:"When you ask AI for recommendations, these filters are automatically applied:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.dietary.map(s=>e.jsx("span",{className:"bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-sm",children:s},s)),a.vibe.map(s=>e.jsx("span",{className:"bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full text-sm",children:s},s)),a.accessibility.map(s=>e.jsx("span",{className:"bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-sm",children:s},s)),a.budgetMin>0&&e.jsxs("span",{className:"bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full text-sm",children:["Budget: $",a.budgetMin,"-$",a.budgetMax]}),"flexible"!==a.timePreference&&e.jsx("span",{className:"bg-pink-500/20 text-pink-400 px-3 py-1 rounded-full text-sm capitalize",children:a.timePreference.replace("-"," ")})]})]})]})},gt=({currentUserId:s,initialSection:t,onClose:a})=>{const[r,i]=u.useState(t||"profile"),[n,l]=u.useState(!1),o=y(),{demoView:d}=D(),c=[{id:"profile",label:"Profile",icon:je},{id:"billing",label:"Billing",icon:Te},{id:"ai-concierge",label:"AI Concierge",icon:Be},{id:"travel-wallet",label:"Travel Wallet",icon:Ye},{id:"saved-recs",label:"Saved Places",icon:Z,comingSoon:!("app-preview"===d)},{id:"notifications",label:"Notifications",icon:qe},{id:"privacy",label:"Privacy & Security",icon:V},{id:"settings",label:"General Settings",icon:ye},{id:"archived",label:"Archived Trips",icon:Pe}],m=()=>{switch(r){case"profile":default:return e.jsx(gs,{});case"billing":return e.jsx(fs,{});case"ai-concierge":return e.jsx(ut,{});case"travel-wallet":return e.jsx("div",{children:e.jsx(ds,{userId:s})});case"saved-recs":return e.jsx(I,{});case"notifications":return e.jsx(ys,{});case"privacy":return e.jsx(js,{});case"settings":return e.jsx(vs,{});case"archived":return e.jsx(xt,{})}},h=c.find(e=>e.id===r);return o?e.jsxs("div",{className:"flex flex-col h-full w-full min-w-0",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 border-b border-white/20",children:[e.jsxs("button",{onClick:()=>l(!n),className:"w-full flex items-center justify-between p-2 bg-white/10 rounded-xl text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h&&e.jsx(h.icon,{size:20}),e.jsx("span",{children:null==h?void 0:h.label})]}),e.jsx(ce,{size:20,className:"transform transition-transform "+(n?"rotate-180":"")})]}),n&&e.jsx("div",{className:"mt-2 bg-white/10 rounded-xl overflow-hidden",children:c.map(s=>{const t=s.icon,a="comingSoon"in s&&s.comingSoon;return e.jsxs("button",{onClick:()=>{a||(i(s.id),l(!1))},disabled:a,className:"w-full flex items-center gap-3 px-3 py-2 text-left transition-colors "+(a?"text-gray-500 cursor-not-allowed opacity-60":r===s.id?"bg-glass-orange/20 text-glass-orange":"text-gray-300 hover:text-white hover:bg-white/10"),children:[e.jsx(t,{size:20}),e.jsx("span",{className:"flex-1",children:s.label}),a&&e.jsx("span",{className:"text-xs bg-gray-600 text-gray-300 px-2 py-0.5 rounded-full",children:"Coming Soon"})]},s.id)})})]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-y-auto",children:e.jsx("div",{className:"p-3",children:m()})})]}):e.jsxs("div",{className:"flex h-full w-full min-w-0",children:[e.jsxs("div",{className:"w-64 flex-shrink-0 bg-white/5 backdrop-blur-md border-r border-white/10 p-4 overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-3",children:"Consumer Settings"}),e.jsx("div",{className:"space-y-1.5",children:c.map(s=>{const t=s.icon,a="comingSoon"in s&&s.comingSoon;return e.jsxs("button",{onClick:()=>{a||i(s.id)},disabled:a,className:"w-full flex items-center gap-3 px-3 py-2 rounded-xl transition-colors "+(a?"text-gray-500 cursor-not-allowed opacity-60":r===s.id?"bg-glass-orange/20 text-glass-orange border border-glass-orange/30":"text-gray-300 hover:text-white hover:bg-white/10"),children:[e.jsx(t,{size:20}),e.jsx("span",{className:"flex-1 text-left",children:s.label}),a&&e.jsx("span",{className:"text-xs bg-gray-600 text-gray-300 px-1.5 py-0.5 rounded-full",children:"Soon"})]},s.id)})})]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-y-auto",children:e.jsx("div",{className:"p-4 pb-16",children:m()})})]})},ft=()=>{const[s,t]=u.useState({organizationName:"",organizerName:"",organizerTitle:"",contactEmail:"",contactPhone:""}),[a,r]=u.useState({showOrganizerInfo:!0,showContactEmail:!1}),i=(e,s)=>{t(t=>({...t,[e]:s}))},n=e=>{r(s=>({...s,[e]:!s[e]}))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(je,{size:24,className:"text-glass-orange"}),"Event Organizer Profile"]}),e.jsx("p",{className:"text-gray-300 mt-2",children:"Manage information about your event organizer"})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-2",children:"Event Organizer Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"organizationName",className:"text-white",children:"Organization/Company Name"}),e.jsx(X,{id:"organizationName",value:s.organizationName,onChange:e=>i("organizationName",e.target.value),className:"bg-gray-800/50 border-gray-600 text-white mt-2",placeholder:"e.g., Acme Events Inc."})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"organizerName",className:"text-white",children:"Organizer Name"}),e.jsx(X,{id:"organizerName",value:s.organizerName,onChange:e=>i("organizerName",e.target.value),className:"bg-gray-800/50 border-gray-600 text-white mt-2",placeholder:"e.g., John Smith"})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"organizerTitle",className:"text-white",children:"Organizer Title/Role"}),e.jsx(X,{id:"organizerTitle",value:s.organizerTitle,onChange:e=>i("organizerTitle",e.target.value),className:"bg-gray-800/50 border-gray-600 text-white mt-2",placeholder:"e.g., Event Coordinator"})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"contactEmail",className:"text-white",children:"Contact Email"}),e.jsx(X,{id:"contactEmail",type:"email",value:s.contactEmail,onChange:e=>i("contactEmail",e.target.value),className:"bg-gray-800/50 border-gray-600 text-white mt-2",placeholder:"e.g., events@company.com"})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"contactPhone",className:"text-white",children:"Contact Phone (Optional)"}),e.jsx(X,{id:"contactPhone",type:"tel",value:s.contactPhone,onChange:e=>i("contactPhone",e.target.value),className:"bg-gray-800/50 border-gray-600 text-white mt-2",placeholder:"e.g., (555) 123-4567"})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-2",children:"Event Host Display"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-white/10",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-white text-sm font-medium",children:"Show organizer info to attendees"}),e.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"Display organizer details on the event page"})]}),e.jsx(se,{checked:a.showOrganizerInfo,onCheckedChange:()=>n("showOrganizerInfo"),className:"data-[state=checked]:bg-glass-orange"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-white text-sm font-medium",children:"Show contact email publicly"}),e.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"Make contact email visible to all attendees"})]}),e.jsx(se,{checked:a.showContactEmail,onCheckedChange:()=>n("showContactEmail"),className:"data-[state=checked]:bg-glass-orange"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(C,{className:"bg-glass-orange hover:bg-glass-orange/80",children:"Save Organizer Profile"})})]})},bt=()=>{const[s,t]=u.useState({rsvpUpdates:!0,chatMessages:!0,agendaChanges:!0,newAttendees:!1,eventReminders:!0}),a=e=>{t(s=>({...s,[e]:!s[e]}))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(qe,{size:24,className:"text-glass-orange"}),"Event Notifications"]}),e.jsx("p",{className:"text-gray-300 mt-2",children:"Manage how you receive updates about your events"})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-2",children:"Notification Preferences"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-white/10 last:border-0",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-white text-sm font-medium",children:"RSVP Updates"}),e.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"Get notified when attendees RSVP to your event"})]}),e.jsx(se,{checked:s.rsvpUpdates,onCheckedChange:()=>a("rsvpUpdates"),className:"data-[state=checked]:bg-glass-orange"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-white/10 last:border-0",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-white text-sm font-medium",children:"Event Chat Messages"}),e.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"Receive notifications for new messages in event chat"})]}),e.jsx(se,{checked:s.chatMessages,onCheckedChange:()=>a("chatMessages"),className:"data-[state=checked]:bg-glass-orange"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-white/10 last:border-0",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-white text-sm font-medium",children:"Agenda Changes"}),e.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"Get notified when the event schedule is updated"})]}),e.jsx(se,{checked:s.agendaChanges,onCheckedChange:()=>a("agendaChanges"),className:"data-[state=checked]:bg-glass-orange"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-white/10 last:border-0",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-white text-sm font-medium",children:"New Attendees"}),e.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"Notify when someone joins the event"})]}),e.jsx(se,{checked:s.newAttendees,onCheckedChange:()=>a("newAttendees"),className:"data-[state=checked]:bg-glass-orange"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-white text-sm font-medium",children:"Event Reminders"}),e.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:"Receive reminders before your event starts"})]}),e.jsx(se,{checked:s.eventReminders,onCheckedChange:()=>a("eventReminders"),className:"data-[state=checked]:bg-glass-orange"})]})]})]})]})},yt=({currentUserId:s,userOrganization:t,onShowProModal:a,onShowEnterpriseSettings:r,onShowAdvertiserHub:i})=>{const[n,l]=u.useState("profile"),[o,d]=u.useState(!1),c=y(),m=[{id:"profile",label:"Organizer Profile",icon:je},{id:"notifications",label:"Notifications",icon:qe}],h=()=>{switch(n){case"profile":default:return e.jsx(ft,{});case"notifications":return e.jsx(bt,{})}},x=m.find(e=>e.id===n);return c?e.jsxs("div",{className:"flex flex-col h-full w-full min-w-0",children:[e.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-white/20",children:[e.jsxs("button",{onClick:()=>d(!o),className:"w-full flex items-center justify-between p-3 bg-white/10 rounded-xl text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[x&&e.jsx(x.icon,{size:20}),e.jsx("span",{className:"text-sm",children:null==x?void 0:x.label})]}),e.jsx(ce,{size:20,className:"transform transition-transform "+(o?"rotate-180":"")})]}),o&&e.jsx("div",{className:"mt-2 bg-white/10 rounded-xl overflow-hidden",children:m.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>{l(s.id),d(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-left transition-colors "+(n===s.id?"bg-glass-orange/20 text-glass-orange":"text-gray-300 hover:text-white hover:bg-white/10"),children:[e.jsx(t,{size:20}),e.jsx("span",{className:"text-sm",children:s.label})]},s.id)})})]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-y-auto",children:e.jsx("div",{className:"p-4",children:h()})})]}):e.jsxs("div",{className:"flex h-full w-full min-w-0",children:[e.jsxs("div",{className:"w-64 flex-shrink-0 bg-white/5 backdrop-blur-md border-r border-white/10 p-4 overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-3",children:"Event Settings"}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Global organizer settings. Event-specific features (Agenda, Attendees, Chat) are in each event."}),e.jsx("div",{className:"space-y-1.5",children:m.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>l(s.id),className:"w-full flex items-center gap-3 px-3 py-2 rounded-xl transition-colors "+(n===s.id?"bg-glass-orange/20 text-glass-orange border border-glass-orange/30":"text-gray-300 hover:text-white hover:bg-white/10"),children:[e.jsx(t,{size:20}),e.jsx("span",{className:"text-sm",children:s.label})]},s.id)})})]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-y-auto",children:e.jsx("div",{className:"p-4 pb-16",children:h()})})]})},jt=({isOpen:s,onClose:t,initialConsumerSection:a,initialSettingsType:r})=>{const{user:i,signOut:n}=S(),l=f(),o=y(),[d,c]=u.useState(!1),[m,h]=u.useState(!1),[x,p]=u.useState("profile"),[g,b]=u.useState(r||"consumer");q();const{demoView:v}=D(),w="app-preview"===v,N=i||(w?{id:"demo-user",email:"demo@chravel.com",displayName:"Demo User",avatar:null,notificationSettings:{emailNotifications:!0,pushNotifications:!0,tripUpdates:!0,chatMessages:!0,calendarReminders:!0}}:null);if(!s)return null;if(!N)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 "+(o?"bg-black":"bg-black/80 backdrop-blur-sm flex items-center justify-center p-4"),onClick:o?void 0:t,children:e.jsxs("div",{className:""+(o?"h-full":"bg-card/95 backdrop-blur-xl border border-white/10 rounded-2xl max-w-md w-full"),onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Settings"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(j,{size:24})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 gap-6 text-center "+(o?"min-h-[80vh]":""),children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx(je,{className:"h-10 w-10 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Sign in to access settings"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Create an account or log in to personalize your experience"})]}),e.jsxs("div",{className:"flex gap-3 w-full max-w-xs",children:[!o&&e.jsx(C,{onClick:t,variant:"outline",className:"flex-1",children:"Cancel"}),e.jsxs(C,{onClick:()=>h(!0),size:"lg",className:o?"w-full":"flex-1",children:[e.jsx(Re,{className:"h-5 w-5 mr-2"})," Log In / Sign Up"]})]})]})]})}),e.jsx(Ae,{isOpen:m,onClose:()=>h(!1)})]});const _={id:"org-123",name:"Acme Entertainment Group",role:"owner",hasProAccess:!0};return"enterprise"===x&&(null==_?void 0:_.hasProAccess)?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-0 md:p-4",onClick:t,children:e.jsxs("div",{className:"w-full h-full md:h-[85vh] md:max-w-6xl bg-black/90 md:bg-white/10 md:backdrop-blur-md md:border md:border-white/20 md:rounded-2xl shadow-2xl flex flex-col animate-fade-in overflow-hidden",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6 border-b border-white/20",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Enterprise Settings"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(j,{size:24})})]}),e.jsx(hs,{organizationId:_.id,currentUserId:N.id})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-0 md:p-4",onClick:t,children:e.jsxs("div",{className:"w-full h-full md:h-[85vh] md:max-w-6xl bg-black/90 md:bg-card/95 md:backdrop-blur-xl md:border md:border-white/10 md:rounded-2xl shadow-2xl flex flex-col animate-fade-in overflow-hidden",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-3 md:px-4 md:py-3 border-b border-white/10 bg-black/20 gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-white whitespace-nowrap",children:"Settings"}),e.jsxs(U,{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 md:gap-2",children:[e.jsx("button",{onClick:()=>b("consumer"),className:"py-2 px-4 rounded-lg text-sm font-medium transition-all whitespace-nowrap "+("consumer"===g?"bg-primary text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-white/5"),children:"Consumer"}),e.jsx("button",{onClick:()=>b("enterprise"),className:"py-2 px-4 rounded-lg text-sm font-medium transition-all whitespace-nowrap "+("enterprise"===g?"bg-primary text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-white/5"),children:"Enterprise"}),e.jsx("button",{onClick:()=>b("events"),className:"py-2 px-4 rounded-lg text-sm font-medium transition-all whitespace-nowrap "+("events"===g?"bg-primary text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-white/5"),children:"Events"}),e.jsxs("button",{onClick:()=>w&&l("/advertiser"),disabled:!w,className:"py-2 px-4 rounded-lg text-sm font-medium whitespace-nowrap flex items-center gap-1 transition-all "+(w?"text-gray-400 hover:text-white hover:bg-white/5":"text-gray-500 cursor-not-allowed opacity-60"),children:["Advertiser",!w&&e.jsx("span",{className:"text-xs bg-gray-600 text-gray-300 px-1 py-0.5 rounded-full",children:"Soon"})]})]}),e.jsx(T,{orientation:"horizontal",className:"md:hidden"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-white/10 transition-colors flex-shrink-0",children:e.jsx(j,{size:20})})]}),o&&e.jsx("div",{className:"flex-shrink-0 p-4 border-b border-white/10 bg-gradient-to-r from-primary/10 to-primary/5",children:i?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx(je,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Signed in as"}),e.jsx("p",{className:"text-sm font-medium text-white truncate max-w-[200px]",children:i.email})]})]}),e.jsxs(C,{onClick:n,variant:"destructive",size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-1"})," Sign Out"]})]}):e.jsxs(C,{onClick:()=>h(!0),className:"w-full",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"})," Log In / Sign Up"]})}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:"consumer"===g?e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(gt,{currentUserId:N.id,initialSection:a,onClose:t})}):"enterprise"===g?e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(hs,{organizationId:null==_?void 0:_.id,currentUserId:N.id})}):"events"===g?e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(yt,{currentUserId:(null==N?void 0:N.id)||""})}):null})]})}),e.jsx(es,{isOpen:d,onClose:()=>c(!1)}),e.jsx(Ae,{isOpen:m,onClose:()=>h(!1)})]})};export{at as A,qe as B,Ue as C,Le as D,ct as E,Re as L,Oe as M,$e as R,Be as S,Ye as W,jt as a,He as b,lt as c,rt as d,dt as e,Ie as f,xs as g,it as h,Vs as i,Js as j,Qs as k,Xs as l,et as m,Zs as n,tt as o,st as p,ts as q,ot as r,rs as s,Ge as t,nt as u,us as v,is as w,Te as x,ps as y,Xe as z};
