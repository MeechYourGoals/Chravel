const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/web-BP8eFM4W-mjd3dogn.js","assets/js/index-Ta7FH5xW-mjd3dogn.js","assets/js/ui-vendor-BO3EQrMK-mjd3dogn.js","assets/js/react-vendor-D1R0t5S0-mjd3dogn.js","assets/js/supabase-DyX-XggK-mjd3dogn.js","assets/js/utils-DD44zzh--mjd3dogn.js","assets/index-Bc63Wok3.css","assets/js/tripConverter-C1IUbOIF-mjd3dogn.js","assets/js/tripsData-DKwZ96V_-mjd3dogn.js","assets/js/select-CMjqEsxb-mjd3dogn.js","assets/js/SettingsMenu-DFNATHGY-mjd3dogn.js","assets/js/SavedRecommendations-D-6cIfyL-mjd3dogn.js","assets/js/card-jeNxgMYk-mjd3dogn.js","assets/js/badge-DyE_ZUPM-mjd3dogn.js","assets/js/useSavedRecommendations-DTox9Xl2-mjd3dogn.js","assets/js/map-pin-BtCU-LeS-mjd3dogn.js","assets/js/plus-Dhwa7sZY-mjd3dogn.js","assets/js/pro-CZgaTEEg-mjd3dogn.js","assets/js/BillingSection-CjHrdMm3-mjd3dogn.js","assets/js/building-QMpp1aWF-mjd3dogn.js","assets/js/camera-AJLsIMdA-mjd3dogn.js","assets/js/user-DFuJ2ZP3-mjd3dogn.js","assets/js/shield-DGBvlKQi-mjd3dogn.js","assets/js/zap-LZcBFzwj-mjd3dogn.js","assets/js/trending-up-B0a-0y1l-mjd3dogn.js","assets/js/input-DsI2n-oJ-mjd3dogn.js","assets/js/label-D_iG0y88-mjd3dogn.js","assets/js/switch-GKuTbu---mjd3dogn.js","assets/js/loader-circle-C0Dqayt8-mjd3dogn.js","assets/js/mail-BdBVrsyz-mjd3dogn.js","assets/js/userPreferencesService-DregIO64-mjd3dogn.js","assets/js/calendar-C9K0fVga-mjd3dogn.js","assets/js/archive-zX2FvEif-mjd3dogn.js","assets/js/AuthModal-BKw70HSh-mjd3dogn.js","assets/js/arrow-left-Biq1qnK6-mjd3dogn.js","assets/js/eye-BNDPAvT6-mjd3dogn.js","assets/js/users-B07yK8Y7-mjd3dogn.js","assets/js/dropdown-menu-BXaKb4pk-mjd3dogn.js","assets/js/chevron-right-DKRZr0Ps-mjd3dogn.js","assets/js/dialog-BcLamxvL-mjd3dogn.js","assets/js/eventsMockData-BWXZ-nj7-mjd3dogn.js","assets/js/calendar-ylgcJK3b-mjd3dogn.js","assets/js/chevron-left-C1xtDQ_l-mjd3dogn.js","assets/js/progress-D31nnzej-mjd3dogn.js","assets/js/textarea-BudkfAn8-mjd3dogn.js","assets/js/googlePlacesNew-Dl7cAwDK-mjd3dogn.js","assets/js/external-link-CqAT5ABV-mjd3dogn.js","assets/js/circle-check-big-Bvor9_sf-mjd3dogn.js","assets/js/avatar-HCmfb6Ad-mjd3dogn.js","assets/js/circle-alert-CX60mGhN-mjd3dogn.js","assets/js/clock-CbBGjTQx-mjd3dogn.js","assets/js/chart-column-DOJCLy2J-mjd3dogn.js","assets/js/circle-check-CNnkiDfZ-mjd3dogn.js","assets/js/charts-CLK9EMgA-mjd3dogn.js","assets/js/share-2-DwO-SOoB-mjd3dogn.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,n,a)=>((t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a)(t,"symbol"!=typeof n?n+"":n,a);import{j as n,t as a,_ as r,v as i,w as s,x as o,z as l,y as c,E as d,F as u,G as m,H as p,a as h,u as g,P as f,f as x,d as v,J as y,K as b,q as w,r as j,b as N,s as _,I as k,O as S,L as C,T as E,M as D,N as P,Q as A,U as T,W as M,c as R,X as I,Y as O}from"./ui-vendor-BO3EQrMK-mjd3dogn.js";import{r as L,c as F,a as U,b as z,R as $,u as B,i as q,k as V}from"./react-vendor-D1R0t5S0-mjd3dogn.js";import{c as H,s as W,u as Y,f as K,a as G,B as Q,d as X,q as Z,r as J,t as ee,e as te,o as ne,X as ae,v as re,l as ie,w as se,x as oe,y as le,z as ce,A as de,j as ue,C as me,D as pe,k as he,W as ge,R as fe,E as xe,F as ve,G as ye,m as be,T as we,g as je,h as Ne,i as _e,H as ke,I as Se,J as Ce,n as Ee,K as De,M as Pe,N as Ae}from"./index-Ta7FH5xW-mjd3dogn.js";import{m as Te,M as Me,F as Re,g as Ie,n as Oe,R as Le,a as Fe,t as Ue,p as ze,L as $e,A as Be,f as qe,o as Ve,q as He,H as We,d as Ye,r as Ke,b as Ge,I as Qe}from"./tripConverter-C1IUbOIF-mjd3dogn.js";import{b as Xe,d as Ze,a as Je,g as et}from"./tripsData-DKwZ96V_-mjd3dogn.js";import{D as tt,a as nt,b as at,e as rt,C as it}from"./dropdown-menu-BXaKb4pk-mjd3dogn.js";import{I as st}from"./input-DsI2n-oJ-mjd3dogn.js";import{L as ot}from"./label-D_iG0y88-mjd3dogn.js";import{C as lt,a as ct,b as dt,c as ut,d as mt}from"./card-jeNxgMYk-mjd3dogn.js";import{S as pt,b as ht,q as gt,s as ft,t as xt,i as vt,j as yt,k as bt,l as wt,m as jt,n as Nt,o as _t,p as kt,g as St,M as Ct,f as Et,v as Dt,w as Pt,x as At,y as Tt,z as Mt,a as Rt}from"./SettingsMenu-DFNATHGY-mjd3dogn.js";import{B as It}from"./badge-DyE_ZUPM-mjd3dogn.js";import{D as Ot,a as Lt,b as Ft,c as Ut,d as zt}from"./dialog-BcLamxvL-mjd3dogn.js";import{S as $t,p as Bt,e as qt}from"./eventsMockData-BWXZ-nj7-mjd3dogn.js";import{P as Vt,a as Ht,b as Wt,C as Yt,c as Kt,d as Gt}from"./calendar-ylgcJK3b-mjd3dogn.js";import{a as Qt,C as Xt,S as Zt,b as Jt,c as en,d as tn,e as nn}from"./select-CMjqEsxb-mjd3dogn.js";import{D as an,S as rn,G as sn,L as on}from"./switch-GKuTbu---mjd3dogn.js";import{U as ln}from"./users-B07yK8Y7-mjd3dogn.js";import{_ as cn}from"./supabase-DyX-XggK-mjd3dogn.js";import{C as dn}from"./calendar-C9K0fVga-mjd3dogn.js";import{P as un,E as mn}from"./progress-D31nnzej-mjd3dogn.js";import{U as pn,a as hn,S as gn}from"./user-DFuJ2ZP3-mjd3dogn.js";import{I as fn,T as xn}from"./textarea-BudkfAn8-mjd3dogn.js";import{P as vn}from"./plus-Dhwa7sZY-mjd3dogn.js";import{C as yn}from"./camera-AJLsIMdA-mjd3dogn.js";import{L as bn}from"./loader-circle-C0Dqayt8-mjd3dogn.js";import{i as wn,b as jn,a as Nn,d as _n,e as kn,s as Sn,g as Cn,h as En,j as Dn,f as Pn,p as An}from"./utils-DD44zzh--mjd3dogn.js";import{g as Tn,a as Mn,w as Rn,r as In,c as On,b as Ln,l as Fn}from"./googlePlacesNew-Dl7cAwDK-mjd3dogn.js";import{M as Un}from"./map-pin-BtCU-LeS-mjd3dogn.js";import{E as zn}from"./external-link-CqAT5ABV-mjd3dogn.js";import{C as $n}from"./circle-check-big-Bvor9_sf-mjd3dogn.js";import{C as Bn}from"./chevron-left-C1xtDQ_l-mjd3dogn.js";import{C as qn}from"./chevron-right-DKRZr0Ps-mjd3dogn.js";import{A as Vn,b as Hn,a as Wn}from"./avatar-HCmfb6Ad-mjd3dogn.js";import{C as Yn}from"./circle-alert-CX60mGhN-mjd3dogn.js";import{C as Kn}from"./clock-CbBGjTQx-mjd3dogn.js";import{C as Gn}from"./chart-column-DOJCLy2J-mjd3dogn.js";import{c as Qn,U as Xn}from"./BillingSection-CjHrdMm3-mjd3dogn.js";import{C as Zn}from"./circle-check-CNnkiDfZ-mjd3dogn.js";import{P as Jn}from"./charts-CLK9EMgA-mjd3dogn.js";import{S as ea}from"./share-2-DwO-SOoB-mjd3dogn.js";import{A as ta}from"./AuthModal-BKw70HSh-mjd3dogn.js";import{Z as na}from"./zap-LZcBFzwj-mjd3dogn.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=H("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]),ra=H("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),ia=H("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),sa=H("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),oa=H("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]),la=H("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),ca=H("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]),da=H("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),ua=H("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),ma=H("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),pa=H("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),ha=H("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),ga=H("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),fa=H("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),xa=H("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),va=H("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),ya=H("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),ba=H("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]),wa=H("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),ja=H("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),Na=H("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),_a=H("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),ka=H("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Sa=H("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Ca=({tripId:e,demoMode:t=!1,isEvent:n=!1}={})=>{const[a,r]=L.useState(""),[i,s]=L.useState(null),[o,l]=L.useState("all"),{user:c}=Y(),{parseMessage:d}={parseMessage:L.useCallback(async(e,t,n)=>{try{const{data:a,error:r}=await W.functions.invoke("message-parser",{body:{messageId:e,content:t,tripId:n}});return!r&&((null==a?void 0:a.success)||!1)}catch(a){return!1}},[])},u=L.useCallback((e,n={})=>{const a=`msg_${Date.now()}`,{isBroadcast:r=!1,isPayment:s=!1,paymentData:o}=n,l=(null==c?void 0:c.avatar)||(t?Xe("You"):void 0);if(s&&o){const e=(o.amount/o.splitCount).toFixed(2),t="Venmo: @yourvenmo";return{id:a,text:`${o.description} - ${o.currency} ${o.amount.toFixed(2)} (split ${o.splitCount} ways) â€¢ Pay me $${e} via ${t}`,sender:{id:(null==c?void 0:c.id)||"demo-user",name:"You",avatar:l},createdAt:(new Date).toISOString(),isBroadcast:!1,isPayment:!0,reactions:{},tags:["payment"],replyTo:i?{id:i.id,text:i.text,sender:i.senderName}:void 0}}return{id:a,text:e,sender:{id:(null==c?void 0:c.id)||"demo-user",name:"You",avatar:l},createdAt:(new Date).toISOString(),isBroadcast:r,reactions:{},replyTo:i?{id:i.id,text:i.text,sender:i.senderName}:void 0}},[i,null==c?void 0:c.avatar,null==c?void 0:c.id,t]),m=L.useCallback(async(i={})=>{const{isPayment:o=!1,paymentData:l}=i;if(n&&o)return null;if(!o&&""===a.trim())return null;const c=u(a,i);return t||!e||o||await d(c.id,a,e),r(""),s(null),c},[a,u,t,e,d]),p=L.useCallback((e,t,n)=>{s({id:e,text:t,senderName:n})},[]),h=L.useCallback(()=>{s(null)},[]),g=L.useCallback(e=>"all"===o?e:"broadcasts"===o?e.filter(e=>!0===e.isBroadcast):"channels"===o?[]:e,[o]);return{inputMessage:a,replyingTo:i,messageFilter:o,setInputMessage:r,setMessageFilter:l,sendMessage:m,setReply:p,clearReply:h,filterMessages:g}},Ea=(e={})=>{const t=K(),n=L.useRef(),a=L.useRef(!1);return L.useEffect(()=>{var r;if(!t)return;n.current=(null==(r=window.visualViewport)?void 0:r.height)||window.innerHeight;const i=()=>{var t,r;if(!window.visualViewport)return;const i=window.visualViewport.height,s=(n.current||0)-i,o=s>150;o!==a.current&&(a.current=o,o?(document.body.classList.add("keyboard-visible"),null==(t=e.onShow)||t.call(e),e.adjustViewport&&document.documentElement.style.setProperty("--keyboard-height",`${s}px`)):(document.body.classList.remove("keyboard-visible"),null==(r=e.onHide)||r.call(e),e.adjustViewport&&document.documentElement.style.removeProperty("--keyboard-height")))},s=t=>{const n=t.target;if(n&&("INPUT"===n.tagName||"TEXTAREA"===n.tagName)){if(e.preventZoom&&/iPad|iPhone|iPod/.test(navigator.userAgent)){const e=n.style.fontSize;n.style.fontSize="16px";const t=()=>{n.style.fontSize=e,n.removeEventListener("blur",t)};n.addEventListener("blur",t)}setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center"})},300)}};return window.visualViewport&&window.visualViewport.addEventListener("resize",i),document.addEventListener("focusin",s),()=>{window.visualViewport&&window.visualViewport.removeEventListener("resize",i),document.removeEventListener("focusin",s),document.body.classList.remove("keyboard-visible"),document.documentElement.style.removeProperty("--keyboard-height")}},[t,e.preventZoom,e.adjustViewport,e.onShow,e.onHide]),{isKeyboardVisible:a.current}},Da=["venmo","cashapp","zelle","paypal","applecash"],Pa=(e=[])=>{const[t,n]=L.useState(0),[a,r]=L.useState("USD"),[i,s]=L.useState(""),[o,l]=L.useState([]),[c,d]=L.useState([]),[u,m]=L.useState(0);L.useEffect(()=>{m(o.length)},[o]);const p=L.useCallback(e=>{l(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),h=L.useCallback(e=>{d(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),g=L.useCallback(()=>{const t=o.length===e.length;l(t?[]:e.map(e=>e.id))},[o.length,e]),f=L.useCallback(()=>{const e=c.length===Da.length;d(e?[]:[...Da])},[c.length]),x=L.useCallback(()=>0===u?0:t/u,[t,u]),v=L.useCallback(()=>t<=0?{isValid:!1,error:"Amount must be greater than 0"}:i.trim()?0===o.length?{isValid:!1,error:"At least one participant must be selected"}:0===c.length?{isValid:!1,error:"At least one payment method must be selected"}:{isValid:!0}:{isValid:!1,error:"Description is required"},[t,i,o,c]),y=L.useCallback(()=>v().isValid?{amount:t,currency:a,description:i.trim(),splitCount:u,splitParticipants:o,paymentMethods:c}:null,[t,a,i,u,o,c,v]),b=L.useCallback(()=>{n(0),r("USD"),s(""),l([]),d([]),m(0)},[]);return{amount:t,currency:a,description:i,selectedParticipants:o,selectedPaymentMethods:c,splitCount:u,perPersonAmount:x(),isValid:v().isValid,validationError:v().error,allParticipantsSelected:o.length===e.length,allPaymentMethodsSelected:c.length===Da.length,setAmount:n,setCurrency:r,setDescription:s,setSelectedParticipants:l,toggleParticipant:p,togglePaymentMethod:h,selectAllParticipants:g,selectAllPaymentMethods:f,getPaymentData:y,validatePayment:v,resetForm:b}};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Aa=.999,Ta=/[\\\/_+.#"@\[\(\{&]/,Ma=/[\\\/_+.#"@\[\(\{&]/g,Ra=/[\s-]/,Ia=/[\s-]/g;function Oa(e,t,n,a,r,i,s){if(i===t.length)return r===e.length?1:.99;var o=`${r},${i}`;if(void 0!==s[o])return s[o];for(var l,c,d,u,m=a.charAt(i),p=n.indexOf(m,r),h=0;p>=0;)(l=Oa(e,t,n,a,p+1,i+1,s))>h&&(p===r?l*=1:Ta.test(e.charAt(p-1))?(l*=.8,(d=e.slice(r,p-1).match(Ma))&&r>0&&(l*=Math.pow(Aa,d.length))):Ra.test(e.charAt(p-1))?(l*=.9,(u=e.slice(r,p-1).match(Ia))&&r>0&&(l*=Math.pow(Aa,u.length))):(l*=.17,r>0&&(l*=Math.pow(Aa,p-r))),e.charAt(p)!==t.charAt(i)&&(l*=.9999)),(l<.1&&n.charAt(p-1)===a.charAt(i+1)||a.charAt(i+1)===a.charAt(i)&&n.charAt(p-1)!==a.charAt(i))&&(.1*(c=Oa(e,t,n,a,p+1,i+2,s))>l&&(l=.1*c)),l>h&&(h=l),p=n.indexOf(m,p+1);return s[o]=h,h}function La(e){return e.toLowerCase().replace(Ia," ")}function Fa(e,t,n){return Oa(e=n&&n.length>0?""+(e+" "+n.join(" ")):e,t,La(e),La(t),0,0,{})}function Ua(e,t,{checkForDefaultPrevented:n=!0}={}){return function(a){if(null==e||e(a),!1===n||!a.defaultPrevented)return null==t?void 0:t(a)}}function za(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function $a(...e){return t=>{let n=!1;const a=e.map(e=>{const a=za(e,t);return n||"function"!=typeof a||(n=!0),a});if(n)return()=>{for(let t=0;t<a.length;t++){const n=a[t];"function"==typeof n?n():za(e[t],null)}}}}function Ba(...e){return L.useCallback($a(...e),e)}function qa(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const a=n.reduce((t,{useScope:n,scopeName:a})=>({...t,...n(e)[`__scope${a}`]}),{});return L.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}var Va=(null==globalThis?void 0:globalThis.document)?L.useLayoutEffect:()=>{},Ha=F[" useId ".trim().toString()]||(()=>{}),Wa=0;function Ya(e){const[t,n]=L.useState(Ha());return Va(()=>{n(e=>e??String(Wa++))},[e]),t?`radix-${t}`:""}var Ka=F[" useInsertionEffect ".trim().toString()]||Va;function Ga({prop:e,defaultProp:t,onChange:n=()=>{},caller:a}){const[r,i,s]=function({defaultProp:e,onChange:t}){const[n,a]=L.useState(e),r=L.useRef(n),i=L.useRef(t);return Ka(()=>{i.current=t},[t]),L.useEffect(()=>{var e;r.current!==n&&(null==(e=i.current)||e.call(i,n),r.current=n)},[n,r]),[n,a,i]}({defaultProp:t,onChange:n}),o=void 0!==e,l=o?e:r;{const t=L.useRef(void 0!==e);L.useEffect(()=>{const e=t.current;if(e!==o){}t.current=o},[o,a])}const c=L.useCallback(t=>{var n;if(o){const a=function(e){return"function"==typeof e}(t)?t(e):t;a!==e&&(null==(n=s.current)||n.call(s,a))}else i(t)},[o,e,i,s]);return[l,c]}function Qa(e){const t=Xa(e),a=L.forwardRef((e,a)=>{const{children:r,...i}=e,s=L.Children.toArray(r),o=s.find(Ja);if(o){const e=o.props.children,r=s.map(t=>t===o?L.Children.count(e)>1?L.Children.only(null):L.isValidElement(e)?e.props.children:null:t);return n.jsx(t,{...i,ref:a,children:L.isValidElement(e)?L.cloneElement(e,void 0,r):null})}return n.jsx(t,{...i,ref:a,children:r})});return a.displayName=`${e}.Slot`,a}function Xa(e){const t=L.forwardRef((e,t)=>{const{children:n,...a}=e;if(L.isValidElement(n)){const e=function(e){var t,n;let a=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,r=a&&"isReactWarning"in a&&a.isReactWarning;if(r)return e.ref;if(a=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,r=a&&"isReactWarning"in a&&a.isReactWarning,r)return e.props.ref;return e.props.ref||e.ref}(n),r=function(e,t){const n={...t};for(const a in t){const r=e[a],i=t[a];/^on[A-Z]/.test(a)?r&&i?n[a]=(...e)=>{const t=i(...e);return r(...e),t}:r&&(n[a]=r):"style"===a?n[a]={...r,...i}:"className"===a&&(n[a]=[r,i].filter(Boolean).join(" "))}return{...e,...n}}(a,n.props);return n.type!==L.Fragment&&(r.ref=t?$a(t,e):e),L.cloneElement(n,r)}return L.Children.count(n)>1?L.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Za=Symbol("radix.slottable");function Ja(e){return L.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Za}var er=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const a=Qa(`Primitive.${t}`),r=L.forwardRef((e,r)=>{const{asChild:i,...s}=e,o=i?a:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),n.jsx(o,{...s,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function tr(e){const t=L.useRef(e);return L.useEffect(()=>{t.current=e}),L.useMemo(()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)},[])}var nr,ar="dismissableLayer.update",rr="dismissableLayer.pointerDownOutside",ir="dismissableLayer.focusOutside",sr=L.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),or=L.forwardRef((e,t)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:l,...c}=e,d=L.useContext(sr),[u,m]=L.useState(null),p=(null==u?void 0:u.ownerDocument)??(null==globalThis?void 0:globalThis.document),[,h]=L.useState({}),g=Ba(t,e=>m(e)),f=Array.from(d.layers),[x]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),v=f.indexOf(x),y=u?f.indexOf(u):-1,b=d.layersWithOutsidePointerEventsDisabled.size>0,w=y>=v,j=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=tr(e),a=L.useRef(!1),r=L.useRef(()=>{});return L.useEffect(()=>{const e=e=>{if(e.target&&!a.current){let a=function(){cr(rr,n,i,{discrete:!0})};const i={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",r.current),r.current=a,t.addEventListener("click",r.current,{once:!0})):a()}else t.removeEventListener("click",r.current);a.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",e),t.removeEventListener("click",r.current)}},[t,n]),{onPointerDownCapture:()=>a.current=!0}}(e=>{const t=e.target,n=[...d.branches].some(e=>e.contains(t));w&&!n&&(null==i||i(e),null==o||o(e),e.defaultPrevented||null==l||l())},p),N=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=tr(e),a=L.useRef(!1);return L.useEffect(()=>{const e=e=>{if(e.target&&!a.current){cr(ir,n,{originalEvent:e},{discrete:!1})}};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,n]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}(e=>{const t=e.target;[...d.branches].some(e=>e.contains(t))||(null==s||s(e),null==o||o(e),e.defaultPrevented||null==l||l())},p);return function(e,t=(null==globalThis?void 0:globalThis.document)){const n=tr(e);L.useEffect(()=>{const e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[n,t])}(e=>{y===d.layers.size-1&&(null==r||r(e),!e.defaultPrevented&&l&&(e.preventDefault(),l()))},p),L.useEffect(()=>{if(u)return a&&(0===d.layersWithOutsidePointerEventsDisabled.size&&(nr=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),lr(),()=>{a&&1===d.layersWithOutsidePointerEventsDisabled.size&&(p.body.style.pointerEvents=nr)}},[u,p,a,d]),L.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),lr())},[u,d]),L.useEffect(()=>{const e=()=>h({});return document.addEventListener(ar,e),()=>document.removeEventListener(ar,e)},[]),n.jsx(er.div,{...c,ref:g,style:{pointerEvents:b?w?"auto":"none":void 0,...e.style},onFocusCapture:Ua(e.onFocusCapture,N.onFocusCapture),onBlurCapture:Ua(e.onBlurCapture,N.onBlurCapture),onPointerDownCapture:Ua(e.onPointerDownCapture,j.onPointerDownCapture)})});or.displayName="DismissableLayer";function lr(){const e=new CustomEvent(ar);document.dispatchEvent(e)}function cr(e,t,n,{discrete:a}){const r=n.originalEvent.target,i=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&r.addEventListener(e,t,{once:!0}),a?function(e,t){e&&U.flushSync(()=>e.dispatchEvent(t))}(r,i):r.dispatchEvent(i)}L.forwardRef((e,t)=>{const a=L.useContext(sr),r=L.useRef(null),i=Ba(t,r);return L.useEffect(()=>{const e=r.current;if(e)return a.branches.add(e),()=>{a.branches.delete(e)}},[a.branches]),n.jsx(er.div,{...e,ref:i})}).displayName="DismissableLayerBranch";var dr="focusScope.autoFocusOnMount",ur="focusScope.autoFocusOnUnmount",mr={bubbles:!1,cancelable:!0},pr=L.forwardRef((e,t)=>{const{loop:a=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=e,[l,c]=L.useState(null),d=tr(i),u=tr(s),m=L.useRef(null),p=Ba(t,e=>c(e)),h=L.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;L.useEffect(()=>{if(r){let e=function(e){if(h.paused||!l)return;const t=e.target;l.contains(t)?m.current=t:xr(m.current,{select:!0})},t=function(e){if(h.paused||!l)return;const t=e.relatedTarget;null!==t&&(l.contains(t)||xr(m.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&xr(l)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const a=new MutationObserver(n);return l&&a.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),a.disconnect()}}},[r,l,h.paused]),L.useEffect(()=>{if(l){vr.add(h);const t=document.activeElement;if(!l.contains(t)){const n=new CustomEvent(dr,mr);l.addEventListener(dr,d),l.dispatchEvent(n),n.defaultPrevented||(!function(e,{select:t=!1}={}){const n=document.activeElement;for(const a of e)if(xr(a,{select:t}),document.activeElement!==n)return}((e=hr(l),e.filter(e=>"A"!==e.tagName)),{select:!0}),document.activeElement===t&&xr(l))}return()=>{l.removeEventListener(dr,d),setTimeout(()=>{const e=new CustomEvent(ur,mr);l.addEventListener(ur,u),l.dispatchEvent(e),e.defaultPrevented||xr(t??document.body,{select:!0}),l.removeEventListener(ur,u),vr.remove(h)},0)}}var e},[l,d,u,h]);const g=L.useCallback(e=>{if(!a&&!r)return;if(h.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){const t=e.currentTarget,[r,i]=function(e){const t=hr(e),n=gr(t,e),a=gr(t.reverse(),e);return[n,a]}(t);r&&i?e.shiftKey||n!==i?e.shiftKey&&n===r&&(e.preventDefault(),a&&xr(i,{select:!0})):(e.preventDefault(),a&&xr(r,{select:!0})):n===t&&e.preventDefault()}},[a,r,h.paused]);return n.jsx(er.div,{tabIndex:-1,...o,ref:p,onKeyDown:g})});function hr(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function gr(e,t){for(const n of e)if(!fr(n,{upTo:t}))return n}function fr(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function xr(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}pr.displayName="FocusScope";var vr=function(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=yr(e,t),e.unshift(t)},remove(t){var n;e=yr(e,t),null==(n=e[0])||n.resume()}}}();function yr(e,t){const n=[...e],a=n.indexOf(t);return-1!==a&&n.splice(a,1),n}var br=L.forwardRef((e,t)=>{var a;const{container:r,...i}=e,[s,o]=L.useState(!1);Va(()=>o(!0),[]);const l=r||s&&(null==(a=null==globalThis?void 0:globalThis.document)?void 0:a.body);return l?z.createPortal(n.jsx(er.div,{...i,ref:t}),l):null});br.displayName="Portal";var wr=e=>{const{present:t,children:n}=e,a=function(e){const[t,n]=L.useState(),a=L.useRef(null),r=L.useRef(e),i=L.useRef("none"),s=e?"mounted":"unmounted",[o,l]=function(e,t){return L.useReducer((e,n)=>t[e][n]??e,e)}(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return L.useEffect(()=>{const e=jr(a.current);i.current="mounted"===o?e:"none"},[o]),Va(()=>{const t=a.current,n=r.current;if(n!==e){const a=i.current,s=jr(t);if(e)l("MOUNT");else if("none"===s||"none"===(null==t?void 0:t.display))l("UNMOUNT");else{l(n&&a!==s?"ANIMATION_OUT":"UNMOUNT")}r.current=e}},[e,l]),Va(()=>{if(t){let e;const n=t.ownerDocument.defaultView??window,s=i=>{const s=jr(a.current).includes(CSS.escape(i.animationName));if(i.target===t&&s&&(l("ANIMATION_END"),!r.current)){const a=t.style.animationFillMode;t.style.animationFillMode="forwards",e=n.setTimeout(()=>{"forwards"===t.style.animationFillMode&&(t.style.animationFillMode=a)})}},o=e=>{e.target===t&&(i.current=jr(a.current))};return t.addEventListener("animationstart",o),t.addEventListener("animationcancel",s),t.addEventListener("animationend",s),()=>{n.clearTimeout(e),t.removeEventListener("animationstart",o),t.removeEventListener("animationcancel",s),t.removeEventListener("animationend",s)}}l("ANIMATION_END")},[t,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:L.useCallback(e=>{a.current=e?getComputedStyle(e):null,n(e)},[])}}(t),r="function"==typeof n?n({present:a.isPresent}):L.Children.only(n),i=Ba(a.ref,function(e){var t,n;let a=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,r=a&&"isReactWarning"in a&&a.isReactWarning;if(r)return e.ref;if(a=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,r=a&&"isReactWarning"in a&&a.isReactWarning,r)return e.props.ref;return e.props.ref||e.ref}(r));return"function"==typeof n||a.isPresent?L.cloneElement(r,{ref:i}):null};function jr(e){return(null==e?void 0:e.animationName)||"none"}wr.displayName="Presence";var Nr=0;function _r(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var kr=a(),Sr=function(){},Cr=L.forwardRef(function(e,t){var n=L.useRef(null),a=L.useState({onScrollCapture:Sr,onWheelCapture:Sr,onTouchMoveCapture:Sr}),o=a[0],l=a[1],c=e.forwardProps,d=e.children,u=e.className,m=e.removeScrollBar,p=e.enabled,h=e.shards,g=e.sideCar,f=e.noRelative,x=e.noIsolation,v=e.inert,y=e.allowPinchZoom,b=e.as,w=void 0===b?"div":b,j=e.gapMode,N=r(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=g,k=i([n,t]),S=s(s({},N),o);return L.createElement(L.Fragment,null,p&&L.createElement(_,{sideCar:kr,removeScrollBar:m,shards:h,noRelative:f,noIsolation:x,inert:v,setCallbacks:l,allowPinchZoom:!!y,lockRef:n,gapMode:j}),c?L.cloneElement(L.Children.only(d),s(s({},S),{ref:k})):L.createElement(w,s({},S,{className:u,ref:k}),d))});Cr.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Cr.classNames={fullWidth:o,zeroRight:l};var Er=!1;if("undefined"!=typeof window)try{var Dr=Object.defineProperty({},"passive",{get:function(){return Er=!0,!0}});window.addEventListener("test",Dr,Dr),window.removeEventListener("test",Dr,Dr)}catch(yN){Er=!1}var Pr=!!Er&&{passive:!1},Ar=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===n[t])},Tr=function(e,t){var n=t.ownerDocument,a=t;do{if("undefined"!=typeof ShadowRoot&&a instanceof ShadowRoot&&(a=a.host),Mr(e,a)){var r=Rr(e,a);if(r[1]>r[2])return!0}a=a.parentNode}while(a&&a!==n.body);return!1},Mr=function(e,t){return"v"===e?function(e){return Ar(e,"overflowY")}(t):function(e){return Ar(e,"overflowX")}(t)},Rr=function(e,t){return"v"===e?[(n=t).scrollTop,n.scrollHeight,n.clientHeight]:function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t);var n},Ir=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Or=function(e){return[e.deltaX,e.deltaY]},Lr=function(e){return e&&"current"in e?e.current:e},Fr=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},Ur=0,zr=[];function $r(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Br=m(kr,function(e){var t=L.useRef([]),n=L.useRef([0,0]),a=L.useRef(),r=L.useState(Ur++)[0],i=L.useState(c)[0],s=L.useRef(e);L.useEffect(function(){s.current=e},[e]),L.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(r));var t=d([e.lockRef.current],(e.shards||[]).map(Lr),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(r))})}}},[e.inert,e.lockRef.current,e.shards]);var o=L.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var r,i=Ir(e),o=n.current,l="deltaX"in e?e.deltaX:o[0]-i[0],c="deltaY"in e?e.deltaY:o[1]-i[1],d=e.target,u=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===u&&"range"===d.type)return!1;var m=Tr(u,d);if(!m)return!0;if(m?r=u:(r="v"===u?"h":"v",m=Tr(u,d)),!m)return!1;if(!a.current&&"changedTouches"in e&&(l||c)&&(a.current=r),!r)return!0;var p=a.current||r;return function(e,t,n,a,r){var i=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),s=i*a,o=n.target,l=t.contains(o),c=!1,d=s>0,u=0,m=0;do{if(!o)break;var p=Rr(e,o),h=p[0],g=p[1]-p[2]-i*h;(h||g)&&Mr(e,o)&&(u+=g,m+=h);var f=o.parentNode;o=f&&f.nodeType===Node.DOCUMENT_FRAGMENT_NODE?f.host:f}while(!l&&o!==document.body||l&&(t.contains(o)||t===o));return d&&(Math.abs(u)<1||!r)?c=!0:d||!(Math.abs(m)<1)&&r||(c=!0),c}(p,t,e,"h"===p?l:c,!0)},[]),l=L.useCallback(function(e){var n=e;if(zr.length&&zr[zr.length-1]===i){var a="deltaY"in n?Or(n):Ir(n),r=t.current.filter(function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&(t=e.delta,r=a,t[0]===r[0]&&t[1]===r[1]);var t,r})[0];if(r&&r.should)n.cancelable&&n.preventDefault();else if(!r){var l=(s.current.shards||[]).map(Lr).filter(Boolean).filter(function(e){return e.contains(n.target)});(l.length>0?o(n,l[0]):!s.current.noIsolation)&&n.cancelable&&n.preventDefault()}}},[]),m=L.useCallback(function(e,n,a,r){var i={name:e,delta:n,target:a,should:r,shadowParent:$r(a)};t.current.push(i),setTimeout(function(){t.current=t.current.filter(function(e){return e!==i})},1)},[]),p=L.useCallback(function(e){n.current=Ir(e),a.current=void 0},[]),h=L.useCallback(function(t){m(t.type,Or(t),t.target,o(t,e.lockRef.current))},[]),g=L.useCallback(function(t){m(t.type,Ir(t),t.target,o(t,e.lockRef.current))},[]);L.useEffect(function(){return zr.push(i),e.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:g}),document.addEventListener("wheel",l,Pr),document.addEventListener("touchmove",l,Pr),document.addEventListener("touchstart",p,Pr),function(){zr=zr.filter(function(e){return e!==i}),document.removeEventListener("wheel",l,Pr),document.removeEventListener("touchmove",l,Pr),document.removeEventListener("touchstart",p,Pr)}},[]);var f=e.removeScrollBar,x=e.inert;return L.createElement(L.Fragment,null,x?L.createElement(i,{styles:Fr(r)}):null,f?L.createElement(u,{noRelative:e.noRelative,gapMode:e.gapMode}):null)});var qr=L.forwardRef(function(e,t){return L.createElement(Cr,s({},e,{ref:t,sideCar:Br}))});qr.classNames=Cr.classNames;var Vr="Dialog",[Hr,Wr]=function(e,t=[]){let a=[];const r=()=>{const t=a.map(e=>L.createContext(e));return function(n){const a=(null==n?void 0:n[e])||t;return L.useMemo(()=>({[`__scope${e}`]:{...n,[e]:a}}),[n,a])}};return r.scopeName=e,[function(t,r){const i=L.createContext(r),s=a.length;a=[...a,r];const o=t=>{var a;const{scope:r,children:o,...l}=t,c=(null==(a=null==r?void 0:r[e])?void 0:a[s])||i,d=L.useMemo(()=>l,Object.values(l));return n.jsx(c.Provider,{value:d,children:o})};return o.displayName=t+"Provider",[o,function(n,a){var o;const l=(null==(o=null==a?void 0:a[e])?void 0:o[s])||i,c=L.useContext(l);if(c)return c;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},qa(r,...t)]}(Vr),[Yr,Kr]=Hr(Vr),Gr=e=>{const{__scopeDialog:t,children:a,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=e,l=L.useRef(null),c=L.useRef(null),[d,u]=Ga({prop:r,defaultProp:i??!1,onChange:s,caller:Vr});return n.jsx(Yr,{scope:t,triggerRef:l,contentRef:c,contentId:Ya(),titleId:Ya(),descriptionId:Ya(),open:d,onOpenChange:u,onOpenToggle:L.useCallback(()=>u(e=>!e),[u]),modal:o,children:a})};Gr.displayName=Vr;var Qr="DialogTrigger";L.forwardRef((e,t)=>{const{__scopeDialog:a,...r}=e,i=Kr(Qr,a),s=Ba(t,i.triggerRef);return n.jsx(er.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":pi(i.open),...r,ref:s,onClick:Ua(e.onClick,i.onOpenToggle)})}).displayName=Qr;var Xr="DialogPortal",[Zr,Jr]=Hr(Xr,{forceMount:void 0}),ei=e=>{const{__scopeDialog:t,forceMount:a,children:r,container:i}=e,s=Kr(Xr,t);return n.jsx(Zr,{scope:t,forceMount:a,children:L.Children.map(r,e=>n.jsx(wr,{present:a||s.open,children:n.jsx(br,{asChild:!0,container:i,children:e})}))})};ei.displayName=Xr;var ti="DialogOverlay",ni=L.forwardRef((e,t)=>{const a=Jr(ti,e.__scopeDialog),{forceMount:r=a.forceMount,...i}=e,s=Kr(ti,e.__scopeDialog);return s.modal?n.jsx(wr,{present:r||s.open,children:n.jsx(ri,{...i,ref:t})}):null});ni.displayName=ti;var ai=Qa("DialogOverlay.RemoveScroll"),ri=L.forwardRef((e,t)=>{const{__scopeDialog:a,...r}=e,i=Kr(ti,a);return n.jsx(qr,{as:ai,allowPinchZoom:!0,shards:[i.contentRef],children:n.jsx(er.div,{"data-state":pi(i.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),ii="DialogContent",si=L.forwardRef((e,t)=>{const a=Jr(ii,e.__scopeDialog),{forceMount:r=a.forceMount,...i}=e,s=Kr(ii,e.__scopeDialog);return n.jsx(wr,{present:r||s.open,children:s.modal?n.jsx(oi,{...i,ref:t}):n.jsx(li,{...i,ref:t})})});si.displayName=ii;var oi=L.forwardRef((e,t)=>{const a=Kr(ii,e.__scopeDialog),r=L.useRef(null),i=Ba(t,a.contentRef,r);return L.useEffect(()=>{const e=r.current;if(e)return p(e)},[]),n.jsx(ci,{...e,ref:i,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ua(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null==(t=a.triggerRef.current)||t.focus()}),onPointerDownOutside:Ua(e.onPointerDownOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()}),onFocusOutside:Ua(e.onFocusOutside,e=>e.preventDefault())})}),li=L.forwardRef((e,t)=>{const a=Kr(ii,e.__scopeDialog),r=L.useRef(!1),i=L.useRef(!1);return n.jsx(ci,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,s;null==(n=e.onCloseAutoFocus)||n.call(e,t),t.defaultPrevented||(r.current||null==(s=a.triggerRef.current)||s.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var n,s;null==(n=e.onInteractOutside)||n.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"===t.detail.originalEvent.type&&(i.current=!0));const o=t.target;(null==(s=a.triggerRef.current)?void 0:s.contains(o))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}})}),ci=L.forwardRef((e,t)=>{const{__scopeDialog:a,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=e,l=Kr(ii,a),c=L.useRef(null),d=Ba(t,c);return L.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??_r()),document.body.insertAdjacentElement("beforeend",e[1]??_r()),Nr++,()=>{1===Nr&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Nr--}},[]),n.jsxs(n.Fragment,{children:[n.jsx(pr,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:n.jsx(or,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":pi(l.open),...o,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),n.jsxs(n.Fragment,{children:[n.jsx(xi,{titleId:l.titleId}),n.jsx(vi,{contentRef:c,descriptionId:l.descriptionId})]})]})}),di="DialogTitle";L.forwardRef((e,t)=>{const{__scopeDialog:a,...r}=e,i=Kr(di,a);return n.jsx(er.h2,{id:i.titleId,...r,ref:t})}).displayName=di;var ui="DialogDescription";L.forwardRef((e,t)=>{const{__scopeDialog:a,...r}=e,i=Kr(ui,a);return n.jsx(er.p,{id:i.descriptionId,...r,ref:t})}).displayName=ui;var mi="DialogClose";function pi(e){return e?"open":"closed"}L.forwardRef((e,t)=>{const{__scopeDialog:a,...r}=e,i=Kr(mi,a);return n.jsx(er.button,{type:"button",...r,ref:t,onClick:Ua(e.onClick,()=>i.onOpenChange(!1))})}).displayName=mi;var hi="DialogTitleWarning",[gi,fi]=function(e,t){const a=L.createContext(t),r=e=>{const{children:t,...r}=e,i=L.useMemo(()=>r,Object.values(r));return n.jsx(a.Provider,{value:i,children:t})};return r.displayName=e+"Provider",[r,function(n){const r=L.useContext(a);if(r)return r;if(void 0!==t)return t;throw new Error(`\`${n}\` must be used within \`${e}\``)}]}(hi,{contentName:ii,titleName:di,docsSlug:"dialog"}),xi=({titleId:e})=>{const t=fi(hi),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.\n\nIf you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return L.useEffect(()=>{if(e){document.getElementById(e)}},[n,e]),null},vi=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${fi("DialogDescriptionWarning").contentName}}.`;return L.useEffect(()=>{var n;const a=null==(n=e.current)?void 0:n.getAttribute("aria-describedby");if(t&&a){document.getElementById(t)}},[n,e,t]),null},yi=Gr,bi=ei,wi=ni,ji=si,Ni='[cmdk-group=""]',_i='[cmdk-group-items=""]',ki='[cmdk-item=""]',Si=`${ki}:not([aria-disabled="true"])`,Ci="cmdk-item-select",Ei="data-value",Di=(e,t,n)=>Fa(e,t,n),Pi=L.createContext(void 0),Ai=()=>L.useContext(Pi),Ti=L.createContext(void 0),Mi=()=>L.useContext(Ti),Ri=L.createContext(void 0),Ii=L.forwardRef((e,t)=>{let n=Gi(()=>{var t,n;return{search:"",value:null!=(n=null!=(t=e.value)?t:e.defaultValue)?n:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),a=Gi(()=>new Set),r=Gi(()=>new Map),i=Gi(()=>new Map),s=Gi(()=>new Set),o=Yi(e),{label:l,children:c,value:d,onValueChange:u,filter:m,shouldFilter:p,loop:h,disablePointerSelection:g=!1,vimBindings:f=!0,...x}=e,v=Ya(),y=Ya(),b=Ya(),w=L.useRef(null),j=Zi();Ki(()=>{if(void 0!==d){let e=d.trim();n.current.value=e,N.emit()}},[d]),Ki(()=>{j(6,D)},[]);let N=L.useMemo(()=>({subscribe:e=>(s.current.add(e),()=>s.current.delete(e)),snapshot:()=>n.current,setState:(e,t,a)=>{var r,i,s,l;if(!Object.is(n.current[e],t)){if(n.current[e]=t,"search"===e)E(),S(),j(1,C);else if("value"===e){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let e=document.getElementById(b);e?e.focus():null==(r=document.getElementById(v))||r.focus()}if(j(7,()=>{var e;n.current.selectedItemId=null==(e=P())?void 0:e.id,N.emit()}),a||j(5,D),void 0!==(null==(i=o.current)?void 0:i.value)){let e=null!=t?t:"";return void(null==(l=(s=o.current).onValueChange)||l.call(s,e))}}N.emit()}},emit:()=>{s.current.forEach(e=>e())}}),[]),_=L.useMemo(()=>({value:(e,t,a)=>{var r;t!==(null==(r=i.current.get(e))?void 0:r.value)&&(i.current.set(e,{value:t,keywords:a}),n.current.filtered.items.set(e,k(t,a)),j(2,()=>{S(),N.emit()}))},item:(e,t)=>(a.current.add(e),t&&(r.current.has(t)?r.current.get(t).add(e):r.current.set(t,new Set([e]))),j(3,()=>{E(),S(),n.current.value||C(),N.emit()}),()=>{i.current.delete(e),a.current.delete(e),n.current.filtered.items.delete(e);let t=P();j(4,()=>{E(),(null==t?void 0:t.getAttribute("id"))===e&&C(),N.emit()})}),group:e=>(r.current.has(e)||r.current.set(e,new Set),()=>{i.current.delete(e),r.current.delete(e)}),filter:()=>o.current.shouldFilter,label:l||e["aria-label"],getDisablePointerSelection:()=>o.current.disablePointerSelection,listId:v,inputId:b,labelId:y,listInnerRef:w}),[]);function k(e,t){var a,r;let i=null!=(r=null==(a=o.current)?void 0:a.filter)?r:Di;return e?i(e,n.current.search,t):0}function S(){if(!n.current.search||!1===o.current.shouldFilter)return;let e=n.current.filtered.items,t=[];n.current.filtered.groups.forEach(n=>{let a=r.current.get(n),i=0;a.forEach(t=>{let n=e.get(t);i=Math.max(n,i)}),t.push([n,i])});let a=w.current;A().sort((t,n)=>{var a,r;let i=t.getAttribute("id"),s=n.getAttribute("id");return(null!=(a=e.get(s))?a:0)-(null!=(r=e.get(i))?r:0)}).forEach(e=>{let t=e.closest(_i);t?t.appendChild(e.parentElement===t?e:e.closest(`${_i} > *`)):a.appendChild(e.parentElement===a?e:e.closest(`${_i} > *`))}),t.sort((e,t)=>t[1]-e[1]).forEach(e=>{var t;let n=null==(t=w.current)?void 0:t.querySelector(`${Ni}[${Ei}="${encodeURIComponent(e[0])}"]`);null==n||n.parentElement.appendChild(n)})}function C(){let e=A().find(e=>"true"!==e.getAttribute("aria-disabled")),t=null==e?void 0:e.getAttribute(Ei);N.setState("value",t||void 0)}function E(){var e,t,s,l;if(!n.current.search||!1===o.current.shouldFilter)return void(n.current.filtered.count=a.current.size);n.current.filtered.groups=new Set;let c=0;for(let r of a.current){let a=k(null!=(t=null==(e=i.current.get(r))?void 0:e.value)?t:"",null!=(l=null==(s=i.current.get(r))?void 0:s.keywords)?l:[]);n.current.filtered.items.set(r,a),a>0&&c++}for(let[a,i]of r.current)for(let e of i)if(n.current.filtered.items.get(e)>0){n.current.filtered.groups.add(a);break}n.current.filtered.count=c}function D(){var e,t,n;let a=P();a&&((null==(e=a.parentElement)?void 0:e.firstChild)===a&&(null==(n=null==(t=a.closest(Ni))?void 0:t.querySelector('[cmdk-group-heading=""]'))||n.scrollIntoView({block:"nearest"})),a.scrollIntoView({block:"nearest"}))}function P(){var e;return null==(e=w.current)?void 0:e.querySelector(`${ki}[aria-selected="true"]`)}function A(){var e;return Array.from((null==(e=w.current)?void 0:e.querySelectorAll(Si))||[])}function T(e){let t=A()[e];t&&N.setState("value",t.getAttribute(Ei))}function M(e){var t;let n=P(),a=A(),r=a.findIndex(e=>e===n),i=a[r+e];null!=(t=o.current)&&t.loop&&(i=r+e<0?a[a.length-1]:r+e===a.length?a[0]:a[r+e]),i&&N.setState("value",i.getAttribute(Ei))}function R(e){let t,n=P(),a=null==n?void 0:n.closest(Ni);for(;a&&!t;)a=e>0?Hi(a,Ni):Wi(a,Ni),t=null==a?void 0:a.querySelector(Si);t?N.setState("value",t.getAttribute(Ei)):M(e)}let I=()=>T(A().length-1),O=e=>{e.preventDefault(),e.metaKey?I():e.altKey?R(1):M(1)},F=e=>{e.preventDefault(),e.metaKey?T(0):e.altKey?R(-1):M(-1)};return L.createElement(er.div,{ref:t,tabIndex:-1,...x,"cmdk-root":"",onKeyDown:e=>{var t;null==(t=x.onKeyDown)||t.call(x,e);let n=e.nativeEvent.isComposing||229===e.keyCode;if(!e.defaultPrevented&&!n)switch(e.key){case"n":case"j":f&&e.ctrlKey&&O(e);break;case"ArrowDown":O(e);break;case"p":case"k":f&&e.ctrlKey&&F(e);break;case"ArrowUp":F(e);break;case"Home":e.preventDefault(),T(0);break;case"End":e.preventDefault(),I();break;case"Enter":{e.preventDefault();let t=P();if(t){let e=new Event(Ci);t.dispatchEvent(e)}}}}},L.createElement("label",{"cmdk-label":"",htmlFor:_.inputId,id:_.labelId,style:es},l),Ji(e,e=>L.createElement(Ti.Provider,{value:N},L.createElement(Pi.Provider,{value:_},e))))}),Oi=L.forwardRef((e,t)=>{var n,a;let r=Ya(),i=L.useRef(null),s=L.useContext(Ri),o=Ai(),l=Yi(e),c=null!=(a=null==(n=l.current)?void 0:n.forceMount)?a:null==s?void 0:s.forceMount;Ki(()=>{if(!c)return o.item(r,null==s?void 0:s.id)},[c]);let d=Xi(r,i,[e.value,e.children,i],e.keywords),u=Mi(),m=Qi(e=>e.value&&e.value===d.current),p=Qi(e=>!(!c&&!1!==o.filter())||(!e.search||e.filtered.items.get(r)>0));function h(){var e,t;g(),null==(t=(e=l.current).onSelect)||t.call(e,d.current)}function g(){u.setState("value",d.current,!0)}if(L.useEffect(()=>{let t=i.current;if(t&&!e.disabled)return t.addEventListener(Ci,h),()=>t.removeEventListener(Ci,h)},[p,e.onSelect,e.disabled]),!p)return null;let{disabled:f,value:x,onSelect:v,forceMount:y,keywords:b,...w}=e;return L.createElement(er.div,{ref:$a(i,t),...w,id:r,"cmdk-item":"",role:"option","aria-disabled":!!f,"aria-selected":!!m,"data-disabled":!!f,"data-selected":!!m,onPointerMove:f||o.getDisablePointerSelection()?void 0:g,onClick:f?void 0:h},e.children)}),Li=L.forwardRef((e,t)=>{let{heading:n,children:a,forceMount:r,...i}=e,s=Ya(),o=L.useRef(null),l=L.useRef(null),c=Ya(),d=Ai(),u=Qi(e=>!(!r&&!1!==d.filter())||(!e.search||e.filtered.groups.has(s)));Ki(()=>d.group(s),[]),Xi(s,o,[e.value,e.heading,l]);let m=L.useMemo(()=>({id:s,forceMount:r}),[r]);return L.createElement(er.div,{ref:$a(o,t),...i,"cmdk-group":"",role:"presentation",hidden:!u||void 0},n&&L.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},n),Ji(e,e=>L.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?c:void 0},L.createElement(Ri.Provider,{value:m},e))))}),Fi=L.forwardRef((e,t)=>{let{alwaysRender:n,...a}=e,r=L.useRef(null),i=Qi(e=>!e.search);return n||i?L.createElement(er.div,{ref:$a(r,t),...a,"cmdk-separator":"",role:"separator"}):null}),Ui=L.forwardRef((e,t)=>{let{onValueChange:n,...a}=e,r=null!=e.value,i=Mi(),s=Qi(e=>e.search),o=Qi(e=>e.selectedItemId),l=Ai();return L.useEffect(()=>{null!=e.value&&i.setState("search",e.value)},[e.value]),L.createElement(er.input,{ref:t,...a,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":o,id:l.inputId,type:"text",value:r?e.value:s,onChange:e=>{r||i.setState("search",e.target.value),null==n||n(e.target.value)}})}),zi=L.forwardRef((e,t)=>{let{children:n,label:a="Suggestions",...r}=e,i=L.useRef(null),s=L.useRef(null),o=Qi(e=>e.selectedItemId),l=Ai();return L.useEffect(()=>{if(s.current&&i.current){let e,t=s.current,n=i.current,a=new ResizeObserver(()=>{e=requestAnimationFrame(()=>{let e=t.offsetHeight;n.style.setProperty("--cmdk-list-height",e.toFixed(1)+"px")})});return a.observe(t),()=>{cancelAnimationFrame(e),a.unobserve(t)}}},[]),L.createElement(er.div,{ref:$a(i,t),...r,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":o,"aria-label":a,id:l.listId},Ji(e,e=>L.createElement("div",{ref:$a(s,l.listInnerRef),"cmdk-list-sizer":""},e)))}),$i=L.forwardRef((e,t)=>{let{open:n,onOpenChange:a,overlayClassName:r,contentClassName:i,container:s,...o}=e;return L.createElement(yi,{open:n,onOpenChange:a},L.createElement(bi,{container:s},L.createElement(wi,{"cmdk-overlay":"",className:r}),L.createElement(ji,{"aria-label":e.label,"cmdk-dialog":"",className:i},L.createElement(Ii,{ref:t,...o}))))}),Bi=L.forwardRef((e,t)=>Qi(e=>0===e.filtered.count)?L.createElement(er.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),qi=L.forwardRef((e,t)=>{let{progress:n,children:a,label:r="Loading...",...i}=e;return L.createElement(er.div,{ref:t,...i,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":r},Ji(e,e=>L.createElement("div",{"aria-hidden":!0},e)))}),Vi=Object.assign(Ii,{List:zi,Item:Oi,Input:Ui,Group:Li,Separator:Fi,Dialog:$i,Empty:Bi,Loading:qi});function Hi(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function Wi(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function Yi(e){let t=L.useRef(e);return Ki(()=>{t.current=e}),t}var Ki="undefined"==typeof window?L.useEffect:L.useLayoutEffect;function Gi(e){let t=L.useRef();return void 0===t.current&&(t.current=e()),t}function Qi(e){let t=Mi(),n=()=>e(t.snapshot());return L.useSyncExternalStore(t.subscribe,n,n)}function Xi(e,t,n,a=[]){let r=L.useRef(),i=Ai();return Ki(()=>{var s;let o=(()=>{var e;for(let t of n){if("string"==typeof t)return t.trim();if("object"==typeof t&&"current"in t)return t.current?null==(e=t.current.textContent)?void 0:e.trim():r.current}})(),l=a.map(e=>e.trim());i.value(e,o,l),null==(s=t.current)||s.setAttribute(Ei,o),r.current=o}),r}var Zi=()=>{let[e,t]=L.useState(),n=Gi(()=>new Map);return Ki(()=>{n.current.forEach(e=>e()),n.current=new Map},[e]),(e,a)=>{n.current.set(e,a),t({})}};function Ji({asChild:e,children:t},n){return e&&L.isValidElement(t)?L.cloneElement(function(e){let t=e.type;return"function"==typeof t?t(e.props):"render"in t?t.render(e.props):e}(t),{ref:t.ref},n(t.props.children)):n(t)}var es={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const ts=L.forwardRef(({className:e,...t},a)=>n.jsx(Vi,{ref:a,className:G("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));ts.displayName=Vi.displayName;const ns=L.forwardRef(({className:e,...t},a)=>n.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[n.jsx($t,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),n.jsx(Vi.Input,{ref:a,className:G("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));ns.displayName=Vi.Input.displayName;const as=L.forwardRef(({className:e,...t},a)=>n.jsx(Vi.List,{ref:a,className:G("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t}));as.displayName=Vi.List.displayName;const rs=L.forwardRef(({className:e,...t},a)=>n.jsx(Vi.Empty,{ref:a,className:G("py-6 text-center text-sm",e),...t}));rs.displayName=Vi.Empty.displayName;const is=L.forwardRef(({className:e,...t},a)=>n.jsx(Vi.Group,{ref:a,className:G("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));is.displayName=Vi.Group.displayName;const ss=L.forwardRef(({className:e,...t},a)=>n.jsx(Vi.Separator,{ref:a,className:G("-mx-1 h-px bg-border",e),...t}));ss.displayName=Vi.Separator.displayName;const os=L.forwardRef(({className:e,...t},a)=>n.jsx(Vi.Item,{ref:a,className:G("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50",e),...t}));os.displayName=Vi.Item.displayName;const ls=[{code:"USD",symbol:"$",name:"US Dollar",decimalPlaces:2},{code:"EUR",symbol:"â‚¬",name:"Euro",decimalPlaces:2},{code:"GBP",symbol:"Â£",name:"British Pound",decimalPlaces:2},{code:"JPY",symbol:"Â¥",name:"Japanese Yen",decimalPlaces:0},{code:"CNY",symbol:"Â¥",name:"Chinese Yuan",decimalPlaces:2},{code:"CAD",symbol:"C$",name:"Canadian Dollar",decimalPlaces:2},{code:"MXN",symbol:"MX$",name:"Mexican Peso",decimalPlaces:2},{code:"AUD",symbol:"A$",name:"Australian Dollar",decimalPlaces:2},{code:"NZD",symbol:"NZ$",name:"New Zealand Dollar",decimalPlaces:2},{code:"SGD",symbol:"S$",name:"Singapore Dollar",decimalPlaces:2},{code:"HKD",symbol:"HK$",name:"Hong Kong Dollar",decimalPlaces:2},{code:"KRW",symbol:"â‚©",name:"South Korean Won",decimalPlaces:0},{code:"INR",symbol:"â‚¹",name:"Indian Rupee",decimalPlaces:2},{code:"THB",symbol:"à¸¿",name:"Thai Baht",decimalPlaces:2},{code:"PHP",symbol:"â‚±",name:"Philippine Peso",decimalPlaces:2},{code:"MYR",symbol:"RM",name:"Malaysian Ringgit",decimalPlaces:2},{code:"IDR",symbol:"Rp",name:"Indonesian Rupiah",decimalPlaces:0},{code:"VND",symbol:"â‚«",name:"Vietnamese Dong",decimalPlaces:0},{code:"CHF",symbol:"CHF",name:"Swiss Franc",decimalPlaces:2},{code:"SEK",symbol:"kr",name:"Swedish Krona",decimalPlaces:2},{code:"NOK",symbol:"kr",name:"Norwegian Krone",decimalPlaces:2},{code:"DKK",symbol:"kr",name:"Danish Krone",decimalPlaces:2},{code:"PLN",symbol:"zÅ‚",name:"Polish Zloty",decimalPlaces:2},{code:"CZK",symbol:"KÄ",name:"Czech Koruna",decimalPlaces:2},{code:"HUF",symbol:"Ft",name:"Hungarian Forint",decimalPlaces:0},{code:"RON",symbol:"lei",name:"Romanian Leu",decimalPlaces:2},{code:"TRY",symbol:"â‚º",name:"Turkish Lira",decimalPlaces:2},{code:"RUB",symbol:"â‚½",name:"Russian Ruble",decimalPlaces:2},{code:"AED",symbol:"Ø¯.Ø¥",name:"UAE Dirham",decimalPlaces:2},{code:"SAR",symbol:"ï·¼",name:"Saudi Riyal",decimalPlaces:2},{code:"ILS",symbol:"â‚ª",name:"Israeli Shekel",decimalPlaces:2},{code:"ZAR",symbol:"R",name:"South African Rand",decimalPlaces:2},{code:"EGP",symbol:"EÂ£",name:"Egyptian Pound",decimalPlaces:2},{code:"BRL",symbol:"R$",name:"Brazilian Real",decimalPlaces:2},{code:"ARS",symbol:"$",name:"Argentine Peso",decimalPlaces:2},{code:"CLP",symbol:"$",name:"Chilean Peso",decimalPlaces:0},{code:"COP",symbol:"$",name:"Colombian Peso",decimalPlaces:0},{code:"PEN",symbol:"S/",name:"Peruvian Sol",decimalPlaces:2},{code:"BTC",symbol:"â‚¿",name:"Bitcoin",decimalPlaces:8},{code:"ETH",symbol:"Îž",name:"Ethereum",decimalPlaces:8}];function cs(e){return ls.find(t=>t.code===e)}const ds=["USD","EUR","GBP","JPY","CAD","AUD","CHF","CNY","MXN","BRL"],us={"North America":["USD","CAD","MXN"],Europe:["EUR","GBP","CHF","SEK","NOK","DKK","PLN","CZK","HUF","RON","TRY","RUB"],"Asia-Pacific":["JPY","CNY","AUD","NZD","SGD","HKD","KRW","INR","THB","PHP","MYR","IDR","VND"],"Middle East & Africa":["AED","SAR","ILS","ZAR","EGP"],"South America":["BRL","ARS","CLP","COP","PEN"],Cryptocurrency:["BTC","ETH"]},ms=({value:e,onChange:t,className:a})=>{const[r,i]=L.useState(!1),[s,o]=L.useState(""),l=cs(e);return n.jsxs(Vt,{open:r,onOpenChange:i,children:[n.jsx(Ht,{asChild:!0,children:n.jsxs(Q,{variant:"outline",role:"combobox","aria-expanded":r,className:G("w-full justify-between h-12 rounded-xl bg-gray-900/40 border-white/10 text-white hover:bg-gray-800/60",a),children:[l?n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"font-mono text-lg",children:l.symbol}),n.jsx("span",{children:l.code}),n.jsxs("span",{className:"text-sm text-gray-400",children:["(",l.name,")"]})]}):n.jsx("span",{className:"text-gray-500",children:"Select currency..."}),n.jsx($t,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),n.jsx(Wt,{className:"w-[400px] p-0 bg-gray-900 border-white/10",align:"start",children:n.jsxs(ts,{className:"bg-gray-900",children:[n.jsx(ns,{placeholder:"Search currencies...",value:s,onValueChange:o,className:"border-none focus:ring-0 text-white placeholder-gray-500"}),n.jsxs(as,{children:[n.jsx(rs,{className:"py-6 text-center text-sm text-gray-400",children:"No currency found."}),!s&&n.jsxs(n.Fragment,{children:[n.jsx(is,{heading:"Popular",className:"text-gray-400",children:ds.map(a=>{const r=cs(a);return r?n.jsxs(os,{value:`${a} ${r.name} ${r.symbol}`,onSelect:()=>{t(a),i(!1)},className:"cursor-pointer hover:bg-gray-800 text-white",children:[n.jsx(Qt,{className:G("mr-2 h-4 w-4",e===a?"opacity-100":"opacity-0")}),n.jsx("span",{className:"font-mono text-lg mr-2 w-8",children:r.symbol}),n.jsx("span",{className:"font-semibold mr-2",children:r.code}),n.jsx("span",{className:"text-sm text-gray-400",children:r.name})]},a):null})}),n.jsx(ss,{className:"bg-white/10"})]}),Object.entries(us).map(([a,r])=>{const o=r.map(e=>cs(e)).filter(Boolean),l=s?o.filter(e=>e.code.toLowerCase().includes(s.toLowerCase())||e.name.toLowerCase().includes(s.toLowerCase())):o;return 0===l.length?null:n.jsxs($.Fragment,{children:[n.jsx(is,{heading:a,className:"text-gray-400",children:l.map(a=>a?n.jsxs(os,{value:`${a.code} ${a.name} ${a.symbol}`,onSelect:()=>{t(a.code),i(!1)},className:"cursor-pointer hover:bg-gray-800 text-white",children:[n.jsx(Qt,{className:G("mr-2 h-4 w-4",e===a.code?"opacity-100":"opacity-0")}),n.jsx("span",{className:"font-mono text-lg mr-2 w-8",children:a.symbol}),n.jsx("span",{className:"font-semibold mr-2",children:a.code}),n.jsx("span",{className:"text-sm text-gray-400",children:a.name})]},a.code):null)}),"Cryptocurrency"!==a&&n.jsx(ss,{className:"bg-white/10"})]},a)})]})]})})]})},ps=({onSubmit:e,tripMembers:t,isVisible:a,tripId:r})=>{const{user:i}=Y(),{amount:s,currency:o,description:l,selectedParticipants:c,selectedPaymentMethods:d,perPersonAmount:u,allParticipantsSelected:m,allPaymentMethodsSelected:p,setAmount:h,setCurrency:g,setDescription:f,toggleParticipant:x,togglePaymentMethod:v,selectAllParticipants:y,selectAllPaymentMethods:b,getPaymentData:w,resetForm:j,setSelectedParticipants:N}=Pa(t),[_,k]=L.useState([]),[S,C]=L.useState(!1),E=u,{isDemoMode:D}=X();return L.useEffect(()=>{if(!(null==i?void 0:i.id)||!r||D||!l.trim())return;const e=setTimeout(async()=>{C(!0);try{const e=await gt(l,r,i.id);if(e.suggestedParticipants.length>0&&e.confidence>.5){k(e.suggestedParticipants);const t=e.suggestedParticipants.filter(e=>e.confidence>=.7).map(e=>e.userId);t.length>0&&0===c.length&&N(t),e.amount&&!s&&h(e.amount),e.currency&&"USD"===o&&g(e.currency)}else k([])}catch(e){}finally{C(!1)}},500);return()=>clearTimeout(e)},[l,r,null==i?void 0:i.id,D,s,o,c.length,h,g,N]),L.useEffect(()=>{if(!(null==i?void 0:i.id)||!r||D)return;(async()=>{try{const e=await ft(r,i.id);if(k(e),0===c.length&&e.length>0){const t=e.filter(e=>e.confidence>=.6).slice(0,3).map(e=>e.userId);t.length>0&&N(t)}}catch(e){}})()},[r,null==i?void 0:i.id,D,c.length,N]),a?n.jsx(lt,{className:"bg-gradient-to-b from-gray-950 via-gray-900 to-gray-950 border border-white/10 rounded-2xl shadow-2xl",children:n.jsxs(ct,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[n.jsx(an,{size:20,className:"text-emerald-400"}),n.jsx("span",{className:"text-base font-semibold text-white",children:"Payment Details"})]}),n.jsxs("form",{onSubmit:t=>{t.preventDefault();const n=w();n&&(e(n),j())},className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"flex flex-col space-y-1",children:[n.jsx(ot,{htmlFor:"amount",className:"text-sm font-medium text-gray-300",children:"Amount"}),n.jsx(st,{id:"amount",type:"number",step:"0.01",value:s||"",onChange:e=>h(Number(e.target.value)),placeholder:"0.00",className:"w-full h-12 rounded-xl bg-gray-900/40 border border-white/10 text-white px-4 focus:ring-2 focus:ring-emerald-400/40 focus:outline-none placeholder-gray-500 transition-all",required:!0})]}),n.jsxs("div",{className:"flex flex-col space-y-1",children:[n.jsx(ot,{htmlFor:"currency",className:"text-sm font-medium text-gray-300",children:"Currency"}),n.jsx(ms,{value:o,onChange:g})]}),n.jsxs("div",{className:"flex flex-col space-y-1",children:[n.jsx(ot,{htmlFor:"description",className:"text-sm font-medium text-gray-300",children:"What's this for?"}),n.jsx("textarea",{id:"description",value:l,onChange:e=>f(e.target.value),placeholder:"Dinner, taxi, tickets, etc.",className:"w-full h-12 resize-none rounded-xl bg-gray-900/40 border border-white/10 text-white px-4 py-2 focus:ring-2 focus:ring-emerald-400/40 focus:outline-none placeholder-gray-500 transition-all",required:!0})]})]}),n.jsxs("div",{className:"bg-gray-900/40 border border-white/10 rounded-xl p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ln,{size:16,className:"text-emerald-400"}),n.jsxs("h4",{className:"text-sm font-semibold text-gray-200",children:["Split between ",c.length," people",E>0&&n.jsxs("span",{className:"text-emerald-400 font-semibold ml-1.5",children:["($",E.toFixed(2)," each)"]})]}),S&&n.jsx(pt,{size:14,className:"text-emerald-400 animate-pulse"})]}),n.jsx("button",{type:"button",onClick:y,className:"text-xs text-emerald-400 hover:text-emerald-300 transition-colors font-medium",children:m?"Deselect All":"Select All"})]}),_.length>0&&!D&&n.jsx("div",{className:"mb-2 flex flex-wrap gap-1",children:_.slice(0,3).map(e=>{const a=t.find(t=>t.id===e.userId);if(!a)return null;const r=c.includes(e.userId);return n.jsxs(It,{variant:r?"default":"outline",className:"text-xs cursor-pointer hover:bg-emerald-500/20",onClick:()=>x(e.userId),children:[a.name,e.confidence>=.7&&n.jsx(pt,{size:10,className:"ml-1"})]},e.userId)})}),n.jsx("div",{className:"flex flex-wrap gap-2 max-h-48 overflow-y-auto",children:t.map(e=>{const t=c.includes(e.id);return n.jsxs("button",{type:"button",onClick:()=>x(e.id),className:`\n                      inline-flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer transition-all w-auto shrink-0\n                      ${t?"bg-emerald-500/20 border-2 border-emerald-500 ring-1 ring-emerald-500/30":"bg-gray-800/50 hover:bg-gray-800/70 border-2 border-transparent"}\n                    `,children:[n.jsx("div",{className:`\n                      w-5 h-5 rounded-full flex items-center justify-center shrink-0 transition-all\n                      ${t?"bg-emerald-500 text-white":"bg-gray-700 border border-gray-600"}\n                    `,children:t&&n.jsx(Qt,{size:12,strokeWidth:3})}),e.avatar&&n.jsx("img",{src:e.avatar,alt:e.name,className:"w-6 h-6 rounded-full object-cover shrink-0"}),n.jsx("span",{className:"text-sm whitespace-nowrap "+(t?"text-white font-medium":"text-gray-300"),children:e.name})]},e.id)})})]}),n.jsxs("div",{className:"mt-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ht,{size:16,className:"text-emerald-400"}),n.jsx("h4",{className:"text-sm font-semibold text-gray-200",children:"Preferred payment methods"})]}),n.jsx("button",{type:"button",onClick:b,className:"text-xs text-emerald-400 hover:text-emerald-300 transition-colors font-medium",children:p?"Deselect All":"Select All"})]}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 gap-3",children:[{id:"venmo",label:"Venmo"},{id:"cashapp",label:"Cash App"},{id:"zelle",label:"Zelle"},{id:"paypal",label:"PayPal"},{id:"applecash",label:"Apple Cash"}].map(e=>{const t=d.includes(e.id);return n.jsxs("button",{type:"button",onClick:()=>v(e.id),className:`\n                      flex items-center justify-center gap-2 rounded-lg h-10 cursor-pointer transition-all\n                      ${t?"bg-emerald-500/20 border-2 border-emerald-500 ring-1 ring-emerald-500/30":"bg-gray-900/40 border-2 border-white/10 hover:bg-gray-800/60"}\n                    `,children:[n.jsx("div",{className:`\n                      w-5 h-5 rounded-full flex items-center justify-center shrink-0 transition-all\n                      ${t?"bg-emerald-500 text-white":"bg-gray-700 border border-gray-600"}\n                    `,children:t&&n.jsx(Qt,{size:12,strokeWidth:3})}),n.jsx("span",{className:"text-sm "+(t?"text-white font-medium":"text-gray-200"),children:e.label})]},e.id)})})]}),n.jsx(Q,{type:"submit",className:"w-full mt-2 py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-xl shadow-lg transition-all duration-200 hover:shadow-emerald-500/30 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!s||!l||0===c.length,children:"Add Payment Request"})]})]})}):null};function hs(e,t){return new Promise(function(n,a){let r;return gs(e).then(function(e){try{return r=e,n(new Blob([t.slice(0,2),r,t.slice(2)],{type:"image/jpeg"}))}catch(i){return a(i)}},a)})}const gs=e=>new Promise((t,n)=>{const a=new FileReader;a.addEventListener("load",({target:{result:e}})=>{const a=new DataView(e);let r=0;if(65496!==a.getUint16(r))return n("not a valid JPEG");for(r+=2;;){const i=a.getUint16(r);if(65498===i)break;const s=a.getUint16(r+2);if(65505===i&&1165519206===a.getUint32(r+4)){const i=r+10;let o;switch(a.getUint16(i)){case 18761:o=!0;break;case 19789:o=!1;break;default:return n("TIFF header contains invalid endian")}if(42!==a.getUint16(i+2,o))return n("TIFF header contains invalid version");const l=a.getUint32(i+4,o),c=i+l+2+12*a.getUint16(i+l,o);for(let e=i+l+2;e<c;e+=12)if(274==a.getUint16(e,o)){if(3!==a.getUint16(e+2,o))return n("Orientation data type is invalid");if(1!==a.getUint32(e+4,o))return n("Orientation data count is invalid");a.setUint16(e+8,1,o);break}return t(e.slice(r,r+2+s))}r+=2+s}return t(new Blob)}),a.readAsArrayBuffer(e)});var fs,xs,vs,ys={},bs={get exports(){return ys},set exports(e){ys=e}};vs={},bs.exports=vs,vs.parse=function(e,t){for(var n=vs.bin.readUshort,a=vs.bin.readUint,r=0,i={},s=new Uint8Array(e),o=s.length-4;101010256!=a(s,o);)o--;r=o,r+=4;var l=n(s,r+=4);n(s,r+=2);var c=a(s,r+=2),d=a(s,r+=4);r+=4,r=d;for(var u=0;u<l;u++){a(s,r),r+=4,r+=4,r+=4,a(s,r+=4),c=a(s,r+=4);var m=a(s,r+=4),p=n(s,r+=4),h=n(s,r+2),g=n(s,r+4);r+=6;var f=a(s,r+=8);r+=4,r+=p+h+g,vs._readLocal(s,f,i,c,m,t)}return i},vs._readLocal=function(e,t,n,a,r,i){var s=vs.bin.readUshort,o=vs.bin.readUint;o(e,t),s(e,t+=4),s(e,t+=2);var l=s(e,t+=2);o(e,t+=2),o(e,t+=4),t+=4;var c=s(e,t+=8),d=s(e,t+=2);t+=2;var u=vs.bin.readUTF8(e,t,c);if(t+=c,t+=d,i)n[u]={size:r,csize:a};else{var m=new Uint8Array(e.buffer,t);if(0==l)n[u]=new Uint8Array(m.buffer.slice(t,t+a));else{if(8!=l)throw"unknown compression method: "+l;var p=new Uint8Array(r);vs.inflateRaw(m,p),n[u]=p}}},vs.inflateRaw=function(e,t){return vs.F.inflate(e,t)},vs.inflate=function(e,t){return e[0],e[1],vs.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},vs.deflate=function(e,t){null==t&&(t={level:6});var n=0,a=new Uint8Array(50+Math.floor(1.1*e.length));a[n]=120,a[n+1]=156,n+=2,n=vs.F.deflateRaw(e,a,n,t.level);var r=vs.adler(e,0,e.length);return a[n+0]=r>>>24&255,a[n+1]=r>>>16&255,a[n+2]=r>>>8&255,a[n+3]=r>>>0&255,new Uint8Array(a.buffer,0,n+4)},vs.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),a=vs.F.deflateRaw(e,n,a,t.level);return new Uint8Array(n.buffer,0,a)},vs.encode=function(e,t){null==t&&(t=!1);var n=0,a=vs.bin.writeUint,r=vs.bin.writeUshort,i={};for(var s in e){var o=!vs._noNeed(s)&&!t,l=e[s],c=vs.crc.crc(l,0,l.length);i[s]={cpr:o,usize:l.length,crc:c,file:o?vs.deflateRaw(l):l}}for(var s in i)n+=i[s].file.length+30+46+2*vs.bin.sizeUTF8(s);n+=22;var d=new Uint8Array(n),u=0,m=[];for(var s in i){var p=i[s];m.push(u),u=vs._writeHeader(d,u,s,p,0)}var h=0,g=u;for(var s in i)p=i[s],m.push(u),u=vs._writeHeader(d,u,s,p,1,m[h++]);var f=u-g;return a(d,u,101010256),u+=4,r(d,u+=4,h),r(d,u+=2,h),a(d,u+=2,f),a(d,u+=4,g),u+=4,u+=2,d.buffer},vs._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return-1!="png,jpg,jpeg,zip".indexOf(t)},vs._writeHeader=function(e,t,n,a,r,i){var s=vs.bin.writeUint,o=vs.bin.writeUshort,l=a.file;return s(e,t,0==r?67324752:33639248),t+=4,1==r&&(t+=2),o(e,t,20),o(e,t+=2,0),o(e,t+=2,a.cpr?8:0),s(e,t+=2,0),s(e,t+=4,a.crc),s(e,t+=4,l.length),s(e,t+=4,a.usize),o(e,t+=4,vs.bin.sizeUTF8(n)),o(e,t+=2,0),t+=2,1==r&&(t+=2,t+=2,s(e,t+=6,i),t+=4),t+=vs.bin.writeUTF8(e,t,n),0==r&&(e.set(l,t),t+=l.length),t},vs.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,a=0;a<8;a++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,n,a){for(var r=0;r<a;r++)e=vs.crc.table[255&(e^t[n+r])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^vs.crc.update(4294967295,e,t,n)}},vs.adler=function(e,t,n){for(var a=1,r=0,i=t,s=t+n;i<s;){for(var o=Math.min(i+5552,s);i<o;)r+=a+=e[i++];a%=65521,r%=65521}return r<<16|a},vs.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var a="",r=0;r<n;r++)a+=String.fromCharCode(e[t+r]);return a},writeASCII:function(e,t,n){for(var a=0;a<n.length;a++)e[t+a]=n.charCodeAt(a)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,n){for(var a,r="",i=0;i<n;i++)r+="%"+vs.bin.pad(e[t+i].toString(16));try{a=decodeURIComponent(r)}catch(s){return vs.bin.readASCII(e,t,n)}return a},writeUTF8:function(e,t,n){for(var a=n.length,r=0,i=0;i<a;i++){var s=n.charCodeAt(i);if(4294967168&s)if(4294965248&s)if(4294901760&s){if(4292870144&s)throw"e";e[t+r]=240|s>>18,e[t+r+1]=128|s>>12&63,e[t+r+2]=128|s>>6&63,e[t+r+3]=128|63&s,r+=4}else e[t+r]=224|s>>12,e[t+r+1]=128|s>>6&63,e[t+r+2]=128|63&s,r+=3;else e[t+r]=192|s>>6,e[t+r+1]=128|63&s,r+=2;else e[t+r]=s,r++}return r},sizeUTF8:function(e){for(var t=e.length,n=0,a=0;a<t;a++){var r=e.charCodeAt(a);if(4294967168&r)if(4294965248&r)if(4294901760&r){if(4292870144&r)throw"e";n+=4}else n+=3;else n+=2;else n++}return n}},vs.F={},vs.F.deflateRaw=function(e,t,n,a){var r=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],i=vs.F.U,s=vs.F._goodIndex;vs.F._hash;var o=vs.F._putsE,l=0,c=n<<3,d=0,u=e.length;if(0==a){for(;l<u;)o(t,c,l+(N=Math.min(65535,u-l))==u?1:0),c=vs.F._copyExact(e,l,N,t,c+8),l+=N;return c>>>3}var m=i.lits,p=i.strt,h=i.prev,g=0,f=0,x=0,v=0,y=0,b=0;for(u>2&&(p[b=vs.F._hash(e,0)]=0),l=0;l<u;l++){if(y=b,l+1<u-2){b=vs.F._hash(e,l+1);var w=l+1&32767;h[w]=p[b],p[b]=w}if(d<=l){(g>14e3||f>26697)&&u-l>100&&(d<l&&(m[g]=l-d,g+=2,d=l),c=vs.F._writeBlock(l==u-1||d==u?1:0,m,g,v,e,x,l-x,t,c),g=f=v=0,x=l);var j=0;l<u-2&&(j=vs.F._bestMatch(e,l,h,y,Math.min(r[2],u-l),r[3]));var N=j>>>16,_=65535&j;if(0!=j){_=65535&j;var k=s(N=j>>>16,i.of0);i.lhst[257+k]++;var S=s(_,i.df0);i.dhst[S]++,v+=i.exb[k]+i.dxb[S],m[g]=N<<23|l-d,m[g+1]=_<<16|k<<8|S,g+=2,d=l+N}else i.lhst[e[l]]++;f++}}for(x==l&&0!=e.length||(d<l&&(m[g]=l-d,g+=2,d=l),c=vs.F._writeBlock(1,m,g,v,e,x,l-x,t,c),g=0,f=0,g=f=v=0,x=l);7&c;)c++;return c>>>3},vs.F._bestMatch=function(e,t,n,a,r,i){var s=32767&t,o=n[s],l=s-o+32768&32767;if(o==s||a!=vs.F._hash(e,t-l))return 0;for(var c=0,d=0,u=Math.min(32767,t);l<=u&&0!=--i&&o!=s;){if(0==c||e[t+c]==e[t+c-l]){var m=vs.F._howLong(e,t,l);if(m>c){if(d=l,(c=m)>=r)break;l+2<m&&(m=l+2);for(var p=0,h=0;h<m-2;h++){var g=t-l+h+32768&32767,f=g-n[g]+32768&32767;f>p&&(p=f,o=g)}}}l+=(s=o)-(o=n[s])+32768&32767}return c<<16|d},vs.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var a=t,r=Math.min(e.length,t+258);for(t+=3;t<r&&e[t]==e[t-n];)t++;return t-a},vs.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},vs.saved=0,vs.F._writeBlock=function(e,t,n,a,r,i,s,o,l){var c,d,u,m,p,h,g,f,x,v=vs.F.U,y=vs.F._putsF,b=vs.F._putsE;v.lhst[256]++,d=(c=vs.F.getTrees())[0],u=c[1],m=c[2],p=c[3],h=c[4],g=c[5],f=c[6],x=c[7];var w=32+(l+3&7?8-(l+3&7):0)+(s<<3),j=a+vs.F.contSize(v.fltree,v.lhst)+vs.F.contSize(v.fdtree,v.dhst),N=a+vs.F.contSize(v.ltree,v.lhst)+vs.F.contSize(v.dtree,v.dhst);N+=14+3*g+vs.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var _=0;_<286;_++)v.lhst[_]=0;for(_=0;_<30;_++)v.dhst[_]=0;for(_=0;_<19;_++)v.ihst[_]=0;var k=w<j&&w<N?0:j<N?1:2;if(y(o,l,e),y(o,l+1,k),l+=3,0==k){for(;7&l;)l++;l=vs.F._copyExact(r,i,s,o,l)}else{var S,C;if(1==k&&(S=v.fltree,C=v.fdtree),2==k){vs.F.makeCodes(v.ltree,d),vs.F.revCodes(v.ltree,d),vs.F.makeCodes(v.dtree,u),vs.F.revCodes(v.dtree,u),vs.F.makeCodes(v.itree,m),vs.F.revCodes(v.itree,m),S=v.ltree,C=v.dtree,b(o,l,p-257),b(o,l+=5,h-1),b(o,l+=5,g-4),l+=4;for(var E=0;E<g;E++)b(o,l+3*E,v.itree[1+(v.ordr[E]<<1)]);l+=3*g,l=vs.F._codeTiny(f,v.itree,o,l),l=vs.F._codeTiny(x,v.itree,o,l)}for(var D=i,P=0;P<n;P+=2){for(var A=t[P],T=A>>>23,M=D+(8388607&A);D<M;)l=vs.F._writeLit(r[D++],S,o,l);if(0!=T){var R=t[P+1],I=R>>16,O=R>>8&255,L=255&R;b(o,l=vs.F._writeLit(257+O,S,o,l),T-v.of0[O]),l+=v.exb[O],y(o,l=vs.F._writeLit(L,C,o,l),I-v.df0[L]),l+=v.dxb[L],D+=T}}l=vs.F._writeLit(256,S,o,l)}return l},vs.F._copyExact=function(e,t,n,a,r){var i=r>>>3;return a[i]=n,a[i+1]=n>>>8,a[i+2]=255-a[i],a[i+3]=255-a[i+1],i+=4,a.set(new Uint8Array(e.buffer,t,n),i),r+(n+4<<3)},vs.F.getTrees=function(){for(var e=vs.F.U,t=vs.F._hufTree(e.lhst,e.ltree,15),n=vs.F._hufTree(e.dhst,e.dtree,15),a=[],r=vs.F._lenCodes(e.ltree,a),i=[],s=vs.F._lenCodes(e.dtree,i),o=0;o<a.length;o+=2)e.ihst[a[o]]++;for(o=0;o<i.length;o+=2)e.ihst[i[o]]++;for(var l=vs.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,n,l,r,s,c,a,i]},vs.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},vs.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},vs.F.contSize=function(e,t){for(var n=0,a=0;a<t.length;a++)n+=t[a]*e[1+(a<<1)];return n},vs.F._codeTiny=function(e,t,n,a){for(var r=0;r<e.length;r+=2){var i=e[r],s=e[r+1];a=vs.F._writeLit(i,t,n,a);var o=16==i?2:17==i?3:7;i>15&&(vs.F._putsE(n,a,s,o),a+=o)}return a},vs.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var a=0;a<n;a+=2){var r=e[a+1],i=a+3<n?e[a+3]:-1,s=a+5<n?e[a+5]:-1,o=0==a?-1:e[a-1];if(0==r&&i==r&&s==r){for(var l=a+5;l+2<n&&e[l+2]==r;)l+=2;(c=Math.min(l+1-a>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),a+=2*c-2}else if(r==o&&i==r&&s==r){for(l=a+5;l+2<n&&e[l+2]==r;)l+=2;var c=Math.min(l+1-a>>>1,6);t.push(16,c-3),a+=2*c-2}else t.push(r,0)}return n>>>1},vs.F._hufTree=function(e,t,n){var a=[],r=e.length,i=t.length,s=0;for(s=0;s<i;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<r;s++)0!=e[s]&&a.push({lit:s,f:e[s]});var o=a.length,l=a.slice(0);if(0==o)return 0;if(1==o){var c=a[0].lit;return l=0==c?1:0,t[1+(c<<1)]=1,t[1+(l<<1)]=1,1}a.sort(function(e,t){return e.f-t.f});var d=a[0],u=a[1],m=0,p=1,h=2;for(a[0]={lit:-1,f:d.f+u.f,l:d,r:u,d:0};p!=o-1;)d=m!=p&&(h==o||a[m].f<a[h].f)?a[m++]:a[h++],u=m!=p&&(h==o||a[m].f<a[h].f)?a[m++]:a[h++],a[p++]={lit:-1,f:d.f+u.f,l:d,r:u};var g=vs.F.setDepth(a[p-1],0);for(g>n&&(vs.F.restrictDepth(l,n,g),g=n),s=0;s<o;s++)t[1+(l[s].lit<<1)]=l[s].d;return g},vs.F.setDepth=function(e,t){return-1!=e.lit?(e.d=t,t):Math.max(vs.F.setDepth(e.l,t+1),vs.F.setDepth(e.r,t+1))},vs.F.restrictDepth=function(e,t,n){var a=0,r=1<<n-t,i=0;for(e.sort(function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d}),a=0;a<e.length&&e[a].d>t;a++){var s=e[a].d;e[a].d=t,i+=r-(1<<n-s)}for(i>>>=n-t;i>0;)(s=e[a].d)<t?(e[a].d++,i-=1<<t-s-1):a++;for(;a>=0;a--)e[a].d==t&&i<0&&(e[a].d--,i++)},vs.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},vs.F._writeLit=function(e,t,n,a){return vs.F._putsF(n,a,t[e<<1]),a+t[1+(e<<1)]},vs.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var a=vs.F,r=a._bitsF,i=a._bitsE,s=a._decodeTiny,o=a.makeCodes,l=a.codes2map,c=a._get17,d=a.U,u=null==t;u&&(t=new n(e.length>>>2<<3));for(var m,p,h=0,g=0,f=0,x=0,v=0,y=0,b=0,w=0,j=0;0==h;)if(h=r(e,j,1),g=r(e,j+1,2),j+=3,0!=g){if(u&&(t=vs.F._check(t,w+(1<<17))),1==g&&(m=d.flmap,p=d.fdmap,y=511,b=31),2==g){f=i(e,j,5)+257,x=i(e,j+5,5)+1,v=i(e,j+10,4)+4,j+=14;for(var N=0;N<38;N+=2)d.itree[N]=0,d.itree[N+1]=0;var _=1;for(N=0;N<v;N++){var k=i(e,j+3*N,3);d.itree[1+(d.ordr[N]<<1)]=k,k>_&&(_=k)}j+=3*v,o(d.itree,_),l(d.itree,_,d.imap),m=d.lmap,p=d.dmap,j=s(d.imap,(1<<_)-1,f+x,e,j,d.ttree);var S=a._copyOut(d.ttree,0,f,d.ltree);y=(1<<S)-1;var C=a._copyOut(d.ttree,f,x,d.dtree);b=(1<<C)-1,o(d.ltree,S),l(d.ltree,S,m),o(d.dtree,C),l(d.dtree,C,p)}for(;;){var E=m[c(e,j)&y];j+=15&E;var D=E>>>4;if(D>>>8==0)t[w++]=D;else{if(256==D)break;var P=w+D-254;if(D>264){var A=d.ldef[D-257];P=w+(A>>>3)+i(e,j,7&A),j+=7&A}var T=p[c(e,j)&b];j+=15&T;var M=T>>>4,R=d.ddef[M],I=(R>>>4)+r(e,j,15&R);for(j+=15&R,u&&(t=vs.F._check(t,w+(1<<17)));w<P;)t[w]=t[w++-I],t[w]=t[w++-I],t[w]=t[w++-I],t[w]=t[w++-I];w=P}}}else{7&j&&(j+=8-(7&j));var O=4+(j>>>3),L=e[O-4]|e[O-3]<<8;u&&(t=vs.F._check(t,w+L)),t.set(new n(e.buffer,e.byteOffset+O,L),w),j=O+L<<3,w+=L}return t.length==w?t:t.slice(0,w)},vs.F._check=function(e,t){var n=e.length;if(t<=n)return e;var a=new Uint8Array(Math.max(n<<1,t));return a.set(e,0),a},vs.F._decodeTiny=function(e,t,n,a,r,i){for(var s=vs.F._bitsE,o=vs.F._get17,l=0;l<n;){var c=e[o(a,r)&t];r+=15&c;var d=c>>>4;if(d<=15)i[l]=d,l++;else{var u=0,m=0;16==d?(m=3+s(a,r,2),r+=2,u=i[l-1]):17==d?(m=3+s(a,r,3),r+=3):18==d&&(m=11+s(a,r,7),r+=7);for(var p=l+m;l<p;)i[l]=u,l++}}return r},vs.F._copyOut=function(e,t,n,a){for(var r=0,i=0,s=a.length>>>1;i<n;){var o=e[i+t];a[i<<1]=0,a[1+(i<<1)]=o,o>r&&(r=o),i++}for(;i<s;)a[i<<1]=0,a[1+(i<<1)]=0,i++;return r},vs.F.makeCodes=function(e,t){for(var n,a,r,i,s=vs.F.U,o=e.length,l=s.bl_count,c=0;c<=t;c++)l[c]=0;for(c=1;c<o;c+=2)l[e[c]]++;var d=s.next_code;for(n=0,l[0]=0,a=1;a<=t;a++)n=n+l[a-1]<<1,d[a]=n;for(r=0;r<o;r+=2)0!=(i=e[r+1])&&(e[r]=d[i],d[i]++)},vs.F.codes2map=function(e,t,n){for(var a=e.length,r=vs.F.U.rev15,i=0;i<a;i+=2)if(0!=e[i+1])for(var s=i>>1,o=e[i+1],l=s<<4|o,c=t-o,d=e[i]<<c,u=d+(1<<c);d!=u;)n[r[d]>>>15-t]=l,d++},vs.F.revCodes=function(e,t){for(var n=vs.F.U.rev15,a=15-t,r=0;r<e.length;r+=2){var i=e[r]<<t-e[r+1];e[r]=n[i]>>>a}},vs.F._putsE=function(e,t,n){n<<=7&t;var a=t>>>3;e[a]|=n,e[a+1]|=n>>>8},vs.F._putsF=function(e,t,n){n<<=7&t;var a=t>>>3;e[a]|=n,e[a+1]|=n>>>8,e[a+2]|=n>>>16},vs.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},vs.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},vs.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},vs.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},vs.F.U=(fs=Uint16Array,xs=Uint32Array,{next_code:new fs(16),bl_count:new fs(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new fs(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new xs(32),flmap:new fs(512),fltree:[],fdmap:new fs(32),fdtree:[],lmap:new fs(32768),ltree:[],ttree:[],dmap:new fs(32768),dtree:[],imap:new fs(512),itree:[],rev15:new fs(32768),lhst:new xs(286),dhst:new xs(30),ihst:new xs(19),lits:new xs(15e3),strt:new fs(65536),prev:new fs(32768)}),function(){for(var e=vs.F.U,t=0;t<32768;t++){var n=t;n=(4278255360&(n=(4042322160&(n=(3435973836&(n=(2863311530&n)>>>1|(1431655765&n)<<1))>>>2|(858993459&n)<<2))>>>4|(252645135&n)<<4))>>>8|(16711935&n)<<8,e.rev15[t]=(n>>>16|n<<16)>>>17}function a(e,t,n){for(;0!=t--;)e.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];a(e.fltree,144,8),a(e.fltree,112,9),a(e.fltree,24,7),a(e.fltree,8,8),vs.F.makeCodes(e.fltree,9),vs.F.codes2map(e.fltree,9,e.flmap),vs.F.revCodes(e.fltree,9),a(e.fdtree,32,5),vs.F.makeCodes(e.fdtree,5),vs.F.codes2map(e.fdtree,5,e.fdmap),vs.F.revCodes(e.fdtree,5),a(e.itree,19,0),a(e.ltree,286,0),a(e.dtree,30,0),a(e.ttree,320,0)}();var ws,js=(ws={__proto__:null,default:ys},[ys].forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(t){if("default"!==t&&!(t in ws)){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(ws,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})}),Object.freeze(ws));const Ns=function(){var e={nextZero(e,t){for(;0!=e[t];)t++;return t},readUshort:(e,t)=>e[t]<<8|e[t+1],writeUshort(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},readUint:(e,t)=>16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3]),writeUint(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},readASCII(e,t,n){let a="";for(let r=0;r<n;r++)a+=String.fromCharCode(e[t+r]);return a},writeASCII(e,t,n){for(let a=0;a<n.length;a++)e[t+a]=n.charCodeAt(a)},readBytes(e,t,n){const a=[];for(let r=0;r<n;r++)a.push(e[t+r]);return a},pad:e=>e.length<2?`0${e}`:e,readUTF8(t,n,a){let r,i="";for(let o=0;o<a;o++)i+=`%${e.pad(t[n+o].toString(16))}`;try{r=decodeURIComponent(i)}catch(s){return e.readASCII(t,n,a)}return r}};function t(t,n,a,r){const s=n*a,o=i(r),l=Math.ceil(n*o/8),c=new Uint8Array(4*s),d=new Uint32Array(c.buffer),{ctype:u}=r,{depth:m}=r,p=e.readUshort;if(6==u){const e=s<<2;if(8==m)for(var h=0;h<e;h+=4)c[h]=t[h],c[h+1]=t[h+1],c[h+2]=t[h+2],c[h+3]=t[h+3];if(16==m)for(h=0;h<e;h++)c[h]=t[h<<1]}else if(2==u){const e=r.tabs.tRNS;if(null==e){if(8==m)for(h=0;h<s;h++){var g=3*h;d[h]=255<<24|t[g+2]<<16|t[g+1]<<8|t[g]}if(16==m)for(h=0;h<s;h++)g=6*h,d[h]=255<<24|t[g+4]<<16|t[g+2]<<8|t[g]}else{var f=e[0];const n=e[1],a=e[2];if(8==m)for(h=0;h<s;h++){var x=h<<2;g=3*h,d[h]=255<<24|t[g+2]<<16|t[g+1]<<8|t[g],t[g]==f&&t[g+1]==n&&t[g+2]==a&&(c[x+3]=0)}if(16==m)for(h=0;h<s;h++)x=h<<2,g=6*h,d[h]=255<<24|t[g+4]<<16|t[g+2]<<8|t[g],p(t,g)==f&&p(t,g+2)==n&&p(t,g+4)==a&&(c[x+3]=0)}}else if(3==u){const e=r.tabs.PLTE,i=r.tabs.tRNS,o=i?i.length:0;if(1==m)for(var v=0;v<a;v++){var y=v*l,b=v*n;for(h=0;h<n;h++){x=b+h<<2;var w=3*(j=t[y+(h>>3)]>>7-(7&h)&1);c[x]=e[w],c[x+1]=e[w+1],c[x+2]=e[w+2],c[x+3]=j<o?i[j]:255}}if(2==m)for(v=0;v<a;v++)for(y=v*l,b=v*n,h=0;h<n;h++)x=b+h<<2,w=3*(j=t[y+(h>>2)]>>6-((3&h)<<1)&3),c[x]=e[w],c[x+1]=e[w+1],c[x+2]=e[w+2],c[x+3]=j<o?i[j]:255;if(4==m)for(v=0;v<a;v++)for(y=v*l,b=v*n,h=0;h<n;h++)x=b+h<<2,w=3*(j=t[y+(h>>1)]>>4-((1&h)<<2)&15),c[x]=e[w],c[x+1]=e[w+1],c[x+2]=e[w+2],c[x+3]=j<o?i[j]:255;if(8==m)for(h=0;h<s;h++){var j;x=h<<2,w=3*(j=t[h]),c[x]=e[w],c[x+1]=e[w+1],c[x+2]=e[w+2],c[x+3]=j<o?i[j]:255}}else if(4==u){if(8==m)for(h=0;h<s;h++){x=h<<2;var N=t[_=h<<1];c[x]=N,c[x+1]=N,c[x+2]=N,c[x+3]=t[_+1]}if(16==m)for(h=0;h<s;h++){var _;x=h<<2,N=t[_=h<<2],c[x]=N,c[x+1]=N,c[x+2]=N,c[x+3]=t[_+2]}}else if(0==u)for(f=r.tabs.tRNS?r.tabs.tRNS:-1,v=0;v<a;v++){const e=v*l,a=v*n;if(1==m)for(var k=0;k<n;k++){var S=(N=255*(t[e+(k>>>3)]>>>7-(7&k)&1))==255*f?0:255;d[a+k]=S<<24|N<<16|N<<8|N}else if(2==m)for(k=0;k<n;k++)S=(N=85*(t[e+(k>>>2)]>>>6-((3&k)<<1)&3))==85*f?0:255,d[a+k]=S<<24|N<<16|N<<8|N;else if(4==m)for(k=0;k<n;k++)S=(N=17*(t[e+(k>>>1)]>>>4-((1&k)<<2)&15))==17*f?0:255,d[a+k]=S<<24|N<<16|N<<8|N;else if(8==m)for(k=0;k<n;k++)S=(N=t[e+k])==f?0:255,d[a+k]=S<<24|N<<16|N<<8|N;else if(16==m)for(k=0;k<n;k++)N=t[e+(k<<1)],S=p(t,e+(k<<1))==f?0:255,d[a+k]=S<<24|N<<16|N<<8|N}return c}function n(e,t,n,o){const l=i(e),c=Math.ceil(n*l/8),d=new Uint8Array((c+1+e.interlace)*o);return t=e.tabs.CgBI?r(t,d):a(t,d),0==e.interlace?t=s(t,e,0,n,o):1==e.interlace&&(t=function(e,t){const n=t.width,a=t.height,r=i(t),o=r>>3,l=Math.ceil(n*r/8),c=new Uint8Array(a*l);let d=0;const u=[0,0,4,0,2,0,1],m=[0,4,0,2,0,1,0],p=[8,8,8,4,4,2,2],h=[8,8,4,4,2,2,1];let g=0;for(;g<7;){const i=p[g],x=h[g];let v=0,y=0,b=u[g];for(;b<a;)b+=i,y++;let w=m[g];for(;w<n;)w+=x,v++;const j=Math.ceil(v*r/8);s(e,t,d,v,y);let N=0,_=u[g];for(;_<a;){let t=m[g],a=d+N*j<<3;for(;t<n;){var f;if(1==r&&(f=(f=e[a>>3])>>7-(7&a)&1,c[_*l+(t>>3)]|=f<<7-(7&t)),2==r&&(f=(f=e[a>>3])>>6-(7&a)&3,c[_*l+(t>>2)]|=f<<6-((3&t)<<1)),4==r&&(f=(f=e[a>>3])>>4-(7&a)&15,c[_*l+(t>>1)]|=f<<4-((1&t)<<2)),r>=8){const n=_*l+t*o;for(let t=0;t<o;t++)c[n+t]=e[(a>>3)+t]}a+=r,t+=x}N++,_+=i}v*y!=0&&(d+=y*(1+j)),g+=1}return c}(t,e)),t}function a(e,t){return r(new Uint8Array(e.buffer,2,e.length-6),t)}var r=function(){const e={H:{}};return e.H.N=function(t,n){const a=Uint8Array;let r,i,s=0,o=0,l=0,c=0,d=0,u=0,m=0,p=0,h=0;if(3==t[0]&&0==t[1])return n||new a(0);const g=e.H,f=g.b,x=g.e,v=g.R,y=g.n,b=g.A,w=g.Z,j=g.m,N=null==n;for(N&&(n=new a(t.length>>>2<<5));0==s;)if(s=f(t,h,1),o=f(t,h+1,2),h+=3,0!=o){if(N&&(n=e.H.W(n,p+(1<<17))),1==o&&(r=j.J,i=j.h,u=511,m=31),2==o){l=x(t,h,5)+257,c=x(t,h+5,5)+1,d=x(t,h+10,4)+4,h+=14;let e=1;for(var _=0;_<38;_+=2)j.Q[_]=0,j.Q[_+1]=0;for(_=0;_<d;_++){const n=x(t,h+3*_,3);j.Q[1+(j.X[_]<<1)]=n,n>e&&(e=n)}h+=3*d,y(j.Q,e),b(j.Q,e,j.u),r=j.w,i=j.d,h=v(j.u,(1<<e)-1,l+c,t,h,j.v);const n=g.V(j.v,0,l,j.C);u=(1<<n)-1;const a=g.V(j.v,l,c,j.D);m=(1<<a)-1,y(j.C,n),b(j.C,n,r),y(j.D,a),b(j.D,a,i)}for(;;){const e=r[w(t,h)&u];h+=15&e;const a=e>>>4;if(a>>>8==0)n[p++]=a;else{if(256==a)break;{let e=p+a-254;if(a>264){const n=j.q[a-257];e=p+(n>>>3)+x(t,h,7&n),h+=7&n}const r=i[w(t,h)&m];h+=15&r;const s=r>>>4,o=j.c[s],l=(o>>>4)+f(t,h,15&o);for(h+=15&o;p<e;)n[p]=n[p++-l],n[p]=n[p++-l],n[p]=n[p++-l],n[p]=n[p++-l];p=e}}}}else{7&h&&(h+=8-(7&h));const r=4+(h>>>3),i=t[r-4]|t[r-3]<<8;N&&(n=e.H.W(n,p+i)),n.set(new a(t.buffer,t.byteOffset+r,i),p),h=r+i<<3,p+=i}return n.length==p?n:n.slice(0,p)},e.H.W=function(e,t){const n=e.length;if(t<=n)return e;const a=new Uint8Array(n<<1);return a.set(e,0),a},e.H.R=function(t,n,a,r,i,s){const o=e.H.e,l=e.H.Z;let c=0;for(;c<a;){const e=t[l(r,i)&n];i+=15&e;const a=e>>>4;if(a<=15)s[c]=a,c++;else{let e=0,t=0;16==a?(t=3+o(r,i,2),i+=2,e=s[c-1]):17==a?(t=3+o(r,i,3),i+=3):18==a&&(t=11+o(r,i,7),i+=7);const n=c+t;for(;c<n;)s[c]=e,c++}}return i},e.H.V=function(e,t,n,a){let r=0,i=0;const s=a.length>>>1;for(;i<n;){const n=e[i+t];a[i<<1]=0,a[1+(i<<1)]=n,n>r&&(r=n),i++}for(;i<s;)a[i<<1]=0,a[1+(i<<1)]=0,i++;return r},e.H.n=function(t,n){const a=e.H.m,r=t.length;let i,s,o,l;const c=a.j;for(var d=0;d<=n;d++)c[d]=0;for(d=1;d<r;d+=2)c[t[d]]++;const u=a.K;for(i=0,c[0]=0,s=1;s<=n;s++)i=i+c[s-1]<<1,u[s]=i;for(o=0;o<r;o+=2)l=t[o+1],0!=l&&(t[o]=u[l],u[l]++)},e.H.A=function(t,n,a){const r=t.length,i=e.H.m.r;for(let e=0;e<r;e+=2)if(0!=t[e+1]){const r=e>>1,s=t[e+1],o=r<<4|s,l=n-s;let c=t[e]<<l;const d=c+(1<<l);for(;c!=d;)a[i[c]>>>15-n]=o,c++}},e.H.l=function(t,n){const a=e.H.m.r,r=15-n;for(let e=0;e<t.length;e+=2){const i=t[e]<<n-t[e+1];t[e]=a[i]>>>r}},e.H.M=function(e,t,n){n<<=7&t;const a=t>>>3;e[a]|=n,e[a+1]|=n>>>8},e.H.I=function(e,t,n){n<<=7&t;const a=t>>>3;e[a]|=n,e[a+1]|=n>>>8,e[a+2]|=n>>>16},e.H.e=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},e.H.b=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},e.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},e.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},e.H.m=function(){const e=Uint16Array,t=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new t(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new t(286),Y:new t(30),a:new t(19),t:new t(15e3),k:new e(65536),g:new e(32768)}}(),function(){const t=e.H.m;for(var n=0;n<32768;n++){let e=n;e=(2863311530&e)>>>1|(1431655765&e)<<1,e=(3435973836&e)>>>2|(858993459&e)<<2,e=(4042322160&e)>>>4|(252645135&e)<<4,e=(4278255360&e)>>>8|(16711935&e)<<8,t.r[n]=(e>>>16|e<<16)>>>17}function a(e,t,n){for(;0!=t--;)e.push(0,n)}for(n=0;n<32;n++)t.q[n]=t.S[n]<<3|t.T[n],t.c[n]=t.p[n]<<4|t.z[n];a(t._,144,8),a(t._,112,9),a(t._,24,7),a(t._,8,8),e.H.n(t._,9),e.H.A(t._,9,t.J),e.H.l(t._,9),a(t.$,32,5),e.H.n(t.$,5),e.H.A(t.$,5,t.h),e.H.l(t.$,5),a(t.Q,19,0),a(t.C,286,0),a(t.D,30,0),a(t.v,320,0)}(),e.H.N}();function i(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth}function s(e,t,n,a,r){let s=i(t);const l=Math.ceil(a*s/8);let c,d;s=Math.ceil(s/8);let u=e[n],m=0;if(u>1&&(e[n]=[0,0,1][u-2]),3==u)for(m=s;m<l;m++)e[m+1]=e[m+1]+(e[m+1-s]>>>1)&255;for(let i=0;i<r;i++)if(c=n+i*l,d=c+i+1,u=e[d-1],m=0,0==u)for(;m<l;m++)e[c+m]=e[d+m];else if(1==u){for(;m<s;m++)e[c+m]=e[d+m];for(;m<l;m++)e[c+m]=e[d+m]+e[c+m-s]}else if(2==u)for(;m<l;m++)e[c+m]=e[d+m]+e[c+m-l];else if(3==u){for(;m<s;m++)e[c+m]=e[d+m]+(e[c+m-l]>>>1);for(;m<l;m++)e[c+m]=e[d+m]+(e[c+m-l]+e[c+m-s]>>>1)}else{for(;m<s;m++)e[c+m]=e[d+m]+o(0,e[c+m-l],0);for(;m<l;m++)e[c+m]=e[d+m]+o(e[c+m-s],e[c+m-l],e[c+m-s-l])}return e}function o(e,t,n){const a=e+t-n,r=a-e,i=a-t,s=a-n;return r*r<=i*i&&r*r<=s*s?e:i*i<=s*s?t:n}function l(t,n,a){a.width=e.readUint(t,n),n+=4,a.height=e.readUint(t,n),n+=4,a.depth=t[n],n++,a.ctype=t[n],n++,a.compress=t[n],n++,a.filter=t[n],n++,a.interlace=t[n],n++}function c(e,t,n,a,r,i,s,o,l){const c=Math.min(t,r),d=Math.min(n,i);let u=0,m=0;for(let w=0;w<d;w++)for(let n=0;n<c;n++)if(s>=0&&o>=0?(u=w*t+n<<2,m=(o+w)*r+s+n<<2):(u=(-o+w)*t-s+n<<2,m=w*r+n<<2),0==l)a[m]=e[u],a[m+1]=e[u+1],a[m+2]=e[u+2],a[m+3]=e[u+3];else if(1==l){var p=e[u+3]*(1/255),h=e[u]*p,g=e[u+1]*p,f=e[u+2]*p,x=a[m+3]*(1/255),v=a[m]*x,y=a[m+1]*x,b=a[m+2]*x;const t=1-p,n=p+x*t,r=0==n?0:1/n;a[m+3]=255*n,a[m+0]=(h+v*t)*r,a[m+1]=(g+y*t)*r,a[m+2]=(f+b*t)*r}else if(2==l)p=e[u+3],h=e[u],g=e[u+1],f=e[u+2],x=a[m+3],v=a[m],y=a[m+1],b=a[m+2],p==x&&h==v&&g==y&&f==b?(a[m]=0,a[m+1]=0,a[m+2]=0,a[m+3]=0):(a[m]=h,a[m+1]=g,a[m+2]=f,a[m+3]=p);else if(3==l){if(p=e[u+3],h=e[u],g=e[u+1],f=e[u+2],x=a[m+3],v=a[m],y=a[m+1],b=a[m+2],p==x&&h==v&&g==y&&f==b)continue;if(p<220&&x>20)return!1}return!0}return{decode:function(t){const i=new Uint8Array(t);let s=8;const o=e,c=o.readUshort,d=o.readUint,u={tabs:{},frames:[]},m=new Uint8Array(i.length);let p,h=0,g=0;const f=[137,80,78,71,13,10,26,10];for(var x=0;x<8;x++)if(i[x]!=f[x])throw"The input is not a PNG file!";for(;s<i.length;){const e=o.readUint(i,s);s+=4;const t=o.readASCII(i,s,4);if(s+=4,"IHDR"==t)l(i,s,u);else if("iCCP"==t){for(var v=s;0!=i[v];)v++;o.readASCII(i,s,v-s),i[v+1];const n=i.slice(v+2,s+e);let l=null;try{l=a(n)}catch(k){l=r(n)}u.tabs[t]=l}else if("CgBI"==t)u.tabs[t]=i.slice(s,s+4);else if("IDAT"==t){for(x=0;x<e;x++)m[h+x]=i[s+x];h+=e}else if("acTL"==t)u.tabs[t]={num_frames:d(i,s),num_plays:d(i,s+4)},p=new Uint8Array(i.length);else if("fcTL"==t){0!=g&&((_=u.frames[u.frames.length-1]).data=n(u,p.slice(0,g),_.rect.width,_.rect.height),g=0);const e={x:d(i,s+12),y:d(i,s+16),width:d(i,s+4),height:d(i,s+8)};let t=c(i,s+22);t=c(i,s+20)/(0==t?100:t);const a={rect:e,delay:Math.round(1e3*t),dispose:i[s+24],blend:i[s+25]};u.frames.push(a)}else if("fdAT"==t){for(x=0;x<e-4;x++)p[g+x]=i[s+x+4];g+=e-4}else if("pHYs"==t)u.tabs[t]=[o.readUint(i,s),o.readUint(i,s+4),i[s+8]];else if("cHRM"==t)for(u.tabs[t]=[],x=0;x<8;x++)u.tabs[t].push(o.readUint(i,s+4*x));else if("tEXt"==t||"zTXt"==t){null==u.tabs[t]&&(u.tabs[t]={});var y=o.nextZero(i,s),b=o.readASCII(i,s,y-s),w=s+e-y-1;if("tEXt"==t)N=o.readASCII(i,y+1,w);else{var j=a(i.slice(y+2,y+2+w));N=o.readUTF8(j,0,j.length)}u.tabs[t][b]=N}else if("iTXt"==t){null==u.tabs[t]&&(u.tabs[t]={}),y=0,v=s,y=o.nextZero(i,v),b=o.readASCII(i,v,y-v);const n=i[v=y+1];var N;i[v+1],v+=2,y=o.nextZero(i,v),o.readASCII(i,v,y-v),v=y+1,y=o.nextZero(i,v),o.readUTF8(i,v,y-v),w=e-((v=y+1)-s),0==n?N=o.readUTF8(i,v,w):(j=a(i.slice(v,v+w)),N=o.readUTF8(j,0,j.length)),u.tabs[t][b]=N}else if("PLTE"==t)u.tabs[t]=o.readBytes(i,s,e);else if("hIST"==t){const e=u.tabs.PLTE.length/3;for(u.tabs[t]=[],x=0;x<e;x++)u.tabs[t].push(c(i,s+2*x))}else if("tRNS"==t)3==u.ctype?u.tabs[t]=o.readBytes(i,s,e):0==u.ctype?u.tabs[t]=c(i,s):2==u.ctype&&(u.tabs[t]=[c(i,s),c(i,s+2),c(i,s+4)]);else if("gAMA"==t)u.tabs[t]=o.readUint(i,s)/1e5;else if("sRGB"==t)u.tabs[t]=i[s];else if("bKGD"==t)0==u.ctype||4==u.ctype?u.tabs[t]=[c(i,s)]:2==u.ctype||6==u.ctype?u.tabs[t]=[c(i,s),c(i,s+2),c(i,s+4)]:3==u.ctype&&(u.tabs[t]=i[s]);else if("IEND"==t)break;s+=e,o.readUint(i,s),s+=4}var _;return 0!=g&&((_=u.frames[u.frames.length-1]).data=n(u,p.slice(0,g),_.rect.width,_.rect.height)),u.data=n(u,m,u.width,u.height),delete u.compress,delete u.interlace,delete u.filter,u},toRGBA8:function(e){const n=e.width,a=e.height;if(null==e.tabs.acTL)return[t(e.data,n,a,e).buffer];const r=[];null==e.frames[0].data&&(e.frames[0].data=e.data);const i=n*a*4,s=new Uint8Array(i),o=new Uint8Array(i),l=new Uint8Array(i);for(let u=0;u<e.frames.length;u++){const m=e.frames[u],p=m.rect.x,h=m.rect.y,g=m.rect.width,f=m.rect.height,x=t(m.data,g,f,e);if(0!=u)for(var d=0;d<i;d++)l[d]=s[d];if(0==m.blend?c(x,g,f,s,n,a,p,h,0):1==m.blend&&c(x,g,f,s,n,a,p,h,1),r.push(s.buffer.slice(0)),0==m.dispose);else if(1==m.dispose)c(o,g,f,s,n,a,p,h,0);else if(2==m.dispose)for(d=0;d<i;d++)s[d]=l[d]}return r},_paeth:o,_copyTile:c,_bin:e}}();!function(){const{_copyTile:e}=Ns,{_bin:t}=Ns,n=Ns._paeth;var a={table:function(){const e=new Uint32Array(256);for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update(e,t,n,r){for(let i=0;i<r;i++)e=a.table[255&(e^t[n+i])]^e>>>8;return e},crc:(e,t,n)=>4294967295^a.update(4294967295,e,t,n)};function r(e,t,n,a){t[n]+=e[0]*a>>4,t[n+1]+=e[1]*a>>4,t[n+2]+=e[2]*a>>4,t[n+3]+=e[3]*a>>4}function i(e){return Math.max(0,Math.min(255,e))}function s(e,t){const n=e[0]-t[0],a=e[1]-t[1],r=e[2]-t[2],i=e[3]-t[3];return n*n+a*a+r*r+i*i}function o(e,t,n,a,o,l,c){null==c&&(c=1);const d=a.length,u=[];for(var m=0;m<d;m++){const e=a[m];u.push([e>>>0&255,e>>>8&255,e>>>16&255,e>>>24&255])}for(m=0;m<d;m++){let e=4294967295;for(var p=0,h=0;h<d;h++){var g=s(u[m],u[h]);h!=m&&g<e&&(e=g,p=h)}}const f=new Uint32Array(o.buffer),x=new Int16Array(t*n*4),v=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(m=0;m<v.length;m++)v[m]=255*((v[m]+.5)/16-.5);for(let b=0;b<n;b++)for(let o=0;o<t;o++){var y;m=4*(b*t+o),2!=c?y=[i(e[m]+x[m]),i(e[m+1]+x[m+1]),i(e[m+2]+x[m+2]),i(e[m+3]+x[m+3])]:(g=v[4*(3&b)+(3&o)],y=[i(e[m]+g),i(e[m+1]+g),i(e[m+2]+g),i(e[m+3]+g)]),p=0;let w=16777215;for(h=0;h<d;h++){const e=s(y,u[h]);e<w&&(w=e,p=h)}const j=u[p],N=[y[0]-j[0],y[1]-j[1],y[2]-j[2],y[3]-j[3]];1==c&&(o!=t-1&&r(N,x,m+4,7),b!=n-1&&(0!=o&&r(N,x,m+4*t-4,3),r(N,x,m+4*t,5),o!=t-1&&r(N,x,m+4*t+4,1))),l[m>>2]=p,f[m>>2]=a[p]}}function l(e,n,r,i,s){null==s&&(s={});const{crc:o}=a,l=t.writeUint,c=t.writeUshort,d=t.writeASCII;let u=8;const m=e.frames.length>1;let p,h=!1,g=33+(m?20:0);if(null!=s.sRGB&&(g+=13),null!=s.pHYs&&(g+=21),null!=s.iCCP&&(p=pako.deflate(s.iCCP),g+=21+p.length+4),3==e.ctype){for(var f=e.plte.length,x=0;x<f;x++)e.plte[x]>>>24!=255&&(h=!0);g+=8+3*f+4+(h?8+1*f+4:0)}for(var v=0;v<e.frames.length;v++)m&&(g+=38),g+=(j=e.frames[v]).cimg.length+12,0!=v&&(g+=4);g+=12;const y=new Uint8Array(g),b=[137,80,78,71,13,10,26,10];for(x=0;x<8;x++)y[x]=b[x];if(l(y,u,13),u+=4,d(y,u,"IHDR"),u+=4,l(y,u,n),u+=4,l(y,u,r),u+=4,y[u]=e.depth,u++,y[u]=e.ctype,u++,y[u]=0,u++,y[u]=0,u++,y[u]=0,u++,l(y,u,o(y,u-17,17)),u+=4,null!=s.sRGB&&(l(y,u,1),u+=4,d(y,u,"sRGB"),u+=4,y[u]=s.sRGB,u++,l(y,u,o(y,u-5,5)),u+=4),null!=s.iCCP){const e=13+p.length;l(y,u,e),u+=4,d(y,u,"iCCP"),u+=4,d(y,u,"ICC profile"),u+=11,u+=2,y.set(p,u),u+=p.length,l(y,u,o(y,u-(e+4),e+4)),u+=4}if(null!=s.pHYs&&(l(y,u,9),u+=4,d(y,u,"pHYs"),u+=4,l(y,u,s.pHYs[0]),u+=4,l(y,u,s.pHYs[1]),u+=4,y[u]=s.pHYs[2],u++,l(y,u,o(y,u-13,13)),u+=4),m&&(l(y,u,8),u+=4,d(y,u,"acTL"),u+=4,l(y,u,e.frames.length),u+=4,l(y,u,null!=s.loop?s.loop:0),u+=4,l(y,u,o(y,u-12,12)),u+=4),3==e.ctype){for(l(y,u,3*(f=e.plte.length)),u+=4,d(y,u,"PLTE"),u+=4,x=0;x<f;x++){const t=3*x,n=e.plte[x],a=255&n,r=n>>>8&255,i=n>>>16&255;y[u+t+0]=a,y[u+t+1]=r,y[u+t+2]=i}if(u+=3*f,l(y,u,o(y,u-3*f-4,3*f+4)),u+=4,h){for(l(y,u,f),u+=4,d(y,u,"tRNS"),u+=4,x=0;x<f;x++)y[u+x]=e.plte[x]>>>24&255;u+=f,l(y,u,o(y,u-f-4,f+4)),u+=4}}let w=0;for(v=0;v<e.frames.length;v++){var j=e.frames[v];m&&(l(y,u,26),u+=4,d(y,u,"fcTL"),u+=4,l(y,u,w++),u+=4,l(y,u,j.rect.width),u+=4,l(y,u,j.rect.height),u+=4,l(y,u,j.rect.x),u+=4,l(y,u,j.rect.y),u+=4,c(y,u,i[v]),u+=2,c(y,u,1e3),u+=2,y[u]=j.dispose,u++,y[u]=j.blend,u++,l(y,u,o(y,u-30,30)),u+=4);const t=j.cimg;l(y,u,(f=t.length)+(0==v?0:4)),u+=4;const n=u;d(y,u,0==v?"IDAT":"fdAT"),u+=4,0!=v&&(l(y,u,w++),u+=4),y.set(t,u),u+=f,l(y,u,o(y,n,u-n)),u+=4}return l(y,u,0),u+=4,d(y,u,"IEND"),u+=4,l(y,u,o(y,u-4,4)),u+=4,y.buffer}function c(e,t,n){for(let a=0;a<e.frames.length;a++){const r=e.frames[a];r.rect.width;const i=r.rect.height,s=new Uint8Array(i*r.bpl+i);r.cimg=p(r.img,i,r.bpp,r.bpl,s,t,n)}}function d(t,n,a,r,i){const s=i[0],l=i[1],c=i[2],d=i[3],p=i[4],h=i[5];let f=6,x=8,v=255;for(var y=0;y<t.length;y++){const e=new Uint8Array(t[y]);for(var b=e.length,w=0;w<b;w+=4)v&=e[w+3]}const j=255!=v,N=function(t,n,a,r,i,s){const o=[];for(var l=0;l<t.length;l++){const u=new Uint8Array(t[l]),p=new Uint32Array(u.buffer);var c;let g=0,f=0,x=n,v=a,y=r?1:0;if(0!=l){const b=s||r||1==l||0!=o[l-2].dispose?1:2;let w=0,j=1e9;for(let e=0;e<b;e++){var d=new Uint8Array(t[l-1-e]);const r=new Uint32Array(t[l-1-e]);let s=n,o=a,c=-1,u=-1;for(let e=0;e<a;e++)for(let t=0;t<n;t++)p[h=e*n+t]!=r[h]&&(t<s&&(s=t),t>c&&(c=t),e<o&&(o=e),e>u&&(u=e));-1==c&&(s=o=c=u=0),i&&(!(1&~s)&&s--,!(1&~o)&&o--);const m=(c-s+1)*(u-o+1);m<j&&(j=m,w=e,g=s,f=o,x=c-s+1,v=u-o+1)}d=new Uint8Array(t[l-1-w]),1==w&&(o[l-1].dispose=2),c=new Uint8Array(x*v*4),e(d,n,a,c,x,v,-g,-f,0),y=e(u,n,a,c,x,v,-g,-f,3)?1:0,1==y?m(u,n,a,c,{x:g,y:f,width:x,height:v}):e(u,n,a,c,x,v,-g,-f,0)}else c=u.slice(0);o.push({rect:{x:g,y:f,width:x,height:v},img:c,blend:y,dispose:0})}if(r)for(l=0;l<o.length;l++){if(1==(g=o[l]).blend)continue;const e=g.rect,r=o[l-1].rect,s=Math.min(e.x,r.x),c=Math.min(e.y,r.y),d={x:s,y:c,width:Math.max(e.x+e.width,r.x+r.width)-s,height:Math.max(e.y+e.height,r.y+r.height)-c};o[l-1].dispose=1,l-1!=0&&u(t,n,a,o,l-1,d,i),u(t,n,a,o,l,d,i)}let p=0;if(1!=t.length)for(var h=0;h<o.length;h++){var g;p+=(g=o[h]).rect.width*g.rect.height}return o}(t,n,a,s,l,c),_={},k=[],S=[];if(0!=r){const e=[];for(w=0;w<N.length;w++)e.push(N[w].img.buffer);const t=g(function(e){let t=0;for(var n=0;n<e.length;n++)t+=e[n].byteLength;const a=new Uint8Array(t);let r=0;for(n=0;n<e.length;n++){const t=new Uint8Array(e[n]),i=t.length;for(let e=0;e<i;e+=4){let n=t[e],i=t[e+1],s=t[e+2];const o=t[e+3];0==o&&(n=i=s=0),a[r+e]=n,a[r+e+1]=i,a[r+e+2]=s,a[r+e+3]=o}r+=i}return a.buffer}(e),r);for(w=0;w<t.plte.length;w++)k.push(t.plte[w].est.rgba);let n=0;for(w=0;w<N.length;w++){const e=(E=N[w]).img.length;var C=new Uint8Array(t.inds.buffer,n>>2,e>>2);S.push(C);const a=new Uint8Array(t.abuf,n,e);h&&o(E.img,E.rect.width,E.rect.height,k,a,C),E.img.set(a),n+=e}}else for(y=0;y<N.length;y++){var E=N[y];const e=new Uint32Array(E.img.buffer);var D=E.rect.width;for(b=e.length,C=new Uint8Array(b),S.push(C),w=0;w<b;w++){const t=e[w];if(0!=w&&t==e[w-1])C[w]=C[w-1];else if(w>D&&t==e[w-D])C[w]=C[w-D];else{let e=_[t];if(null==e&&(_[t]=e=k.length,k.push(t),k.length>=300))break;C[w]=e}}}const P=k.length;for(P<=256&&0==p&&(x=P<=2?1:P<=4?2:P<=16?4:8,x=Math.max(x,d)),y=0;y<N.length;y++){(E=N[y]).rect.x,E.rect.y,D=E.rect.width;const e=E.rect.height;let t=E.img;new Uint32Array(t.buffer);let n=4*D,a=4;if(P<=256&&0==p){n=Math.ceil(x*D/8);var A=new Uint8Array(n*e);const r=S[y];for(let t=0;t<e;t++){w=t*n;const e=t*D;if(8==x)for(var T=0;T<D;T++)A[w+T]=r[e+T];else if(4==x)for(T=0;T<D;T++)A[w+(T>>1)]|=r[e+T]<<4-4*(1&T);else if(2==x)for(T=0;T<D;T++)A[w+(T>>2)]|=r[e+T]<<6-2*(3&T);else if(1==x)for(T=0;T<D;T++)A[w+(T>>3)]|=r[e+T]<<7-1*(7&T)}t=A,f=3,a=1}else if(0==j&&1==N.length){A=new Uint8Array(D*e*3);const r=D*e;for(w=0;w<r;w++){const e=3*w,n=4*w;A[e]=t[n],A[e+1]=t[n+1],A[e+2]=t[n+2]}t=A,f=2,a=3,n=3*D}E.img=t,E.bpl=n,E.bpp=a}return{ctype:f,depth:x,plte:k,frames:N}}function u(t,n,a,r,i,s,o){const l=Uint8Array,c=Uint32Array,d=new l(t[i-1]),u=new c(t[i-1]),p=i+1<t.length?new l(t[i+1]):null,h=new l(t[i]),g=new c(h.buffer);let f=n,x=a,v=-1,y=-1;for(let e=0;e<s.height;e++)for(let t=0;t<s.width;t++){const a=s.x+t,o=s.y+e,l=o*n+a,c=g[l];0==c||0==r[i-1].dispose&&u[l]==c&&(null==p||0!=p[4*l+3])||(a<f&&(f=a),a>v&&(v=a),o<x&&(x=o),o>y&&(y=o))}-1==v&&(f=x=v=y=0),o&&(!(1&~f)&&f--,!(1&~x)&&x--),s={x:f,y:x,width:v-f+1,height:y-x+1};const b=r[i];b.rect=s,b.blend=1,b.img=new Uint8Array(s.width*s.height*4),0==r[i-1].dispose?(e(d,n,a,b.img,s.width,s.height,-s.x,-s.y,0),m(h,n,a,b.img,s)):e(h,n,a,b.img,s.width,s.height,-s.x,-s.y,0)}function m(t,n,a,r,i){e(t,n,a,r,i.width,i.height,-i.x,-i.y,2)}function p(e,t,n,a,r,i,s){const o=[];let l,c=[0,1,2,3,4];-1!=i?c=[i]:(t*a>5e5||1==n)&&(c=[0]),s&&(l={level:0});const d=js;for(var u=0;u<c.length;u++){for(let i=0;i<t;i++)h(r,e,i,a,n,c[u]);o.push(d.deflate(r,l))}let m,p=1e9;for(u=0;u<o.length;u++)o[u].length<p&&(m=u,p=o[u].length);return o[m]}function h(e,t,a,r,i,s){const o=a*r;let l=o+a;if(e[l]=s,l++,0==s)if(r<500)for(var c=0;c<r;c++)e[l+c]=t[o+c];else e.set(new Uint8Array(t.buffer,o,r),l);else if(1==s){for(c=0;c<i;c++)e[l+c]=t[o+c];for(c=i;c<r;c++)e[l+c]=t[o+c]-t[o+c-i]+256&255}else if(0==a){for(c=0;c<i;c++)e[l+c]=t[o+c];if(2==s)for(c=i;c<r;c++)e[l+c]=t[o+c];if(3==s)for(c=i;c<r;c++)e[l+c]=t[o+c]-(t[o+c-i]>>1)+256&255;if(4==s)for(c=i;c<r;c++)e[l+c]=t[o+c]-n(t[o+c-i],0,0)+256&255}else{if(2==s)for(c=0;c<r;c++)e[l+c]=t[o+c]+256-t[o+c-r]&255;if(3==s){for(c=0;c<i;c++)e[l+c]=t[o+c]+256-(t[o+c-r]>>1)&255;for(c=i;c<r;c++)e[l+c]=t[o+c]+256-(t[o+c-r]+t[o+c-i]>>1)&255}if(4==s){for(c=0;c<i;c++)e[l+c]=t[o+c]+256-n(0,t[o+c-r],0)&255;for(c=i;c<r;c++)e[l+c]=t[o+c]+256-n(t[o+c-i],t[o+c-r],t[o+c-i-r])&255}}}function g(e,t){const n=new Uint8Array(e),a=n.slice(0),r=new Uint32Array(a.buffer),i=f(a,t),s=i[0],o=i[1],l=n.length,c=new Uint8Array(l>>2);let d;if(n.length<2e7)for(var u=0;u<l;u+=4)d=x(s,m=n[u]*(1/255),p=n[u+1]*(1/255),h=n[u+2]*(1/255),g=n[u+3]*(1/255)),c[u>>2]=d.ind,r[u>>2]=d.est.rgba;else for(u=0;u<l;u+=4){var m=n[u]*(1/255),p=n[u+1]*(1/255),h=n[u+2]*(1/255),g=n[u+3]*(1/255);for(d=s;d.left;)d=v(d.est,m,p,h,g)<=0?d.left:d.right;c[u>>2]=d.ind,r[u>>2]=d.est.rgba}return{abuf:a.buffer,inds:c,plte:o}}function f(e,t,n){null==n&&(n=1e-4);const a=new Uint32Array(e.buffer),r={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};r.bst=w(e,r.i0,r.i1),r.est=j(r.bst);const i=[r];for(;i.length<t;){let t=0,r=0;for(var s=0;s<i.length;s++)i[s].est.L>t&&(t=i[s].est.L,r=s);if(t<n)break;const o=i[r],l=y(e,a,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=l||o.i1<=l){o.est.L=0;continue}const c={i0:o.i0,i1:l,bst:null,est:null,tdst:0,left:null,right:null};c.bst=w(e,c.i0,c.i1),c.est=j(c.bst);const d={i0:l,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(d.bst={R:[],m:[],N:o.bst.N-c.bst.N},s=0;s<16;s++)d.bst.R[s]=o.bst.R[s]-c.bst.R[s];for(s=0;s<4;s++)d.bst.m[s]=o.bst.m[s]-c.bst.m[s];d.est=j(d.bst),o.left=c,o.right=d,i[r]=c,i.push(d)}for(i.sort((e,t)=>t.bst.N-e.bst.N),s=0;s<i.length;s++)i[s].ind=s;return[r,i]}function x(e,t,n,a,r){if(null==e.left)return e.tdst=function(e,t,n,a,r){const i=t-e[0],s=n-e[1],o=a-e[2],l=r-e[3];return i*i+s*s+o*o+l*l}(e.est.q,t,n,a,r),e;const i=v(e.est,t,n,a,r);let s=e.left,o=e.right;i>0&&(s=e.right,o=e.left);const l=x(s,t,n,a,r);if(l.tdst<=i*i)return l;const c=x(o,t,n,a,r);return c.tdst<l.tdst?c:l}function v(e,t,n,a,r){const{e:i}=e;return i[0]*t+i[1]*n+i[2]*a+i[3]*r-e.eMq}function y(e,t,n,a,r,i){for(a-=4;n<a;){for(;b(e,n,r)<=i;)n+=4;for(;b(e,a,r)>i;)a-=4;if(n>=a)break;const s=t[n>>2];t[n>>2]=t[a>>2],t[a>>2]=s,n+=4,a-=4}for(;b(e,n,r)>i;)n-=4;return n+4}function b(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]+e[t+3]*n[3]}function w(e,t,n){const a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0],i=n-t>>2;for(let s=t;s<n;s+=4){const t=e[s]*(1/255),n=e[s+1]*(1/255),i=e[s+2]*(1/255),o=e[s+3]*(1/255);r[0]+=t,r[1]+=n,r[2]+=i,r[3]+=o,a[0]+=t*t,a[1]+=t*n,a[2]+=t*i,a[3]+=t*o,a[5]+=n*n,a[6]+=n*i,a[7]+=n*o,a[10]+=i*i,a[11]+=i*o,a[15]+=o*o}return a[4]=a[1],a[8]=a[2],a[9]=a[6],a[12]=a[3],a[13]=a[7],a[14]=a[11],{R:a,m:r,N:i}}function j(e){const{R:t}=e,{m:n}=e,{N:a}=e,r=n[0],i=n[1],s=n[2],o=n[3],l=0==a?0:1/a,c=[t[0]-r*r*l,t[1]-r*i*l,t[2]-r*s*l,t[3]-r*o*l,t[4]-i*r*l,t[5]-i*i*l,t[6]-i*s*l,t[7]-i*o*l,t[8]-s*r*l,t[9]-s*i*l,t[10]-s*s*l,t[11]-s*o*l,t[12]-o*r*l,t[13]-o*i*l,t[14]-o*s*l,t[15]-o*o*l],d=c,u=N;let m=[Math.random(),Math.random(),Math.random(),Math.random()],p=0,h=0;if(0!=a)for(let f=0;f<16&&(m=u.multVec(d,m),h=Math.sqrt(u.dot(m,m)),m=u.sml(1/h,m),!(0!=f&&Math.abs(h-p)<1e-9));f++)p=h;const g=[r*l,i*l,s*l,o*l];return{Cov:c,q:g,e:m,L:p,eMq255:u.dot(u.sml(255,g),m),eMq:u.dot(m,g),rgba:(Math.round(255*g[3])<<24|Math.round(255*g[2])<<16|Math.round(255*g[1])<<8|Math.round(255*g[0]))>>>0}}var N={multVec:(e,t)=>[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],sml:(e,t)=>[e*t[0],e*t[1],e*t[2],e*t[3]]};Ns.encode=function(e,t,n,a,r,i,s){null==a&&(a=0),null==s&&(s=!1);const o=d(e,t,n,a,[!1,!1,!1,0,s,!1]);return c(o,-1),l(o,t,n,r,i)},Ns.encodeLL=function(e,t,n,a,r,i,s,o){const d={ctype:0+(1==a?0:2)+(0==r?0:4),depth:i,frames:[]},u=(a+r)*i,m=u*t;for(let l=0;l<e.length;l++)d.frames.push({rect:{x:0,y:0,width:t,height:n},img:new Uint8Array(e[l]),blend:0,dispose:1,bpp:Math.ceil(u/8),bpl:Math.ceil(m/8)});return c(d,0,!0),l(d,t,n,s,o)},Ns.encode.compress=d,Ns.encode.dither=o,Ns.quantize=g,Ns.quantize.getKDtree=f,Ns.quantize.getNearest=x}();const _s={toArrayBuffer(e,t){const n=e.width,a=e.height,r=n<<2,i=e.getContext("2d").getImageData(0,0,n,a),s=new Uint32Array(i.data.buffer),o=(32*n+31)/32<<2,l=o*a,c=122+l,d=new ArrayBuffer(c),u=new DataView(d),m=1<<20;let p,h,g,f,x=m,v=0,y=0,b=0;function w(e){u.setUint16(y,e,!0),y+=2}function j(e){u.setUint32(y,e,!0),y+=4}function N(e){y+=e}w(19778),j(c),N(4),j(122),j(108),j(n),j(-a>>>0),w(1),w(32),j(3),j(l),j(2835),j(2835),N(8),j(16711680),j(65280),j(255),j(4278190080),j(1466527264),function e(){for(;v<a&&x>0;){for(f=122+v*o,p=0;p<r;)x--,h=s[b++],g=h>>>24,u.setUint32(f+p,h<<8|g),p+=4;v++}b<s.length?(x=m,setTimeout(e,_s._dly)):t(d)}()},toBlob(e,t){this.toArrayBuffer(e,e=>{t(new Blob([e],{type:"image/bmp"}))})},_dly:9};var ks={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Ss={[ks.CHROME]:16384,[ks.FIREFOX]:11180,[ks.DESKTOP_SAFARI]:16384,[ks.IE]:8192,[ks.IOS]:4096,[ks.ETC]:8192};const Cs="undefined"!=typeof window,Es="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,Ds=Cs&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Ps=(Cs||Es)&&(Ds&&Ds.getOriginalSymbol(window,"File")||"undefined"!=typeof File&&File),As=(Cs||Es)&&(Ds&&Ds.getOriginalSymbol(window,"FileReader")||"undefined"!=typeof FileReader&&FileReader);function Ts(e,t,n=Date.now()){return new Promise(a=>{const r=e.split(","),i=r[0].match(/:(.*?);/)[1],s=globalThis.atob(r[1]);let o=s.length;const l=new Uint8Array(o);for(;o--;)l[o]=s.charCodeAt(o);const c=new Blob([l],{type:i});c.name=t,c.lastModified=n,a(c)})}function Ms(e){return new Promise((t,n)=>{const a=new As;a.onload=()=>t(a.result),a.onerror=e=>n(e),a.readAsDataURL(e)})}function Rs(e){return new Promise((t,n)=>{const a=new Image;a.onload=()=>t(a),a.onerror=e=>n(e),a.src=e})}function Is(){if(void 0!==Is.cachedResult)return Is.cachedResult;let e=ks.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=ks.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=ks.IOS:/Safari/i.test(t)?e=ks.DESKTOP_SAFARI:/Firefox/i.test(t)?e=ks.FIREFOX:(/MSIE/i.test(t)||1==!!document.documentMode)&&(e=ks.IE),Is.cachedResult=e,Is.cachedResult}function Os(e,t){const n=Is(),a=Ss[n];let r=e,i=t,s=r*i;const o=r>i?i/r:r/i;for(;s>a*a;){const e=(a+r)/2,t=(a+i)/2;e<t?(i=t,r=t*o):(i=e*o,r=e),s=r*i}return{width:r,height:i}}function Ls(e,t){let n,a;try{if(n=new OffscreenCanvas(e,t),a=n.getContext("2d"),null===a)throw new Error("getContext of OffscreenCanvas returns null")}catch(r){n=document.createElement("canvas"),a=n.getContext("2d")}return n.width=e,n.height=t,[n,a]}function Fs(e,t){const{width:n,height:a}=Os(e.width,e.height),[r,i]=Ls(n,a);return t&&/jpe?g/.test(t)&&(i.fillStyle="white",i.fillRect(0,0,r.width,r.height)),i.drawImage(e,0,0,r.width,r.height),r}function Us(){return void 0!==Us.cachedResult||(Us.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"undefined"!=typeof document&&"ontouchend"in document),Us.cachedResult}function zs(e,t={}){return new Promise(function(n,a){let r,i;var s=function(){try{return i=Fs(r,t.fileType||e.type),n([r,i])}catch(s){return a(s)}},o=function(t){try{var n=function(e){try{throw e}catch(t){return a(t)}};try{let t;return Ms(e).then(function(e){try{return t=e,Rs(t).then(function(e){try{return r=e,function(){try{return s()}catch(e){return a(e)}}()}catch(t){return n(t)}},n)}catch(i){return n(i)}},n)}catch(i){n(i)}}catch(i){return a(i)}};try{if(Us()||[ks.DESKTOP_SAFARI,ks.MOBILE_SAFARI].includes(Is()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then(function(e){try{return r=e,s()}catch(t){return o()}},o)}catch(l){o()}})}function $s(e,t,n,a,r=1){return new Promise(function(i,s){let o;if("image/png"===t){let i,s,c;return i=e.getContext("2d"),({data:s}=i.getImageData(0,0,e.width,e.height)),c=Ns.encode([s.buffer],e.width,e.height,4096*r),o=new Blob([c],{type:t}),o.name=n,o.lastModified=a,l.call(this)}{let i=function(){return l.call(this)};if("image/bmp"===t)return new Promise(t=>_s.toBlob(e,t)).then(function(e){try{return o=e,o.name=n,o.lastModified=a,i.call(this)}catch(t){return s(t)}}.bind(this),s);{let l=function(){return i.call(this)};if("function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return e.convertToBlob({type:t,quality:r}).then(function(e){try{return o=e,o.name=n,o.lastModified=a,l.call(this)}catch(t){return s(t)}}.bind(this),s);{let i;return i=e.toDataURL(t,r),Ts(i,n,a).then(function(e){try{return o=e,l.call(this)}catch(t){return s(t)}}.bind(this),s)}}}function l(){return i(o)}})}function Bs(e){e.width=0,e.height=0}function qs(){return new Promise(function(e,t){let n,a,r,i;return void 0!==qs.cachedResult?e(qs.cachedResult):Ts("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(s){try{return n=s,zs(n).then(function(s){try{return a=s[1],$s(a,n.type,n.name,n.lastModified).then(function(n){try{return r=n,Bs(a),zs(r).then(function(n){try{return i=n[0],qs.cachedResult=1===i.width&&2===i.height,e(qs.cachedResult)}catch(a){return t(a)}},t)}catch(s){return t(s)}},t)}catch(o){return t(o)}},t)}catch(o){return t(o)}},t)})}function Vs(e){return new Promise((t,n)=>{const a=new As;a.onload=e=>{const n=new DataView(e.target.result);if(65496!=n.getUint16(0,!1))return t(-2);const a=n.byteLength;let r=2;for(;r<a;){if(n.getUint16(r+2,!1)<=8)return t(-1);const e=n.getUint16(r,!1);if(r+=2,65505==e){if(1165519206!=n.getUint32(r+=2,!1))return t(-1);const e=18761==n.getUint16(r+=6,!1);r+=n.getUint32(r+4,e);const a=n.getUint16(r,e);r+=2;for(let i=0;i<a;i++)if(274==n.getUint16(r+12*i,e))return t(n.getUint16(r+12*i+8,e))}else{if(65280&~e)break;r+=n.getUint16(r,!1)}}return t(-1)},a.onerror=e=>n(e),a.readAsArrayBuffer(e)})}function Hs(e,t){const{width:n}=e,{height:a}=e,{maxWidthOrHeight:r}=t;let i,s=e;return isFinite(r)&&(n>r||a>r)&&([s,i]=Ls(n,a),n>a?(s.width=r,s.height=a/n*r):(s.width=n/a*r,s.height=r),i.drawImage(e,0,0,s.width,s.height),Bs(e)),s}function Ws(e,t){const{width:n}=e,{height:a}=e,[r,i]=Ls(n,a);switch(t>4&&t<9?(r.width=a,r.height=n):(r.width=n,r.height=a),t){case 2:i.transform(-1,0,0,1,n,0);break;case 3:i.transform(-1,0,0,-1,n,a);break;case 4:i.transform(1,0,0,-1,0,a);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,a,0);break;case 7:i.transform(0,-1,-1,0,a,n);break;case 8:i.transform(0,-1,1,0,0,n)}return i.drawImage(e,0,0,n,a),Bs(e),r}function Ys(e,t,n=0){return new Promise(function(a,r){let i,s,o,l,c,d,u,m,p,h,g,f,x,v,y,b,w,j,N,_;function k(e=5){if(t.signal&&t.signal.aborted)throw t.signal.reason;i+=e,t.onProgress(Math.min(i,100))}function S(e){if(t.signal&&t.signal.aborted)throw t.signal.reason;i=Math.min(Math.max(e,i),100),t.onProgress(i)}return i=n,s=t.maxIteration||10,o=1024*t.maxSizeMB*1024,k(),zs(e,t).then(function(n){try{return[,l]=n,k(),c=Hs(l,t),k(),new Promise(function(n,a){var r;if(!(r=t.exifOrientation))return Vs(e).then(function(e){try{return r=e,i.call(this)}catch(t){return a(t)}}.bind(this),a);function i(){return n(r)}return i.call(this)}).then(function(n){try{return d=n,k(),qs().then(function(n){try{return u=n?c:Ws(c,d),k(),m=t.initialQuality||1,p=t.fileType||e.type,$s(u,p,e.name,e.lastModified,m).then(function(n){try{{let d=function(){if(s--&&(y>o||y>x)){let t,n;return t=_?.95*N.width:N.width,n=_?.95*N.height:N.height,[w,j]=Ls(t,n),j.drawImage(N,0,0,t,n),m*="image/png"===p?.85:.95,$s(w,p,e.name,e.lastModified,m).then(function(e){try{return b=e,Bs(N),N=w,y=b.size,S(Math.min(99,Math.floor((v-y)/(v-o)*100))),d}catch(t){return r(t)}},r)}return[1]},C=function(){return Bs(N),Bs(w),Bs(c),Bs(u),Bs(l),S(100),a(b)};return h=n,k(),g=h.size>o,f=h.size>e.size,g||f?(x=e.size,v=h.size,y=v,N=u,_=!t.alwaysKeepResolution&&g,(i=function(e){for(;e;){if(e.then)return void e.then(i,r);try{if(e.pop){if(e.length)return e.pop()?C.call(this):e;e=d}else e=e.call(this)}catch(t){return r(t)}}}.bind(this))(d)):(S(100),a(h));var i}}catch(d){return r(d)}}.bind(this),r)}catch(i){return r(i)}}.bind(this),r)}catch(i){return r(i)}}.bind(this),r)}catch(i){return r(i)}}.bind(this),r)})}let Ks;function Gs(e,t){return new Promise(function(n,a){let r,i,s,o,l,c;if(r={...t},s=0,({onProgress:o}=r),r.maxSizeMB=r.maxSizeMB||Number.POSITIVE_INFINITY,l="boolean"!=typeof r.useWebWorker||r.useWebWorker,delete r.useWebWorker,r.onProgress=e=>{s=e,"function"==typeof o&&o(s)},!(e instanceof Blob||e instanceof Ps))return a(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return a(new Error("The file given is not an image"));if(c="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!l||"function"!=typeof Worker||c)return Ys(e,r).then(function(e){try{return i=e,m.call(this)}catch(t){return a(t)}}.bind(this),a);var d=function(){try{return m.call(this)}catch(e){return a(e)}}.bind(this),u=function(t){try{return Ys(e,r).then(function(e){try{return i=e,d()}catch(t){return a(t)}},a)}catch(n){return a(n)}};try{return r.libURL=r.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",function(e,t){return new Promise((n,a)=>{Ks||(Ks=function(e){const t=[];return t.push(e),URL.createObjectURL(new Blob(t))}("\nlet scriptImported = false\nself.addEventListener('message', async (e) => {\n  const { file, id, imageCompressionLibUrl, options } = e.data\n  options.onProgress = (progress) => self.postMessage({ progress, id })\n  try {\n    if (!scriptImported) {\n      // console.log('[worker] importScripts', imageCompressionLibUrl)\n      self.importScripts(imageCompressionLibUrl)\n      scriptImported = true\n    }\n    // console.log('[worker] self', self)\n    const compressedFile = await imageCompression(file, options)\n    self.postMessage({ file: compressedFile, id })\n  } catch (e) {\n    // console.error('[worker] error', e)\n    self.postMessage({ error: e.message + '\\n' + e.stack, id })\n  }\n})\n"));const r=new Worker(Ks);r.addEventListener("message",function(e){if(t.signal&&t.signal.aborted)r.terminate();else if(void 0===e.data.progress){if(e.data.error)return a(new Error(e.data.error)),void r.terminate();n(e.data.file),r.terminate()}else t.onProgress(e.data.progress)}),r.addEventListener("error",a),t.signal&&t.signal.addEventListener("abort",()=>{a(t.signal.reason),r.terminate()}),r.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:{...t,onProgress:void 0,signal:void 0}})})}(e,r).then(function(e){try{return i=e,d()}catch(t){return u()}},u)}catch(p){u()}function m(){try{i.name=e.name,i.lastModified=e.lastModified}catch(p){}try{r.preserveExif&&"image/jpeg"===e.type&&(!r.fileType||r.fileType&&r.fileType===e.type)&&(i=hs(e,i))}catch(p){}return n(i)}})}Gs.getDataUrlFromFile=Ms,Gs.getFilefromDataUrl=Ts,Gs.loadImage=Rs,Gs.drawImageInCanvas=Fs,Gs.drawFileInCanvas=zs,Gs.canvasToFile=$s,Gs.getExifOrientation=Vs,Gs.handleMaxWidthOrHeight=Hs,Gs.followExifOrientation=Ws,Gs.cleanupCanvasMemory=Bs,Gs.isAutoOrientationInBrowser=qs,Gs.approximateBelowMaximumCanvasSizeOfBrowser=Os,Gs.copyExifWithoutOrientation=hs,Gs.getBrowserName=Is,Gs.version="2.0.2";const Qs={mp4:"video/mp4",m4v:"video/x-m4v",mov:"video/quicktime",webm:"video/webm",mkv:"video/x-matroska",avi:"video/x-msvideo",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",pdf:"application/pdf"};function Xs(e){const t=(e||"").toLowerCase(),n=t.includes(".")?t.split(".").pop():null;return n?Qs[n]??null:null}function Zs(e){return e.type&&e.type.length>0?e.type:Xs(e.name)??"application/octet-stream"}async function Js(e,t,n){let a=e;if("images"===n&&e.type.startsWith("image/")&&"image/gif"!==e.type)try{const t={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,fileType:e.type};a=await Gs(e,t)}catch(c){a=e}const r=`${t}/${n}/${crypto.randomUUID()}.${e.name.split(".").pop()??"bin"}`,i=Zs(e),{data:s,error:o}=await W.storage.from("trip-media").upload(r,a,{contentType:i,upsert:!1});if(o)throw o;const{data:l}=W.storage.from("trip-media").getPublicUrl(r);return{key:r,publicUrl:l.publicUrl}}async function eo(e){const{data:t,error:n}=await W.from("trip_link_index").insert({trip_id:e.tripId,url:e.url,og_title:e.ogTitle??null,og_image_url:e.ogImage??null,og_description:e.ogDescription??null,domain:e.domain??new URL(e.url).hostname,message_id:e.messageId??null}).select().single();if(n)throw n;return t}async function to(e){try{const t=void 0,n=void 0;if(!t||!n)throw new Error("Supabase configuration missing");const a=await fetch(`${t}/functions/v1/fetch-og-metadata`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({url:e})});if(!a.ok)throw new Error(`Failed to fetch metadata: ${a.statusText}`);return await a.json()}catch(t){return{error:t instanceof Error?t.message:"Unknown error"}}}function no(e,t){var n,a;const r=new URL(e).hostname.toLowerCase(),i=(null==(n=null==t?void 0:t.title)?void 0:n.toLowerCase())||"",s=(null==(a=null==t?void 0:t.description)?void 0:a.toLowerCase())||"";if(["venmo.com","paypal.com","square.com","stripe.com","receipt","invoice"].some(e=>r.includes(e)))return"receipt";if(["calendar.google.com","outlook.com","calendly.com","doodle.com"].some(e=>r.includes(e)))return"schedule";if(["airbnb.com","booking.com","expedia.com","hotels.com","kayak.com","priceline.com","tripadvisor.com","opentable.com","resy.com","tock.com"].some(e=>r.includes(e)))return"booking";const o=`${i} ${s}`;return["receipt","invoice","payment","paid","transaction","confirmation"].some(e=>o.includes(e))?"receipt":["calendar","schedule","appointment","meeting","event","reservation"].some(e=>o.includes(e))?"schedule":["book","reservation","check-in","check-out","hotel","flight","restaurant"].some(e=>o.includes(e))?"booking":"general"}async function ao(e,t){var n,a,r,i;try{const{data:s,error:o}=await W.functions.invoke("enhanced-ai-parser",{body:{messageText:e,extractionType:"calendar",tripId:t}});if(o)throw new Error(`Failed to parse message: ${o.message}`);const l=null==s?void 0:s.extracted_data,c={dates:null==(n=null==l?void 0:l.events)?void 0:n.map(e=>({value:e.date,confidence:e.confidence||.8})),times:null==(a=null==l?void 0:l.events)?void 0:a.map(e=>({value:e.start_time||"",confidence:e.confidence||.8})),locations:null==(r=null==l?void 0:l.events)?void 0:r.map(e=>({value:e.location||"",confidence:e.confidence||.8})),suggested_events:null==(i=null==l?void 0:l.events)?void 0:i.map(e=>({title:e.title,date:e.date,time:e.start_time,location:e.location,confidence:e.confidence||.8}))},d=[];c.suggested_events&&c.suggested_events.length>0&&c.suggested_events.forEach(e=>{e.confidence>.7&&d.push({action:"create_calendar_event",data:{title:e.title,date:e.date,start_time:e.time,location:e.location},message:`Add "${e.title}" to calendar`})});const{data:u}=await W.functions.invoke("enhanced-ai-parser",{body:{messageText:e,extractionType:"todo",tripId:t}}),m=(null==u?void 0:u.todos)||[];return m.length>0&&m.forEach(e=>{e.confidence>.7&&d.push({action:"create_todo",data:e,message:`Create todo: "${e.title}"`})}),{type:"message",entities:c,todos:m.length>0?m:void 0,confidence:(null==l?void 0:l.confidence_overall)||.7,suggestions:d}}catch(s){return{type:"message",confidence:.3}}}async function ro(e,t,n,a,r){try{switch(t){case"image":return await async function(e,t){var n,a,r;try{const{data:i,error:s}=await W.functions.invoke("enhanced-ai-parser",{body:{fileUrl:e,fileType:"image/jpeg",extractionType:"document_parse",tripId:t}});if(s)throw new Error(`Failed to parse receipt: ${s.message}`);const o=null==i?void 0:i.parsed_data;if(!o)throw new Error("No parsed data returned from parser");const l="receipt"===o.document_type||"invoice"===o.document_type||(null==(n=o.structured_data)?void 0:n.amounts)&&o.structured_data.amounts.length>0,c={extracted_text:o.extracted_text||"",structured_data:o.structured_data||{},ocr_confidence:o.ocr_confidence||.8,document_type:l?"receipt":o.document_type||"other"},d=[];return c.structured_data.total_cost&&d.push({action:"extract_receipt",data:c,message:`Extract receipt for $${c.structured_data.total_cost}`}),c.structured_data.dates&&c.structured_data.dates.length>0&&d.push({action:"create_calendar_event",data:{title:`Receipt: ${(null==(a=c.structured_data.vendors)?void 0:a[0])||"Purchase"}`,date:c.structured_data.dates[0],location:null==(r=c.structured_data.locations)?void 0:r[0]},message:"Add calendar event for this receipt"}),{type:"receipt",receipt:c,confidence:c.ocr_confidence,suggestions:d}}catch(i){throw i}}(e,a);case"document":return await async function(e,t,n,a){try{const{data:r,error:i}=await W.functions.invoke("enhanced-ai-parser",{body:{fileUrl:e,fileType:t,messageText:n,extractionType:"calendar",tripId:a}});if(i)throw new Error(`Failed to parse itinerary: ${i.message}`);const s=null==r?void 0:r.extracted_data;if(!s||!s.events)throw new Error("No events extracted from itinerary");const o={events:s.events||[],confidence_overall:s.confidence_overall||.8},l=o.events.map(e=>({action:"create_calendar_event",data:{title:e.title,date:e.date,start_time:e.start_time,end_time:e.end_time,location:e.location,category:e.category,confirmation_number:e.confirmation_number},message:`Add "${e.title}" to calendar`}));return{type:"itinerary",itinerary:o,confidence:o.confidence_overall,suggestions:l}}catch(r){throw r}}(e,n,"",a);case"url":return await async function(e,t,n){try{const a=await to(e);return await eo({tripId:t,url:e,ogTitle:a.title,ogImage:a.image,ogDescription:a.description,domain:a.siteName||new URL(e).hostname,messageId:n}),{type:"link",linkPreview:{title:a.title,description:a.description,image:a.image,domain:a.siteName||new URL(e).hostname},confidence:a.error?.5:.9}}catch(a){return{type:"link",linkPreview:{domain:new URL(e).hostname},confidence:.3}}}(e,a,r);case"message":return await ao(e,a);default:return null}}catch(i){return null}}function io(e){const[t,n]=L.useState(!1),[a,r]=L.useState({}),[i,s]=L.useState(null),[o,l]=L.useState(null),{user:c}=Y(),d=(null==c?void 0:c.id)||"";async function u(t,a,i){var o,u,m,p,h,g;const f=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`;n(!0),s(null),r(e=>({...e,[f]:{fileId:f,fileName:a.name,progress:0,status:"uploading"}}));const x=setInterval(()=>{r(e=>{const t=e[f];if(t&&t.progress<90){const n=Math.min(t.progress+10,90);return i&&i(n),{...e,[f]:{...t,progress:n}}}return e})},200);try{const n="image"===t?"images":"video"===t?"videos":"files",{publicUrl:s,key:y}=await Js(a,e,n);if(clearInterval(x),r(e=>({...e,[f]:{fileId:f,fileName:a.name,progress:100,status:"completed"}})),i&&i(100),"image"===t||"video"===t){const n=await async function(e){const t=e.mimeType&&e.mimeType.length>0?e.mimeType:void 0,{data:n,error:a}=await W.from("trip_media_index").insert({trip_id:e.tripId,media_type:e.mediaType,media_url:e.url,filename:e.filename??null,file_size:e.fileSize??null,mime_type:t??null,message_id:e.messageId??null,metadata:e.uploadedBy||e.uploadPath?{...e.uploadedBy?{uploaded_by:e.uploadedBy}:{},...e.uploadPath?{upload_path:e.uploadPath}:{}}:null,caption:null,tags:[]}).select().single();if(a)throw a;return n}({tripId:e,mediaType:t,url:s,uploadPath:y,filename:a.name,fileSize:a.size,mimeType:a.type,uploadedBy:d}),r=await J({trip_id:e,user_id:d,author_name:(null==(o=null==c?void 0:c.email)?void 0:o.split("@")[0])||"Unknown User",content:"",privacy_mode:"standard",media_type:t,media_url:s,attachments:[{type:t,ref_id:n.id,url:s}]});if("image"===t)try{const t=await ro(s,"image",a.type,e,null==(u=null==r?void 0:r.id)?void 0:u.toString());t&&t.suggestions&&t.suggestions.length>0&&(l(t),"receipt"===t.type?ee.success("Receipt detected! Check suggestions below.",{duration:5e3}):"itinerary"===t.type&&ee.success(`Found ${(null==(m=t.itinerary)?void 0:m.events.length)||0} calendar events!`,{duration:5e3}))}catch(v){}return ee.success(("image"===t?"Photo":"Video")+" uploaded successfully"),{type:t,ref:n}}{const t=await async function(e){const{data:t,error:n}=await W.from("trip_files").insert({trip_id:e.tripId,name:e.name,file_type:e.fileType,uploaded_by:e.uploadedBy}).select().single();if(n)throw n;return t}({tripId:e,name:a.name,fileType:a.type||"application/octet-stream",uploadedBy:d}),n=await J({trip_id:e,user_id:d,author_name:(null==(p=null==c?void 0:c.email)?void 0:p.split("@")[0])||"Unknown User",content:a.name,privacy_mode:"standard",attachments:[{type:"file",ref_id:t.id,url:s}]});if("application/pdf"===a.type||a.name.toLowerCase().includes("itinerary"))try{const t=await ro(s,"document",a.type,e,null==(h=null==n?void 0:n.id)?void 0:h.toString());t&&t.suggestions&&t.suggestions.length>0&&(l(t),ee.success(`Found ${(null==(g=t.itinerary)?void 0:g.events.length)||0} calendar events!`,{duration:5e3}))}catch(v){}return ee.success("File uploaded successfully"),{type:"file",ref:t}}}catch(ws){clearInterval(x);const t=ws.message??"Upload failed";throw s(t),r(e=>({...e,[f]:{fileId:f,fileName:a.name,progress:0,status:"error"}})),ee.error(t),ws}finally{setTimeout(()=>{r(e=>{const t={...e};return delete t[f],t})},2e3),n(!1)}}return{shareFile:u,shareLink:async function(t){var a;n(!0),s(null);try{try{new URL(t)}catch{throw new Error("Invalid URL format")}const n=await async function(e){try{const t=void 0,n=void 0;if(!t||!n){const t=new URL(e);return{domain:t.hostname,title:t.hostname}}const a=await fetch(`${t}/functions/v1/fetch-og-metadata`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({url:e})});if(!a.ok)throw new Error(`Failed to fetch OG metadata: ${a.statusText}`);const r=await a.json();return{domain:r.siteName||new URL(e).hostname,title:r.title,image:r.image,description:r.description}}catch(i){try{const t=new URL(e);return{domain:t.hostname,title:t.hostname}}catch{return{domain:"unknown"}}}}(t),r=await eo({tripId:e,url:t,ogTitle:n.title,ogImage:n.image,ogDescription:n.description,domain:n.domain,submittedBy:d});return await J({trip_id:e,user_id:d,author_name:(null==(a=null==c?void 0:c.email)?void 0:a.split("@")[0])||"Unknown User",content:t,privacy_mode:"standard",link_preview:{url:t,title:n.title,image:n.image,description:n.description,domain:n.domain},attachments:[{type:"link",ref_id:r.id,url:t}]}),ee.success("Link shared successfully"),{type:"link",ref:r}}catch(ws){const t=ws.message??"Link share failed";throw s(t),ee.error(t),ws}finally{n(!1)}},shareMultipleFiles:async function(e,t){const n=[];for(const r of Array.from(e))try{const e="document"===t?"file":t,a=await u(e,r);n.push(a)}catch(a){}return n},isUploading:t,uploadProgress:a,error:i,parsedContent:o,clearParsedContent:()=>l(null)}}const so={free:{aiQueriesPerTrip:10,photosPerTrip:5,videosPerTrip:5,filesPerTrip:5,urlsPerTrip:-1,storageAccountMB:500,activeTripsLimit:3,paymentRequestsPerTrip:5,canCreatePayments:!0,canSettlePayments:!0,freeProTripsLimit:1,freeEventsLimit:1,eventAttendeesLimit:50,canCreateEvents:!0},explorer:{aiQueriesPerTrip:-1,photosPerTrip:-1,videosPerTrip:-1,filesPerTrip:-1,urlsPerTrip:-1,storageAccountMB:5e4,activeTripsLimit:-1,paymentRequestsPerTrip:-1,canCreatePayments:!0,canSettlePayments:!0,canCreateEvents:!0,eventsLimit:-1,eventAttendeesLimit:100},"frequent-chraveler":{aiQueriesPerTrip:-1,photosPerTrip:-1,videosPerTrip:-1,filesPerTrip:-1,urlsPerTrip:-1,storageAccountMB:-1,activeTripsLimit:-1,paymentRequestsPerTrip:-1,canCreatePayments:!0,canSettlePayments:!0,canCreateProTrip:!0,proTripsPerMonth:1,canCreateEvents:!0,eventsLimit:-1,eventAttendeesLimit:200}},oo=({tripId:e,onProgress:t,onComplete:n,onError:a})=>{const r=ne(),{isDemoMode:i}=X(),[s,o]=L.useState([]),[l,c]=L.useState(!1),d=(e=>{const{tier:t,isLoading:n}=te(),a=so[t],{data:r,isLoading:i}=Te({queryKey:["media-limits",e],queryFn:async()=>{const{data:t,error:n}=await W.from("trip_media_index").select("media_type").eq("trip_id",e);if(n)return{photos:0,videos:0,files:0};const a={photos:0,videos:0,files:0};return null==t||t.forEach(e=>{"image"===e.media_type?a.photos++:"video"===e.media_type?a.videos++:"document"===e.media_type&&a.files++}),a},enabled:!!e,staleTime:1e4});if(n||i||!r)return{photos:{used:0,limit:a.photosPerTrip,canUpload:!0},videos:{used:0,limit:a.videosPerTrip,canUpload:!0},files:{used:0,limit:a.filesPerTrip,canUpload:!0},isLoading:!0};const s=a.photosPerTrip,o=a.videosPerTrip,l=a.filesPerTrip;return{photos:{used:r.photos,limit:s,canUpload:-1===s||r.photos<s},videos:{used:r.videos,limit:o,canUpload:-1===o||r.videos<o},files:{used:r.files,limit:l,canUpload:-1===l||r.files<l},isLoading:!1}})(e),u=async(t,n,a)=>{const r=(e=>e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"video":"document")(t);if(m(n,20,"uploading"),i){await new Promise(e=>setTimeout(e,1e3));const e=URL.createObjectURL(t);return m(n,100,"complete",void 0,e),{id:n,url:e,filename:t.name,type:r,size:t.size,mimeType:t.type}}try{m(n,50,"uploading");const{mediaService:i}=await cn(async()=>{const{mediaService:e}=await Promise.resolve().then(()=>Ah);return{mediaService:e}},void 0),s=await i.uploadMedia({tripId:e,file:t,media_type:r});return null==a||a.aborted,m(n,90,"processing"),m(n,100,"complete",void 0,s.media_url),{id:s.id,url:s.media_url,filename:s.filename,type:s.media_type,size:s.file_size||t.size,mimeType:s.mime_type||t.type}}catch(s){throw m(n,0,"error",s.message),s}},m=(e,n,a,r,i)=>{o(s=>{const o=s.map(t=>t.fileId===e?{...t,progress:n,status:a,error:r,url:i}:t);return null==t||t(o),o})},p=L.useCallback(async i=>{const s=Array.from(i);if(0===s.length)return[];const l=s.filter(e=>e.type.startsWith("image/")).length,m=s.filter(e=>e.type.startsWith("video/")).length,p=s.filter(e=>!e.type.startsWith("image/")&&!e.type.startsWith("video/")).length;if(!d.isLoading){if(l>0&&!d.photos.canUpload){const e=d.photos.limit;return ee.error(`Photo limit reached (${d.photos.used}/${e} for this trip). Upgrade to Explorer for unlimited uploads.`),[]}if(m>0&&!d.videos.canUpload){const e=d.videos.limit;return ee.error(`Video limit reached (${d.videos.used}/${e} for this trip). Upgrade to Explorer for unlimited uploads.`),[]}if(p>0&&!d.files.canUpload){const e=d.files.limit;return ee.error(`File limit reached (${d.files.used}/${e} for this trip). Upgrade to Explorer for unlimited uploads.`),[]}if(l>0&&-1!==d.photos.limit){const e=d.photos.limit-d.photos.used;if(l>e)return ee.error(`Can only upload ${e} more photo${1===e?"":"s"} for this trip. Upgrade for unlimited.`),[]}if(m>0&&-1!==d.videos.limit){const e=d.videos.limit-d.videos.used;if(m>e)return ee.error(`Can only upload ${e} more video${1===e?"":"s"} for this trip. Upgrade for unlimited.`),[]}if(p>0&&-1!==d.files.limit){const e=d.files.limit-d.files.used;if(p>e)return ee.error(`Can only upload ${e} more file${1===e?"":"s"} for this trip. Upgrade for unlimited.`),[]}}c(!0);const h=s.map((e,t)=>({fileId:`${Date.now()}-${t}`,fileName:e.name,progress:0,status:"pending"}));o(h),null==t||t(h);const g=[],f=[],x=[];for(let e=0;e<s.length;e+=3)x.push(s.slice(e,e+3));for(const e of x){const t=e.map(async(e,t)=>{const n=h[s.indexOf(e)].fileId;try{const t=await u(e,n);g.push(t)}catch(r){f.push({fileName:e.name,error:r}),null==a||a(r,e.name)}});await Promise.allSettled(t)}return r.invalidateQueries({queryKey:["tripMedia",e]}),g.length>0&&(ee.success(`${g.length} file${g.length>1?"s":""} uploaded successfully`),null==n||n(g)),f.length>0&&ee.error(`${f.length} file${f.length>1?"s":""} failed to upload`),c(!1),setTimeout(()=>o([]),2e3),g},[e,r,t,n,a,i,d]),h=L.useCallback(()=>{o([])},[]),g=L.useCallback(async()=>{const e=s.filter(e=>"error"===e.status);0!==e.length&&ee.info(`Retrying ${e.length} failed upload${e.length>1?"s":""}...`)},[s]);return{uploadFiles:p,uploadQueue:s,isUploading:l,clearQueue:h,retryFailedUploads:g,hasFailedUploads:s.some(e=>"error"===e.status)}},lo=({parsedContent:e,tripId:t,onSuggestionApplied:a,onDismiss:r})=>{if(!e||!e.suggestions||0===e.suggestions.length)return null;const i=async e=>{try{const n=await async function(e,t){var n;try{if("create_calendar_event"===e.action){if(!e.data)return null;const a={trip_id:t,title:e.data.title,start_time:e.data.date?new Date(`${e.data.date}T${e.data.start_time||"12:00"}`).toISOString():(new Date).toISOString(),end_time:e.data.end_time?new Date(`${e.data.date}T${e.data.end_time}`).toISOString():void 0,location:e.data.location,event_category:e.data.category||"other",source_type:"ai_parsed",source_data:e.data};return(null==(n=(await Z.createEvent(a)).event)?void 0:n.id)||null}return null}catch(a){return null}}(e,t);n?(ee.success(e.message),null==a||a()):ee.error("Failed to apply suggestion")}catch(n){ee.error("Failed to apply suggestion")}},s=e=>{switch(e){case"create_calendar_event":return n.jsx(dn,{className:"w-4 h-4"});case"create_todo":return n.jsx(ht,{className:"w-4 h-4"});case"extract_receipt":return n.jsx(ba,{className:"w-4 h-4"});default:return n.jsx(pt,{className:"w-4 h-4"})}};return n.jsxs(lt,{className:"mb-4 border-blue-500/50 bg-blue-950/20",children:[n.jsx(dt,{className:"pb-3",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(pt,{className:"w-5 h-5 text-blue-400"}),n.jsxs("div",{children:[n.jsx(ut,{className:"text-sm font-semibold text-white",children:(()=>{switch(e.type){case"receipt":return"Receipt Detected";case"itinerary":return"Itinerary Parsed";case"message":return"Smart Suggestions";default:return"Content Suggestions"}})()}),n.jsx(mt,{className:"text-xs text-gray-400 mt-1",children:(()=>{var t;switch(e.type){case"receipt":return"Found receipt data. Would you like to extract it?";case"itinerary":return`Found ${(null==(t=e.itinerary)?void 0:t.events.length)||0} calendar events. Add them to your trip?`;case"message":return"Detected dates, times, and locations. Create calendar events?";default:return"Apply these suggestions to enhance your trip"}})()})]})]}),r&&n.jsx(Q,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-gray-400 hover:text-white",onClick:r,children:n.jsx(ae,{className:"w-4 h-4"})})]})}),n.jsx(ct,{className:"pt-0",children:n.jsx("div",{className:"space-y-2",children:e.suggestions.map((e,t)=>n.jsxs("div",{className:"flex items-center justify-between gap-3 p-2 rounded-lg bg-gray-800/50 hover:bg-gray-800/70 transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"text-blue-400 flex-shrink-0",children:s(e.action)}),n.jsx("span",{className:"text-sm text-gray-300 truncate",children:e.message})]}),n.jsx(Q,{size:"sm",variant:"outline",className:"flex-shrink-0 text-xs h-7 px-3 border-blue-500/50 text-blue-400 hover:bg-blue-500/10 hover:text-blue-300",onClick:()=>i(e),children:"Apply"})]},t))})})]})},co=/https?:\/\/[^\s<>"{}|\\^`[\]]+/gi;const uo=({inputMessage:e,onInputChange:t,onSendMessage:a,onKeyPress:r,onFileUpload:i,isTyping:s,tripMembers:o=[],hidePayments:l=!1,isInChannelMode:c=!1,isPro:d=!1,tripId:u,onTypingChange:m})=>{const[p,h]=L.useState(!1),[g,f]=L.useState(!1),[x,v]=L.useState(!1),[y,b]=L.useState(!1),w=L.useRef(null),j=L.useRef(null),{shareFile:N,shareLink:_,shareMultipleFiles:k,isUploading:S,uploadProgress:C,parsedContent:E,clearParsedContent:D}=io(u),{uploadFiles:P,uploadQueue:A,isUploading:T,clearQueue:M}=oo({tripId:u,onComplete:e=>{},onError:(e,t)=>{ee.error(`Failed to upload ${t}: ${e.message}`)}});L.useEffect(()=>{if(m){const t=e.trim().length>0;m(t)}},[e,m]);const R=async()=>{if(!g){null==m||m(!1);const n=function(e){const t=e.match(co);return t?t[0]:null}(e);let r=null;if(n){b(!0);try{const e=await to(n);e&&!e.error&&(r={url:n,title:e.title,description:e.description,image:e.image,domain:new URL(n).hostname.replace("www.","")})}catch(t){}finally{b(!1)}}a(p,!1,void 0,r)}},I=async e=>{if(!w.current)return;w.current.accept={image:"image/*",video:"video/*",document:".pdf,.doc,.docx,.txt,.xlsx,.pptx"}[e],w.current.onchange=async t=>{const n=t.target.files;n&&n.length>0&&(await P(n),await k(n,e),i&&i(n,e))},w.current.click()};return n.jsxs("div",{className:"space-y-2",children:[E&&n.jsx(lo,{parsedContent:E,tripId:u,onDismiss:D,onSuggestionApplied:D}),g&&n.jsx(ps,{onSubmit:e=>{a(!1,!0,e),f(!1)},tripMembers:o,isVisible:g,tripId:u}),!g&&n.jsxs("div",{ref:j,className:G("chat-composer flex items-center gap-2 px-3 py-2 bg-neutral-950/90 backdrop-blur-md sticky bottom-0 relative transition-all duration-200 w-full rounded-xl border border-white/10",x&&"ring-2 ring-primary ring-offset-2 ring-offset-background"),style:{paddingBottom:"env(safe-area-inset-bottom)"},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),v(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),j.current&&!j.current.contains(e.relatedTarget)&&v(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:async e=>{e.preventDefault(),e.stopPropagation(),v(!1);const t=e.dataTransfer.files;if(t&&t.length>0){await P(t);const e=t[0],n=e.type.startsWith("image/"),a=e.type.startsWith("video/"),r=n?"image":a?"video":"document";await k(t,r),i&&i(t,r)}},children:[x&&n.jsxs("div",{className:"absolute inset-0 z-20 bg-primary/10 border-2 border-dashed border-primary rounded-xl flex flex-col items-center justify-center gap-3 backdrop-blur-sm",children:[n.jsx(pn,{className:"w-8 h-8 text-primary animate-bounce"}),n.jsx("p",{className:"text-primary font-medium text-sm",children:"Drop files here"}),n.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(fn,{className:"w-4 h-4"})," Photos"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(ca,{className:"w-4 h-4"})," Videos"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(la,{className:"w-4 h-4"})," Documents"]})]})]}),n.jsxs(tt,{children:[n.jsx(nt,{asChild:!0,children:n.jsx("button",{className:"flex items-center justify-center w-9 h-9 rounded-full bg-neutral-900 hover:bg-neutral-800 transition-all","aria-label":"Message options",children:n.jsx(vn,{className:"w-5 h-5 text-neutral-300"})})}),n.jsxs(at,{side:"top",align:"start",sideOffset:8,className:"w-52 p-1 bg-neutral-900/95 backdrop-blur-lg border border-neutral-800 rounded-xl shadow-lg animate-slide-in-right z-50",children:[n.jsxs(rt,{onClick:()=>h(!p),className:"flex items-center gap-2 px-3 py-2 border border-orange-500/60 text-orange-400 font-medium hover:bg-orange-500/10 rounded-lg mb-1 cursor-pointer",children:[n.jsx(Me,{className:"w-4 h-4"}),"Broadcast"]}),n.jsxs(rt,{onClick:()=>I("document"),className:"flex items-center gap-2 px-3 py-2 text-neutral-300 hover:bg-neutral-800 rounded-lg cursor-pointer",children:[n.jsx(Re,{className:"w-4 h-4"}),"File"]}),n.jsxs(rt,{onClick:async()=>{const e=prompt("Paste the link you want to share:");if(e&&e.trim())try{await _(e.trim())}catch(t){}},className:"flex items-center gap-2 px-3 py-2 text-neutral-300 hover:bg-neutral-800 rounded-lg cursor-pointer",children:[n.jsx(ga,{className:"w-4 h-4"}),"Link"]}),n.jsxs(rt,{onClick:()=>I("image"),className:"flex items-center gap-2 px-3 py-2 text-neutral-300 hover:bg-neutral-800 rounded-lg cursor-pointer",children:[n.jsx(yn,{className:"w-4 h-4"}),"Photo"]}),n.jsxs(rt,{onClick:()=>I("video"),className:"flex items-center gap-2 px-3 py-2 text-neutral-300 hover:bg-neutral-800 rounded-lg cursor-pointer",children:[n.jsx(_a,{className:"w-4 h-4"}),"Video"]})]})]}),n.jsx("textarea",{value:e,onChange:e=>t(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey?r(e):(e.preventDefault(),R())},placeholder:p?"Send an announcement...":"Type a messageâ€¦",rows:1,className:G("flex-1 min-h-[44px] sm:min-h-[48px] px-4 py-2 rounded-full resize-none focus:outline-none focus-visible:ring-2 transition-all",p?"bg-white/5 border border-orange-500/50 focus-visible:ring-orange-500/40 backdrop-blur-sm text-white placeholder-red-800/80":"bg-white/5 border border-white/10 focus-visible:ring-blue-500/40 backdrop-blur-sm text-white placeholder-neutral-400")}),n.jsx("button",{onClick:R,disabled:!e.trim()&&!T&&!S||s||y,className:G("size-10 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",p?"bg-gradient-to-r from-orange-600 to-red-600 hover:opacity-90":"bg-gradient-to-r from-indigo-600 to-purple-600 hover:opacity-90"),children:y?n.jsx(bn,{size:18,className:"text-white animate-spin"}):n.jsx(wa,{size:18,className:"text-white"})}),n.jsx("input",{ref:w,type:"file",className:"hidden",multiple:!0})]}),p&&!g&&n.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-orange-500/10 border-t border-orange-500/30",children:[n.jsxs("span",{className:"text-xs text-orange-400 flex items-center gap-2",children:[n.jsx(Me,{size:14}),"Broadcasting to all members"]}),n.jsx("button",{onClick:()=>h(!1),className:"text-xs text-orange-400 hover:text-orange-300 underline",children:"Cancel"})]}),Object.values(C).length>0&&n.jsx("div",{className:"space-y-2 px-3",children:Object.values(C).map(e=>n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx("div",{className:"flex-1 bg-neutral-700 rounded-full h-2 overflow-hidden",children:n.jsx("div",{className:G("h-full transition-all duration-300","completed"===e.status?"bg-green-500":"error"===e.status?"bg-red-500":"bg-blue-500"),style:{width:`${e.progress}%`}})}),n.jsx("span",{className:"text-neutral-400 text-xs truncate max-w-[150px]",children:e.fileName}),"completed"===e.status&&n.jsx("span",{className:"text-green-500 text-xs",children:"âœ“"}),"error"===e.status&&n.jsx("span",{className:"text-red-500 text-xs",children:"âœ—"})]},e.fileId))}),A.length>0&&n.jsx("div",{className:"space-y-2 px-4 py-3 bg-background/50 backdrop-blur-sm rounded-lg border border-white/10",children:A.map(e=>n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"flex-1 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs",children:[n.jsx("span",{className:"text-foreground/80 truncate max-w-[200px]",children:e.fileName}),n.jsxs("span",{className:"text-foreground/60",children:[e.progress,"%"]})]}),n.jsx(un,{value:e.progress,className:"h-1.5"})]}),"complete"===e.status&&n.jsx("span",{className:"text-green-500 text-sm",children:"âœ“"}),"error"===e.status&&n.jsx("span",{className:"text-red-500 text-sm",children:"âœ—"}),"uploading"===e.status&&n.jsx(bn,{className:"w-4 h-4 animate-spin text-primary"})]},e.fileId))})]})},mo=({replyTo:e,onRemoveReply:t,onCancel:a})=>e?n.jsx("div",{className:"bg-background/50 border-l-2 border-primary p-2 mb-2 rounded-r-lg",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("p",{className:"text-xs text-muted-foreground mb-1",children:["Replying to ",e.senderName]}),n.jsx("p",{className:"text-sm text-foreground/80 truncate",children:e.text})]}),(t||a)&&n.jsx("button",{onClick:t||a,className:"text-muted-foreground hover:text-foreground ml-2 transition-colors",children:"Ã—"})]})}):null,po=({isLoading:e,hasMore:t,localHasMore:a=!1,messageCount:r})=>{const i=t||a;return e?n.jsxs("div",{className:"flex items-center justify-center py-4",children:[n.jsx(bn,{className:"animate-spin h-5 w-5 text-primary mr-2"}),n.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading messages..."})]}):i&&r>0?n.jsx("div",{className:"text-center py-3 px-4",children:n.jsx("div",{className:"text-xs text-muted-foreground",children:"â†‘ Scroll up to load older messages"})}):!i&&r>0?n.jsx("div",{className:"text-center py-3 px-4",children:n.jsx("div",{className:"inline-block px-4 py-2 rounded-full bg-muted/50 text-muted-foreground text-xs",children:"Beginning of conversation"})}):null},ho=({date:e})=>{return n.jsx("div",{className:"flex items-center justify-center py-3",children:n.jsx("div",{className:"px-3 py-1 rounded-full bg-white/10 backdrop-blur-sm",children:n.jsx("span",{className:"text-xs md:text-sm text-white/60 font-medium",children:(t=e,wn(t)?"Today":jn(t)?"Yesterday":Nn(t,"MMMM d, yyyy"))})})});var t};var go,fo,xo,vo;(fo=go||(go={})).Heavy="HEAVY",fo.Medium="MEDIUM",fo.Light="LIGHT",(vo=xo||(xo={})).Success="SUCCESS",vo.Warning="WARNING",vo.Error="ERROR";const yo=re("Haptics",{web:()=>cn(()=>import("./web-BP8eFM4W-mjd3dogn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54])).then(e=>new e.HapticsWeb)});const bo=new class{constructor(){t(this,"isCapacitorAvailable",!1),this.isCapacitorAvailable=!!window.Capacitor}async light(){if(this.isCapacitorAvailable)try{await yo.impact({style:go.Light})}catch(e){}}async medium(){if(this.isCapacitorAvailable)try{await yo.impact({style:go.Medium})}catch(e){}}async heavy(){if(this.isCapacitorAvailable)try{await yo.impact({style:go.Heavy})}catch(e){}}async success(){if(this.isCapacitorAvailable)try{await yo.impact({style:go.Light}),setTimeout(()=>yo.impact({style:go.Light}),100)}catch(e){}}async celebration(){if(this.isCapacitorAvailable)try{await yo.impact({style:go.Medium}),setTimeout(()=>yo.impact({style:go.Light}),150),setTimeout(()=>yo.impact({style:go.Light}),250)}catch(e){}}},wo=({messages:e,renderMessage:t,onLoadMore:a,hasMore:r,isLoading:i,initialVisibleCount:s=10,loadMoreThreshold:o=3,className:l="",style:c,autoScroll:d=!0,restoreScroll:u=!0,scrollKey:m="chat-scroll"})=>{const p=L.useRef(null),h=L.useRef(null),[g,f]=L.useState(!1),[x,v]=L.useState(!1),y=L.useRef(e.length),b=L.useRef(!1),w=L.useRef(0),[j,N]=L.useState(Math.max(0,e.length-s)),_=e.slice(j),k=j>0;L.useEffect(()=>{if(!d)return;if(!p.current)return;if(e.length>y.current){!g&&setTimeout(()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"})},100)}},[e.length,d,g]),L.useEffect(()=>{if(!u)return;const e=p.current;if(!e)return;const t=localStorage.getItem(m);t?e.scrollTop=parseInt(t,10):setTimeout(()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"auto"})},100)},[m,u]),L.useEffect(()=>{if(!u)return;const e=p.current;if(!e)return;const t=()=>{e&&localStorage.setItem(m,e.scrollTop.toString())};let n;const a=()=>{clearTimeout(n),n=setTimeout(t,500)};return e.addEventListener("scroll",a,{passive:!0}),()=>{clearTimeout(n),t(),e.removeEventListener("scroll",a)}},[m,u]),L.useEffect(()=>{const t=e.length,n=y.current;t>n?g?v(!0):(N(Math.max(0,t-s)),v(!1)):t<n&&N(Math.max(0,t-s)),y.current=t},[e.length,g,s]);const S=L.useCallback(()=>{if(!p.current)return;const{scrollTop:e,scrollHeight:t,clientHeight:n}=p.current,i=t-e-n>100;if(f(i),i||v(!1),e<200&&!b.current)if(k){b.current=!0;const t=p.current.scrollHeight;w.current=t,N(e=>Math.max(0,e-20)),setTimeout(()=>{if(p.current){const n=p.current.scrollHeight-t;p.current.scrollTop=e+n}b.current=!1},50),bo.light()}else r&&(b.current=!0,bo.light(),a(),setTimeout(()=>{b.current=!1},1e3))},[r,a,k,20]);return n.jsxs("div",{className:"relative flex-1 flex flex-col min-h-0",children:[n.jsxs("div",{ref:p,onScroll:S,className:`flex-1 overflow-y-auto scroll-smooth ${l}`,style:{WebkitOverflowScrolling:"touch",...c},children:[n.jsx(po,{isLoading:i,hasMore:r,localHasMore:k,messageCount:e.length}),n.jsxs("div",{className:"space-y-2 p-3",children:[_.map((e,a)=>{const r=new Date(e.created_at||e.createdAt),i=_[a-1],s=i?new Date(i.created_at||i.createdAt):null,o=!s||!_n(r,s);return n.jsxs($.Fragment,{children:[o&&n.jsx(ho,{date:r}),t(e,a)]},e.id)}),n.jsx("div",{ref:h})]})]}),x&&n.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-10",children:n.jsx("button",{onClick:()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"}),v(!1),f(!1)},className:"bg-primary text-primary-foreground px-4 py-2 rounded-full shadow-lg hover:bg-primary/90 transition-all animate-bounce text-sm font-medium",children:"â†“ New messages"})})]})},jo=[{id:"like",emoji:"ðŸ‘",label:"Like"},{id:"love",emoji:"â¤ï¸",label:"Love"},{id:"dislike",emoji:"ðŸ‘Ž",label:"Dislike"},{id:"question",emoji:"â“",label:"Question"}],No=({messageId:e,reactions:t={},onReaction:a,onReactMessage:r,className:i=""})=>n.jsx("div",{className:`flex items-center gap-1 mt-1 ${i}`,children:jo.map(i=>{const s=t[i.id],o=(null==s?void 0:s.count)||0,l=(null==s?void 0:s.userReacted)||!1;return n.jsxs(Q,{variant:"ghost",size:"sm",onClick:()=>{a&&e?a(e,i.id):r&&r(i.id)},className:"h-6 px-2 py-1 text-xs rounded-full bg-background/20 backdrop-blur-sm border border-border/30 hover:bg-background/40 transition-all duration-200 "+(l?"bg-primary/20 border-primary/50 text-primary":"text-muted-foreground hover:text-foreground"),title:i.label,children:[n.jsx("span",{className:"text-sm mr-1",children:i.emoji}),o>0&&n.jsx("span",{className:"text-xs font-medium",children:o})]},i.id)})}),_o=({messageId:e,messageContent:t,messageType:a,isOwnMessage:r,isDeleted:i=!1,onEdit:s,onDelete:o})=>{const[l,c]=L.useState(!1),[d,u]=L.useState(!1),[m,p]=L.useState(t),[h,g]=L.useState(!1);if(!r||i)return null;return n.jsxs(n.Fragment,{children:[n.jsxs(tt,{children:[n.jsx(nt,{asChild:!0,children:n.jsx(Q,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(mn,{className:"h-4 w-4"})})}),n.jsxs(at,{align:"end",className:"w-40",children:[n.jsxs(rt,{onClick:()=>{p(t),c(!0)},children:[n.jsx(xt,{className:"mr-2 h-4 w-4"}),"Edit"]}),n.jsxs(rt,{onClick:()=>u(!0),className:"text-red-600 focus:text-red-600",children:[n.jsx(ie,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}),n.jsx(Ot,{open:l,onOpenChange:c,children:n.jsxs(Lt,{className:"bg-gray-900 border-white/10",children:[n.jsx(Ft,{children:n.jsx(Ut,{className:"text-white",children:"Edit Message"})}),n.jsxs("div",{className:"space-y-4",children:[n.jsx(xn,{value:m,onChange:e=>p(e.target.value),placeholder:"Edit your message...",className:"bg-gray-800 border-white/10 text-white min-h-[100px]",disabled:h}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(Q,{variant:"ghost",onClick:()=>c(!1),disabled:h,children:"Cancel"}),n.jsx(Q,{onClick:async()=>{if(m.trim())if(m!==t){g(!0);try{("channel"===a?await se(e,m):await oe(e,m))?(ee.success("Message edited"),c(!1),null==s||s(e,m)):ee.error("Failed to edit message")}catch(n){ee.error("Failed to edit message")}finally{g(!1)}}else c(!1);else ee.error("Message cannot be empty")},disabled:h||!m.trim(),children:h?"Saving...":"Save"})]})]})]})}),n.jsx(vt,{open:d,onOpenChange:u,children:n.jsxs(yt,{className:"bg-gray-900 border-white/10",children:[n.jsxs(bt,{children:[n.jsx(wt,{className:"text-white",children:"Delete Message"}),n.jsx(jt,{className:"text-gray-400",children:"Are you sure you want to delete this message? This action cannot be undone."})]}),n.jsxs(Nt,{children:[n.jsx(_t,{disabled:h,children:"Cancel"}),n.jsx(kt,{onClick:async()=>{g(!0);try{("channel"===a?await le(e):await ce(e))?(ee.success("Message deleted"),u(!1),null==o||o(e)):ee.error("Failed to delete message")}catch(t){ee.error("Failed to delete message")}finally{g(!1)}},disabled:h,className:"bg-red-600 hover:bg-red-700",children:h?"Deleting...":"Delete"})]})]})})]})},ko=({widgetToken:e,height:t=300})=>{const a=L.useRef(null);return L.useEffect(()=>{const n=Tn();if(!n)return void(a.current&&(a.current.innerHTML='\n          <div class="flex items-center justify-center h-full text-gray-400 text-sm">\n            <div class="text-center">\n              <p>ðŸ—ºï¸ Google Maps configuration error</p>\n              <p class="text-xs mt-1">API key not available</p>\n            </div>\n          </div>\n        '));const r=document.createElement("script");r.src=`https://maps.googleapis.com/maps/api/js?key=${n}&libraries=extended&loading=async`,r.async=!0;const i=()=>{if(a.current&&!a.current.querySelector("gmp-place-contextual"))try{const n=document.createElement("gmp-place-contextual");n.setAttribute("context-token",e),n.style.width="100%",n.style.height=`${t}px`,n.addEventListener("error",e=>{a.current&&(a.current.innerHTML='\n                <div class="flex items-center justify-center h-full text-gray-400 text-sm">\n                  <div class="text-center">\n                    <p>âš ï¸ Map temporarily unavailable</p>\n                    <p class="text-xs mt-1">Retry in a moment</p>\n                  </div>\n                </div>\n              ')}),a.current.appendChild(n)}catch(n){a.current&&(a.current.innerHTML='\n              <div class="flex items-center justify-center h-full text-gray-400 text-sm">\n                <p>âš ï¸ Map loading failed</p>\n              </div>\n            ')}};r.onload=i,r.onerror=e=>{a.current&&(a.current.innerHTML='\n          <div class="flex items-center justify-center h-full text-gray-400 text-sm">\n            <div class="text-center">\n              <p>âš ï¸ Google Maps script blocked</p>\n              <p class="text-xs mt-1">Check API key domain restrictions</p>\n            </div>\n          </div>\n        ')};return document.querySelector('script[src*="maps.googleapis.com"]')?i():document.head.appendChild(r),()=>{if(document.head.contains(r)){document.querySelectorAll("gmp-place-contextual").length<=1&&document.head.removeChild(r)}}},[e,t]),n.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl overflow-hidden my-3",children:[n.jsxs("div",{className:"bg-white/10 px-3 py-2 flex items-center gap-2 border-b border-white/10",children:[n.jsx(Un,{size:16,className:"text-blue-400"}),n.jsx("span",{className:"text-sm font-medium text-white",children:"Google Maps"}),n.jsxs("div",{className:"ml-auto text-xs text-gray-400 flex items-center gap-1",children:[n.jsx(zn,{size:12}),"Verified by Google"]})]}),n.jsx("div",{ref:a,style:{height:`${t}px`,minHeight:"200px"}})]})},So=({citation:e,index:t})=>{const a=Ie(),r="google_maps_grounding"===e.source,i=e.thumbnailUrl||(e.coordinates?((e,t=120,n=80,a=15)=>{const r=Tn();return r?`https://maps.googleapis.com/maps/api/staticmap?center=${e.lat},${e.lng}&zoom=${a}&size=${t}x${n}&markers=color:red%7C${e.lat},${e.lng}&key=${r}&style=feature:poi|visibility:off`:""})(e.coordinates,100,80):null);return n.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:G("block bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg transition-all duration-200 hover:scale-[1.02]",a?"p-2":"p-3"),children:n.jsxs("div",{className:"flex gap-3",children:[i&&n.jsx("div",{className:"flex-shrink-0",children:n.jsx("img",{src:i,alt:e.title,className:G("rounded object-cover border border-white/10",a?"w-16 h-12":"w-24 h-18")})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[n.jsx("h4",{className:G("font-semibold text-white line-clamp-1",a?"text-xs":"text-sm"),children:e.title}),r&&n.jsxs("span",{className:G("flex items-center gap-1 bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded whitespace-nowrap flex-shrink-0",a?"text-[9px]":"text-[10px]"),children:[n.jsx($n,{size:a?10:12}),"Verified"]})]}),(e.distanceFromBasecamp||e.placeType)&&n.jsxs("div",{className:G("flex items-center gap-2 mb-1 text-gray-400",a?"text-[10px]":"text-xs"),children:[e.distanceFromBasecamp&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Un,{size:a?10:12,className:"text-green-400"}),e.distanceFromBasecamp.value.toFixed(1)," ",e.distanceFromBasecamp.unit," away"]}),e.placeType&&n.jsxs("span",{className:"capitalize",children:["â€¢ ",e.placeType]})]}),n.jsx("p",{className:G("text-gray-300 line-clamp-2",a?"text-[10px]":"text-xs"),children:e.snippet}),n.jsxs("div",{className:G("flex items-center gap-1 text-blue-400 mt-1",a?"text-[9px]":"text-[10px]"),children:[n.jsx(zn,{size:a?8:10}),n.jsx("span",{children:"Open in Google Maps"})]})]})]})})},Co=L.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),Eo=L.createContext({}),Do=L.createContext(null),Po="undefined"!=typeof document,Ao=Po?L.useLayoutEffect:L.useEffect,To=L.createContext({strict:!1}),Mo=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Ro="data-"+Mo("framerAppearId");function Io(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Oo(e){return"string"==typeof e||Array.isArray(e)}function Lo(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const Fo=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Uo=["initial",...Fo];function zo(e){return Lo(e.animate)||Uo.some(t=>Oo(e[t]))}function $o(e){return Boolean(zo(e)||e.variants)}function Bo(e){const{initial:t,animate:n}=function(e,t){if(zo(e)){const{initial:t,animate:n}=e;return{initial:!1===t||Oo(t)?t:void 0,animate:Oo(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,L.useContext(Eo));return L.useMemo(()=>({initial:t,animate:n}),[qo(t),qo(n)])}function qo(e){return Array.isArray(e)?e.join(" "):e}const Vo={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Ho={};for(const wN in Vo)Ho[wN]={isEnabled:e=>Vo[wN].some(t=>!!e[t])};const Wo=L.createContext({}),Yo=L.createContext({}),Ko=Symbol.for("motionComponentSymbol");function Go({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:a,Component:r}){e&&function(e){for(const t in e)Ho[t]={...Ho[t],...e[t]}}(e);const i=L.forwardRef(function(i,s){let o;const l={...L.useContext(Co),...i,layoutId:Qo(i)},{isStatic:c}=l,d=Bo(i),u=a(i,c);if(!c&&Po){d.visualElement=function(e,t,n,a){const{visualElement:r}=L.useContext(Eo),i=L.useContext(To),s=L.useContext(Do),o=L.useContext(Co).reducedMotion,l=L.useRef();a=a||i.renderer,!l.current&&a&&(l.current=a(e,{visualState:t,parent:r,props:n,presenceContext:s,blockInitialAnimation:!!s&&!1===s.initial,reducedMotionConfig:o}));const c=l.current;L.useInsertionEffect(()=>{c&&c.update(n,s)});const d=L.useRef(Boolean(n[Ro]&&!window.HandoffComplete));return Ao(()=>{c&&(c.render(),d.current&&c.animationState&&c.animationState.animateChanges())}),L.useEffect(()=>{c&&(c.updateFeatures(),!d.current&&c.animationState&&c.animationState.animateChanges(),d.current&&(d.current=!1,window.HandoffComplete=!0))}),c}(r,u,l,t);const n=L.useContext(Yo),a=L.useContext(To).strict;d.visualElement&&(o=d.visualElement.loadFeatures(l,a,e,n))}return L.createElement(Eo.Provider,{value:d},o&&d.visualElement?L.createElement(o,{visualElement:d.visualElement,...l}):null,n(r,i,function(e,t,n){return L.useCallback(a=>{a&&e.mount&&e.mount(a),t&&(a?t.mount(a):t.unmount()),n&&("function"==typeof n?n(a):Io(n)&&(n.current=a))},[t])}(u,d.visualElement,s),u,c,d.visualElement))});return i[Ko]=r,i}function Qo({layoutId:e}){const t=L.useContext(Wo).id;return t&&void 0!==e?t+"-"+e:e}function Xo(e){function t(t,n={}){return Go(e(t,n))}if("undefined"==typeof Proxy)return t;const n=new Map;return new Proxy(t,{get:(e,a)=>(n.has(a)||n.set(a,t(a)),n.get(a))})}const Zo=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Jo(e){return"string"==typeof e&&!e.includes("-")&&!!(Zo.indexOf(e)>-1||/[A-Z]/.test(e))}const el={};const tl=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],nl=new Set(tl);function al(e,{layout:t,layoutId:n}){return nl.has(e)||e.startsWith("origin")||(t||void 0!==n)&&(!!el[e]||"opacity"===e)}const rl=e=>Boolean(e&&e.getVelocity),il={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},sl=tl.length;const ol=e=>t=>"string"==typeof t&&t.startsWith(e),ll=ol("--"),cl=ol("var(--"),dl=(e,t)=>t&&"number"==typeof e?t.transform(e):e,ul=(e,t,n)=>Math.min(Math.max(n,e),t),ml={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},pl={...ml,transform:e=>ul(0,1,e)},hl={...ml,default:1},gl=e=>Math.round(1e5*e)/1e5,fl=/(-)?([\d]*\.?[\d])+/g,xl=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,vl=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function yl(e){return"string"==typeof e}const bl=e=>({test:t=>yl(t)&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),wl=bl("deg"),jl=bl("%"),Nl=bl("px"),_l=bl("vh"),kl=bl("vw"),Sl={...jl,parse:e=>jl.parse(e)/100,transform:e=>jl.transform(100*e)},Cl={...ml,transform:Math.round},El={borderWidth:Nl,borderTopWidth:Nl,borderRightWidth:Nl,borderBottomWidth:Nl,borderLeftWidth:Nl,borderRadius:Nl,radius:Nl,borderTopLeftRadius:Nl,borderTopRightRadius:Nl,borderBottomRightRadius:Nl,borderBottomLeftRadius:Nl,width:Nl,maxWidth:Nl,height:Nl,maxHeight:Nl,size:Nl,top:Nl,right:Nl,bottom:Nl,left:Nl,padding:Nl,paddingTop:Nl,paddingRight:Nl,paddingBottom:Nl,paddingLeft:Nl,margin:Nl,marginTop:Nl,marginRight:Nl,marginBottom:Nl,marginLeft:Nl,rotate:wl,rotateX:wl,rotateY:wl,rotateZ:wl,scale:hl,scaleX:hl,scaleY:hl,scaleZ:hl,skew:wl,skewX:wl,skewY:wl,distance:Nl,translateX:Nl,translateY:Nl,translateZ:Nl,x:Nl,y:Nl,z:Nl,perspective:Nl,transformPerspective:Nl,opacity:pl,originX:Sl,originY:Sl,originZ:Nl,zIndex:Cl,fillOpacity:pl,strokeOpacity:pl,numOctaves:Cl};function Dl(e,t,n,a){const{style:r,vars:i,transform:s,transformOrigin:o}=e;let l=!1,c=!1,d=!0;for(const u in t){const e=t[u];if(ll(u)){i[u]=e;continue}const n=El[u],a=dl(e,n);if(nl.has(u)){if(l=!0,s[u]=a,!d)continue;e!==(n.default||0)&&(d=!1)}else u.startsWith("origin")?(c=!0,o[u]=a):r[u]=a}if(t.transform||(l||a?r.transform=function(e,{enableHardwareAcceleration:t=!0,allowTransformNone:n=!0},a,r){let i="";for(let s=0;s<sl;s++){const t=tl[s];void 0!==e[t]&&(i+=`${il[t]||t}(${e[t]}) `)}return t&&!e.z&&(i+="translateZ(0)"),i=i.trim(),r?i=r(e,a?"":i):n&&a&&(i="none"),i}(e.transform,n,d,a):r.transform&&(r.transform="none")),c){const{originX:e="50%",originY:t="50%",originZ:n=0}=o;r.transformOrigin=`${e} ${t} ${n}`}}const Pl=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Al(e,t,n){for(const a in t)rl(t[a])||al(a,n)||(e[a]=t[a])}function Tl(e,t,n){const a={};return Al(a,e.style||{},e),Object.assign(a,function({transformTemplate:e},t,n){return L.useMemo(()=>{const a={style:{},transform:{},transformOrigin:{},vars:{}};return Dl(a,t,{enableHardwareAcceleration:!n},e),Object.assign({},a.vars,a.style)},[t])}(e,t,n)),e.transformValues?e.transformValues(a):a}function Ml(e,t,n){const a={},r=Tl(e,t,n);return e.drag&&!1!==e.dragListener&&(a.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(a.tabIndex=0),a.style=r,a}const Rl=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Il(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Rl.has(e)}let Ol=e=>!Il(e);try{(Ll=require("@emotion/is-prop-valid").default)&&(Ol=e=>e.startsWith("on")?!Il(e):Ll(e))}catch(bN){}var Ll;function Fl(e,t,n){return"string"==typeof e?e:Nl.transform(t+n*e)}const Ul={offset:"stroke-dashoffset",array:"stroke-dasharray"},zl={offset:"strokeDashoffset",array:"strokeDasharray"};function $l(e,{attrX:t,attrY:n,attrScale:a,originX:r,originY:i,pathLength:s,pathSpacing:o=1,pathOffset:l=0,...c},d,u,m){if(Dl(e,c,d,m),u)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:p,style:h,dimensions:g}=e;p.transform&&(g&&(h.transform=p.transform),delete p.transform),g&&(void 0!==r||void 0!==i||h.transform)&&(h.transformOrigin=function(e,t,n){return`${Fl(t,e.x,e.width)} ${Fl(n,e.y,e.height)}`}(g,void 0!==r?r:.5,void 0!==i?i:.5)),void 0!==t&&(p.x=t),void 0!==n&&(p.y=n),void 0!==a&&(p.scale=a),void 0!==s&&function(e,t,n=1,a=0,r=!0){e.pathLength=1;const i=r?Ul:zl;e[i.offset]=Nl.transform(-a);const s=Nl.transform(t),o=Nl.transform(n);e[i.array]=`${s} ${o}`}(p,s,o,l,!1)}const Bl=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),ql=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Vl(e,t,n,a){const r=L.useMemo(()=>{const n={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return $l(n,t,{enableHardwareAcceleration:!1},ql(a),e.transformTemplate),{...n.attrs,style:{...n.style}}},[t]);if(e.style){const t={};Al(t,e.style,e),r.style={...t,...r.style}}return r}function Hl(e=!1){return(t,n,a,{latestValues:r},i)=>{const s=(Jo(t)?Vl:Ml)(n,r,i,t),o=function(e,t,n){const a={};for(const r in e)"values"===r&&"object"==typeof e.values||(Ol(r)||!0===n&&Il(r)||!t&&!Il(r)||e.draggable&&r.startsWith("onDrag"))&&(a[r]=e[r]);return a}(n,"string"==typeof t,e),l={...o,...s,ref:a},{children:c}=n,d=L.useMemo(()=>rl(c)?c.get():c,[c]);return L.createElement(t,{...l,children:d})}}function Wl(e,{style:t,vars:n},a,r){Object.assign(e.style,t,r&&r.getProjectionStyles(a));for(const i in n)e.style.setProperty(i,n[i])}const Yl=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Kl(e,t,n,a){Wl(e,t,void 0,a);for(const r in t.attrs)e.setAttribute(Yl.has(r)?r:Mo(r),t.attrs[r])}function Gl(e,t){const{style:n}=e,a={};for(const r in n)(rl(n[r])||t.style&&rl(t.style[r])||al(r,e))&&(a[r]=n[r]);return a}function Ql(e,t){const n=Gl(e,t);for(const a in e)if(rl(e[a])||rl(t[a])){n[-1!==tl.indexOf(a)?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a]=e[a]}return n}function Xl(e,t,n,a={},r={}){return"function"==typeof t&&(t=t(void 0!==n?n:e.custom,a,r)),"string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t&&(t=t(void 0!==n?n:e.custom,a,r)),t}function Zl(e){const t=L.useRef(null);return null===t.current&&(t.current=e()),t.current}const Jl=e=>Array.isArray(e),ec=e=>Jl(e)?e[e.length-1]||0:e;function tc(e){const t=rl(e)?e.get():e;return n=t,Boolean(n&&"object"==typeof n&&n.mix&&n.toValue)?t.toValue():t;var n}const nc=e=>(t,n)=>{const a=L.useContext(Eo),r=L.useContext(Do),i=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:n},a,r,i){const s={latestValues:ac(a,r,i,e),renderState:t()};return n&&(s.mount=e=>n(a,e,s)),s}(e,t,a,r);return n?i():Zl(i)};function ac(e,t,n,a){const r={},i=a(e,{});for(const m in i)r[m]=tc(i[m]);let{initial:s,animate:o}=e;const l=zo(e),c=$o(e);t&&c&&!l&&!1!==e.inherit&&(void 0===s&&(s=t.initial),void 0===o&&(o=t.animate));let d=!!n&&!1===n.initial;d=d||!1===s;const u=d?o:s;if(u&&"boolean"!=typeof u&&!Lo(u)){(Array.isArray(u)?u:[u]).forEach(t=>{const n=Xl(e,t);if(!n)return;const{transitionEnd:a,transition:i,...s}=n;for(const e in s){let t=s[e];if(Array.isArray(t)){t=t[d?t.length-1:0]}null!==t&&(r[e]=t)}for(const e in a)r[e]=a[e]})}return r}const rc=e=>e;class ic{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);-1!==t&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}const sc=["prepare","read","update","preRender","render","postRender"];const{schedule:oc,cancel:lc,state:cc,steps:dc}=function(e,t){let n=!1,a=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=sc.reduce((e,t)=>(e[t]=function(e){let t=new ic,n=new ic,a=0,r=!1,i=!1;const s=new WeakSet,o={schedule:(e,i=!1,o=!1)=>{const l=o&&r,c=l?t:n;return i&&s.add(e),c.add(e)&&l&&r&&(a=t.order.length),e},cancel:e=>{n.remove(e),s.delete(e)},process:l=>{if(r)i=!0;else{if(r=!0,[t,n]=[n,t],n.clear(),a=t.order.length,a)for(let n=0;n<a;n++){const a=t.order[n];a(l),s.has(a)&&(o.schedule(a),e())}r=!1,i&&(i=!1,o.process(l))}}};return o}(()=>n=!0),e),{}),s=e=>i[e].process(r),o=()=>{const i=performance.now();n=!1,r.delta=a?1e3/60:Math.max(Math.min(i-r.timestamp,40),1),r.timestamp=i,r.isProcessing=!0,sc.forEach(s),r.isProcessing=!1,n&&t&&(a=!1,e(o))};return{schedule:sc.reduce((t,s)=>{const l=i[s];return t[s]=(t,i=!1,s=!1)=>(n||(n=!0,a=!0,r.isProcessing||e(o)),l.schedule(t,i,s)),t},{}),cancel:e=>sc.forEach(t=>i[t].cancel(e)),state:r,steps:i}}("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:rc,!0),uc={useVisualState:nc({scrapeMotionValuesFromProps:Ql,createRenderState:Bl,onMount:(e,t,{renderState:n,latestValues:a})=>{oc.read(()=>{try{n.dimensions="function"==typeof t.getBBox?t.getBBox():t.getBoundingClientRect()}catch(ws){n.dimensions={x:0,y:0,width:0,height:0}}}),oc.render(()=>{$l(n,a,{enableHardwareAcceleration:!1},ql(t.tagName),e.transformTemplate),Kl(t,n)})}})},mc={useVisualState:nc({scrapeMotionValuesFromProps:Gl,createRenderState:Pl})};function pc(e,t,n,a={passive:!0}){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n)}const hc=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function gc(e,t="page"){return{point:{x:e[t+"X"],y:e[t+"Y"]}}}function fc(e,t,n,a){return pc(e,t,(e=>t=>hc(t)&&e(t,gc(t)))(n),a)}const xc=(e,t)=>n=>t(e(n)),vc=(...e)=>e.reduce(xc);function yc(e){let t=null;return()=>{const n=()=>{t=null};return null===t&&(t=e,n)}}const bc=yc("dragHorizontal"),wc=yc("dragVertical");function jc(e){let t=!1;if("y"===e)t=wc();else if("x"===e)t=bc();else{const e=bc(),n=wc();e&&n?t=()=>{e(),n()}:(e&&e(),n&&n())}return t}function Nc(){const e=jc(!0);return!e||(e(),!1)}class _c{constructor(e){this.isMounted=!1,this.node=e}update(){}}function kc(e,t){const n="pointer"+(t?"enter":"leave"),a="onHover"+(t?"Start":"End");return fc(e.current,n,(n,r)=>{if("touch"===n.pointerType||Nc())return;const i=e.getProps();e.animationState&&i.whileHover&&e.animationState.setActive("whileHover",t),i[a]&&oc.update(()=>i[a](n,r))},{passive:!e.getProps()[a]})}const Sc=(e,t)=>!!t&&(e===t||Sc(e,t.parentElement));function Cc(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,gc(n))}const Ec=new WeakMap,Dc=new WeakMap,Pc=e=>{const t=Ec.get(e.target);t&&t(e)},Ac=e=>{e.forEach(Pc)};function Tc(e,t,n){const a=function({root:e,...t}){const n=e||document;Dc.has(n)||Dc.set(n,{});const a=Dc.get(n),r=JSON.stringify(t);return a[r]||(a[r]=new IntersectionObserver(Ac,{root:e,...t})),a[r]}(t);return Ec.set(e,n),a.observe(e),()=>{Ec.delete(e),a.unobserve(e)}}const Mc={some:0,all:1};const Rc={inView:{Feature:class extends _c{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:a="some",once:r}=e,i={root:t?t.current:void 0,rootMargin:n,threshold:"number"==typeof a?a:Mc[a]};return Tc(this.node.current,i,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:a}=this.node.getProps(),i=t?n:a;i&&i(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends _c{constructor(){super(...arguments),this.removeStartListeners=rc,this.removeEndListeners=rc,this.removeAccessibleListeners=rc,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),a=fc(window,"pointerup",(e,t)=>{if(!this.checkPressEnd())return;const{onTap:n,onTapCancel:a,globalTapTarget:r}=this.node.getProps();oc.update(()=>{r||Sc(this.node.current,e.target)?n&&n(e,t):a&&a(e,t)})},{passive:!(n.onTap||n.onPointerUp)}),r=fc(window,"pointercancel",(e,t)=>this.cancelPress(e,t),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=vc(a,r),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=pc(this.node.current,"keydown",e=>{if("Enter"!==e.key||this.isPressing)return;this.removeEndListeners(),this.removeEndListeners=pc(this.node.current,"keyup",e=>{"Enter"===e.key&&this.checkPressEnd()&&Cc("up",(e,t)=>{const{onTap:n}=this.node.getProps();n&&oc.update(()=>n(e,t))})}),Cc("down",(e,t)=>{this.startPress(e,t)})}),t=pc(this.node.current,"blur",()=>{this.isPressing&&Cc("cancel",(e,t)=>this.cancelPress(e,t))});this.removeAccessibleListeners=vc(e,t)}}startPress(e,t){this.isPressing=!0;const{onTapStart:n,whileTap:a}=this.node.getProps();a&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&oc.update(()=>n(e,t))}checkPressEnd(){this.removeEndListeners(),this.isPressing=!1;return this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!Nc()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&oc.update(()=>n(e,t))}mount(){const e=this.node.getProps(),t=fc(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),n=pc(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=vc(t,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}},focus:{Feature:class extends _c{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(ws){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=vc(pc(this.node.current,"focus",()=>this.onFocus()),pc(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends _c{mount(){this.unmount=vc(kc(this.node,!0),kc(this.node,!1))}unmount(){}}}};function Ic(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let a=0;a<n;a++)if(t[a]!==e[a])return!1;return!0}function Oc(e,t,n){const a=e.getProps();return Xl(a,t,void 0!==n?n:a.custom,function(e){const t={};return e.values.forEach((e,n)=>t[n]=e.get()),t}(e),function(e){const t={};return e.values.forEach((e,n)=>t[n]=e.getVelocity()),t}(e))}let Lc=rc;const Fc=e=>1e3*e,Uc=e=>e/1e3,zc=!1,$c=e=>Array.isArray(e)&&"number"==typeof e[0];function Bc(e){return Boolean(!e||"string"==typeof e&&Vc[e]||$c(e)||Array.isArray(e)&&e.every(Bc))}const qc=([e,t,n,a])=>`cubic-bezier(${e}, ${t}, ${n}, ${a})`,Vc={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:qc([0,.65,.55,1]),circOut:qc([.55,0,1,.45]),backIn:qc([.31,.01,.66,-.59]),backOut:qc([.33,1.53,.69,.99])};function Hc(e){if(e)return $c(e)?qc(e):Array.isArray(e)?e.map(Hc):Vc[e]}const Wc=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function Yc(e,t,n,a){if(e===t&&n===a)return rc;const r=t=>function(e,t,n,a,r){let i,s,o=0;do{s=t+(n-t)/2,i=Wc(s,a,r)-e,i>0?n=s:t=s}while(Math.abs(i)>1e-7&&++o<12);return s}(t,0,1,e,n);return e=>0===e||1===e?e:Wc(r(e),t,a)}const Kc=Yc(.42,0,1,1),Gc=Yc(0,0,.58,1),Qc=Yc(.42,0,.58,1),Xc=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Zc=e=>t=>1-e(1-t),Jc=e=>1-Math.sin(Math.acos(e)),ed=Zc(Jc),td=Xc(Jc),nd=Yc(.33,1.53,.69,.99),ad=Zc(nd),rd=Xc(ad),id={linear:rc,easeIn:Kc,easeInOut:Qc,easeOut:Gc,circIn:Jc,circInOut:td,circOut:ed,backIn:ad,backInOut:rd,backOut:nd,anticipate:e=>(e*=2)<1?.5*ad(e):.5*(2-Math.pow(2,-10*(e-1)))},sd=e=>{if(Array.isArray(e)){Lc(4===e.length);const[t,n,a,r]=e;return Yc(t,n,a,r)}return"string"==typeof e?(Lc(void 0!==id[e]),id[e]):e},od=(e,t)=>n=>Boolean(yl(n)&&vl.test(n)&&n.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(n,t)),ld=(e,t,n)=>a=>{if(!yl(a))return a;const[r,i,s,o]=a.match(fl);return{[e]:parseFloat(r),[t]:parseFloat(i),[n]:parseFloat(s),alpha:void 0!==o?parseFloat(o):1}},cd={...ml,transform:e=>Math.round((e=>ul(0,255,e))(e))},dd={test:od("rgb","red"),parse:ld("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:a=1})=>"rgba("+cd.transform(e)+", "+cd.transform(t)+", "+cd.transform(n)+", "+gl(pl.transform(a))+")"};const ud={test:od("#"),parse:function(e){let t="",n="",a="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),a=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),a=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,a+=a,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(a,16),alpha:r?parseInt(r,16)/255:1}},transform:dd.transform},md={test:od("hsl","hue"),parse:ld("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:a=1})=>"hsla("+Math.round(e)+", "+jl.transform(gl(t))+", "+jl.transform(gl(n))+", "+gl(pl.transform(a))+")"},pd={test:e=>dd.test(e)||ud.test(e)||md.test(e),parse:e=>dd.test(e)?dd.parse(e):md.test(e)?md.parse(e):ud.parse(e),transform:e=>yl(e)?e:e.hasOwnProperty("red")?dd.transform(e):md.transform(e)},hd=(e,t,n)=>-n*e+n*t+e;function gd(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}const fd=(e,t,n)=>{const a=e*e;return Math.sqrt(Math.max(0,n*(t*t-a)+a))},xd=[ud,dd,md];function vd(e){const t=(n=e,xd.find(e=>e.test(n)));var n;let a=t.parse(e);return t===md&&(a=function({hue:e,saturation:t,lightness:n,alpha:a}){e/=360,n/=100;let r=0,i=0,s=0;if(t/=100){const a=n<.5?n*(1+t):n+t-n*t,o=2*n-a;r=gd(o,a,e+1/3),i=gd(o,a,e),s=gd(o,a,e-1/3)}else r=i=s=n;return{red:Math.round(255*r),green:Math.round(255*i),blue:Math.round(255*s),alpha:a}}(a)),a}const yd=(e,t)=>{const n=vd(e),a=vd(t),r={...n};return e=>(r.red=fd(n.red,a.red,e),r.green=fd(n.green,a.green,e),r.blue=fd(n.blue,a.blue,e),r.alpha=hd(n.alpha,a.alpha,e),dd.transform(r))};const bd={regex:/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,countKey:"Vars",token:"${v}",parse:rc},wd={regex:xl,countKey:"Colors",token:"${c}",parse:pd.parse},jd={regex:fl,countKey:"Numbers",token:"${n}",parse:ml.parse};function Nd(e,{regex:t,countKey:n,token:a,parse:r}){const i=e.tokenised.match(t);i&&(e["num"+n]=i.length,e.tokenised=e.tokenised.replace(t,a),e.values.push(...i.map(r)))}function _d(e){const t=e.toString(),n={value:t,tokenised:t,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&Nd(n,bd),Nd(n,wd),Nd(n,jd),n}function kd(e){return _d(e).values}function Sd(e){const{values:t,numColors:n,numVars:a,tokenised:r}=_d(e),i=t.length;return e=>{let t=r;for(let r=0;r<i;r++)t=r<a?t.replace(bd.token,e[r]):r<a+n?t.replace(wd.token,pd.transform(e[r])):t.replace(jd.token,gl(e[r]));return t}}const Cd=e=>"number"==typeof e?0:e;const Ed={test:function(e){var t,n;return isNaN(e)&&yl(e)&&((null===(t=e.match(fl))||void 0===t?void 0:t.length)||0)+((null===(n=e.match(xl))||void 0===n?void 0:n.length)||0)>0},parse:kd,createTransformer:Sd,getAnimatableNone:function(e){const t=kd(e);return Sd(e)(t.map(Cd))}},Dd=(e,t)=>n=>`${n>0?t:e}`;function Pd(e,t){return"number"==typeof e?n=>hd(e,t,n):pd.test(e)?yd(e,t):e.startsWith("var(")?Dd(e,t):Md(e,t)}const Ad=(e,t)=>{const n=[...e],a=n.length,r=e.map((e,n)=>Pd(e,t[n]));return e=>{for(let t=0;t<a;t++)n[t]=r[t](e);return n}},Td=(e,t)=>{const n={...e,...t},a={};for(const r in n)void 0!==e[r]&&void 0!==t[r]&&(a[r]=Pd(e[r],t[r]));return e=>{for(const t in a)n[t]=a[t](e);return n}},Md=(e,t)=>{const n=Ed.createTransformer(t),a=_d(e),r=_d(t);return a.numVars===r.numVars&&a.numColors===r.numColors&&a.numNumbers>=r.numNumbers?vc(Ad(a.values,r.values),n):Dd(e,t)},Rd=(e,t,n)=>{const a=t-e;return 0===a?1:(n-e)/a},Id=(e,t)=>n=>hd(e,t,n);function Od(e,t,n){const a=[],r=n||("number"==typeof(i=e[0])?Id:"string"==typeof i?pd.test(i)?yd:Md:Array.isArray(i)?Ad:"object"==typeof i?Td:Id);var i;const s=e.length-1;for(let o=0;o<s;o++){let n=r(e[o],e[o+1]);if(t){const e=Array.isArray(t)?t[o]||rc:t;n=vc(e,n)}a.push(n)}return a}function Ld(e,t,{clamp:n=!0,ease:a,mixer:r}={}){const i=e.length;if(Lc(i===t.length),1===i)return()=>t[0];e[0]>e[i-1]&&(e=[...e].reverse(),t=[...t].reverse());const s=Od(t,a,r),o=s.length,l=t=>{let n=0;if(o>1)for(;n<e.length-2&&!(t<e[n+1]);n++);const a=Rd(e[n],e[n+1],t);return s[n](a)};return n?t=>l(ul(e[0],e[i-1],t)):l}function Fd(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let a=1;a<=t;a++){const r=Rd(0,t,a);e.push(hd(n,1,r))}}(t,e.length-1),t}function Ud({duration:e=300,keyframes:t,times:n,ease:a="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(a)?a.map(sd):sd(a),i={done:!1,value:t[0]},s=function(e,t){return e.map(e=>e*t)}(n&&n.length===t.length?n:Fd(t),e),o=Ld(s,t,{ease:Array.isArray(r)?r:(l=t,c=r,l.map(()=>c||Qc).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(i.value=o(t),i.done=t>=e,i)}}function zd(e,t){return t?e*(1e3/t):0}function $d(e,t,n){const a=Math.max(t-5,0);return zd(n-e(a),t-a)}const Bd=.001;function qd({duration:e=800,bounce:t=.25,velocity:n=0,mass:a=1}){let r,i,s=1-t;s=ul(.05,1,s),e=ul(.01,10,Uc(e)),s<1?(r=t=>{const a=t*s,r=a*e,i=a-n,o=Hd(t,s),l=Math.exp(-r);return Bd-i/o*l},i=t=>{const a=t*s*e,i=a*n+n,o=Math.pow(s,2)*Math.pow(t,2)*e,l=Math.exp(-a),c=Hd(Math.pow(t,2),s);return(-r(t)+Bd>0?-1:1)*((i-o)*l)/c}):(r=t=>Math.exp(-t*e)*((t-n)*e+1)-.001,i=t=>Math.exp(-t*e)*(e*e*(n-t)));const o=function(e,t,n){let a=n;for(let r=1;r<Vd;r++)a-=e(a)/t(a);return a}(r,i,5/e);if(e=Fc(e),isNaN(o))return{stiffness:100,damping:10,duration:e};{const t=Math.pow(o,2)*a;return{stiffness:t,damping:2*s*Math.sqrt(a*t),duration:e}}}const Vd=12;function Hd(e,t){return e*Math.sqrt(1-t*t)}const Wd=["duration","bounce"],Yd=["stiffness","damping","mass"];function Kd(e,t){return t.some(t=>void 0!==e[t])}function Gd({keyframes:e,restDelta:t,restSpeed:n,...a}){const r=e[0],i=e[e.length-1],s={done:!1,value:r},{stiffness:o,damping:l,mass:c,duration:d,velocity:u,isResolvedFromDuration:m}=function(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!Kd(e,Yd)&&Kd(e,Wd)){const n=qd(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}({...a,velocity:-Uc(a.velocity||0)}),p=u||0,h=l/(2*Math.sqrt(o*c)),g=i-r,f=Uc(Math.sqrt(o/c)),x=Math.abs(g)<5;let v;if(n||(n=x?.01:2),t||(t=x?.005:.5),h<1){const e=Hd(f,h);v=t=>{const n=Math.exp(-h*f*t);return i-n*((p+h*f*g)/e*Math.sin(e*t)+g*Math.cos(e*t))}}else if(1===h)v=e=>i-Math.exp(-f*e)*(g+(p+f*g)*e);else{const e=f*Math.sqrt(h*h-1);v=t=>{const n=Math.exp(-h*f*t),a=Math.min(e*t,300);return i-n*((p+h*f*g)*Math.sinh(a)+e*g*Math.cosh(a))/e}}return{calculatedDuration:m&&d||null,next:e=>{const a=v(e);if(m)s.done=e>=d;else{let r=p;0!==e&&(r=h<1?$d(v,e,a):0);const o=Math.abs(r)<=n,l=Math.abs(i-a)<=t;s.done=o&&l}return s.value=s.done?i:a,s}}}function Qd({keyframes:e,velocity:t=0,power:n=.8,timeConstant:a=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:s,min:o,max:l,restDelta:c=.5,restSpeed:d}){const u=e[0],m={done:!1,value:u},p=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let h=n*t;const g=u+h,f=void 0===s?g:s(g);f!==g&&(h=f-u);const x=e=>-h*Math.exp(-e/a),v=e=>f+x(e),y=e=>{const t=x(e),n=v(e);m.done=Math.abs(t)<=c,m.value=m.done?f:n};let b,w;const j=e=>{var t;(t=m.value,void 0!==o&&t<o||void 0!==l&&t>l)&&(b=e,w=Gd({keyframes:[m.value,p(m.value)],velocity:$d(v,e,m.value),damping:r,stiffness:i,restDelta:c,restSpeed:d}))};return j(0),{calculatedDuration:null,next:e=>{let t=!1;return w||void 0!==b||(t=!0,y(e),j(e)),void 0!==b&&e>b?w.next(e-b):(!t&&y(e),m)}}}const Xd=e=>{const t=({timestamp:t})=>e(t);return{start:()=>oc.update(t,!0),stop:()=>lc(t),now:()=>cc.isProcessing?cc.timestamp:performance.now()}};function Zd(e){let t=0;let n=e.next(t);for(;!n.done&&t<2e4;)t+=50,n=e.next(t);return t>=2e4?1/0:t}const Jd={decay:Qd,inertia:Qd,tween:Ud,keyframes:Ud,spring:Gd};function eu({autoplay:e=!0,delay:t=0,driver:n=Xd,keyframes:a,type:r="keyframes",repeat:i=0,repeatDelay:s=0,repeatType:o="loop",onPlay:l,onStop:c,onComplete:d,onUpdate:u,...m}){let p,h,g=1,f=!1;const x=()=>{h=new Promise(e=>{p=e})};let v;x();const y=Jd[r]||Ud;let b;y!==Ud&&"number"!=typeof a[0]&&(b=Ld([0,100],a,{clamp:!1}),a=[0,100]);const w=y({...m,keyframes:a});let j;"mirror"===o&&(j=y({...m,keyframes:[...a].reverse(),velocity:-(m.velocity||0)}));let N="idle",_=null,k=null,S=null;null===w.calculatedDuration&&i&&(w.calculatedDuration=Zd(w));const{calculatedDuration:C}=w;let E=1/0,D=1/0;null!==C&&(E=C+s,D=E*(i+1)-s);let P=0;const A=e=>{if(null===k)return;g>0&&(k=Math.min(k,e)),g<0&&(k=Math.min(e-D/g,k)),P=null!==_?_:Math.round(e-k)*g;const n=P-t*(g>=0?1:-1),r=g>=0?n<0:n>D;P=Math.max(n,0),"finished"===N&&null===_&&(P=D);let l=P,c=w;if(i){const e=Math.min(P,D)/E;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,i+1);Boolean(t%2)&&("reverse"===o?(n=1-n,s&&(n-=s/E)):"mirror"===o&&(c=j)),l=ul(0,1,n)*E}const d=r?{done:!1,value:a[0]}:c.next(l);b&&(d.value=b(d.value));let{done:m}=d;r||null===C||(m=g>=0?P>=D:P<=0);const p=null===_&&("finished"===N||"running"===N&&m);return u&&u(d.value),p&&R(),d},T=()=>{v&&v.stop(),v=void 0},M=()=>{N="idle",T(),p(),x(),k=S=null},R=()=>{N="finished",d&&d(),T(),p()},I=()=>{if(f)return;v||(v=n(A));const e=v.now();l&&l(),null!==_?k=e-_:k&&"finished"!==N||(k=e),"finished"===N&&x(),S=k,_=null,N="running",v.start()};e&&I();const O={then:(e,t)=>h.then(e,t),get time(){return Uc(P)},set time(e){e=Fc(e),P=e,null===_&&v&&0!==g?k=v.now()-e/g:_=e},get duration(){const e=null===w.calculatedDuration?Zd(w):w.calculatedDuration;return Uc(e)},get speed(){return g},set speed(e){e!==g&&v&&(g=e,O.time=Uc(P))},get state(){return N},play:I,pause:()=>{N="paused",_=P},stop:()=>{f=!0,"idle"!==N&&(N="idle",c&&c(),M())},cancel:()=>{null!==S&&A(S),M()},complete:()=>{N="finished"},sample:e=>(k=0,A(e))};return O}const tu=function(e){let t;return()=>(void 0===t&&(t=e()),t)}(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),nu=new Set(["opacity","clipPath","filter","transform","backgroundColor"]);function au(e,t,{onUpdate:n,onComplete:a,...r}){if(!(tu()&&nu.has(t)&&!r.repeatDelay&&"mirror"!==r.repeatType&&0!==r.damping&&"inertia"!==r.type))return!1;let i,s,o=!1,l=!1;const c=()=>{s=new Promise(e=>{i=e})};c();let{keyframes:d,duration:u=300,ease:m,times:p}=r;if(((e,t)=>"spring"===t.type||"backgroundColor"===e||!Bc(t.ease))(t,r)){const e=eu({...r,repeat:0,delay:0});let t={done:!1,value:d[0]};const n=[];let a=0;for(;!t.done&&a<2e4;)t=e.sample(a),n.push(t.value),a+=10;p=void 0,d=n,u=a-10,m="linear"}const h=function(e,t,n,{delay:a=0,duration:r,repeat:i=0,repeatType:s="loop",ease:o,times:l}={}){const c={[t]:n};l&&(c.offset=l);const d=Hc(o);return Array.isArray(d)&&(c.easing=d),e.animate(c,{delay:a,duration:r,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:i+1,direction:"reverse"===s?"alternate":"normal"})}(e.owner.current,t,d,{...r,duration:u,ease:m,times:p}),g=()=>{l=!1,h.cancel()},f=()=>{l=!0,oc.update(g),i(),c()};h.onfinish=()=>{l||(e.set(function(e,{repeat:t,repeatType:n="loop"}){return e[t&&"loop"!==n&&t%2==1?0:e.length-1]}(d,r)),a&&a(),f())};return{then:(e,t)=>s.then(e,t),attachTimeline:e=>(h.timeline=e,h.onfinish=null,rc),get time(){return Uc(h.currentTime||0)},set time(e){h.currentTime=Fc(e)},get speed(){return h.playbackRate},set speed(e){h.playbackRate=e},get duration(){return Uc(u)},play:()=>{o||(h.play(),lc(g))},pause:()=>h.pause(),stop:()=>{if(o=!0,"idle"===h.playState)return;const{currentTime:t}=h;if(t){const n=eu({...r,autoplay:!1});e.setWithVelocity(n.sample(t-10).value,n.sample(t).value,10)}f()},complete:()=>{l||h.finish()},cancel:f}}const ru={type:"spring",stiffness:500,damping:25,restSpeed:10},iu={type:"keyframes",duration:.8},su={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ou=(e,{keyframes:t})=>t.length>2?iu:nl.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:ru:su,lu=(e,t)=>"zIndex"!==e&&(!("number"!=typeof t&&!Array.isArray(t))||!("string"!=typeof t||!Ed.test(t)&&"0"!==t||t.startsWith("url("))),cu=new Set(["brightness","contrast","saturate","opacity"]);function du(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[a]=n.match(fl)||[];if(!a)return e;const r=n.replace(a,"");let i=cu.has(t)?1:0;return a!==n&&(i*=100),t+"("+i+r+")"}const uu=/([a-z-]*)\(.*?\)/g,mu={...Ed,getAnimatableNone:e=>{const t=e.match(uu);return t?t.map(du).join(" "):e}},pu={...El,color:pd,backgroundColor:pd,outlineColor:pd,fill:pd,stroke:pd,borderColor:pd,borderTopColor:pd,borderRightColor:pd,borderBottomColor:pd,borderLeftColor:pd,filter:mu,WebkitFilter:mu},hu=e=>pu[e];function gu(e,t){let n=hu(e);return n!==mu&&(n=Ed),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const fu=e=>/^0[^.\s]+$/.test(e);function xu(e){return"number"==typeof e?0===e:null!==e?"none"===e||"0"===e||fu(e):void 0}function vu(e,t){return e[t]||e.default||e}const yu=!1,bu=(e,t,n,a={})=>r=>{const i=vu(a,e)||{},s=i.delay||a.delay||0;let{elapsed:o=0}=a;o-=Fc(s);const l=function(e,t,n,a){const r=lu(t,n);let i;i=Array.isArray(n)?[...n]:[null,n];const s=void 0!==a.from?a.from:e.get();let o;const l=[];for(let c=0;c<i.length;c++)null===i[c]&&(i[c]=0===c?s:i[c-1]),xu(i[c])&&l.push(c),"string"==typeof i[c]&&"none"!==i[c]&&"0"!==i[c]&&(o=i[c]);if(r&&l.length&&o)for(let c=0;c<l.length;c++)i[l[c]]=gu(t,o);return i}(t,e,n,i),c=l[0],d=l[l.length-1],u=lu(e,c),m=lu(e,d);let p={keyframes:l,velocity:t.getVelocity(),ease:"easeOut",...i,delay:-o,onUpdate:e=>{t.set(e),i.onUpdate&&i.onUpdate(e)},onComplete:()=>{r(),i.onComplete&&i.onComplete()}};if(function({when:e,delay:t,delayChildren:n,staggerChildren:a,staggerDirection:r,repeat:i,repeatType:s,repeatDelay:o,from:l,elapsed:c,...d}){return!!Object.keys(d).length}(i)||(p={...p,...ou(e,p)}),p.duration&&(p.duration=Fc(p.duration)),p.repeatDelay&&(p.repeatDelay=Fc(p.repeatDelay)),!u||!m||zc||!1===i.type||yu)return function({keyframes:e,delay:t,onUpdate:n,onComplete:a}){const r=()=>(n&&n(e[e.length-1]),a&&a(),{time:0,speed:1,duration:0,play:rc,pause:rc,stop:rc,then:e=>(e(),Promise.resolve()),cancel:rc,complete:rc});return t?eu({keyframes:[0,1],duration:0,delay:t,onComplete:r}):r()}(p);if(!a.isHandoff&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate){const n=au(t,e,p);if(n)return n}return eu(p)};function wu(e){return Boolean(rl(e)&&e.add)}const ju=e=>/^\-?\d*\.?\d+$/.test(e);function Nu(e,t){-1===e.indexOf(t)&&e.push(t)}function _u(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class ku{constructor(){this.subscriptions=[]}add(e){return Nu(this.subscriptions,e),()=>_u(this.subscriptions,e)}notify(e,t,n){const a=this.subscriptions.length;if(a)if(1===a)this.subscriptions[0](e,t,n);else for(let r=0;r<a;r++){const a=this.subscriptions[r];a&&a(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}class Su{constructor(e,t={}){var n;this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(e,t=!0)=>{this.prev=this.current,this.current=e;const{delta:n,timestamp:a}=cc;this.lastUpdated!==a&&(this.timeDelta=n,this.lastUpdated=a,oc.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),t&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>oc.postRender(this.velocityCheck),this.velocityCheck=({timestamp:e})=>{e!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=(n=this.current,!isNaN(parseFloat(n))),this.owner=t.owner}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new ku);const n=this.events[e].add(t);return"change"===e?()=>{n(),oc.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,n){this.set(t),this.prev=e,this.timeDelta=n}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?zd(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Cu(e,t){return new Su(e,t)}const Eu=e=>t=>t.test(e),Du=[ml,Nl,jl,wl,kl,_l,{test:e=>"auto"===e,parse:e=>e}],Pu=e=>Du.find(Eu(e)),Au=[...Du,pd,Ed],Tu=e=>Au.find(Eu(e));function Mu(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,Cu(n))}function Ru(e,t){if(!t)return;return(t[e]||t.default||t).from}function Iu({protectedKeys:e,needsAnimating:t},n){const a=e.hasOwnProperty(n)&&!0!==t[n];return t[n]=!1,a}function Ou(e,t){const n=e.get();if(!Array.isArray(t))return n!==t;for(let a=0;a<t.length;a++)if(t[a]!==n)return!0}function Lu(e,t,{delay:n=0,transitionOverride:a,type:r}={}){let{transition:i=e.getDefaultTransition(),transitionEnd:s,...o}=e.makeTargetAnimatable(t);const l=e.getValue("willChange");a&&(i=a);const c=[],d=r&&e.animationState&&e.animationState.getState()[r];for(const u in o){const t=e.getValue(u),a=o[u];if(!t||void 0===a||d&&Iu(d,u))continue;const r={delay:n,elapsed:0,...vu(i||{},u)};if(window.HandoffAppearAnimations){const n=e.getProps()[Ro];if(n){const e=window.HandoffAppearAnimations(n,u,t,oc);null!==e&&(r.elapsed=e,r.isHandoff=!0)}}let s=!r.isHandoff&&!Ou(t,a);if("spring"===r.type&&(t.getVelocity()||r.velocity)&&(s=!1),t.animation&&(s=!1),s)continue;t.start(bu(u,t,a,e.shouldReduceMotion&&nl.has(u)?{type:!1}:r));const m=t.animation;wu(l)&&(l.add(u),m.then(()=>l.remove(u))),c.push(m)}return s&&Promise.all(c).then(()=>{s&&function(e,t){const n=Oc(e,t);let{transitionEnd:a={},transition:r={},...i}=n?e.makeTargetAnimatable(n,!1):{};i={...i,...a};for(const s in i)Mu(e,s,ec(i[s]))}(e,s)}),c}function Fu(e,t,n={}){const a=Oc(e,t,n.custom);let{transition:r=e.getDefaultTransition()||{}}=a||{};n.transitionOverride&&(r=n.transitionOverride);const i=a?()=>Promise.all(Lu(e,a,n)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?(a=0)=>{const{delayChildren:i=0,staggerChildren:s,staggerDirection:o}=r;return function(e,t,n=0,a=0,r=1,i){const s=[],o=(e.variantChildren.size-1)*a,l=1===r?(e=0)=>e*a:(e=0)=>o-e*a;return Array.from(e.variantChildren).sort(Uu).forEach((e,a)=>{e.notify("AnimationStart",t),s.push(Fu(e,t,{...i,delay:n+l(a)}).then(()=>e.notify("AnimationComplete",t)))}),Promise.all(s)}(e,t,i+a,s,o,n)}:()=>Promise.resolve(),{when:o}=r;if(o){const[e,t]="beforeChildren"===o?[i,s]:[s,i];return e().then(()=>t())}return Promise.all([i(),s(n.delay)])}function Uu(e,t){return e.sortNodePosition(t)}const zu=[...Fo].reverse(),$u=Fo.length;function Bu(e){return t=>Promise.all(t.map(({animation:t,options:n})=>function(e,t,n={}){let a;if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map(t=>Fu(e,t,n));a=Promise.all(r)}else if("string"==typeof t)a=Fu(e,t,n);else{const r="function"==typeof t?Oc(e,t,n.custom):t;a=Promise.all(Lu(e,r,n))}return a.then(()=>e.notify("AnimationComplete",t))}(e,t,n)))}function qu(e){let t=Bu(e);const n={animate:Hu(!0),whileInView:Hu(),whileHover:Hu(),whileTap:Hu(),whileDrag:Hu(),whileFocus:Hu(),exit:Hu()};let a=!0;const r=(t,n)=>{const a=Oc(e,n);if(a){const{transition:e,transitionEnd:n,...r}=a;t={...t,...r,...n}}return t};function i(i,s){const o=e.getProps(),l=e.getVariantContext(!0)||{},c=[],d=new Set;let u={},m=1/0;for(let t=0;t<$u;t++){const p=zu[t],h=n[p],g=void 0!==o[p]?o[p]:l[p],f=Oo(g),x=p===s?h.isActive:null;!1===x&&(m=t);let v=g===l[p]&&g!==o[p]&&f;if(v&&a&&e.manuallyAnimateOnMount&&(v=!1),h.protectedKeys={...u},!h.isActive&&null===x||!g&&!h.prevProp||Lo(g)||"boolean"==typeof g)continue;let y=Vu(h.prevProp,g)||p===s&&h.isActive&&!v&&f||t>m&&f,b=!1;const w=Array.isArray(g)?g:[g];let j=w.reduce(r,{});!1===x&&(j={});const{prevResolvedValues:N={}}=h,_={...N,...j},k=e=>{y=!0,d.has(e)&&(b=!0,d.delete(e)),h.needsAnimating[e]=!0};for(const e in _){const t=j[e],n=N[e];if(u.hasOwnProperty(e))continue;let a=!1;a=Jl(t)&&Jl(n)?!Ic(t,n):t!==n,a?void 0!==t?k(e):d.add(e):void 0!==t&&d.has(e)?k(e):h.protectedKeys[e]=!0}h.prevProp=g,h.prevResolvedValues=j,h.isActive&&(u={...u,...j}),a&&e.blockInitialAnimation&&(y=!1),!y||v&&!b||c.push(...w.map(e=>({animation:e,options:{type:p,...i}})))}if(d.size){const t={};d.forEach(n=>{const a=e.getBaseTarget(n);void 0!==a&&(t[n]=a)}),c.push({animation:t})}let p=Boolean(c.length);return!a||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(p=!1),a=!1,p?t(c):Promise.resolve()}return{animateChanges:i,setActive:function(t,a,r){var s;if(n[t].isActive===a)return Promise.resolve();null===(s=e.variantChildren)||void 0===s||s.forEach(e=>{var n;return null===(n=e.animationState)||void 0===n?void 0:n.setActive(t,a)}),n[t].isActive=a;const o=i(r,t);for(const e in n)n[e].protectedKeys={};return o},setAnimateFunction:function(n){t=n(e)},getState:()=>n}}function Vu(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!Ic(t,e)}function Hu(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}let Wu=0;const Yu={animation:{Feature:class extends _c{constructor(e){super(e),e.animationState||(e.animationState=qu(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),Lo(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){}}},exit:{Feature:class extends _c{constructor(){super(...arguments),this.id=Wu++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t,custom:n}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const r=this.node.animationState.setActive("exit",!e,{custom:null!=n?n:this.node.getProps().custom});t&&!e&&r.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},Ku=(e,t)=>Math.abs(e-t);class Gu{constructor(e,t,{transformPagePoint:n,contextWindow:a,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Zu(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=Ku(e.x,t.x),a=Ku(e.y,t.y);return Math.sqrt(n**2+a**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!n)return;const{point:a}=e,{timestamp:r}=cc;this.history.push({...a,timestamp:r});const{onStart:i,onMove:s}=this.handlers;t||(i&&i(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),s&&s(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Qu(t,this.transformPagePoint),oc.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:a,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const i=Zu("pointercancel"===e.type?this.lastMoveEventInfo:Qu(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,i),a&&a(e,i)},!hc(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=n,this.contextWindow=a||window;const i=Qu(gc(e),this.transformPagePoint),{point:s}=i,{timestamp:o}=cc;this.history=[{...s,timestamp:o}];const{onSessionStart:l}=t;l&&l(e,Zu(i,this.history)),this.removeListeners=vc(fc(this.contextWindow,"pointermove",this.handlePointerMove),fc(this.contextWindow,"pointerup",this.handlePointerUp),fc(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),lc(this.updatePoint)}}function Qu(e,t){return t?{point:t(e.point)}:e}function Xu(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Zu({point:e},t){return{point:e,delta:Xu(e,em(t)),offset:Xu(e,Ju(t)),velocity:tm(t,.1)}}function Ju(e){return e[0]}function em(e){return e[e.length-1]}function tm(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,a=null;const r=em(e);for(;n>=0&&(a=e[n],!(r.timestamp-a.timestamp>Fc(t)));)n--;if(!a)return{x:0,y:0};const i=Uc(r.timestamp-a.timestamp);if(0===i)return{x:0,y:0};const s={x:(r.x-a.x)/i,y:(r.y-a.y)/i};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function nm(e){return e.max-e.min}function am(e,t=0,n=.01){return Math.abs(e-t)<=n}function rm(e,t,n,a=.5){e.origin=a,e.originPoint=hd(t.min,t.max,e.origin),e.scale=nm(n)/nm(t),(am(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=hd(n.min,n.max,e.origin)-e.originPoint,(am(e.translate)||isNaN(e.translate))&&(e.translate=0)}function im(e,t,n,a){rm(e.x,t.x,n.x,a?a.originX:void 0),rm(e.y,t.y,n.y,a?a.originY:void 0)}function sm(e,t,n){e.min=n.min+t.min,e.max=e.min+nm(t)}function om(e,t,n){e.min=t.min-n.min,e.max=e.min+nm(t)}function lm(e,t,n){om(e.x,t.x,n.x),om(e.y,t.y,n.y)}function cm(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function dm(e,t){let n=t.min-e.min,a=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,a]=[a,n]),{min:n,max:a}}const um=.35;function mm(e,t,n){return{min:pm(e,t),max:pm(e,n)}}function pm(e,t){return"number"==typeof e?e:e[t]||0}const hm=()=>({x:{min:0,max:0},y:{min:0,max:0}});function gm(e){return[e("x"),e("y")]}function fm({top:e,left:t,right:n,bottom:a}){return{x:{min:t,max:n},y:{min:e,max:a}}}function xm(e){return void 0===e||1===e}function vm({scale:e,scaleX:t,scaleY:n}){return!xm(e)||!xm(t)||!xm(n)}function ym(e){return vm(e)||bm(e)||e.z||e.rotate||e.rotateX||e.rotateY}function bm(e){return wm(e.x)||wm(e.y)}function wm(e){return e&&"0%"!==e}function jm(e,t,n){return n+t*(e-n)}function Nm(e,t,n,a,r){return void 0!==r&&(e=jm(e,r,a)),jm(e,n,a)+t}function _m(e,t=0,n=1,a,r){e.min=Nm(e.min,t,n,a,r),e.max=Nm(e.max,t,n,a,r)}function km(e,{x:t,y:n}){_m(e.x,t.translate,t.scale,t.originPoint),_m(e.y,n.translate,n.scale,n.originPoint)}function Sm(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function Cm(e,t){e.min=e.min+t,e.max=e.max+t}function Em(e,t,[n,a,r]){const i=void 0!==t[r]?t[r]:.5,s=hd(e.min,e.max,i);_m(e,t[n],t[a],s,t.scale)}const Dm=["x","scaleX","originX"],Pm=["y","scaleY","originY"];function Am(e,t){Em(e.x,t,Dm),Em(e.y,t,Pm)}function Tm(e,t){return fm(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),a=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:a.y,right:a.x}}(e.getBoundingClientRect(),t))}const Mm=({current:e})=>e?e.ownerDocument.defaultView:null,Rm=new WeakMap;class Im{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:a}=this.getProps();this.panSession=new Gu(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(gc(e,"page").point)},onStart:(e,t)=>{const{drag:n,dragPropagation:a,onDragStart:r}=this.getProps();if(n&&!a&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=jc(n),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),gm(e=>{let t=this.getAxisMotionValue(e).get()||0;if(jl.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const a=n.layout.layoutBox[e];if(a){t=nm(a)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),r&&oc.update(()=>r(e,t),!1,!0);const{animationState:i}=this.visualElement;i&&i.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:n,dragDirectionLock:a,onDirectionLock:r,onDrag:i}=this.getProps();if(!n&&!this.openGlobalLock)return;const{offset:s}=t;if(a&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(s),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,s),this.updateAxis("y",t.point,s),this.visualElement.render(),i&&i(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>gm(e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:a,contextWindow:Mm(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:a}=t;this.startAnimation(a);const{onDragEnd:r}=this.getProps();r&&oc.update(()=>r(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:a}=this.getProps();if(!n||!Om(e,a,this.currentDirection))return;const r=this.getAxisMotionValue(e);let i=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(i=function(e,{min:t,max:n},a){return void 0!==t&&e<t?e=a?hd(t,e,a.min):Math.max(e,t):void 0!==n&&e>n&&(e=a?hd(n,e,a.max):Math.min(e,n)),e}(i,this.constraints[e],this.elastic[e])),r.set(i)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,r=this.constraints;t&&Io(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!a)&&function(e,{top:t,left:n,bottom:a,right:r}){return{x:cm(e.x,n,r),y:cm(e.y,t,a)}}(a.layoutBox,t),this.elastic=function(e=um){return!1===e?e=0:!0===e&&(e=um),{x:mm(e,"left","right"),y:mm(e,"top","bottom")}}(n),r!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&gm(e=>{this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(a.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Io(e))return!1;const n=e.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const r=function(e,t,n){const a=Tm(e,n),{scroll:r}=t;return r&&(Cm(a.x,r.offset.x),Cm(a.y,r.offset.y)),a}(n,a.root,this.visualElement.getTransformPagePoint());let i=function(e,t){return{x:dm(e.x,t.x),y:dm(e.y,t.y)}}(a.layout.layoutBox,r);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(i));this.hasMutatedConstraints=!!e,e&&(i=fm(e))}return i}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:a,dragTransition:r,dragSnapToOrigin:i,onDragTransitionEnd:s}=this.getProps(),o=this.constraints||{},l=gm(s=>{if(!Om(s,t,this.currentDirection))return;let l=o&&o[s]||{};i&&(l={min:0,max:0});const c=a?200:1e6,d=a?40:1e7,u={type:"inertia",velocity:n?e[s]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(s,u)});return Promise.all(l).then(s)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return n.start(bu(e,n,0,t))}stopAnimation(){gm(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){gm(e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()})}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t="_drag"+e.toUpperCase(),n=this.visualElement.getProps(),a=n[t];return a||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){gm(t=>{const{drag:n}=this.getProps();if(!Om(t,n,this.currentDirection))return;const{projection:a}=this.visualElement,r=this.getAxisMotionValue(t);if(a&&a.layout){const{min:n,max:i}=a.layout.layoutBox[t];r.set(e[t]-hd(n,i,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!Io(t)||!n||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};gm(e=>{const t=this.getAxisMotionValue(e);if(t){const n=t.get();a[e]=function(e,t){let n=.5;const a=nm(e),r=nm(t);return r>a?n=Rd(t.min,t.max-a,e.min):a>r&&(n=Rd(e.min,e.max-r,t.min)),ul(0,1,n)}({min:n,max:n},this.constraints[e])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),gm(t=>{if(!Om(t,e,null))return;const n=this.getAxisMotionValue(t),{min:r,max:i}=this.constraints[t];n.set(hd(r,i,a[t]))})}addListeners(){if(!this.visualElement.current)return;Rm.set(this.visualElement,this);const e=fc(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();Io(e)&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,a=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),t();const r=pc(window,"resize",()=>this.scalePositionWithinConstraints()),i=n.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(gm(t=>{const n=this.getAxisMotionValue(t);n&&(this.originPoint[t]+=e[t].translate,n.set(n.get()+e[t].translate))}),this.visualElement.render())});return()=>{r(),e(),a(),i&&i()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:a=!1,dragConstraints:r=!1,dragElastic:i=um,dragMomentum:s=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:a,dragConstraints:r,dragElastic:i,dragMomentum:s}}}function Om(e,t,n){return!(!0!==t&&t!==e||null!==n&&n!==e)}const Lm=e=>(t,n)=>{e&&oc.update(()=>e(t,n))};const Fm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Um(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const zm={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!Nl.test(e))return e;e=parseFloat(e)}return`${Um(e,t.target.x)}% ${Um(e,t.target.y)}%`}},$m={correct:(e,{treeScale:t,projectionDelta:n})=>{const a=e,r=Ed.parse(e);if(r.length>5)return a;const i=Ed.createTransformer(e),s="number"!=typeof r[0]?1:0,o=n.x.scale*t.x,l=n.y.scale*t.y;r[0+s]/=o,r[1+s]/=l;const c=hd(o,l,.5);return"number"==typeof r[2+s]&&(r[2+s]/=c),"number"==typeof r[3+s]&&(r[3+s]/=c),i(r)}};class Bm extends $.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:a}=this.props,{projection:r}=e;var i;i=Vm,Object.assign(el,i),r&&(t.group&&t.group.add(r),n&&n.register&&a&&n.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),Fm.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:a,isPresent:r}=this.props,i=n.projection;return i?(i.isPresent=r,a||e.layoutDependency!==t||void 0===t?i.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?i.promote():i.relegate()||oc.postRender(()=>{const e=i.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:a}=e;a&&(a.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(a),n&&n.deregister&&n.deregister(a))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function qm(e){const[t,n]=function(){const e=L.useContext(Do);if(null===e)return[!0,null];const{isPresent:t,onExitComplete:n,register:a}=e,r=L.useId();return L.useEffect(()=>a(r),[]),!t&&n?[!1,()=>n&&n(r)]:[!0]}(),a=L.useContext(Wo);return $.createElement(Bm,{...e,layoutGroup:a,switchLayoutGroup:L.useContext(Yo),isPresent:t,safeToRemove:n})}const Vm={borderRadius:{...zm,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:zm,borderTopRightRadius:zm,borderBottomLeftRadius:zm,borderBottomRightRadius:zm,boxShadow:$m},Hm=["TopLeft","TopRight","BottomLeft","BottomRight"],Wm=Hm.length,Ym=e=>"string"==typeof e?parseFloat(e):e,Km=e=>"number"==typeof e||Nl.test(e);function Gm(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Qm=Zm(0,.5,ed),Xm=Zm(.5,.95,rc);function Zm(e,t,n){return a=>a<e?0:a>t?1:n(Rd(e,t,a))}function Jm(e,t){e.min=t.min,e.max=t.max}function ep(e,t){Jm(e.x,t.x),Jm(e.y,t.y)}function tp(e,t,n,a,r){return e=jm(e-=t,1/n,a),void 0!==r&&(e=jm(e,1/r,a)),e}function np(e,t,[n,a,r],i,s){!function(e,t=0,n=1,a=.5,r,i=e,s=e){jl.test(t)&&(t=parseFloat(t),t=hd(s.min,s.max,t/100)-s.min);if("number"!=typeof t)return;let o=hd(i.min,i.max,a);e===i&&(o-=t),e.min=tp(e.min,t,n,o,r),e.max=tp(e.max,t,n,o,r)}(e,t[n],t[a],t[r],t.scale,i,s)}const ap=["x","scaleX","originX"],rp=["y","scaleY","originY"];function ip(e,t,n,a){np(e.x,t,ap,n?n.x:void 0,a?a.x:void 0),np(e.y,t,rp,n?n.y:void 0,a?a.y:void 0)}function sp(e){return 0===e.translate&&1===e.scale}function op(e){return sp(e.x)&&sp(e.y)}function lp(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function cp(e){return nm(e.x)/nm(e.y)}class dp{constructor(){this.members=[]}add(e){Nu(this.members,e),e.scheduleRender()}remove(e){if(_u(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let n;for(let a=t;a>=0;a--){const e=this.members[a];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:a}=e.options;!1===a&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function up(e,t,n){let a="";const r=e.x.translate/t.x,i=e.y.translate/t.y;if((r||i)&&(a=`translate3d(${r}px, ${i}px, 0) `),1===t.x&&1===t.y||(a+=`scale(${1/t.x}, ${1/t.y}) `),n){const{rotate:e,rotateX:t,rotateY:r}=n;e&&(a+=`rotate(${e}deg) `),t&&(a+=`rotateX(${t}deg) `),r&&(a+=`rotateY(${r}deg) `)}const s=e.x.scale*t.x,o=e.y.scale*t.y;return 1===s&&1===o||(a+=`scale(${s}, ${o})`),a||"none"}const mp=(e,t)=>e.depth-t.depth;class pp{constructor(){this.children=[],this.isDirty=!1}add(e){Nu(this.children,e),this.isDirty=!0}remove(e){_u(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(mp),this.isDirty=!1,this.children.forEach(e)}}const hp=["","X","Y","Z"],gp={visibility:"hidden"};let fp=0;const xp={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function vp({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:a,resetTransform:r}){return class{constructor(e={},n=(null==t?void 0:t())){this.id=fp++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{var e;this.projectionUpdateScheduled=!1,xp.totalNodes=xp.resolvedTargetDeltas=xp.recalculatedProjection=0,this.nodes.forEach(wp),this.nodes.forEach(Ep),this.nodes.forEach(Dp),this.nodes.forEach(jp),e=xp,window.MotionDebug&&window.MotionDebug.record(e)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=n?n.root||n:this,this.path=n?[...n.path,n]:[],this.parent=n,this.depth=n?n.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new pp)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new ku),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const n=this.eventHandlers.get(e);n&&n.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t,n=this.root.hasTreeAnimated){if(this.instance)return;var a;this.isSVG=(a=t)instanceof SVGElement&&"svg"!==a.tagName,this.instance=t;const{layoutId:r,layout:i,visualElement:s}=this.options;if(s&&!s.current&&s.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),n&&(i||r)&&(this.isLayoutDirty=!0),e){let n;const a=()=>this.root.updateBlockedByResize=!1;e(t,()=>{this.root.updateBlockedByResize=!0,n&&n(),n=function(e,t){const n=performance.now(),a=({timestamp:r})=>{const i=r-n;i>=t&&(lc(a),e(i-t))};return oc.read(a,!0),()=>lc(a)}(a,250),Fm.hasAnimatedSinceResize&&(Fm.hasAnimatedSinceResize=!1,this.nodes.forEach(Cp))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&s&&(r||i)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t,hasRelativeTargetChanged:n,layout:a})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||s.getDefaultTransition()||Ip,{onLayoutAnimationStart:i,onLayoutAnimationComplete:o}=s.getProps(),l=!this.targetLayout||!lp(this.targetLayout,a)||n,c=!t&&n;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const t={...vu(r,"layout"),onPlay:i,onComplete:o};(s.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else t||Cp(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=a})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,lc(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Pp),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const a=this.getTransformTemplate();this.prevTransformTemplateValue=a?a(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(_p);this.isUpdating||this.nodes.forEach(kp),this.isUpdating=!1,this.nodes.forEach(Sp),this.nodes.forEach(yp),this.nodes.forEach(bp),this.clearAllSnapshots();const e=performance.now();cc.delta=ul(0,1e3/60,e-cc.timestamp),cc.timestamp=e,cc.isProcessing=!0,dc.update.process(cc),dc.preRender.process(cc),dc.render.process(cc),cc.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Np),this.sharedNodes.forEach(Ap)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,oc.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){oc.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&(this.scroll={animationId:this.root.animationId,phase:e,isRoot:a(this.instance),offset:n(this.instance)})}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform,t=this.projectionDelta&&!op(this.projectionDelta),n=this.getTransformTemplate(),a=n?n(this.latestValues,""):void 0,i=a!==this.prevTransformTemplateValue;e&&(t||ym(this.latestValues)||i)&&(r(this.instance,a),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let n=this.removeElementScroll(t);var a;return e&&(n=this.removeTransform(n)),Fp((a=n).x),Fp(a.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const t=e.measureViewportBox(),{scroll:n}=this.root;return n&&(Cm(t.x,n.offset.x),Cm(t.y,n.offset.y)),t}removeElementScroll(e){const t={x:{min:0,max:0},y:{min:0,max:0}};ep(t,e);for(let n=0;n<this.path.length;n++){const a=this.path[n],{scroll:r,options:i}=a;if(a!==this.root&&r&&i.layoutScroll){if(r.isRoot){ep(t,e);const{scroll:n}=this.root;n&&(Cm(t.x,-n.offset.x),Cm(t.y,-n.offset.y))}Cm(t.x,r.offset.x),Cm(t.y,r.offset.y)}}return t}applyTransform(e,t=!1){const n={x:{min:0,max:0},y:{min:0,max:0}};ep(n,e);for(let a=0;a<this.path.length;a++){const e=this.path[a];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&Am(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),ym(e.latestValues)&&Am(n,e.latestValues)}return ym(this.latestValues)&&Am(n,this.latestValues),n}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};ep(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!ym(e.latestValues))continue;vm(e.latestValues)&&e.updateSnapshot();const a=hm();ep(a,e.measurePageBox()),ip(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,a)}return ym(this.latestValues)&&ip(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==cc.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var t;const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const a=Boolean(this.resumingFrom)||this!==n;if(!(e||a&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget))return;const{layout:r,layoutId:i}=this.options;if(this.layout&&(r||i)){if(this.resolvedRelativeTargetAt=cc.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},lm(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),ep(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var s,o,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),s=this.target,o=this.relativeTarget,l=this.relativeParent.target,sm(s.x,o.x,l.x),sm(s.y,o.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):ep(this.target,this.layout.layoutBox),km(this.target,this.targetDelta)):ep(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},lm(this.relativeTargetOrigin,this.target,e.target),ep(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}xp.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!vm(this.parent.latestValues)&&!bm(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),n=Boolean(this.resumingFrom)||this!==t;let a=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(a=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(a=!1),this.resolvedRelativeTargetAt===cc.timestamp&&(a=!1),a)return;const{layout:r,layoutId:i}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!i)return;ep(this.layoutCorrected,this.layout.layoutBox);const s=this.treeScale.x,o=this.treeScale.y;!function(e,t,n,a=!1){const r=n.length;if(!r)return;let i,s;t.x=t.y=1;for(let o=0;o<r;o++){i=n[o],s=i.projectionDelta;const r=i.instance;r&&r.style&&"contents"===r.style.display||(a&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Am(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),s&&(t.x*=s.x.scale,t.y*=s.y.scale,km(e,s)),a&&ym(i.latestValues)&&Am(e,i.latestValues))}t.x=Sm(t.x),t.y=Sm(t.y)}(this.layoutCorrected,this.treeScale,this.path,n),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox);const{target:l}=t;if(!l)return void(this.projectionTransform&&(this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionTransform="none",this.scheduleRender()));this.projectionDelta||(this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}});const c=this.projectionTransform;im(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.projectionTransform=up(this.projectionDelta,this.treeScale),this.projectionTransform===c&&this.treeScale.x===s&&this.treeScale.y===o||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),xp.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(e,t=!1){const n=this.snapshot,a=n?n.latestValues:{},r={...this.latestValues},i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const s={x:{min:0,max:0},y:{min:0,max:0}},o=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(Rp));let u;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;var l,m,p,h,g,f;Tp(i.x,e.x,n),Tp(i.y,e.y,n),this.setTargetDelta(i),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(lm(s,this.layout.layoutBox,this.relativeParent.layout.layoutBox),p=this.relativeTarget,h=this.relativeTargetOrigin,g=s,f=n,Mp(p.x,h.x,g.x,f),Mp(p.y,h.y,g.y,f),u&&(l=this.relativeTarget,m=u,l.x.min===m.x.min&&l.x.max===m.x.max&&l.y.min===m.y.min&&l.y.max===m.y.max)&&(this.isProjectionDirty=!1),u||(u={x:{min:0,max:0},y:{min:0,max:0}}),ep(u,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,n,a,r,i){r?(e.opacity=hd(0,void 0!==n.opacity?n.opacity:1,Qm(a)),e.opacityExit=hd(void 0!==t.opacity?t.opacity:1,0,Xm(a))):i&&(e.opacity=hd(void 0!==t.opacity?t.opacity:1,void 0!==n.opacity?n.opacity:1,a));for(let s=0;s<Wm;s++){const r=`border${Hm[s]}Radius`;let i=Gm(t,r),o=Gm(n,r);void 0===i&&void 0===o||(i||(i=0),o||(o=0),0===i||0===o||Km(i)===Km(o)?(e[r]=Math.max(hd(Ym(i),Ym(o),a),0),(jl.test(o)||jl.test(i))&&(e[r]+="%")):e[r]=o)}(t.rotate||n.rotate)&&(e.rotate=hd(t.rotate||0,n.rotate||0,a))}(r,a,this.latestValues,n,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(lc(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=oc.update(()=>{Fm.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,n){const a=rl(e)?e:Cu(e);return a.start(bu("",a,t,n)),a.animation}(0,1e3,{...e,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:a,latestValues:r}=e;if(t&&n&&a){if(this!==e&&this.layout&&a&&Up(this.options.animationType,this.layout.layoutBox,a.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=nm(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const a=nm(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+a}ep(t,n),Am(t,r),im(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new dp);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:n}={}){const a=this.getStack();a&&a.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.rotate||n.rotateX||n.rotateY||n.rotateZ)&&(t=!0),!t)return;const a={};for(let r=0;r<hp.length;r++){const t="rotate"+hp[r];n[t]&&(a[t]=n[t],e.setStaticValue(t,0))}e.render();for(const r in a)e.setStaticValue(r,a[r]);e.scheduleRender()}getProjectionStyles(e){var t,n;if(!this.instance||this.isSVG)return;if(!this.isVisible)return gp;const a={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,a.opacity="",a.pointerEvents=tc(null==e?void 0:e.pointerEvents)||"",a.transform=r?r(this.latestValues,""):"none",a;const i=this.getLead();if(!this.projectionDelta||!this.layout||!i.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=tc(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!ym(this.latestValues)&&(t.transform=r?r({},""):"none",this.hasProjected=!1),t}const s=i.animationValues||i.latestValues;this.applyTransformsToTarget(),a.transform=up(this.projectionDeltaWithTransform,this.treeScale,s),r&&(a.transform=r(s,a.transform));const{x:o,y:l}=this.projectionDelta;a.transformOrigin=`${100*o.origin}% ${100*l.origin}% 0`,i.animationValues?a.opacity=i===this?null!==(n=null!==(t=s.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==n?n:1:this.preserveOpacity?this.latestValues.opacity:s.opacityExit:a.opacity=i===this?void 0!==s.opacity?s.opacity:"":void 0!==s.opacityExit?s.opacityExit:0;for(const c in el){if(void 0===s[c])continue;const{correct:e,applyTo:t}=el[c],n="none"===a.transform?s[c]:e(s[c],i);if(t){const e=t.length;for(let r=0;r<e;r++)a[t[r]]=n}else a[c]=n}return this.options.layoutId&&(a.pointerEvents=i===this?tc(null==e?void 0:e.pointerEvents)||"":"none"),a}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()}),this.root.nodes.forEach(_p),this.root.sharedNodes.clear()}}}function yp(e){e.updateLayout()}function bp(e){var t;const n=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:a}=e.layout,{animationType:r}=e.options,i=n.source!==e.layout.source;"size"===r?gm(e=>{const a=i?n.measuredBox[e]:n.layoutBox[e],r=nm(a);a.min=t[e].min,a.max=a.min+r}):Up(r,n.layoutBox,t)&&gm(a=>{const r=i?n.measuredBox[a]:n.layoutBox[a],s=nm(t[a]);r.max=r.min+s,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[a].max=e.relativeTarget[a].min+s)});const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};im(s,t,n.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};i?im(o,e.applyTransform(a,!0),n.measuredBox):im(o,t,n.layoutBox);const l=!op(s);let c=!1;if(!e.resumeFrom){const a=e.getClosestProjectingParent();if(a&&!a.resumeFrom){const{snapshot:r,layout:i}=a;if(r&&i){const s={x:{min:0,max:0},y:{min:0,max:0}};lm(s,n.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};lm(o,t,i.layoutBox),lp(s,o)||(c=!0),a.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=s,e.relativeParent=a)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:n,delta:o,layoutDelta:s,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function wp(e){xp.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function jp(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Np(e){e.clearSnapshot()}function _p(e){e.clearMeasurements()}function kp(e){e.isLayoutDirty=!1}function Sp(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Cp(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Ep(e){e.resolveTargetDelta()}function Dp(e){e.calcProjection()}function Pp(e){e.resetRotation()}function Ap(e){e.removeLeadSnapshot()}function Tp(e,t,n){e.translate=hd(t.translate,0,n),e.scale=hd(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function Mp(e,t,n,a){e.min=hd(t.min,n.min,a),e.max=hd(t.max,n.max,a)}function Rp(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Ip={duration:.45,ease:[.4,0,.1,1]},Op=e=>"undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().includes(e),Lp=Op("applewebkit/")&&!Op("chrome/")?Math.round:rc;function Fp(e){e.min=Lp(e.min),e.max=Lp(e.max)}function Up(e,t,n){return"position"===e||"preserve-aspect"===e&&!am(cp(t),cp(n),.2)}const zp=vp({attachResizeListener:(e,t)=>pc(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),$p={current:void 0},Bp=vp({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!$p.current){const e=new zp({});e.mount(window),e.setOptions({layoutScroll:!0}),$p.current=e}return $p.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),qp={pan:{Feature:class extends _c{constructor(){super(...arguments),this.removePointerDownListener=rc}onPointerDown(e){this.session=new Gu(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Mm(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:a}=this.node.getProps();return{onSessionStart:Lm(e),onStart:Lm(t),onMove:n,onEnd:(e,t)=>{delete this.session,a&&oc.update(()=>a(e,t))}}}mount(){this.removePointerDownListener=fc(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends _c{constructor(e){super(e),this.removeGroupControls=rc,this.removeListeners=rc,this.controls=new Im(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||rc}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Bp,MeasureLayout:qm}},Vp=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Hp(e,t,n=1){const[a,r]=function(e){const t=Vp.exec(e);if(!t)return[,];const[,n,a]=t;return[n,a]}(e);if(!a)return;const i=window.getComputedStyle(t).getPropertyValue(a);if(i){const e=i.trim();return ju(e)?parseFloat(e):e}return cl(r)?Hp(r,t,n+1):r}const Wp=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Yp=e=>Wp.has(e),Kp=e=>e===ml||e===Nl,Gp=(e,t)=>parseFloat(e.split(", ")[t]),Qp=(e,t)=>(n,{transform:a})=>{if("none"===a||!a)return 0;const r=a.match(/^matrix3d\((.+)\)$/);if(r)return Gp(r[1],t);{const t=a.match(/^matrix\((.+)\)$/);return t?Gp(t[1],e):0}},Xp=new Set(["x","y","z"]),Zp=tl.filter(e=>!Xp.has(e));const Jp={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Qp(4,13),y:Qp(5,14)};Jp.translateX=Jp.x,Jp.translateY=Jp.y;const eh=(e,t,n={},a={})=>{t={...t},a={...a};const r=Object.keys(t).filter(Yp);let i=[],s=!1;const o=[];if(r.forEach(r=>{const l=e.getValue(r);if(!e.hasValue(r))return;let c=n[r],d=Pu(c);const u=t[r];let m;if(Jl(u)){const e=u.length,t=null===u[0]?1:0;c=u[t],d=Pu(c);for(let n=t;n<e&&null!==u[n];n++)m?Lc(Pu(u[n])===m):m=Pu(u[n])}else m=Pu(u);if(d!==m)if(Kp(d)&&Kp(m)){const e=l.get();"string"==typeof e&&l.set(parseFloat(e)),"string"==typeof u?t[r]=parseFloat(u):Array.isArray(u)&&m===Nl&&(t[r]=u.map(parseFloat))}else(null==d?void 0:d.transform)&&(null==m?void 0:m.transform)&&(0===c||0===u)?0===c?l.set(m.transform(c)):t[r]=d.transform(u):(s||(i=function(e){const t=[];return Zp.forEach(n=>{const a=e.getValue(n);void 0!==a&&(t.push([n,a.get()]),a.set(n.startsWith("scale")?1:0))}),t.length&&e.render(),t}(e),s=!0),o.push(r),a[r]=void 0!==a[r]?a[r]:t[r],l.jump(u))}),o.length){const n=o.indexOf("height")>=0?window.pageYOffset:null,r=((e,t,n)=>{const a=t.measureViewportBox(),r=t.current,i=getComputedStyle(r),{display:s}=i,o={};"none"===s&&t.setStaticValue("display",e.display||"block"),n.forEach(e=>{o[e]=Jp[e](a,i)}),t.render();const l=t.measureViewportBox();return n.forEach(n=>{const a=t.getValue(n);a&&a.jump(o[n]),e[n]=Jp[n](l,i)}),e})(t,e,o);return i.length&&i.forEach(([t,n])=>{e.getValue(t).set(n)}),e.render(),Po&&null!==n&&window.scrollTo({top:n}),{target:r,transitionEnd:a}}return{target:t,transitionEnd:a}};function th(e,t,n,a){return(e=>Object.keys(e).some(Yp))(t)?eh(e,t,n,a):{target:t,transitionEnd:a}}const nh=(e,t,n,a)=>{const r=function(e,{...t},n){const a=e.current;if(!(a instanceof Element))return{target:t,transitionEnd:n};n&&(n={...n}),e.values.forEach(e=>{const t=e.get();if(!cl(t))return;const n=Hp(t,a);n&&e.set(n)});for(const r in t){const e=t[r];if(!cl(e))continue;const i=Hp(e,a);i&&(t[r]=i,n||(n={}),void 0===n[r]&&(n[r]=e))}return{target:t,transitionEnd:n}}(e,t,a);return th(e,t=r.target,n,a=r.transitionEnd)},ah={current:null},rh={current:!1};const ih=new WeakMap,sh=Object.keys(Ho),oh=sh.length,lh=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],ch=Uo.length;class dh{constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:a,visualState:r},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>oc.render(this.render,!1,!0);const{latestValues:s,renderState:o}=r;this.latestValues=s,this.baseTarget={...s},this.initialValues=t.initial?{...s}:{},this.renderState=o,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=a,this.options=i,this.isControllingVariants=zo(t),this.isVariantNode=$o(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:l,...c}=this.scrapeMotionValuesFromProps(t,{});for(const d in c){const e=c[d];void 0!==s[d]&&rl(e)&&(e.set(s[d],!1),wu(l)&&l.add(d))}}scrapeMotionValuesFromProps(e,t){return{}}mount(e){this.current=e,ih.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),rh.current||function(){if(rh.current=!0,Po)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>ah.current=e.matches;e.addListener(t),t()}else ah.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||ah.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){ih.delete(this.current),this.projection&&this.projection.unmount(),lc(this.notifyUpdate),lc(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,t){const n=nl.has(e),a=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&oc.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),r=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{a(),r()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}loadFeatures({children:e,...t},n,a,r){let i,s;for(let o=0;o<oh;o++){const e=sh[o],{isEnabled:n,Feature:a,ProjectionNode:r,MeasureLayout:l}=Ho[e];r&&(i=r),n(t)&&(!this.features[e]&&a&&(this.features[e]=new a(this)),l&&(s=l))}if(("html"===this.type||"svg"===this.type)&&!this.projection&&i){this.projection=new i(this.latestValues,this.parent&&this.parent.projection);const{layoutId:e,layout:n,drag:a,dragConstraints:s,layoutScroll:o,layoutRoot:l}=t;this.projection.setOptions({layoutId:e,layout:n,alwaysMeasureLayout:Boolean(a)||s&&Io(s),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:"string"==typeof n?n:"both",initialPromotionConfig:r,layoutScroll:o,layoutRoot:l})}return s}updateFeatures(){for(const e in this.features){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}makeTargetAnimatable(e,t=!0){return this.makeTargetAnimatableFromInstance(e,this.props,t)}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<lh.length;n++){const t=lh[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const a=e["on"+t];a&&(this.propEventSubscriptions[t]=this.on(t,a))}this.prevMotionValues=function(e,t,n){const{willChange:a}=t;for(const r in t){const i=t[r],s=n[r];if(rl(i))e.addValue(r,i),wu(a)&&a.add(r);else if(rl(s))e.addValue(r,Cu(i,{owner:e})),wu(a)&&a.remove(r);else if(s!==i)if(e.hasValue(r)){const t=e.getValue(r);!t.hasAnimated&&t.set(i)}else{const t=e.getStaticValue(r);e.addValue(r,Cu(void 0!==t?t:i,{owner:e}))}}for(const r in n)void 0===t[r]&&e.removeValue(r);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const e=this.parent&&this.parent.getVariantContext()||{};return void 0!==this.props.initial&&(e.initial=this.props.initial),e}const t={};for(let n=0;n<ch;n++){const e=Uo[n],a=this.props[e];(Oo(a)||!1===a)&&(t[e]=a)}return t}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){t!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,t)),this.values.set(e,t),this.latestValues[e]=t.get()}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=Cu(t,{owner:this}),this.addValue(e,n)),n}readValue(e){var t;return void 0===this.latestValues[e]&&this.current?null!==(t=this.getBaseTargetFromProps(this.props,e))&&void 0!==t?t:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e]}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props,a="string"==typeof n||"object"==typeof n?null===(t=Xl(this.props,n))||void 0===t?void 0:t[e]:void 0;if(n&&void 0!==a)return a;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||rl(r)?void 0!==this.initialValues[e]&&void 0===a?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new ku),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class uh extends dh{sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:t,...n},{transformValues:a},r){let i=function(e,t,n){const a={};for(const r in e){const e=Ru(r,t);if(void 0!==e)a[r]=e;else{const e=n.getValue(r);e&&(a[r]=e.get())}}return a}(n,e||{},this);if(a&&(t&&(t=a(t)),n&&(n=a(n)),i&&(i=a(i))),r){!function(e,t,n){var a,r;const i=Object.keys(t).filter(t=>!e.hasValue(t)),s=i.length;if(s)for(let o=0;o<s;o++){const s=i[o],l=t[s];let c=null;Array.isArray(l)&&(c=l[0]),null===c&&(c=null!==(r=null!==(a=n[s])&&void 0!==a?a:e.readValue(s))&&void 0!==r?r:t[s]),null!=c&&("string"==typeof c&&(ju(c)||fu(c))?c=parseFloat(c):!Tu(c)&&Ed.test(l)&&(c=gu(s,l)),e.addValue(s,Cu(c,{owner:e})),void 0===n[s]&&(n[s]=c),null!==c&&e.setBaseTarget(s,c))}}(this,n,i);const e=nh(this,n,i,t);t=e.transitionEnd,n=e.target}return{transition:e,transitionEnd:t,...n}}}class mh extends uh{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(nl.has(t)){const e=hu(t);return e&&e.default||0}{const a=(n=e,window.getComputedStyle(n)),r=(ll(t)?a.getPropertyValue(t):a[t])||0;return"string"==typeof r?r.trim():r}var n}measureInstanceViewportBox(e,{transformPagePoint:t}){return Tm(e,t)}build(e,t,n,a){Dl(e,t,n,a.transformTemplate)}scrapeMotionValuesFromProps(e,t){return Gl(e,t)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;rl(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}renderInstance(e,t,n,a){Wl(e,t,n,a)}}class ph extends uh{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(nl.has(t)){const e=hu(t);return e&&e.default||0}return t=Yl.has(t)?t:Mo(t),e.getAttribute(t)}measureInstanceViewportBox(){return{x:{min:0,max:0},y:{min:0,max:0}}}scrapeMotionValuesFromProps(e,t){return Ql(e,t)}build(e,t,n,a){$l(e,t,n,this.isSVGTag,a.transformTemplate)}renderInstance(e,t,n,a){Kl(e,t,0,a)}mount(e){this.isSVGTag=ql(e.tagName),super.mount(e)}}const hh=(e,t)=>Jo(e)?new ph(t,{enableHardwareAcceleration:!1}):new mh(t,{enableHardwareAcceleration:!0}),gh={...Yu,...Rc,...qp,...{layout:{ProjectionNode:Bp,MeasureLayout:qm}}},fh=Xo((e,t)=>function(e,{forwardMotionProps:t=!1},n,a){return{...Jo(e)?uc:mc,preloadedFeatures:n,useRender:Hl(t),createVisualElement:a,Component:e}}(e,t,gh,hh));function xh(){const e=L.useRef(!1);return Ao(()=>(e.current=!0,()=>{e.current=!1}),[]),e}class vh extends L.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function yh({children:e,isPresent:t}){const n=L.useId(),a=L.useRef(null),r=L.useRef({width:0,height:0,top:0,left:0});return L.useInsertionEffect(()=>{const{width:e,height:i,top:s,left:o}=r.current;if(t||!a.current||!e||!i)return;a.current.dataset.motionPopId=n;const l=document.createElement("style");return document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`\n          [data-motion-pop-id="${n}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${i}px !important;\n            top: ${s}px !important;\n            left: ${o}px !important;\n          }\n        `),()=>{document.head.removeChild(l)}},[t]),L.createElement(vh,{isPresent:t,childRef:a,sizeRef:r},L.cloneElement(e,{ref:a}))}const bh=({children:e,initial:t,isPresent:n,onExitComplete:a,custom:r,presenceAffectsLayout:i,mode:s})=>{const o=Zl(wh),l=L.useId(),c=L.useMemo(()=>({id:l,initial:t,isPresent:n,custom:r,onExitComplete:e=>{o.set(e,!0);for(const t of o.values())if(!t)return;a&&a()},register:e=>(o.set(e,!1),()=>o.delete(e))}),i?void 0:[n]);return L.useMemo(()=>{o.forEach((e,t)=>o.set(t,!1))},[n]),L.useEffect(()=>{!n&&!o.size&&a&&a()},[n]),"popLayout"===s&&(e=L.createElement(yh,{isPresent:n},e)),L.createElement(Do.Provider,{value:c},e)};function wh(){return new Map}const jh=e=>e.key||"";const Nh=({children:e,custom:t,initial:n=!0,onExitComplete:a,exitBeforeEnter:r,presenceAffectsLayout:i=!0,mode:s="sync"})=>{const o=L.useContext(Wo).forceRender||function(){const e=xh(),[t,n]=L.useState(0),a=L.useCallback(()=>{e.current&&n(t+1)},[t]);return[L.useCallback(()=>oc.postRender(a),[a]),t]}()[0],l=xh(),c=function(e){const t=[];return L.Children.forEach(e,e=>{L.isValidElement(e)&&t.push(e)}),t}(e);let d=c;const u=L.useRef(new Map).current,m=L.useRef(d),p=L.useRef(new Map).current,h=L.useRef(!0);var g;if(Ao(()=>{h.current=!1,function(e,t){e.forEach(e=>{const n=jh(e);t.set(n,e)})}(c,p),m.current=d}),g=()=>{h.current=!0,p.clear(),u.clear()},L.useEffect(()=>()=>g(),[]),h.current)return L.createElement(L.Fragment,null,d.map(e=>L.createElement(bh,{key:jh(e),isPresent:!0,initial:!!n&&void 0,presenceAffectsLayout:i,mode:s},e)));d=[...d];const f=m.current.map(jh),x=c.map(jh),v=f.length;for(let y=0;y<v;y++){const e=f[y];-1!==x.indexOf(e)||u.has(e)||u.set(e,void 0)}return"wait"===s&&u.size&&(d=[]),u.forEach((e,n)=>{if(-1!==x.indexOf(n))return;const r=p.get(n);if(!r)return;const h=f.indexOf(n);let g=e;if(!g){const e=()=>{u.delete(n);const e=Array.from(p.keys()).filter(e=>!x.includes(e));if(e.forEach(e=>p.delete(e)),m.current=c.filter(t=>{const a=jh(t);return a===n||e.includes(a)}),!u.size){if(!1===l.current)return;o(),a&&a()}};g=L.createElement(bh,{key:jh(r),isPresent:!1,onExitComplete:e,custom:t,presenceAffectsLayout:i,mode:s},r),u.set(n,g)}d.splice(h,0,g)}),d=d.map(e=>{const t=e.key;return u.has(t)?e:L.createElement(bh,{key:jh(e),isPresent:!0,presenceAffectsLayout:i,mode:s},e)}),L.createElement(L.Fragment,null,u.size?d:d.map(e=>L.cloneElement(e)))},_h=({isOpen:e,images:t,initialIndex:a=0,onClose:r})=>{const[i,s]=L.useState(a),[o,l]=L.useState(1);L.useEffect(()=>{e&&(s(a),l(1))},[e,a]),L.useEffect(()=>{if(!e)return;const t=e=>{switch(e.key){case"Escape":r();break;case"ArrowLeft":c();break;case"ArrowRight":d();break;case"+":case"=":l(e=>Math.min(e+.5,3));break;case"-":l(e=>Math.max(e-.5,.5))}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,i,t.length]);const c=L.useCallback(()=>{s(e=>e>0?e-1:t.length-1),l(1)},[t.length]),d=L.useCallback(()=>{s(e=>e<t.length-1?e+1:0),l(1)},[t.length]);if(!e||0===t.length)return null;const u=t[i];return n.jsx(Nh,{children:e&&n.jsxs(fh.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:e=>{e.target===e.currentTarget&&r()},children:[n.jsx("button",{onClick:r,className:"absolute top-4 right-4 z-10 p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors","aria-label":"Close lightbox",children:n.jsx(ae,{className:"w-6 h-6 text-white"})}),t.length>1&&n.jsxs("div",{className:"absolute top-4 left-4 z-10 px-3 py-1.5 rounded-full bg-white/10 text-white text-sm",children:[i+1," / ",t.length]}),n.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10 flex items-center gap-2",children:[n.jsx("button",{onClick:()=>l(e=>Math.max(e-.5,.5)),className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors","aria-label":"Zoom out",children:n.jsx(Sa,{className:"w-5 h-5 text-white"})}),n.jsxs("span",{className:"px-2 text-white text-sm",children:[Math.round(100*o),"%"]}),n.jsx("button",{onClick:()=>l(e=>Math.min(e+.5,3)),className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors","aria-label":"Zoom in",children:n.jsx(ka,{className:"w-5 h-5 text-white"})}),n.jsx("button",{onClick:async()=>{const e=t[i];if(e)try{const t=await fetch(e.url),n=await t.blob(),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=`image-${i+1}.jpg`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}catch(n){window.open(e.url,"_blank")}},className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors","aria-label":"Download image",children:n.jsx(Oe,{className:"w-5 h-5 text-white"})})]}),t.length>1&&n.jsx("button",{onClick:c,className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors","aria-label":"Previous image",children:n.jsx(Bn,{className:"w-8 h-8 text-white"})}),t.length>1&&n.jsx("button",{onClick:d,className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors","aria-label":"Next image",children:n.jsx(qn,{className:"w-8 h-8 text-white"})}),n.jsx(fh.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},className:"relative max-w-[90vw] max-h-[85vh] flex items-center justify-center",children:n.jsx("img",{src:u.url,alt:u.caption||`Image ${i+1}`,className:G("max-w-full max-h-[85vh] object-contain rounded-lg transition-transform duration-200","select-none"),style:{transform:`scale(${o})`},draggable:!1})},i),u.caption&&n.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10 px-4 py-2 rounded-lg bg-black/60 text-white text-sm max-w-[80vw] text-center",children:u.caption})]})})},kh=({onLongPress:e,threshold:t=500})=>{const n=L.useRef(),a=L.useRef(),r=L.useCallback(r=>{const i="touches"in r?{x:r.touches[0].clientX,y:r.touches[0].clientY}:{x:r.clientX,y:r.clientY};a.current=i,n.current=window.setTimeout(async()=>{await bo.medium(),e()},t)},[e,t]),i=L.useCallback(e=>{if(n.current&&a.current){const t="touches"in e?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY};Math.sqrt(Math.pow(t.x-a.current.x,2)+Math.pow(t.y-a.current.y,2))>10&&clearTimeout(n.current)}},[]),s=L.useCallback(()=>{n.current&&clearTimeout(n.current)},[]);return{onTouchStart:r,onTouchMove:i,onTouchEnd:s,onMouseDown:r,onMouseMove:i,onMouseUp:s,onMouseLeave:s}};function Sh(e){try{const t=new URL(e).pathname,n="/storage/v1/object/public/trip-media/",a="/storage/v1/object/sign/trip-media/";if(t.includes(n)){const e=t.indexOf(n);return decodeURIComponent(t.slice(e+n.length))}if(t.includes(a)){const e=t.indexOf(a);return decodeURIComponent(t.slice(e+a.length))}}catch{}return null}function Ch(e){if("object"!=typeof e||null===e)return null;if(!("upload_path"in e))return null;const t=e.upload_path;return"string"==typeof t&&t.length>0?t:null}async function Eh(e,t,n){const a=Zs(t);if("image/heic"===a||t.name.toLowerCase().endsWith(".heic"))throw new Error("HEIC images are not supported. Please upload JPG or PNG.");let r="document";a.startsWith("image/")?r="image":a.startsWith("video/")&&(r="video");const i=t.name.split(".").pop(),s=`${e}/${crypto.randomUUID()}.${i}`,{error:o}=await W.storage.from("trip-media").upload(s,t,{contentType:a,upsert:!1});if(o)throw o;const{data:l}=W.storage.from("trip-media").getPublicUrl(s),{data:c,error:d}=await W.from("trip_media_index").insert({trip_id:e,media_url:l.publicUrl,filename:t.name,media_type:r,mime_type:a,file_size:t.size,metadata:{upload_path:s,uploaded_by:n,original_name:t.name}}).select().single();if(d)throw d;return{id:c.id,trip_id:c.trip_id,media_url:c.media_url,mime_type:c.mime_type??a,file_name:c.filename,media_type:c.media_type,metadata:c.metadata,created_at:c.created_at??(new Date).toISOString(),file_size:c.file_size}}async function Dh(e){const t=Ch(e.metadata)??Sh(e.media_url);if(t){const{error:e}=await W.storage.from("trip-media").remove([t]);if(e)throw e}const{data:n,error:a}=await W.from("trip_media_index").delete().eq("id",e.id).select("id");if(a)throw a;if(!n||1!==n.length)throw new Error("Delete failed (not authorized, not found, or already deleted).")}const Ph={async uploadMedia(e){const{data:{user:t}}=await W.auth.getUser();if(!t)throw new Error("Not authenticated");const n=await Eh(e.tripId,e.file,t.id);return{id:n.id,trip_id:n.trip_id,media_url:n.media_url,filename:n.file_name??e.file.name,media_type:n.media_type,metadata:n.metadata,created_at:n.created_at,file_size:n.file_size,mime_type:n.mime_type}},async getMediaItems(e){const{data:t,error:n}=await W.from("trip_media_index").select("*").eq("trip_id",e).order("created_at",{ascending:!1});if(n)throw n;return(t||[]).map(e=>({id:e.id,trip_id:e.trip_id,media_url:e.media_url,filename:e.filename??"",media_type:e.media_type,metadata:e.metadata,created_at:e.created_at??"",file_size:e.file_size,mime_type:e.mime_type}))},async getMediaByType(e,t){const{data:n,error:a}=await W.from("trip_media_index").select("*").eq("trip_id",e).eq("media_type",t).order("created_at",{ascending:!1});if(a)throw a;return(n||[]).map(e=>({id:e.id,trip_id:e.trip_id,media_url:e.media_url,filename:e.filename??"",media_type:e.media_type,metadata:e.metadata,created_at:e.created_at??"",file_size:e.file_size,mime_type:e.mime_type}))},async deleteMedia(e){const{data:t,error:n}=await W.from("trip_media_index").select("*").eq("id",e).maybeSingle();if(n)throw n;if(t){const e={id:t.id,trip_id:t.trip_id,media_url:t.media_url,mime_type:t.mime_type??"",file_name:t.filename,media_type:t.media_type,metadata:t.metadata,created_at:t.created_at??"",file_size:t.file_size};return void(await Dh(e))}const{data:a,error:r}=await W.from("trip_files").select("id").eq("id",e).maybeSingle();if(r)throw r;if(!a)throw new Error("Item not found.");const{data:i,error:s}=await W.from("trip_files").delete().eq("id",e).select("id");if(s)throw s;if(!i||1!==i.length)throw new Error("Delete failed (not authorized, not found, or already deleted).")},async getMediaStats(e){const{data:t,error:n}=await W.from("trip_media_index").select("media_type, file_size").eq("trip_id",e);if(n)return{total_items:0,total_size:0,by_type:{}};const a={total_items:t.length,total_size:t.reduce((e,t)=>e+(t.file_size||0),0),by_type:{}};return t.forEach(e=>{a.by_type[e.media_type]=(a.by_type[e.media_type]||0)+1}),a},async uploadBatch(e){const t=[];for(const a of e)try{const e=await this.uploadMedia(a);t.push(e)}catch(n){}return t}},Ah=Object.freeze(Object.defineProperty({__proto__:null,deleteTripMedia:Dh,extractTripMediaStoragePath:Sh,extractUploadPathFromMetadata:Ch,getUploadContentType:Zs,inferMimeTypeFromFilename:Xs,mediaService:Ph,uploadTripMedia:Eh},Symbol.toStringTag,{value:"Module"})),Th=new Map;function Mh(e){const{url:t,metadata:n}=e,[a,r]=L.useState(t??null);return L.useEffect(()=>{let e=!1;return async function(){if(t){r(t);try{const a=await async function(e){const{mediaUrl:t,metadata:n,expiresInSeconds:a=1800}=e;if(!t)return t;if((r=t).startsWith("blob:")||r.startsWith("data:"))return t;var r;const i=Ch(n)??(function(e){return e.includes("/storage/v1/object/")&&e.includes("/trip-media/")}(t)?Sh(t):null);if(!i)return t;const s=Th.get(i),o=Date.now();if(s&&s.expiresAtMs>o+1e4)return s.signedUrl;const{data:l,error:c}=await W.storage.from("trip-media").createSignedUrl(i,a);return c||!(null==l?void 0:l.signedUrl)?t:(Th.set(i,{signedUrl:l.signedUrl,expiresAtMs:o+1e3*a}),l.signedUrl)}({mediaUrl:t,metadata:n});e||r(a)}catch{e||r(t)}}else r(null)}(),()=>{e=!0}},[t,n]),a}const Rh=L.memo(({id:e,text:t,senderName:a,senderAvatar:r,timestamp:i,isBroadcast:s,isPayment:o,isOwnMessage:l=!1,isEdited:c=!1,reactions:d,onReaction:u,messageType:m="trip",isDeleted:p=!1,onEdit:h,onDelete:g,grounding:f,showSenderInfo:x=!0,mediaType:v,mediaUrl:y,linkPreview:b,attachments:w,allChatImages:j=[],status:N,onRetry:_})=>{const[k,S]=L.useState(!1),[C,E]=L.useState(!1),[D,P]=L.useState(0),A=Ie(),T=v&&y,M=b&&"object"==typeof b,R=w&&Array.isArray(w)&&w.length>0,I=Mh({url:y??null}),O=e=>{const t=j.findIndex(t=>t.url===e);P(t>=0?t:0),E(!0)};return kh({onLongPress:()=>{S(!0),setTimeout(()=>S(!1),5e3)},threshold:500}),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:G("flex gap-2 group",l?"justify-end":"justify-start"),children:[!l&&x&&n.jsxs(Vn,{className:"w-8 h-8 md:w-10 md:h-10 border-2 border-border/50 flex-shrink-0",children:[n.jsx(Hn,{src:r||Ze,alt:a}),n.jsx(Wn,{className:"bg-muted text-muted-foreground text-xs md:text-sm font-semibold",children:St(a)})]}),!l&&!x&&n.jsx("div",{className:"w-8 md:w-10 flex-shrink-0"}),n.jsxs("div",{className:G("flex flex-col max-w-[85%]",l?"items-end text-right":"items-start text-left"),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[x&&n.jsxs("span",{className:"text-[10px] md:text-xs text-white/70 mb-0.5",children:[l?"You":a," â€” ",(F=i,new Date(F).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),c&&n.jsx("span",{className:"ml-1 text-white/50",children:"(edited)"})]}),n.jsx(_o,{messageId:e,messageContent:t,messageType:m,isOwnMessage:l,isDeleted:p,onEdit:h,onDelete:g})]}),n.jsxs("div",{className:G("px-3 py-2 md:px-4 md:py-2.5 rounded-2xl break-words","text-sm md:text-base",l?"bg-primary text-primary-foreground":"bg-muted/80 text-white",s&&"border-2 border-red-500/50 bg-gray-800",o&&"border-2 border-green-500/50","failed"===N&&"opacity-70 border-2 border-destructive/50","sending"===N&&"opacity-80",(T||M)&&!t&&"p-1 bg-transparent"),children:[t&&n.jsx("p",{className:"whitespace-pre-wrap",children:t}),(()=>{if(!T)return null;switch(v){case"image":return n.jsxs("div",{className:"mt-2 relative group",children:[n.jsx("img",{src:I??y,alt:"Shared image",className:"rounded-lg max-w-full h-auto cursor-pointer hover:opacity-95 transition-opacity",style:{maxHeight:"300px"},onClick:()=>O(I??y)}),n.jsx("button",{onClick:()=>O(I??y),className:"absolute top-2 right-2 bg-black/50 text-white p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"View full size",children:n.jsx(fa,{size:16})})]});case"video":return n.jsx("div",{className:"mt-2 relative",children:n.jsx("video",{src:I??y,controls:!0,playsInline:!0,className:"rounded-lg max-w-full h-auto",style:{maxHeight:"300px"},children:"Your browser does not support the video tag."})});case"document":return n.jsxs("a",{href:y,target:"_blank",rel:"noopener noreferrer",className:"mt-2 flex items-center gap-2 bg-gray-800 hover:bg-gray-700 px-3 py-2 rounded-lg transition-colors",children:[n.jsx(Re,{size:16,className:"text-gray-400"}),n.jsx("span",{className:"text-sm truncate flex-1",children:t||"Document"}),n.jsx(Oe,{size:14,className:"text-gray-400"})]});default:return null}})(),R?n.jsx("div",{className:"mt-2 space-y-2",children:w.map((e,a)=>"image"===e.type&&e.url?n.jsxs("div",{className:"relative group",children:[n.jsx("img",{src:e.url,alt:`Attachment ${a+1}`,className:"rounded-lg max-w-full h-auto cursor-pointer hover:opacity-95 transition-opacity",style:{maxHeight:"300px"},onClick:()=>O(e.url)}),n.jsx("button",{onClick:()=>O(e.url),className:"absolute top-2 right-2 bg-black/50 text-white p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"View full size",children:n.jsx(fa,{size:16})})]},a):"file"===e.type&&e.url?n.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-gray-800 hover:bg-gray-700 px-3 py-2 rounded-lg transition-colors",children:[n.jsx(Re,{size:16,className:"text-gray-400"}),n.jsx("span",{className:"text-sm truncate flex-1",children:t||"File attachment"}),n.jsx(Oe,{size:14,className:"text-gray-400"})]},a):null)}):null,(()=>{if(!M)return null;const e=b;return n.jsxs("a",{href:e.url||t,target:"_blank",rel:"noopener noreferrer",className:"mt-2 block bg-gray-800 hover:bg-gray-700 rounded-lg overflow-hidden transition-colors",children:[e.image&&n.jsx("img",{src:e.image,alt:e.title||"Link preview",className:"w-full h-32 object-cover"}),n.jsx("div",{className:"p-3",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(ga,{size:14,className:"text-gray-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"text-sm font-medium text-white truncate",children:e.title||e.domain||"Link"}),e.description&&n.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:e.description}),e.domain&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:e.domain})]}),n.jsx(zn,{size:14,className:"text-gray-400 flex-shrink-0"})]})})]})})(),"sending"===N&&n.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs opacity-70",children:[n.jsx(bn,{className:"h-3 w-3 animate-spin"}),n.jsx("span",{children:"Sending..."})]}),"failed"===N&&n.jsxs("button",{onClick:()=>null==_?void 0:_(e),className:"flex items-center gap-1.5 mt-1 text-xs text-destructive hover:text-destructive/80 transition-colors",children:[n.jsx(Yn,{className:"h-3 w-3"}),n.jsx("span",{children:"Failed to send"}),n.jsx(Le,{className:"h-3 w-3 ml-1"}),n.jsx("span",{className:"underline",children:"Retry"})]})]}),(null==f?void 0:f.googleMapsWidget)&&n.jsx("div",{className:"mt-2",children:n.jsx(ko,{widgetToken:f.googleMapsWidget,height:A?200:250})}),(null==f?void 0:f.sources)&&f.sources.length>0&&n.jsxs("div",{className:G("space-y-2","mt-2","w-full"),children:[n.jsxs("div",{className:G("font-medium text-white/80 flex items-center gap-2",A?"text-[10px]":"text-xs"),children:[n.jsx("span",{children:"Sources:"}),f.sources.filter(e=>"google_maps_grounding"===e.source).length>0&&n.jsxs("span",{className:G("bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded flex items-center gap-1",A?"text-[9px]":"text-[10px]"),children:[n.jsx(Un,{size:A?10:12}),f.sources.filter(e=>"google_maps_grounding"===e.source).length," verified by Google"]})]}),n.jsx("div",{className:"space-y-2",children:f.sources.map((e,t)=>n.jsx(So,{citation:e,index:t},e.id||t))})]}),k&&n.jsx("div",{className:G("mt-1"),children:n.jsx(No,{messageId:e,reactions:d,onReaction:u})})]})]}),n.jsx(_h,{isOpen:C,images:j.length>0?j:y?[{url:y}]:[],initialIndex:D,onClose:()=>E(!1)})]});var F}),Ih=L.memo(({message:e,reactions:t,onReaction:a,showSenderInfo:r,onRetry:i})=>{var s,o;const{user:l}=Y(),c=e,d=e.sender.userId||e.sender.id,u=!!(null==l?void 0:l.id)&&(d===l.id||e.sender.id===l.id||e.sender.name===(l.displayName||(null==(s=l.email)?void 0:s.split("@")[0]))),m=L.useCallback(async(e,t)=>{},[]),p=L.useCallback(async e=>{},[]),h=e;return n.jsx(Rh,{id:e.id,text:e.text,senderName:e.sender.name,senderAvatar:e.sender.avatar,timestamp:e.createdAt,isBroadcast:e.isBroadcast,isPayment:e.isPayment||(null==(o=e.tags)?void 0:o.includes("payment")),isOwnMessage:u,isEdited:e.isEdited||!1,reactions:t,onReaction:a,showSenderInfo:r,messageType:"trip",onEdit:m,onDelete:p,grounding:c.sources||c.googleMapsWidget?{sources:c.sources,googleMapsWidget:c.googleMapsWidget}:void 0,mediaType:h.mediaType,mediaUrl:h.mediaUrl,linkPreview:h.linkPreview,attachments:h.attachments,status:e.status,onRetry:i})}),Oh=()=>n.jsx("div",{className:"space-y-4 animate-pulse",children:[1,2,3].map(e=>n.jsxs("div",{className:"flex gap-3 "+(e%2==0?"flex-row-reverse":""),children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-white/10"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("div",{className:"h-4 bg-white/10 rounded w-3/4"}),n.jsx("div",{className:"h-4 bg-white/10 rounded w-1/2"})]})]},e))}),Lh=()=>n.jsx("div",{className:"space-y-3 animate-pulse",children:[1,2,3].map(e=>n.jsx("div",{className:"bg-white/10 rounded-xl p-4",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"w-6 h-6 rounded-full bg-white/20"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("div",{className:"h-4 bg-white/20 rounded w-3/4"}),n.jsx("div",{className:"h-3 bg-white/10 rounded w-1/2"})]})]})},e))}),Fh=()=>n.jsx("div",{className:"space-y-4 animate-pulse",children:n.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[n.jsx("div",{className:"h-6 bg-white/20 rounded w-1/3 mb-4"}),n.jsx("div",{className:"grid grid-cols-7 gap-2",children:Array(35).fill(0).map((e,t)=>n.jsx("div",{className:"aspect-square bg-white/10 rounded"},t))})]})}),Uh=e=>{const[t,n]=L.useState([]),[a,r]=L.useState(!1),[i,s]=L.useState(null),{isDemoMode:o}=X(),{user:l}=Y(),c=e=>{if(!/^\d+$/.test(e))return[];const t=parseInt(e,10),n=Je(t),a=n&&n.participants?n.participants.map((e,t)=>({id:e.id.toString(),name:e.name,avatar:e.avatar,isCreator:0===t})):[{id:"user1",name:"You",isCreator:!0},{id:"user2",name:"Trip Organizer"}],r=Fe.getState().getAddedMembers(e).map(e=>({id:e.id.toString(),name:e.name,avatar:e.avatar,isCreator:!1})),i=[...a];for(const s of r)i.some(e=>e.id===s.id)||i.push(s);return i},d=async e=>{var t;r(!0);try{const a=/^\d+$/.test(e);if(o&&a){const a=c(e);return n(a),s((null==(t=a[0])?void 0:t.id)||null),void r(!1)}const{data:i}=await W.from("trips").select("created_by").eq("id",e).single();(null==i?void 0:i.created_by)&&s(i.created_by);let l=await Ue.getTripMembers(e);if((null==i?void 0:i.created_by)&&!o){if(!(null==l?void 0:l.some(e=>e.user_id===i.created_by))){Ue.addTripMember(e,i.created_by,"admin").catch(console.error);const{data:t}=await W.from("profiles").select("user_id, display_name, avatar_url, email").eq("user_id",i.created_by).single();if(t){const e={user_id:i.created_by,role:"admin",created_at:(new Date).toISOString(),profiles:t,id:"temp-fix-"+Date.now()};l=[...l||[],e]}}}if(l&&l.length>0){const e=((e,t)=>e.map(e=>{var n,a,r;return{id:e.user_id,name:(null==(n=e.profiles)?void 0:n.display_name)||(null==(a=e.profiles)?void 0:a.first_name)||"Unknown User",avatar:null==(r=e.profiles)?void 0:r.avatar_url,isCreator:e.user_id===t}}))(l,null==i?void 0:i.created_by);n(e)}else if(o){const t=c(e);n(t)}else n([])}catch(a){if(o){const t=c(e);n(t)}else n([])}finally{r(!1)}},u=L.useCallback(async()=>{if(!e||!(null==l?void 0:l.id))return!1;if(i===l.id)return!0;const{data:t}=await W.from("trip_admins").select("id").eq("trip_id",e).eq("user_id",l.id).maybeSingle();return!!t},[e,null==l?void 0:l.id,i]),m=L.useCallback(async t=>{if(!e)return ee.error("No trip selected"),!1;if(t===i)return ee.error("Cannot remove the trip creator"),!1;try{const{error:a}=await W.from("trip_members").delete().eq("trip_id",e).eq("user_id",t);return a?(ee.error("Failed to remove member"),!1):(n(e=>e.filter(e=>e.id!==t)),ee.success("Member removed from trip"),!0)}catch(a){return ee.error("Failed to remove member"),!1}},[e,i]),p=L.useCallback(async t=>{if(!e||!(null==l?void 0:l.id))return ee.error("You must be logged in to leave a trip"),!1;if(o)return ee.success("You have left the trip"),!0;try{const{data:a}=await W.from("profiles").select("display_name, first_name, last_name").eq("user_id",l.id).single(),r=(null==a?void 0:a.display_name)||`${(null==a?void 0:a.first_name)||""} ${(null==a?void 0:a.last_name)||""}`.trim()||"A member",{error:s}=await W.from("trip_members").delete().eq("trip_id",e).eq("user_id",l.id);return s?(ee.error("Failed to leave trip"),!1):(i&&await W.from("notifications").insert({user_id:i,title:`${r} left ${t}`,message:`${r} has left the trip "${t}"`,type:"member_left",metadata:{trip_id:e,trip_name:t,left_user_id:l.id,left_user_name:r}}),n(e=>e.filter(e=>e.id!==l.id)),!0)}catch(a){return ee.error("Failed to leave trip"),!1}},[e,null==l?void 0:l.id,i,o]),h=Fe(t=>{var n;return e&&(null==(n=t.addedMembers[e])?void 0:n.length)||0});return L.useEffect(()=>{e&&d(e)},[e,o,h]),L.useEffect(()=>{if(!e)return;let t;(async()=>{try{const{data:n}=await W.from("trip_members").select("id").limit(1);null!==n&&(t=W.channel(`trip-members-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"trip_members",filter:`trip_id=eq.${e}`},()=>{d(e)}).subscribe())}catch{}})();const a=W.channel(`profiles-updates-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"profiles"},e=>{const t=e.new,a=null==t?void 0:t.user_id;a&&n(e=>e.map(e=>e.id!==a?e:{...e,name:(null==t?void 0:t.display_name)??e.name,avatar:(null==t?void 0:t.avatar_url)??e.avatar}))}).subscribe();return()=>{t&&W.removeChannel(t),W.removeChannel(a)}},[e]),{tripMembers:t,loading:a,tripCreatorId:i,canRemoveMembers:u,removeMember:m,leaveTrip:p,refreshMembers:()=>e&&d(e)}};const zh=new class{constructor(){t(this,"attempts",new Map)}checkLimit(e,t=10,n=6e4){const a=Date.now(),r=this.attempts.get(e);return!r||a>r.resetTime?(this.attempts.set(e,{count:1,resetTime:a+n}),!0):!(r.count>=t)&&(r.count++,!0)}getRemainingAttempts(e,t=10){const n=this.attempts.get(e);return!n||Date.now()>n.resetTime?t:Math.max(0,t-n.count)}};const $h=new class{constructor(){t(this,"isOnline",navigator.onLine),t(this,"listeners",new Set),window.addEventListener("online",()=>this.setOnline(!0)),window.addEventListener("offline",()=>this.setOnline(!1))}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}getStatus(){return this.isOnline}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}};new class{constructor(){t(this,"queue",[]),t(this,"isProcessing",!1),$h.subscribe(e=>{e&&this.queue.length>0&&this.processQueue()})}add(e,t){this.queue.push({id:e,operation:t,retryCount:0}),$h.getStatus()&&this.processQueue()}async processQueue(){if(!this.isProcessing&&0!==this.queue.length){for(this.isProcessing=!0;this.queue.length>0&&$h.getStatus();){const t=this.queue.shift();try{await t.operation()}catch(e){t.retryCount++,t.retryCount<3&&this.queue.unshift(t)}}this.isProcessing=!1}}};class Bh{static sanitizeText(e){return"string"!=typeof e?"":e.replace(/[<>'"]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim().substring(0,1e3)}static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&e.length<=255}static sanitizeSearchQuery(e){return"string"!=typeof e?"":e.replace(/[<>'"]/g,"").replace(/[;(){}[\]]/g,"").trim().substring(0,200)}static isValidUrl(e){try{const t=new URL(e);return["http:","https:"].includes(t.protocol)}catch{return!1}}static sanitizeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}static isValidTripId(e){return/^[a-zA-Z0-9_-]+$/.test(e)&&e.length>0&&e.length<=50}static checkRateLimit(e,t=100,n=6e4){const a=Date.now(),r=this.requestCounts.get(e);return!r||a>r.resetTime?(this.requestCounts.set(e,{count:1,resetTime:a+n}),!0):!(r.count>=t)&&(r.count++,!0)}}t(Bh,"requestCounts",new Map);let qh=null;async function Vh(){return qh||(qh=await de("chravel-offline-queue",1,{upgrade(e){if(!e.objectStoreNames.contains("queue")){const t=e.createObjectStore("queue",{keyPath:"id"});t.createIndex("by-status","status"),t.createIndex("by-timestamp","timestamp")}}}),qh)}const Hh=2592e6;let Wh=null;async function Yh(){return Wh||(Wh=await de("chravel-chat-db",2,{upgrade(e,t,n,a){if(e.objectStoreNames.contains("messages")){if(t<2){const e=a.objectStore("messages");e.indexNames.contains("by-created-at")||e.createIndex("by-created-at","created_at")}}else{const t=e.createObjectStore("messages",{keyPath:"id"});t.createIndex("by-trip","trip_id"),t.createIndex("by-date","created_at"),t.createIndex("by-created-at","created_at")}}}),Wh)}async function Kh(e,t){try{const n=await Yh(),a=n.transaction("messages","readwrite"),r=Date.now(),i=new Date(r-Hh),s=t.filter(e=>new Date(e.created_at)>=i);await Promise.all(s.map(t=>a.store.put({...t,trip_id:e,cached_at:r}))),await a.done,await async function(e){try{const t=await e.getAll("messages"),n=Date.now()-Hh,a=t.filter(e=>new Date(e.created_at).getTime()<n);if(a.length>0){const t=e.transaction("messages","readwrite");await Promise.all(a.map(e=>t.store.delete(e.id))),await t.done}}catch(t){}}(n)}catch(n){}}async function Gh(e){try{const t=await Yh(),n=await t.getAllFromIndex("messages","by-trip",e),a=Date.now()-Hh;return n.filter(e=>new Date(e.created_at).getTime()>=a).sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())}catch(t){return[]}}const Qh=e=>{const t=ne(),{toast:n}=ue(),{isOffline:a}=me(),[r,i]=L.useState(!0),[s,o]=L.useState(!1),{data:l=[],isLoading:c,error:d}=Te({queryKey:["tripChat",e],queryFn:async()=>{if(!e)return[];const t=await Gh(e);try{const{data:t,error:n}=await W.from("trip_chat_messages").select("*").eq("trip_id",e).eq("is_deleted",!1).order("created_at",{ascending:!1}).limit(10);if(n)throw n;const a=(t||[]).reverse();return i(t&&10===t.length),t&&t.length>0&&await Kh(e,t),a}catch(yN){if(t.length>0){return t.slice(-10).map(e=>({...e,updated_at:e.updated_at||e.created_at}))}throw yN}},enabled:!!e,staleTime:3e4});L.useEffect(()=>{if(!e)return;let n=0;let a=Date.now();const r=W.channel(`trip_chat_${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"trip_chat_messages",filter:`trip_id=eq.${e}`},r=>{const i=Date.now();i-a>6e4&&(n=0,a=i),n>=100||(n++,t.setQueryData(["tripChat",e],(e=[])=>{const t=r.new;if(e.some(e=>e.id===t.id))return e;return[...e,t].sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())}))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"trip_chat_messages",filter:`trip_id=eq.${e}`},n=>{const a=n.new;a.is_deleted?t.setQueryData(["tripChat",e],(e=[])=>e.filter(e=>e.id!==a.id)):t.setQueryData(["tripChat",e],(e=[])=>e.map(e=>e.id===n.new.id?{...e,...n.new}:e))}).subscribe();return()=>{W.removeChannel(r)}},[e,t]),L.useEffect(()=>{!a&&e&&async function(){const e=await Vh(),t=await e.getAllFromIndex("queue","by-status","pending");let n=0,a=0;for(const r of t)try{await e.put("queue",{...r,status:"sending"});const{data:t,error:a}=await W.from("trip_chat_messages").insert({...r.message,privacy_mode:r.message.privacy_mode||"standard"}).select().single();if(a)throw a;await e.delete("queue",r.id),n++}catch(d){const n=r.retryCount+1;n>=3?(await e.put("queue",{...r,status:"failed",retryCount:n}),a++):await e.put("queue",{...r,status:"pending",retryCount:n})}return{success:n,failed:a}}().then(e=>{e.success>0&&n({title:"Messages sent",description:`${e.success} message${e.success>1?"s":""} sent successfully`}),e.failed>0&&n({title:"Some messages failed",description:`${e.failed} message${e.failed>1?"s":""} could not be sent. Check your connection.`,variant:"destructive"})})},[a,e,n]);const u=ze({mutationFn:async t=>{const r=`chat_${e}_${t.author_name}`;if(!zh.checkLimit(r,30,6e4))throw new Error("Rate limit exceeded. Please slow down your messages.");const i=Bh.sanitizeText(t.content);if(!i.trim())throw new Error("Message cannot be empty.");if(i.length>1e3)throw new Error("Message is too long. Please keep it under 1000 characters.");const s={trip_id:e,content:i,author_name:Bh.sanitizeText(t.author_name),user_id:t.userId,privacy_mode:t.privacyMode||"standard",message_type:t.messageType||"text",media_type:t.media_type,media_url:t.media_url};if(a){const t=await pe.queueOperation("chat_message","create",e,s);await async function(e){const t=await Vh(),n=`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={id:n,message:e,timestamp:Date.now(),retryCount:0,status:"pending"};return await t.put("queue",a),n}(s),n({title:"Message queued",description:"Your message will be sent when connection is restored."});const a={id:t,...s,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return await Kh(e,[a]),a}const o=await J(s);return await Kh(e,[o]),o},onError:e=>{const t=e.message||"Failed to send message. Please try again.";n({title:"Error",description:t,variant:"destructive"})}});return{messages:l,isLoading:c,error:d,sendMessage:(e,t,n,a,r,i,s)=>{u.mutate({content:e,author_name:t,media_type:n,media_url:a,userId:r,privacyMode:i,messageType:s})},sendMessageAsync:(e,t,n,a,r,i,s)=>u.mutateAsync({content:e,author_name:t,media_type:n,media_url:a,userId:r,privacyMode:i,messageType:s}),isCreating:u.isPending,loadMore:async()=>{if(r&&!s&&0!==l.length){o(!0);try{const n=l[0],{data:a,error:r}=await W.from("trip_chat_messages").select("*").eq("trip_id",e).eq("is_deleted",!1).lt("created_at",n.created_at).order("created_at",{ascending:!1}).limit(20);if(r)throw r;if(a&&a.length>0){const n=a.reverse();t.setQueryData(["tripChat",e],(e=[])=>[...n,...e]),i(20===a.length)}else i(!1)}catch(n){}finally{o(!1)}}},hasMore:r,isLoadingMore:s}};const Xh=new class{async createRoleChannel(e,t){try{const{data:{user:n}}=await W.auth.getUser();if(!n)throw new Error("No authenticated user");const a=t.toLowerCase().replace(/\s+/g,"-"),{data:r,error:i}=await W.from("trip_channels").insert({trip_id:e,channel_name:t,channel_slug:a,is_private:!0,created_by:n.id}).select().single();if(i)throw i;return{id:r.id,tripId:r.trip_id,roleName:r.channel_name,memberCount:0,createdAt:r.created_at,createdBy:r.created_by}}catch(n){return null}}async getRoleChannels(e){try{const{data:t,error:n}=await W.from("trip_channels").select("*").eq("trip_id",e).order("created_at",{ascending:!0});if(n)throw n;return(t||[]).map(e=>({id:e.id,tripId:e.trip_id,roleName:e.channel_name,memberCount:0,createdAt:e.created_at,createdBy:e.created_by}))}catch(t){return[]}}async deleteChannel(e){try{const{error:t}=await W.from("trip_channels").delete().eq("id",e);if(t)throw t;return!0}catch(t){return!1}}canUserAccessChannel(e,t){return!0}async sendChannelMessage(e,t){try{const{data:{user:n}}=await W.auth.getUser();if(!n)throw new Error("No authenticated user");const{data:a,error:r}=await W.from("channel_messages").insert({channel_id:e,sender_id:n.id,content:t}).select().single();if(r)throw r;return{id:a.id,channelId:a.channel_id,senderId:a.sender_id,content:a.content,createdAt:a.created_at}}catch(n){return null}}async getChannelMessages(e){try{const{data:t,error:n}=await W.from("channel_messages").select("\n          *,\n          sender:sender_id (\n            id,\n            raw_user_meta_data\n          ),\n          profiles!sender_id (\n            display_name,\n            avatar_url\n          )\n        ").eq("channel_id",e).is("deleted_at",null).order("created_at",{ascending:!0});if(n)throw n;return(t||[]).map(e=>{var t,n,a,r,i,s;return{id:e.id,channelId:e.channel_id,senderId:e.sender_id,senderName:(null==(t=e.profiles)?void 0:t.display_name)||(null==(a=null==(n=e.sender)?void 0:n.raw_user_meta_data)?void 0:a.full_name)||"Anonymous",senderAvatar:(null==(r=e.profiles)?void 0:r.avatar_url)||(null==(s=null==(i=e.sender)?void 0:i.raw_user_meta_data)?void 0:s.avatar_url),content:e.content,createdAt:e.created_at}})}catch(t){return[]}}subscribeToChannel(e,t){const n=W.channel(`channel_messages:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"channel_messages",filter:`channel_id=eq.${e}`},e=>{t({id:e.new.id,channelId:e.new.channel_id,senderId:e.new.sender_id,content:e.new.content,createdAt:e.new.created_at})}).subscribe();return()=>{n.unsubscribe()}}},Zh=[{channel:{channelName:"Players",channelSlug:"players",description:"Team player discussions",requiredRoleId:"demo-role-players",requiredRoleName:"Players",isPrivate:!0,isArchived:!1,memberCount:15,createdBy:"demo-user"},messages:[{senderName:"LeBron James",content:"Who's got the playlist for the bus? ðŸŽµ",timestamp:"2:30 PM"},{senderName:"Anthony Davis",content:"I got you. Sending now.",timestamp:"2:32 PM"},{senderName:"Head Coach",content:"ðŸš¨ URGENT: Bus departure moved to 5:45 AM sharp. NO exceptions.",timestamp:"4:30 PM",isBroadcast:!0,category:"urgent"},{senderName:"Austin Reaves",content:"Practice tomorrow 2pm at the arena ðŸ€",timestamp:"4:45 PM"}]},{channel:{channelName:"Coaches",channelSlug:"coaches",description:"Coaching staff coordination",requiredRoleId:"demo-role-coaches",requiredRoleName:"Coaches",isPrivate:!0,isArchived:!1,memberCount:5,createdBy:"demo-user"},messages:[{senderName:"Head Coach",content:"Reviewing game film at 7pm in conference room B",timestamp:"11:15 AM"},{senderName:"Assistant Coach",content:"Defense needs work on pick and roll coverage",timestamp:"11:20 AM"},{senderName:"Head Coach",content:"Strategy session after practice. All coaches required.",timestamp:"12:00 PM",isBroadcast:!0,category:"logistics"}]},{channel:{channelName:"Medical Staff",channelSlug:"medical-staff",description:"Medical team coordination",requiredRoleId:"demo-role-medical",requiredRoleName:"Medical Staff",isPrivate:!0,isArchived:!1,memberCount:4,createdBy:"demo-user"},messages:[{senderName:"Team Doctor",content:"Injury report: 2 players need treatment before game",timestamp:"9:00 AM"},{senderName:"Physical Therapist",content:"Recovery sessions scheduled for 1pm",timestamp:"9:15 AM"}]},{channel:{channelName:"Security",channelSlug:"security",description:"Security team coordination",requiredRoleId:"demo-role-security",requiredRoleName:"Security",isPrivate:!0,isArchived:!1,memberCount:6,createdBy:"demo-user"},messages:[{senderName:"Security Chief",content:"Arena entrance secured. All checkpoints active.",timestamp:"8:00 AM"},{senderName:"Security Lead",content:"VIP section ready. Badge system operational.",timestamp:"8:30 AM"}]},{channel:{channelName:"Crew",channelSlug:"crew",description:"Operations and logistics crew",requiredRoleId:"demo-role-crew",requiredRoleName:"Crew",isPrivate:!0,isArchived:!1,memberCount:10,createdBy:"demo-user"},messages:[{senderName:"Equipment Manager",content:"All gear loaded on bus. Ready for departure.",timestamp:"7:00 AM"},{senderName:"Travel Coordinator",content:"Hotel check-in confirmed for 3pm arrival",timestamp:"7:15 AM"}]}],Jh=[{channel:{channelName:"Production",channelSlug:"production",description:"Production team coordination",requiredRoleId:"demo-role-production",requiredRoleName:"Production",isPrivate:!0,isArchived:!1,memberCount:25,createdBy:"demo-user"},messages:[{senderName:"Production Lead",content:"Stage setup complete. Sound check at 3pm",timestamp:"1:45 PM"},{senderName:"Lighting Director",content:"New lighting cues programmed for Act 2",timestamp:"2:10 PM"},{senderName:"Tour Manager",content:"Showtime in 90 minutes. All crew report to positions NOW.",timestamp:"2:20 PM",isBroadcast:!0,category:"urgent"},{senderName:"Stage Manager",content:"All pyro tested and ready for tonight",timestamp:"2:30 PM"}]},{channel:{channelName:"Security",channelSlug:"security",description:"Security team coordination",requiredRoleId:"demo-role-security",requiredRoleName:"Security",isPrivate:!0,isArchived:!1,memberCount:20,createdBy:"demo-user"},messages:[{senderName:"Security Chief",content:"VIP entrance secured. Meet & greet at 6pm",timestamp:"10:00 AM"},{senderName:"Security Chief",content:"Reminder: Backstage credentials must be visible at all times",timestamp:"10:15 AM",isBroadcast:!0,category:"logistics"},{senderName:"Head of Security",content:"Barricades in place. Crowd control ready",timestamp:"10:30 AM"}]}],eg=[{channel:{channelName:"Executives",channelSlug:"executives",description:"Executive team discussions",requiredRoleId:"demo-role-executives",requiredRoleName:"Executives",isPrivate:!0,isArchived:!1,memberCount:8,createdBy:"demo-user"},messages:[{senderName:"David Ricks",content:"Strategic planning session moved to 3pm today",timestamp:"9:00 AM"},{senderName:"Executive Assistant",content:"Board meeting materials now available in shared drive",timestamp:"9:10 AM",isBroadcast:!0,category:"chill"},{senderName:"Anat Ashkenazi",content:"Q1 financials deck ready for review",timestamp:"9:15 AM"},{senderName:"Dan Skovronsky",content:"R&D pipeline update at tomorrow's session",timestamp:"10:30 AM"}]},{channel:{channelName:"Event Planning",channelSlug:"event-planning",description:"Event coordination team",requiredRoleId:"demo-role-event",requiredRoleName:"Event Planning",isPrivate:!0,isArchived:!1,memberCount:4,createdBy:"demo-user"},messages:[{senderName:"Event Coordinator",content:"Dinner reservations confirmed for 7:30pm",timestamp:"11:00 AM"},{senderName:"Meeting Planner",content:"AV equipment tested in all conference rooms",timestamp:"11:20 AM"},{senderName:"Event Coordinator",content:"Transportation departing hotel lobby at 7:00pm sharp",timestamp:"11:45 AM",isBroadcast:!0,category:"logistics"}]}],tg=[{channel:{channelName:"Production Crew",channelSlug:"production-crew",description:"Production team coordination",requiredRoleId:"demo-role-production",requiredRoleName:"Production",isPrivate:!0,isArchived:!1,memberCount:12,createdBy:"demo-user"},messages:[{senderName:"Production Lead",content:"Stage setup complete. Sound check at 3pm",timestamp:"1:45 PM"},{senderName:"AV Tech",content:"Lighting programmed and ready to test",timestamp:"2:10 PM"},{senderName:"Stage Manager",content:"Truck arrives at 4pm. Everyone ready to sync.",timestamp:"2:30 PM"}]},{channel:{channelName:"Security",channelSlug:"security",description:"Security team coordination",requiredRoleId:"demo-role-security",requiredRoleName:"Security",isPrivate:!0,isArchived:!1,memberCount:8,createdBy:"demo-user"},messages:[{senderName:"Security Chief",content:"Perimeter secured. All checkpoints active.",timestamp:"10:00 AM"},{senderName:"Security Lead",content:"VIP entrance ready. Badge system live.",timestamp:"10:30 AM"}]}],ng=(e,t)=>{const n=(new Date).toISOString();let a=[];const r=String(e);if("13"===r||"lakers-road-trip"===r?a=Zh:"14"===r||"tesla-cybertruck-roadshow-2025"===r?a=tg:"15"===r||"beyonce-cowboy-carter-tour"===r?a=Jh:"16"!==r&&"eli-lilly-c-suite-retreat-2026"!==r||(a=eg),0===a.length&&t&&t.length>0)return((e,t)=>{const n=(new Date).toISOString(),a=[...new Set(t.filter(Boolean))],r=a.slice(0,5);a.length;const i=r.map((t,a)=>({id:`demo-channel-${e}-${a}`,tripId:e,channelName:t,channelSlug:t.toLowerCase().replace(/\s+/g,"-"),description:`${t} coordination channel`,requiredRoleId:`demo-role-${t.toLowerCase()}`,requiredRoleName:t,isPrivate:!0,isArchived:!1,memberCount:1,createdAt:n,updatedAt:n,createdBy:"demo-user"})),s=new Map;return i.forEach(e=>s.set(e.id,[])),{channels:i,messagesByChannel:s}})(e,t);const i=a.map((t,a)=>({id:`demo-channel-${e}-${a}`,tripId:e,...t.channel,createdAt:n,updatedAt:n})),s=new Map;return a.forEach((t,a)=>{const r=`demo-channel-${e}-${a}`,i=t.messages.map((e,t)=>({id:`demo-msg-${r}-${t}`,channelId:r,senderId:`demo-sender-${t}`,senderName:e.senderName,content:e.content,messageType:e.isBroadcast?"system":"text",metadata:e.isBroadcast?{isBroadcast:!0,category:e.category}:void 0,createdAt:n,editedAt:void 0,deletedAt:void 0}));s.set(r,i)}),{channels:i,messagesByChannel:s}};class ag{static seedRolesForTrip(e,t,n){const a=this.getRolesForTrip(e);if(a)return a;const r=this.getAllRoles();return r[e]=[],localStorage.setItem(this.MOCK_ROLES_KEY,JSON.stringify(r)),[]}static seedChannelsForRoles(e,t,n){const a=t.map((t,a)=>({id:`mock-channel-${e}-${a}`,tripId:e,channelName:`#${t.roleName.toLowerCase().replace(/\s+/g,"-")}`,channelSlug:t.roleName.toLowerCase().replace(/\s+/g,"-"),description:`Private channel for ${t.roleName} only`,isPrivate:!0,isArchived:!1,requiredRoleId:t.id,requiredRoleName:t.roleName,memberCount:0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),createdBy:n})),r=this.getAllChannels();return r[e]=a,localStorage.setItem(this.MOCK_CHANNELS_KEY,JSON.stringify(r)),a}static getRolesForTrip(e){return this.getAllRoles()[e]||null}static createRole(e,t,n,a,r){const i=this.getAllRoles(),s=i[e]||[],o={id:`mock-role-${e}-${Date.now()}`,tripId:e,roleName:t,description:n,permissionLevel:a,featurePermissions:this.getDefaultFeaturePermissions(a),createdBy:r,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),memberCount:0};return s.push(o),i[e]=s,localStorage.setItem(this.MOCK_ROLES_KEY,JSON.stringify(i)),o}static deleteRole(e,t){const n=this.getAllRoles(),a=n[e]||[],r=a.filter(e=>e.id!==t);return r.length!==a.length&&(n[e]=r,localStorage.setItem(this.MOCK_ROLES_KEY,JSON.stringify(n)),!0)}static getChannelsForTrip(e){return this.getAllChannels()[e]||null}static getAllRoles(){const e=localStorage.getItem(this.MOCK_ROLES_KEY);return e?JSON.parse(e):{}}static getAllChannels(){const e=localStorage.getItem(this.MOCK_CHANNELS_KEY);return e?JSON.parse(e):{}}static getDefaultFeaturePermissions(e){return"admin"===e?{channels:{can_view:!0,can_post:!0,can_edit_messages:!0,can_delete_messages:!0,can_manage_members:!0},calendar:{can_view:!0,can_create_events:!0,can_edit_events:!0,can_delete_events:!0},tasks:{can_view:!0,can_create:!0,can_assign:!0,can_complete:!0,can_delete:!0},media:{can_view:!0,can_upload:!0,can_delete_own:!0,can_delete_any:!0},payments:{can_view:!0,can_create:!0,can_approve:!0}}:"edit"===e?{channels:{can_view:!0,can_post:!0,can_edit_messages:!1,can_delete_messages:!1,can_manage_members:!1},calendar:{can_view:!0,can_create_events:!0,can_edit_events:!1,can_delete_events:!1},tasks:{can_view:!0,can_create:!0,can_assign:!1,can_complete:!0,can_delete:!1},media:{can_view:!0,can_upload:!0,can_delete_own:!0,can_delete_any:!1},payments:{can_view:!0,can_create:!1,can_approve:!1}}:{channels:{can_view:!0,can_post:!1,can_edit_messages:!1,can_delete_messages:!1,can_manage_members:!1},calendar:{can_view:!0,can_create_events:!1,can_edit_events:!1,can_delete_events:!1},tasks:{can_view:!0,can_create:!1,can_assign:!1,can_complete:!0,can_delete:!1},media:{can_view:!0,can_upload:!1,can_delete_own:!1,can_delete_any:!1},payments:{can_view:!0,can_create:!1,can_approve:!1}}}static clearMockData(e){if(e){const t=this.getAllRoles(),n=this.getAllChannels();delete t[e],delete n[e],localStorage.setItem(this.MOCK_ROLES_KEY,JSON.stringify(t)),localStorage.setItem(this.MOCK_CHANNELS_KEY,JSON.stringify(n))}else localStorage.removeItem(this.MOCK_ROLES_KEY),localStorage.removeItem(this.MOCK_CHANNELS_KEY),localStorage.removeItem(this.MOCK_ASSIGNMENTS_KEY)}}t(ag,"MOCK_ROLES_KEY","demo_pro_trip_roles"),t(ag,"MOCK_CHANNELS_KEY","demo_pro_trip_channels"),t(ag,"MOCK_ASSIGNMENTS_KEY","demo_pro_trip_assignments");const rg=["lakers-road-trip","beyonce-cowboy-carter-tour","eli-lilly-c-suite-retreat-2026","13","14","15","16","1","2","3","4","5","6","7","8","9","10","11","12"],ig=e=>({id:e.id,tripId:e.tripId,channelName:e.roleName,channelSlug:e.roleName.toLowerCase().replace(/\s+/g,"-"),requiredRoleId:"role-"+e.id,requiredRoleName:e.roleName,isPrivate:!0,isArchived:!1,memberCount:e.memberCount||0,createdBy:e.createdBy,createdAt:e.createdAt,updatedAt:e.createdAt}),sg=e=>({id:e.id,channelId:e.channelId,senderId:e.senderId,senderName:e.senderName,senderAvatar:void 0,content:e.content,createdAt:e.createdAt}),og=(e,t,n)=>{const{isDemoMode:a}=X(),[r,i]=L.useState([]),[s,o]=L.useState(null),[l,c]=L.useState([]),[d,u]=L.useState(!1),[m,p]=L.useState(new Map),h=rg.includes(e),g=L.useCallback(async()=>{if(u(!0),a||h){const t=ag.getChannelsForTrip(e);if(t&&t.length>0)return i(t),void u(!1);const{channels:a,messagesByChannel:r}=ng(e,n);return i(a),p(r),void u(!1)}try{const n=await Xh.getRoleChannels(e);if(!n||0===n.length)return i([]),void u(!1);const a=n.filter(e=>Xh.canUserAccessChannel(e,t)).map(ig);i(a)}catch(r){i([])}u(!1)},[e,t,a,h,n]);L.useEffect(()=>{g()},[g]),L.useEffect(()=>{if(!s)return void c([]);if(h){const e=(m.get(s.id)||[]).map(sg);return void c(e)}(async()=>{const e=await Xh.getChannelMessages(s.id);c(e)})();return Xh.subscribeToChannel(s.id,e=>{c(t=>[...t,e])})},[s,h,m]);return{availableChannels:r,activeChannel:s,messages:l,isLoading:d,setActiveChannel:o,createChannel:async t=>!!(await Xh.createRoleChannel(e,t))&&(await g(),!0),deleteChannel:async e=>!!(await Xh.deleteChannel(e))&&((null==s?void 0:s.id)===e&&o(null),await g(),!0),sendMessage:async e=>{if(!s)return!1;if(h){const t={id:`demo-msg-${Date.now()}`,channelId:s.id,senderId:"demo-user",senderName:"You",content:e,createdAt:(new Date).toISOString()};return c(e=>[...e,t]),!0}return!!(await Xh.sendChannelMessage(s.id,e))},refreshChannels:g}};const lg=new class{async isAdmin(e,t){var n;try{const a=t||(null==(n=(await W.auth.getUser()).data.user)?void 0:n.id);if(!a)return!1;const{data:r}=await W.from("trip_admins").select("id").eq("trip_id",e).eq("user_id",a).single();return!!r}catch{return!1}}async hasAdminPermission(e,t,n){var a;try{const r=n||(null==(a=(await W.auth.getUser()).data.user)?void 0:a.id);if(!r)return!1;const{data:i}=await W.from("trip_admins").select("permissions").eq("trip_id",e).eq("user_id",r).single();if(!i)return!1;const s=i.permissions;return!0===(null==s?void 0:s[t])}catch{return!1}}async getUserPrimaryRole(e,t){var n;try{const a=t||(null==(n=(await W.auth.getUser()).data.user)?void 0:n.id);if(!a)return null;const{data:r}=await W.from("user_trip_roles").select("role_id, trip_roles(*)").eq("trip_id",e).eq("user_id",a).eq("is_primary",!0).single();if(!(null==r?void 0:r.trip_roles))return null;const i=r.trip_roles;return{id:i.id,tripId:i.trip_id,roleName:i.role_name,description:i.description,createdBy:i.created_by,createdAt:i.created_at,updatedAt:i.updated_at}}catch{return null}}async createRole(e){try{const{data:{user:t}}=await W.auth.getUser();if(!t)return null;const{data:n,error:a}=await W.from("trip_roles").insert({trip_id:e.tripId,role_name:e.roleName,description:e.description,created_by:t.id}).select().single();if(a)throw a;return{id:n.id,tripId:n.trip_id,roleName:n.role_name,description:n.description,createdBy:n.created_by,createdAt:n.created_at,updatedAt:n.updated_at}}catch{return null}}async getRoles(e){try{const{data:t}=await W.from("trip_roles").select("*").eq("trip_id",e).order("created_at");return(t||[]).map(e=>({id:e.id,tripId:e.trip_id,roleName:e.role_name,description:e.description,createdBy:e.created_by,createdAt:e.created_at,updatedAt:e.updated_at}))}catch{return[]}}async deleteRole(e){try{const{error:t}=await W.from("trip_roles").delete().eq("id",e);return!t}catch{return!1}}async assignUserToRole(e){try{const{data:{user:t}}=await W.auth.getUser();if(!t)return!1;if(!1!==e.isPrimary){const{data:t}=await W.from("user_trip_roles").select("id").eq("trip_id",e.tripId).eq("user_id",e.userId).eq("is_primary",!0).single();if(t)throw new Error("User already has a primary role for this trip")}const{error:n}=await W.from("user_trip_roles").insert({trip_id:e.tripId,user_id:e.userId,role_id:e.roleId,assigned_by:t.id,is_primary:!1!==e.isPrimary});return!n}catch{return!1}}async revokeUserFromRole(e,t,n){try{const{error:a}=await W.from("user_trip_roles").delete().eq("trip_id",e).eq("user_id",t).eq("role_id",n);return!a}catch{return!1}}async getUserRoles(e,t){try{const{data:n}=await W.from("user_trip_roles").select("role_id, trip_roles(*)").eq("trip_id",e).eq("user_id",t);return(n||[]).filter(e=>e.trip_roles).map(e=>{const t=e.trip_roles;return{id:t.id,tripId:t.trip_id,roleName:t.role_name,description:t.description,createdBy:t.created_by,createdAt:t.created_at,updatedAt:t.updated_at}})}catch{return[]}}async getRoleAssignments(e){try{const{data:t}=await W.from("user_trip_roles").select("*, trip_roles(role_name)").eq("trip_id",e);return(t||[]).map(e=>{var t;return{id:e.id,tripId:e.trip_id,userId:e.user_id,roleId:e.role_id,roleName:null==(t=e.trip_roles)?void 0:t.role_name,assignedBy:e.assigned_by,assignedAt:e.assigned_at}})}catch{return[]}}async createChannel(e){try{const{data:{user:t}}=await W.auth.getUser();if(!t)return null;const{data:n}=await W.from("trip_channels").insert({trip_id:e.tripId,channel_name:e.channelName,channel_slug:e.channelSlug,description:e.description,required_role_id:e.requiredRoleId,is_private:e.isPrivate??!0,created_by:t.id}).select().single();return{id:n.id,tripId:n.trip_id,channelName:n.channel_name,channelSlug:n.channel_slug,description:n.description,requiredRoleId:n.required_role_id,isPrivate:n.is_private,isArchived:n.is_archived,createdBy:n.created_by,createdAt:n.created_at,updatedAt:n.updated_at}}catch{return null}}async createChannelWithRoles(e,t,n,a,r){try{const{data:{user:i}}=await W.auth.getUser();if(!i)return null;const{data:s,error:o}=await W.from("trip_channels").insert({trip_id:e,channel_name:t,channel_slug:n,description:r,required_role_id:a.length>0?a[0]:null,is_private:!0,created_by:i.id}).select().single();if(o||!s)throw o;if(a.length>0){const e=a.map(e=>({channel_id:s.id,role_id:e})),{error:t}=await W.from("channel_role_access").insert(e)}return{id:s.id,tripId:s.trip_id,channelName:s.channel_name,channelSlug:s.channel_slug,description:s.description,requiredRoleId:s.required_role_id,isPrivate:s.is_private,isArchived:s.is_archived,createdBy:s.created_by,createdAt:s.created_at,updatedAt:s.updated_at}}catch(i){return null}}async getAccessibleChannels(e){try{const{data:{user:t}}=await W.auth.getUser();if(!t)return[];const n=await this.getUserPrimaryRole(e,t.id);if(!n)return[];const{data:a}=await W.from("trip_channels").select("\n          *,\n          trip_roles!inner(role_name),\n          channel_role_access!inner(role_id)\n        ").eq("trip_id",e).eq("is_archived",!1).eq("channel_role_access.role_id",n.id);return(a||[]).map(e=>{var t;return{id:e.id,tripId:e.trip_id,channelName:e.channel_name,channelSlug:e.channel_slug,description:e.description,requiredRoleId:e.required_role_id,requiredRoleName:null==(t=e.trip_roles)?void 0:t.role_name,isPrivate:e.is_private,isArchived:e.is_archived,createdBy:e.created_by,createdAt:e.created_at,updatedAt:e.updated_at}})}catch{return[]}}async sendMessage(e){try{const{data:{user:t}}=await W.auth.getUser();if(!t)return null;const n={channel_id:e.channelId,sender_id:t.id,content:e.content,message_type:"broadcast"===e.messageType?"broadcast":e.messageType||"text",metadata:e.metadata||{}};"broadcast"===e.messageType&&e.broadcastCategory&&(n.broadcast_category=e.broadcastCategory,n.metadata={...n.metadata,category:e.broadcastCategory});const{data:a}=await W.from("channel_messages").insert(n).select().single();return{id:a.id,channelId:a.channel_id,senderId:a.sender_id,content:a.content,messageType:a.message_type,metadata:a.metadata||{},createdAt:a.created_at}}catch{return null}}async getMessages(e,t=50){try{const{data:n}=await W.from("channel_messages").select("\n          *,\n          profiles!channel_messages_sender_id_fkey(display_name, avatar_url)\n        ").eq("channel_id",e).is("deleted_at",null).order("created_at").limit(t);return(n||[]).map(e=>{const t=e.profiles;return{id:e.id,channelId:e.channel_id,senderId:e.sender_id,senderName:(null==t?void 0:t.display_name)||"Unknown",senderAvatar:null==t?void 0:t.avatar_url,content:e.content,messageType:e.message_type,metadata:e.metadata||{},createdAt:e.created_at}})}catch(n){return[]}}async getAllChannelsForAdmin(e){try{const{data:{user:t}}=await W.auth.getUser();if(!t)return[];if(!(await this.isAdmin(e,t.id)))return[];const{data:n}=await W.from("trip_channels").select("\n          *,\n          trip_roles(role_name)\n        ").eq("trip_id",e).eq("is_archived",!1).order("created_at");return(n||[]).map(e=>{var t;return{id:e.id,tripId:e.trip_id,channelName:e.channel_name,channelSlug:e.channel_slug,description:e.description,requiredRoleId:e.required_role_id,requiredRoleName:null==(t=e.trip_roles)?void 0:t.role_name,isPrivate:e.is_private,isArchived:e.is_archived,createdBy:e.created_by,createdAt:e.created_at,updatedAt:e.updated_at}})}catch{return[]}}subscribeToChannel(e,t,n){const a=W.channel(`chan_${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"channel_messages",filter:`channel_id=eq.${e}`},e=>{t({id:e.new.id,channelId:e.new.channel_id,senderId:e.new.sender_id,content:e.new.content,messageType:e.new.message_type,metadata:e.new.metadata,createdAt:e.new.created_at})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"channel_messages",filter:`channel_id=eq.${e}`},e=>{e.new.deleted_at&&n&&n(e.new.id)}).subscribe();return()=>a.unsubscribe()}async designateAdmin(e,t,n){try{const{data:{user:a}}=await W.auth.getUser();if(!a)return!1;if(!(await this.hasAdminPermission(e,"can_designate_admins",a.id)))throw new Error("Insufficient permissions to designate admins");const r={...{can_manage_roles:!0,can_manage_channels:!0,can_designate_admins:!1},...n},{error:i}=await W.from("trip_admins").insert({trip_id:e,user_id:t,granted_by:a.id,permissions:r});return!i}catch(a){return!1}}async revokeAdmin(e,t){try{const{data:{user:n}}=await W.auth.getUser();if(!n)return!1;if(!(await this.hasAdminPermission(e,"can_designate_admins",n.id)))throw new Error("Insufficient permissions to revoke admin access");const{error:a}=await W.from("trip_admins").delete().eq("trip_id",e).eq("user_id",t);return!a}catch(n){return!1}}async updateAdminPermissions(e,t,n){try{const{data:{user:a}}=await W.auth.getUser();if(!a)return!1;if(!(await this.hasAdminPermission(e,"can_designate_admins",a.id)))throw new Error("Insufficient permissions to update admin permissions");const{data:r}=await W.from("trip_admins").select("permissions").eq("trip_id",e).eq("user_id",t).single();if(!r)throw new Error("Admin not found");const i={...r.permissions,...n},{error:s}=await W.from("trip_admins").update({permissions:i}).eq("trip_id",e).eq("user_id",t);return!s}catch(a){return!1}}async getAdmins(e){try{const{data:t}=await W.from("trip_admins").select("*").eq("trip_id",e);return(t||[]).map(e=>({userId:e.user_id,permissions:e.permissions,grantedBy:e.granted_by,grantedAt:e.granted_at}))}catch{return[]}}},cg=e=>{const{user:t}=Y(),{isDemoMode:n}=X(),[a,r]=L.useState("view"),[i,s]=L.useState(null),[o,l]=L.useState(!1),[c,d]=L.useState(!0),u=L.useCallback(async()=>{if(n)return r("admin"),l(!0),s({channels:{can_view:!0,can_post:!0,can_edit_messages:!0,can_delete_messages:!0,can_manage_members:!0},calendar:{can_view:!0,can_create_events:!0,can_edit_events:!0,can_delete_events:!0},tasks:{can_view:!0,can_create:!0,can_assign:!0,can_complete:!0,can_delete:!0},media:{can_view:!0,can_upload:!0,can_delete_own:!0,can_delete_any:!0},payments:{can_view:!0,can_create:!0,can_approve:!0}}),void d(!1);if((null==t?void 0:t.id)&&e)try{const{data:n}=await W.from("trip_members").select("id, role").eq("trip_id",e).eq("user_id",t.id).maybeSingle(),a=!!n;l(a);const{data:i,error:o}=await W.from("user_trip_roles").select("\n          role_id,\n          trip_roles:role_id (\n            permission_level,\n            feature_permissions\n          )\n        ").eq("trip_id",e).eq("user_id",t.id).eq("is_primary",!0).maybeSingle();if(o||!(null==i?void 0:i.trip_roles))return void(a?(r("edit"),s({channels:{can_view:!0,can_post:!0,can_edit_messages:!0,can_delete_messages:!1,can_manage_members:!1},calendar:{can_view:!0,can_create_events:!0,can_edit_events:!0,can_delete_events:!0},tasks:{can_view:!0,can_create:!0,can_assign:!0,can_complete:!0,can_delete:!0},media:{can_view:!0,can_upload:!0,can_delete_own:!0,can_delete_any:!1},payments:{can_view:!0,can_create:!0,can_approve:!1}})):(r("view"),s(null)));const c=i.trip_roles;r(c.permission_level||"view"),s(c.feature_permissions||null)}catch(a){r("view"),s(null)}finally{d(!1)}else d(!1)},[null==t?void 0:t.id,e,n]);L.useEffect(()=>{u()},[u]);const m=L.useCallback((e,t)=>{if(n)return!0;if(o&&!i){return["can_view","can_create","can_edit","can_create_events","can_edit_events","can_delete_events","can_post","can_upload","can_complete","can_assign","can_delete"].includes(t)}if(!i)return!1;const a=i[e];return!0===(null==a?void 0:a[t])},[i,n,o]);return{permissionLevel:a,featurePermissions:i,isTripMember:o,isLoading:c,canPerformAction:m,isAdmin:"admin"===a,canEdit:"admin"===a||"edit"===a,refreshPermissions:u}},dg=({channel:e,availableChannels:t=[],onBack:a,onChannelChange:r})=>{const[i,s]=L.useState([]),[o,l]=L.useState(""),[c,d]=L.useState(!1),[u,m]=L.useState(!0),[p,h]=L.useState({}),{user:g}=Y(),{toast:f}=ue(),{canPerformAction:x,permissionLevel:v}=cg(e.tripId),y=L.useMemo(()=>i.map(e=>{var t;return{id:e.id,text:e.content,sender:{id:e.senderId,name:e.senderName,avatar:Xe(e.senderName)},createdAt:e.createdAt,isBroadcast:(null==(t=e.metadata)?void 0:t.isBroadcast)||"system"===e.messageType,isPayment:!1,tags:[]}}),[i]);L.useEffect(()=>{b();if(!["lakers-road-trip","beyonce-cowboy-carter-tour","eli-lilly-c-suite-retreat-2026"].includes(e.tripId)){return lg.subscribeToChannel(e.id,e=>{s(t=>[...t,e])},e=>{s(t=>t.filter(t=>t.id!==e))})}},[e.id,e.tripId]);const b=async()=>{m(!0);if(["lakers-road-trip","beyonce-cowboy-carter-tour","eli-lilly-c-suite-retreat-2026"].includes(e.tripId)){const{messagesByChannel:t}=ng(e.tripId),n=t.get(e.id)||[];return s(n),void m(!1)}const t=await lg.getMessages(e.id);s(t),m(!1)},w=async(t=!1)=>{if(!o.trim()||c)return;d(!0);if(["lakers-road-trip","beyonce-cowboy-carter-tour","eli-lilly-c-suite-retreat-2026"].includes(e.tripId)){const n={id:`demo-msg-${Date.now()}`,channelId:e.id,senderId:(null==g?void 0:g.id)||"demo-user",senderName:(null==g?void 0:g.displayName)||"You",content:o.trim(),messageType:t?"system":"text",metadata:t?{isBroadcast:!0}:void 0,createdAt:(new Date).toISOString()};return s(e=>[...e,n]),l(""),void d(!1)}await lg.sendMessage({channelId:e.id,content:o.trim(),messageType:t?"broadcast":"regular"})?l(""):f({title:"Failed to send message",variant:"destructive"}),d(!1)},j=(e,t)=>{const n={...p};n[e]||(n[e]={});const a=n[e][t]||{count:0,userReacted:!1};a.userReacted=!a.userReacted,a.count+=a.userReacted?1:-1,n[e][t]=a,h(n)};return L.useMemo(()=>{if(!(null==e?void 0:e.id)||!t||0===t.length)return 0;const n=t.find(t=>t.id===e.id);return(null==n?void 0:n.memberCount)??0},[null==e?void 0:e.id,t]),n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex-1",children:u?n.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:n.jsx("div",{className:"text-center text-gray-400 py-8",children:"Loading messages..."})}):n.jsx(wo,{messages:y,renderMessage:e=>n.jsx(Ih,{message:e,reactions:p[e.id],onReaction:j}),onLoadMore:()=>{},hasMore:!1,isLoading:!1,className:"chat-scroll-container native-scroll px-3",autoScroll:!0})}),n.jsx("div",{className:"bg-black/30 p-3 pb-[env(safe-area-inset-bottom)] md:pb-3",children:x("channels","can_post")?n.jsx(uo,{inputMessage:o,onInputChange:l,onSendMessage:w,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},apiKey:"",isTyping:c,tripMembers:[],hidePayments:!0,isInChannelMode:!0,isPro:!0,tripId:e.tripId}):n.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-3 flex items-center gap-2 text-gray-400",children:[n.jsx($e,{size:16}),n.jsx("span",{className:"text-sm",children:"You have view-only access to this channel"})]})})]})},ug=({typingUsers:e})=>{if(0===e.length)return null;const t=e.map(e=>e.userName);let a="";return a=1===t.length?`${t[0]} is typing...`:2===t.length?`${t[0]} and ${t[1]} are typing...`:`${t[0]} and ${t.length-1} others are typing...`,n.jsx("div",{className:"px-4 py-2 text-sm text-gray-400 italic animate-pulse",children:a})};class mg{constructor(e,n,a){t(this,"channel",null),t(this,"tripId"),t(this,"userId"),t(this,"userName"),t(this,"typingTimeout",null),t(this,"isTyping",!1),this.tripId=e,this.userId=n,this.userName=a}async initialize(e){this.channel=W.channel(`typing:${this.tripId}`,{config:{presence:{key:this.userId}}}),this.channel.on("presence",{event:"sync"},()=>{var t;const n=null==(t=this.channel)?void 0:t.presenceState(),a=this.extractTypingUsers(n||{});e(a)}).on("presence",{event:"join"},({key:t,newPresences:n})=>{var a;const r=this.extractTypingUsers((null==(a=this.channel)?void 0:a.presenceState())||{});e(r)}).on("presence",{event:"leave"},({key:t,leftPresences:n})=>{var a;const r=this.extractTypingUsers((null==(a=this.channel)?void 0:a.presenceState())||{});e(r)}).subscribe(async e=>{var t;"SUBSCRIBED"===e&&await(null==(t=this.channel)?void 0:t.track({userId:this.userId,userName:this.userName,typing:!1,timestamp:Date.now()}))})}async startTyping(){var e;this.isTyping||(this.isTyping=!0,await(null==(e=this.channel)?void 0:e.track({userId:this.userId,userName:this.userName,typing:!0,timestamp:Date.now()})),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.stopTyping()},3e3))}async stopTyping(){var e;this.isTyping&&(this.isTyping=!1,this.typingTimeout&&(clearTimeout(this.typingTimeout),this.typingTimeout=null),await(null==(e=this.channel)?void 0:e.track({userId:this.userId,userName:this.userName,typing:!1,timestamp:Date.now()})))}extractTypingUsers(e){const t=[],n=Date.now();return Object.values(e).forEach(e=>{e.forEach(e=>{!0===e.typing&&e.userId!==this.userId&&n-e.timestamp<5e3&&t.push({userId:e.userId,userName:e.userName||"Someone",timestamp:e.timestamp})})}),t}async cleanup(){this.typingTimeout&&clearTimeout(this.typingTimeout),await this.stopTyping(),this.channel&&(await W.removeChannel(this.channel),this.channel=null)}}async function pg(e,t,n){const a=e.map(e=>({message_id:e,user_id:n,message_type:"trip",read_at:(new Date).toISOString()})),{error:r}=await W.from("message_read_receipts").upsert(a,{onConflict:"message_id,user_id"});if(r)throw r}function hg({tripId:e,messages:t,userId:n,enabled:a=!0}){const[r,i]=L.useState(0),[s,o]=L.useState(0);return L.useEffect(()=>{if(!a||!n||!e||0===t.length)return i(0),void o(0);const r=async()=>{try{const e=t.map(e=>e.id),{data:a,error:r}=await W.from("message_read_receipts").select("message_id").eq("user_id",n).in("message_id",e);if(r)return;const s=new Set((a||[]).map(e=>e.message_id)),l=t.filter(e=>!s.has(e.id)&&e.user_id!==n),c=l.length,d=l.filter(e=>"broadcast"===e.privacy_mode).length;i(c),o(d)}catch(e){}};r();const s=W.channel(`unread_counts:${e}:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"message_read_receipts",filter:`user_id=eq.${n}`},()=>{r()}).subscribe();return()=>{W.removeChannel(s)}},[e,n,t,a]),{unreadCount:r,broadcastCount:s}}const gg=({activeFilter:e,onFilterChange:t,hasChannels:a=!1,isPro:r=!1,broadcastCount:i=0,unreadCount:s=0,availableChannels:o=[],activeChannel:l,onChannelSelect:c,onSearchClick:d})=>{const u=L.useRef(null),[m,p]=L.useState(0),[h,g]=L.useState(!1);L.useEffect(()=>{if(!u.current)return;const e=()=>{u.current&&p(u.current.offsetWidth)};e();const t=new ResizeObserver(e);return t.observe(u.current),()=>t.disconnect()},[]),L.useEffect(()=>{"channels"===e&&a&&o.length>0?g(!0):g(!1)},[e,a,o.length]);return n.jsx("div",{className:"sticky top-0 z-10 backdrop-blur-lg px-2 py-1 rounded-t-2xl overflow-hidden",children:n.jsx("div",{className:"flex items-center justify-center",children:n.jsxs("div",{ref:u,className:"inline-flex items-center bg-neutral-900/70 backdrop-blur-md border border-white/10 rounded-xl p-0.5 shadow-lg max-w-full sm:max-w-[450px] md:max-w-[520px] lg:max-w-[600px]",children:[n.jsxs("button",{onClick:()=>t("all"),className:G("relative flex items-center gap-1.5 px-3 py-2 rounded-xl","text-sm font-medium transition-all duration-200","all"===e?"bg-blue-600 text-white shadow-md":"text-white/70 hover:text-white hover:bg-white/5"),"aria-pressed":"all"===e,children:[n.jsx(Ct,{className:"w-4 h-4"}),n.jsx("span",{children:"Messages"}),s>0&&"all"!==e&&n.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-xs rounded-full bg-blue-500 text-white font-semibold",children:s})]}),n.jsxs("button",{onClick:()=>t("broadcasts"),className:G("relative flex items-center gap-1.5 px-3 py-2 rounded-xl","text-sm font-medium transition-all duration-200","broadcasts"===e?"bg-orange-500 text-white shadow-md":"text-orange-400/70 hover:text-orange-400 hover:bg-orange-500/10"),"aria-pressed":"broadcasts"===e,children:[n.jsx(Me,{className:"w-4 h-4"}),n.jsx("span",{children:"Broadcasts"}),i>0&&"broadcasts"!==e&&n.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-xs rounded-full bg-orange-500 text-white font-semibold",children:i})]}),r&&n.jsxs(Vt,{open:h,onOpenChange:g,children:[n.jsx(Ht,{asChild:!0,children:n.jsxs("button",{onClick:()=>{a&&t("channels")},disabled:!a,className:G("relative flex items-center gap-1.5 px-3 py-2 rounded-xl","text-sm font-medium transition-all duration-200",!a&&"opacity-40 cursor-not-allowed","channels"===e&&a?"bg-purple-500 text-white shadow-md":"text-purple-400/70 hover:text-purple-400 hover:bg-purple-500/10",!a&&"hover:bg-transparent"),"aria-pressed":"channels"===e,title:a?void 0:"No role-based channels for this trip",children:[n.jsx(pa,{className:"w-4 h-4"}),n.jsx("span",{children:l?l.channelName.toLowerCase().replace(/\s+/g,"-"):"Channels"}),l&&a&&n.jsx(Xt,{className:"w-3 h-3 opacity-70"})]})}),a&&o.length>0&&n.jsx(Wt,{side:"bottom",align:"center",className:"channel-dropdown rounded-xl backdrop-blur-md bg-neutral-900 border border-white/10 shadow-lg p-2 mt-1 z-50 w-auto",sideOffset:4,children:n.jsxs("div",{className:"flex flex-col gap-1 min-w-[200px]",children:[n.jsxs("button",{onClick:()=>{null==c||c(null),t("all"),g(!1)},className:G("flex items-center justify-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200",l?"text-white/70 hover:text-white hover:bg-white/10":"bg-blue-500 text-white shadow-md"),children:[n.jsx(Ct,{className:"w-3.5 h-3.5 flex-shrink-0"}),n.jsx("span",{className:"whitespace-nowrap",children:"All Messages"})]}),n.jsx("div",{className:"h-px bg-white/10 my-1"}),o.sort((e,t)=>e.channelName.localeCompare(t.channelName)).map(e=>n.jsxs("button",{onClick:()=>(e=>{null==c||c(e),g(!1)})(e),className:G("flex items-center justify-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200",(null==l?void 0:l.id)===e.id?"bg-purple-500 text-white shadow-md":"text-white/70 hover:text-white hover:bg-white/10"),children:[n.jsx(pa,{className:"w-3.5 h-3.5 flex-shrink-0"}),n.jsx("span",{className:"whitespace-nowrap",children:e.channelName.toLowerCase().replace(/\s+/g,"-")}),n.jsx("span",{className:"text-xs text-white/50 flex-shrink-0",children:e.memberCount||0})]},e.id))]})})]}),n.jsxs("button",{onClick:d,className:G("relative flex items-center gap-1.5 px-3 py-2 rounded-xl","text-sm font-medium transition-all duration-200","text-cyan-400/70 hover:text-cyan-400 hover:bg-cyan-500/10"),title:"Search messages and broadcasts",children:[n.jsx($t,{className:"w-4 h-4"}),n.jsx("span",{children:"Search"})]})]})})})};async function fg(e,t,n=50){if(!t.trim())return[];const{data:a,error:r}=await W.from("trip_chat_messages").select("\n      id,\n      content,\n      author_name,\n      user_id,\n      created_at\n    ").eq("trip_id",e).ilike("content",`%${t}%`).is("deleted_at",null).order("created_at",{ascending:!1}).limit(n);return r?[]:(a||[]).map(e=>({...e,type:"message"}))}async function xg(e,t,n=50){if(!t.trim())return[];const{data:a,error:r}=await W.from("broadcasts").select("\n      id,\n      message,\n      created_by,\n      priority,\n      created_at\n    ").eq("trip_id",e).eq("is_sent",!0).ilike("message",`%${t}%`).order("created_at",{ascending:!1}).limit(n);if(r)return[];const i=[...new Set((null==a?void 0:a.map(e=>e.created_by))||[])],{data:s}=await W.from("profiles").select("user_id, display_name, first_name, last_name").in("user_id",i),o=new Map((s||[]).map(e=>[e.user_id,e.display_name||`${e.first_name||""} ${e.last_name||""}`.trim()||"Unknown"]));return(a||[]).map(e=>({...e,created_by_name:o.get(e.created_by)||"Unknown",type:"broadcast"}))}const vg=({tripId:e,onClose:t,onResultSelect:a,isDemoMode:r=!1,demoMessages:i=[]})=>{const[s,o]=L.useState(""),[l,c]=L.useState(!1),[d,u]=L.useState([]),[m,p]=L.useState([]),[h,g]=L.useState(0),f=L.useRef(null),x=L.useRef(null),v=d.length+m.length;L.useEffect(()=>{var e;null==(e=f.current)||e.focus()},[]),L.useEffect(()=>{if(!s.trim())return u([]),void p([]);c(!0);const t=setTimeout(async()=>{if(r&&i.length>0){const e=s.toLowerCase(),t=i.filter(t=>!t.isBroadcast&&t.text.toLowerCase().includes(e)).map(e=>({id:e.id,content:e.text,author_name:e.sender.name,user_id:e.sender.id,created_at:e.createdAt,type:"message"})),n=i.filter(t=>t.isBroadcast&&t.text.toLowerCase().includes(e)).map(e=>{var t,n;return{id:e.id,message:e.text,created_by:e.sender.id,created_by_name:e.sender.name,priority:(null==(t=e.tags)?void 0:t.includes("urgent"))?"urgent":(null==(n=e.tags)?void 0:n.includes("logistics"))?"high":"normal",created_at:e.createdAt,type:"broadcast"}});u(t),p(n)}else{const t=await async function(e,t){const[n,a]=await Promise.all([fg(e,t),xg(e,t)]);return{messages:n,broadcasts:a}}(e,s);u(t.messages),p(t.broadcasts)}c(!1),g(0)},300);return()=>clearTimeout(t)},[s,e,r,i]),L.useEffect(()=>{const e=e=>{"Escape"===e.key?t():"ArrowDown"===e.key?(e.preventDefault(),g(e=>Math.min(e+1,v-1))):"ArrowUp"===e.key?(e.preventDefault(),g(e=>Math.max(e-1,0))):"Enter"===e.key&&v>0&&(e.preventDefault(),y(h))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h,v]),L.useEffect(()=>{if(x.current&&v>0){const e=x.current.querySelector(`[data-index="${h}"]`);null==e||e.scrollIntoView({behavior:"smooth",block:"nearest"})}},[h,v]);const y=e=>{if(e<d.length){const t=d[e];a(t.id,"message")}else{const t=m[e-d.length];a(t.id,"broadcast")}},b=e=>{if(!e||"normal"===e)return null;const t={urgent:{bg:"bg-red-500",text:"Urgent"},high:{bg:"bg-orange-500",text:"High"},reminder:{bg:"bg-blue-500",text:"Reminder"}}[e]||null;return t?n.jsx("span",{className:G("px-2 py-0.5 rounded-full text-xs font-medium text-white",t.bg),children:t.text}):null},w=(e,t=100)=>e.length<=t?e:e.substring(0,t)+"...";return n.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-20 px-4 bg-black/80 backdrop-blur-md animate-fade-in",children:n.jsxs("div",{className:"w-full max-w-2xl bg-neutral-900 rounded-2xl shadow-2xl border border-white/10 overflow-hidden animate-scale-in",children:[n.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-white/10",children:[n.jsx($t,{className:"w-5 h-5 text-white/50"}),n.jsx("input",{ref:f,type:"text",value:s,onChange:e=>o(e.target.value),placeholder:"Search messages and broadcasts...",className:"flex-1 bg-transparent text-white placeholder:text-white/50 outline-none text-base"}),s&&n.jsx("button",{onClick:()=>o(""),className:"p-1 hover:bg-white/10 rounded-lg transition-colors",children:n.jsx(ae,{className:"w-4 h-4 text-white/70"})}),n.jsx("button",{onClick:t,className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors",children:n.jsx(ae,{className:"w-5 h-5 text-white/70"})})]}),n.jsxs("div",{ref:x,className:"max-h-[60vh] overflow-y-auto scrollbar-hide",children:[l&&n.jsx("div",{className:"p-8 text-center text-white/50",children:"Searching..."}),!l&&0===v&&s&&n.jsxs("div",{className:"p-8 text-center text-white/50",children:['No results found for "',s,'"']}),!l&&0===v&&!s&&n.jsx("div",{className:"p-8 text-center text-white/50",children:"Type to search messages and broadcasts"}),d.length>0&&n.jsxs("div",{className:"border-b border-white/10",children:[n.jsxs("div",{className:"px-4 py-2 bg-white/5 flex items-center gap-2",children:[n.jsx(Ct,{className:"w-4 h-4 text-blue-400"}),n.jsx("span",{className:"text-sm font-medium text-white/70",children:"Messages"}),n.jsxs("span",{className:"text-xs text-white/50",children:["(",d.length,")"]})]}),d.map((e,t)=>n.jsxs("button",{"data-index":t,onClick:()=>y(t),className:G("w-full text-left px-4 py-3 hover:bg-white/5 transition-colors border-b border-white/5",h===t&&"bg-blue-500/20"),children:[n.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[n.jsx("span",{className:"text-sm font-medium text-white",children:e.author_name}),n.jsx("span",{className:"text-xs text-white/50",children:Nn(new Date(e.created_at),"MMM d, h:mm a")})]}),n.jsx("p",{className:"text-sm text-white/70 line-clamp-2",children:w(e.content,120)})]},e.id))]}),m.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"px-4 py-2 bg-white/5 flex items-center gap-2",children:[n.jsx(Me,{className:"w-4 h-4 text-orange-400"}),n.jsx("span",{className:"text-sm font-medium text-white/70",children:"Broadcasts"}),n.jsxs("span",{className:"text-xs text-white/50",children:["(",m.length,")"]})]}),m.map((e,t)=>{const a=d.length+t;return n.jsxs("button",{"data-index":a,onClick:()=>y(a),className:G("w-full text-left px-4 py-3 hover:bg-white/5 transition-colors border-b border-white/5",h===a&&"bg-orange-500/20"),children:[n.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-medium text-white",children:e.created_by_name}),b(e.priority)]}),n.jsx("span",{className:"text-xs text-white/50",children:Nn(new Date(e.created_at),"MMM d, h:mm a")})]}),n.jsx("p",{className:"text-sm text-white/70 line-clamp-2",children:w(e.message,120)})]},e.id)})]})]}),v>0&&n.jsxs("div",{className:"px-4 py-2 bg-white/5 border-t border-white/10 flex items-center justify-center gap-4 text-xs text-white/50",children:[n.jsx("span",{children:"â†‘â†“ Navigate"}),n.jsx("span",{children:"â†µ Select"}),n.jsx("span",{children:"Esc Close"})]})]})})},yg=({enableGroupChat:e=!0,showBroadcasts:t=!0,isEvent:a=!1,tripId:r,isPro:i=!1,userRole:s="member",participants:o=[]})=>{const[l,c]=L.useState([]),[d,u]=L.useState({});L.useState(null);const[m,p]=L.useState([]),h=L.useRef(null),[g,f]=L.useState(!1),x=L.useRef(null),{isOffline:v}=me(),y=B(),b=L.useMemo(()=>r||y.tripId||y.proTripId||y.eventId||"",[r,y.tripId,y.proTripId,y.eventId]),w=X(),{user:j}=Y(),N=w.isDemoMode&&/^\d+$/.test(b),{tripMembers:_}=Uh(N?void 0:b),{messages:k,isLoading:S,sendMessageAsync:C,isCreating:E,loadMore:D,hasMore:P,isLoadingMore:A}=Qh(N?void 0:b),{inputMessage:T,setInputMessage:M,messageFilter:R,setMessageFilter:I,replyingTo:O,setReply:F,clearReply:U,sendMessage:z,filterMessages:$}=Ca({tripId:b,demoMode:w.isDemoMode,isEvent:a}),q=L.useMemo(()=>i?[...new Set(o.map(e=>e.role).filter(Boolean))]:[],[i,o]),{availableChannels:V,activeChannel:H,messages:K,setActiveChannel:G,sendMessage:Q}=og(b,s,q),Z=L.useRef(null);L.useRef(null),Ea({preventZoom:!0,adjustViewport:!0,onShow:()=>{setTimeout(()=>{var e;null==(e=Z.current)||e.scrollIntoView({behavior:"smooth"})},300)}});((e,t)=>{const n=L.useRef(0),a=L.useRef(0),{onSwipeLeft:r,onSwipeRight:i,threshold:s=50}=t||{};L.useEffect(()=>{const t=e.current;if(!t)return;const o=e=>{n.current=e.touches[0].clientX,a.current=e.touches[0].clientY},l=e=>{const t=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY,l=t-n.current,c=o-a.current;Math.abs(l)>Math.abs(c)&&Math.abs(l)>s&&(l>0&&i?i():l<0&&r&&r())};return t.addEventListener("touchstart",o),t.addEventListener("touchend",l),()=>{t.removeEventListener("touchstart",o),t.removeEventListener("touchend",l)}},[e,r,i,s])})(L.useRef(null),{onSwipeLeft:()=>{bo.light()},onSwipeRight:()=>{bo.light()},threshold:50});const{unreadCount:J,broadcastCount:ee}=hg({tripId:b,messages:k,userId:(null==j?void 0:j.id)||null,enabled:!w.isDemoMode&&!!(null==j?void 0:j.id)});L.useEffect(()=>{var e;if(w.isDemoMode||!(null==j?void 0:j.id)||!b)return;const t=(null==j?void 0:j.displayName)||(null==(e=null==j?void 0:j.email)?void 0:e.split("@")[0])||"You";return h.current=new mg(b,j.id,t),h.current.initialize(p).catch(e=>{}),()=>{var e;null==(e=h.current)||e.cleanup().catch(e=>{})}},[w.isDemoMode,null==j?void 0:j.id,b]),L.useEffect(()=>{if(w.isDemoMode||!(null==j?void 0:j.id)||!b)return;const e=(t=b,n=()=>{},W.channel(`read_receipts:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"message_read_receipts"},e=>{n(e.new)}).subscribe());var t,n;return(async()=>{const e=k.filter(e=>e.user_id!==j.id).map(e=>e.id);e.length>0&&await pg(e,0,j.id).catch(e=>{})})(),()=>{W.removeChannel(e).catch(e=>{})}},[k,null==j?void 0:j.id,b,w.isDemoMode]);const te=L.useMemo(()=>w.isDemoMode?[]:k.map(e=>{var t,n;return{id:e.id,text:e.content,sender:{id:e.user_id||e.author_name||"unknown",name:(null==(t=_.find(t=>t.id===(e.user_id||"")))?void 0:t.name)||e.author_name||"Unknown",avatar:(null==(n=_.find(t=>t.id===(e.user_id||"")))?void 0:n.avatar)||Ze,userId:e.user_id},createdAt:e.created_at,isBroadcast:"broadcast"===e.message_type,isPayment:"payment"===e.message_type,isEdited:e.is_edited||!1,editedAt:e.edited_at,tags:[]}}),[k,w.isDemoMode,_]),ne=async(e=!1,t=!1,n)=>{var a;let r;t&&n&&(r={amount:n.amount,currency:n.currency,description:n.description,splitCount:n.splitCount,splitParticipants:n.splitParticipants||[],paymentMethods:n.paymentMethods||[]});const i=await z({isBroadcast:e,isPayment:t,paymentData:r});if(!i)return;if(w.isDemoMode)return void c(e=>[...e,i]);const s=(null==j?void 0:j.displayName)||(null==(a=null==j?void 0:j.email)?void 0:a.split("@")[0])||"You";try{const n=e?"broadcast":t?"payment":"text";if(await C(i.text,s,void 0,void 0,null==j?void 0:j.id,"standard",n),i.text&&i.text.trim().length>10)try{await ao(i.text,b)}catch(o){0}}catch(l){}},ae=(e,t)=>{const n={...d};n[e]||(n[e]={});const a=n[e][t]||{count:0,userReacted:!1};a.userReacted=!a.userReacted,a.count+=a.userReacted?1:-1,n[e][t]=a,u(n)};L.useEffect(()=>{if(!w.isDemoMode)return void c([]);const e=i||y.proTripId,t=a||y.eventId;let n;n=e?he.getProMockMessages("pro",(null==j?void 0:j.id)||"demo-user"):t?he.getProMockMessages("event",(null==j?void 0:j.id)||"demo-user"):he.getMockMessages("friends-trip",!0,(null==j?void 0:j.id)||"demo-user");const r=n.map(e=>{var t,n,a;return{id:e.id,text:e.message_content||"",sender:{id:e.sender_id||e.sender_name||e.id,name:e.sender_name||"Unknown",avatar:Xe(e.sender_name||"Unknown")},createdAt:new Date(Date.now()-864e5*(e.timestamp_offset_days||0)).toISOString(),isBroadcast:(null==(t=e.tags)?void 0:t.includes("broadcast"))||(null==(n=e.tags)?void 0:n.includes("logistics"))||(null==(a=e.tags)?void 0:a.includes("urgent"))||!1,trip_type:e.trip_type,sender_name:e.sender_name,message_content:e.message_content,delay_seconds:e.delay_seconds,timestamp_offset_days:e.timestamp_offset_days,tags:e.tags}});c(r)},[w.isDemoMode,i,a,y.proTripId,y.eventId,null==j?void 0:j.id]),L.useEffect(()=>{if("channels"===R&&V.length>0&&!H){const e=[...V].sort((e,t)=>e.channelName.localeCompare(t.channelName));G(e[0])}},[R,V,H,G]);const re=$(w.isDemoMode?l:te),ie=!w.isDemoMode&&S;return L.useEffect(()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&"channels"!==R&&(e.preventDefault(),f(!0))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[R]),ie?n.jsx("div",{children:"Loading messages..."}):n.jsxs("div",{className:"flex flex-col h-full",children:[g&&n.jsx(vg,{tripId:b,onClose:()=>f(!1),onResultSelect:(e,t)=>{f(!1),"broadcast"===t&&"broadcasts"!==R?I("broadcasts"):"message"===t&&"all"!==R&&I("all"),setTimeout(()=>{const t=document.querySelector(`[data-message-id="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("search-highlight-flash"),setTimeout(()=>{t.classList.remove("search-highlight-flash")},1e3))},100)},isDemoMode:w.isDemoMode,demoMessages:l}),v&&n.jsxs(Be,{className:"mx-4 mt-2 mb-0 border-warning/50 bg-warning/10",children:[n.jsx(ge,{className:"h-4 w-4"}),n.jsx(qe,{className:"text-sm",children:"Offline Mode â€“ viewing cached messages"})]}),n.jsx("div",{className:"flex-1 flex flex-col min-h-0","data-chat-container":!0,children:n.jsxs("div",{ref:x,className:"rounded-2xl border border-white/10 bg-black/40 shadow-[inset_0_1px_0_rgba(255,255,255,0.06)] overflow-hidden flex-1 flex flex-col relative min-h-0",children:[n.jsx(gg,{activeFilter:R,onFilterChange:I,hasChannels:V.length>0||q.length>0,onSearchClick:()=>f(!0),isPro:i,broadcastCount:ee,unreadCount:J,availableChannels:V,activeChannel:H,onChannelSelect:e=>{G(e),I("channels")}}),"channels"===R&&H?n.jsx(dg,{channel:H,availableChannels:V,onChannelChange:G}):n.jsxs(n.Fragment,{children:[ie?n.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:n.jsx(Oh,{})}):n.jsx(wo,{messages:re,renderMessage:e=>n.jsx("div",{"data-message-id":e.id,children:n.jsx(Ih,{message:e,reactions:d[e.id],onReaction:ae})}),onLoadMore:w.isDemoMode?()=>{}:D,hasMore:!w.isDemoMode&&P,isLoading:A,initialVisibleCount:10,className:"chat-scroll-container native-scroll px-3",autoScroll:!0,restoreScroll:!0,scrollKey:`chat-scroll-${b}`}),!w.isDemoMode&&m.length>0&&n.jsx(ug,{typingUsers:m}),O&&n.jsx("div",{className:"border-t border-white/10 bg-black/30 px-4 py-2",children:n.jsx(mo,{replyTo:{id:O.id,text:O.text,senderName:O.senderName},onCancel:U})})]})]})}),"channels"!==R&&n.jsx("div",{className:"chat-input-persistent w-full",children:n.jsx("div",{className:"w-full",children:n.jsx(uo,{inputMessage:T,onInputChange:M,onSendMessage:ne,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ne())},apiKey:"",isTyping:E,tripMembers:_,hidePayments:!0,isPro:i,tripId:b,onTypingChange:e=>{!w.isDemoMode&&h.current&&(e?h.current.startTyping().catch(e=>{}):h.current.stopTyping().catch(e=>{}))}})})})]})},bg=Object.freeze(Object.defineProperty({__proto__:null,TripChat:yg},Symbol.toStringTag,{value:"Module"})),wg=({onRefresh:e,threshold:t=80,maxPullDistance:n=120})=>{const[a,r]=L.useState(!1),[i,s]=L.useState(!1),[o,l]=L.useState(0),c=L.useRef(0),d=L.useRef(0);return L.useEffect(()=>{const u=e=>{0===(window.scrollY||document.documentElement.scrollTop)&&(c.current=e.touches[0].clientY,r(!0))},m=e=>{if(!a||i)return;d.current=e.touches[0].clientY;const r=d.current-c.current;if(r>0){e.preventDefault();const a=Math.min(.5*r,n);l(a),a>=t&&o<t&&bo.medium()}},p=async()=>{if(a){if(o>=t){s(!0),await bo.success();try{await e()}finally{s(!1)}}r(!1),l(0)}};return document.addEventListener("touchstart",u,{passive:!0}),document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("touchend",p),()=>{document.removeEventListener("touchstart",u),document.removeEventListener("touchmove",m),document.removeEventListener("touchend",p)}},[a,i,o,t,n,e]),{isPulling:a,isRefreshing:i,pullDistance:o,shouldTrigger:o>=t}},jg=({isRefreshing:e,pullDistance:t,threshold:a})=>{const r=Math.min(t/a*100,100),i=Math.min(t/a,1);return n.jsx("div",{className:"absolute top-0 left-0 right-0 flex justify-center items-center transition-opacity",style:{transform:`translateY(${t}px)`,opacity:i,pointerEvents:"none"},children:n.jsx("div",{className:"bg-black/80 backdrop-blur-sm rounded-full p-3 shadow-lg border border-white/10",children:n.jsx(fe,{size:20,className:"text-white "+(e?"animate-spin":""),style:{transform:`rotate(${3.6*r}deg)`}})})})},Ng=({isOpen:e,onClose:t,selectedDate:a,tripId:r,onEventCreated:i,editEvent:s,onEventUpdated:o})=>{const[l,c]=L.useState(""),[d,u]=L.useState(a),[m,p]=L.useState("12:00"),[h,g]=L.useState(""),[f,x]=L.useState(""),[v,y]=L.useState(!1),b=!!s;if(L.useEffect(()=>{if(s){c(s.title||"");const e=new Date(s.start_time);u(e),p(Nn(e,"HH:mm")),g(s.location||""),x(s.description||"")}else c(""),u(a),p("12:00"),g(""),x("")},[s,a,e]),L.useEffect(()=>{s||u(a)},[a,s]),!e)return null;return n.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",children:[n.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:t}),n.jsxs("div",{className:"relative w-full max-w-md bg-glass-slate-card border border-glass-slate-border rounded-t-3xl sm:rounded-3xl shadow-enterprise-2xl p-6 animate-slide-up max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`w-10 h-10 rounded-xl ${b?"bg-amber-500/20":"bg-blue-500/20"} flex items-center justify-center`,children:b?n.jsx(ya,{className:"w-5 h-5 text-amber-400"}):n.jsx(dn,{className:"w-5 h-5 text-blue-400"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-semibold text-white",children:b?"Edit Event":"Add Event"}),n.jsx("p",{className:"text-sm text-gray-400",children:Nn(d,"MMM d, yyyy")})]})]}),n.jsx("button",{onClick:t,className:"w-8 h-8 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors",children:n.jsx(ae,{className:"w-5 h-5 text-white"})})]}),n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),y(!0);try{const[e,n]=m.split(":"),a=new Date(d);if(a.setHours(parseInt(e),parseInt(n),0,0),b&&s){if(!(await Z.updateEvent(s.id,{title:l,description:f||void 0,start_time:a.toISOString(),location:h||void 0,trip_id:r})))throw new Error("Failed to update event");ee.success("Event updated",{description:`${l} has been updated`}),null==o||o({...s,title:l,description:f||void 0,start_time:a.toISOString(),location:h||void 0}),t()}else{const e=new Promise((e,t)=>{setTimeout(()=>t(new Error("Event creation timed out. Please try again.")),1e4)}),n=await Promise.race([Z.createEvent({trip_id:r,title:l,description:f||void 0,start_time:a.toISOString(),location:h||void 0,include_in_itinerary:!0,source_type:"manual",source_data:{created_from:"mobile"}}),e]);if(!n.event)throw new Error("Failed to create event");n.conflicts.length>0?ee.success("Event created",{description:`${l} has been added to your calendar. Note: This event overlaps with "${n.conflicts[0]}"${n.conflicts.length>1?` and ${n.conflicts.length-1} other event(s)`:""}.`}):ee.success("Event created",{description:`${l} has been added to your calendar`}),null==i||i(n.event),c(""),p("12:00"),g(""),x(""),t()}}catch(n){const e=n instanceof Error?n.message:"Please try again or contact support";ee.error(b?"Failed to update event":"Failed to create event",{description:e})}finally{y(!1)}},className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Event Title"}),n.jsx("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"e.g., Dinner at Italian Restaurant",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Date"}),n.jsx("input",{type:"date",value:Nn(d,"yyyy-MM-dd"),onChange:e=>u(new Date(e.target.value)),className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Time"}),n.jsx("input",{type:"time",value:m,onChange:e=>p(e.target.value),className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location"}),n.jsx("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"e.g., Central Park",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description (Optional)"}),n.jsx("textarea",{value:f,onChange:e=>x(e.target.value),placeholder:"Add any additional details...",rows:3,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 resize-none"})]}),n.jsxs("div",{className:"flex gap-3 pt-2",children:[n.jsx(Q,{type:"button",variant:"outline",onClick:t,className:"flex-1 bg-white/5 border-white/10 text-white hover:bg-white/10",children:"Cancel"}),n.jsx(Q,{type:"submit",disabled:v,className:`flex-1 ${b?"bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700"} text-white`,children:v?b?"Updating...":"Creating...":b?"Save Changes":"Create Event"})]})]})]})]})};const _g=new class{formatDate(e){return e.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}escapeText(e){return e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\r?\n/g,"\\n")}exportToICS(e,t){const n=e.map(e=>({title:e.title,start:e.date instanceof Date?e.date:new Date(e.date),end:new Date((e.date instanceof Date?e.date:new Date(e.date)).getTime()+72e5),location:e.location,description:e.description,uid:e.id}));return this.generateICS(n,t)}generateICS(e,t){const n=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Ravel//Trip Planning//EN",`X-WR-CALNAME:${this.escapeText(t)}`,"X-WR-TIMEZONE:UTC","CALSCALE:GREGORIAN","METHOD:PUBLISH"];return e.forEach(e=>{n.push("BEGIN:VEVENT"),n.push(`UID:${e.uid}@ravel.app`),n.push(`DTSTART:${this.formatDate(e.start)}`),n.push(`DTEND:${this.formatDate(e.end)}`),n.push(`SUMMARY:${this.escapeText(e.title)}`),e.location&&n.push(`LOCATION:${this.escapeText(e.location)}`),e.description&&n.push(`DESCRIPTION:${this.escapeText(e.description)}`),n.push(`DTSTAMP:${this.formatDate(new Date)}`),n.push("END:VEVENT")}),n.push("END:VCALENDAR"),n.join("\r\n")}downloadICS(e,t){const n=this.exportToICS(e,t),a=new Blob([n],{type:"text/calendar;charset=utf-8"}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=`${t.replace(/[^a-zA-Z0-9]/g,"_")}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}generateCalendarUrls(e){const t=e.date instanceof Date?e.date:new Date(e.date),n=t.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),a=new Date(t.getTime()+72e5).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),r=encodeURIComponent(e.title),i=n,s=a,o=encodeURIComponent(e.location||""),l=encodeURIComponent(e.description||"");return{google:`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${r}&dates=${i}/${s}&location=${o}&details=${l}`,outlook:`https://outlook.live.com/calendar/0/deeplink/compose?subject=${r}&startdt=${i}&enddt=${s}&location=${o}&body=${l}`,apple:`data:text/calendar;charset=utf8,${encodeURIComponent(this.generateICS([{title:e.title,start:t,end:new Date(t.getTime()+72e5),location:e.location,description:e.description,uid:e.id}],"Trip Event"))}`}}},kg=["from-blue-500 to-blue-600","from-purple-500 to-purple-600","from-pink-500 to-pink-600","from-green-500 to-green-600","from-yellow-500 to-yellow-600","from-indigo-500 to-indigo-600","from-red-500 to-red-600","from-teal-500 to-teal-600"],Sg=({tripId:e,onExport:t,onToggleView:a,viewMode:r})=>{const[i,s]=L.useState(new Date),[o,l]=L.useState(new Date),[c,d]=L.useState(!1),[u,m]=L.useState(null),[p,h]=L.useState(!1),[g,f]=L.useState(null),[x,v]=L.useState("list"),y=r??x,b=async()=>{await bo.light(),a?a():v(e=>"list"===e?"grid":"list")},{events:w,loading:j,refreshEvents:N,deleteEvent:_,updateEvent:k}=(e=>{const[t,n]=L.useState([]),[a,r]=L.useState(!1),{isDemoMode:i}=X();L.useEffect(()=>{e&&s()},[e]),L.useEffect(()=>{if(!e||i)return;const t=W.channel(`trip_events:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"trip_events",filter:`trip_id=eq.${e}`},e=>{"INSERT"===e.eventType?n(t=>[...t,e.new]):"UPDATE"===e.eventType?n(t=>t.map(t=>t.id===e.new.id?e.new:t)):"DELETE"===e.eventType&&n(t=>t.filter(t=>t.id!==e.old.id))}).subscribe();return()=>{W.removeChannel(t)}},[e,i]);const s=async()=>{if(e){r(!0);try{const t=await Z.getTripEvents(e);n(t)}catch(t){}finally{r(!1)}}},o=async e=>{try{const t=await Z.createEvent(e);return t.event&&n(e=>[...e,t.event]),t.event}catch(t){throw t}};return{events:t,loading:a,createEvent:o,createEventFromCalendar:async t=>{if(!e)return null;const n=Z.convertFromCalendarEvent(t,e);return o(n)},updateEvent:async(e,t)=>{const a=await Z.updateEvent(e,t);return a&&n(n=>n.map(n=>n.id===e?{...n,...t}:n)),a},deleteEvent:async t=>{const a=await Z.deleteEvent(t,e);return a&&n(e=>e.filter(e=>e.id!==t)),a},refreshEvents:s,getCalendarEvents:()=>t.map(e=>Z.convertToCalendarEvent(e))}})(e),S=L.useMemo(()=>w.map((e,t)=>({id:e.id,title:e.title,date:new Date(e.start_time),time:new Date(e.start_time).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),location:e.location||void 0,participants:0,color:kg[t%kg.length],originalEvent:e})),[w]),{isPulling:C,isRefreshing:E,pullDistance:D}=wg({onRefresh:async()=>{await N()}}),P=async()=>{await bo.medium(),f(null),d(!0)},A=(()=>{const e=Sn(o),t=Cn(o),n=e.getDay(),a=t.getDate(),r=[];for(let i=n-1;i>=0;i--){const t=new Date(e);t.setDate(t.getDate()-i-1),r.push(t)}for(let i=1;i<=a;i++)r.push(new Date(o.getFullYear(),o.getMonth(),i));for(;r.length<42;){const e=r[r.length-1],t=new Date(e);t.setDate(t.getDate()+1),r.push(t)}return r})(),T=["S","M","T","W","T","F","S"],M=async()=>{await bo.light(),l(En(o,1))},R=async()=>{await bo.light(),l(Dn(o,1))},I=S.filter(e=>_n(e.date,i)),O=L.useCallback(async e=>{await bo.medium(),m(e)},[]),F=L.useCallback(async e=>{if(e){h(!0);try{await bo.medium();await _(e)?(ee.success("Event deleted"),m(null),await N()):ee.error("Failed to delete event")}catch(t){ee.error("Failed to delete event")}finally{h(!1)}}},[_,N]),U=L.useCallback(async t=>{await bo.medium(),m(null);const n=t.originalEvent||{id:t.id,title:t.title,start_time:t.date.toISOString(),location:t.location,trip_id:e};f(n),d(!0)},[e]),z=L.useCallback(()=>{m(null)},[]);return n.jsxs("div",{className:"flex flex-col h-full bg-black relative",children:[n.jsx(jg,{isRefreshing:E,pullDistance:D,threshold:80}),j?n.jsx("div",{className:"px-4 py-4",children:n.jsx(Fh,{})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10",children:[n.jsx("button",{onClick:M,className:"p-2 hover:bg-white/10 rounded-lg active:scale-95 transition-all",children:n.jsx(Bn,{size:20,className:"text-white"})}),n.jsx("h3",{className:"text-lg font-semibold text-white",children:Nn(o,"MMMM yyyy")}),n.jsx("button",{onClick:R,className:"p-2 hover:bg-white/10 rounded-lg active:scale-95 transition-all",children:n.jsx(qn,{size:20,className:"text-white"})})]}),"list"===y&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-white",children:Nn(i,"EEEE, MMMM d")}),n.jsx("button",{onClick:P,className:"p-2 bg-blue-600 rounded-lg active:scale-95 transition-transform",children:n.jsx(vn,{size:18,className:"text-white"})})]}),n.jsx("div",{className:"space-y-3",children:0===I.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Kn,{size:40,className:"text-gray-600 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"No events scheduled"}),n.jsx("button",{onClick:P,className:"mt-3 text-sm text-blue-400 hover:text-blue-300",children:"Add an event"})]}):I.map(e=>n.jsxs("button",{onClick:()=>O(e),className:"w-full bg-white/10 rounded-xl p-4 active:scale-98 transition-transform relative",children:[n.jsx("div",{className:`w-1 h-full absolute left-0 top-0 rounded-l-xl bg-gradient-to-b ${e.color}`}),n.jsxs("div",{className:"flex items-start justify-between mb-2",children:[n.jsx("h4",{className:"text-white font-semibold text-left",children:e.title}),n.jsx("span",{className:"text-sm text-gray-400",children:e.time})]}),e.location&&n.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300 mb-2",children:[n.jsx(Un,{size:14}),n.jsx("span",{children:e.location})]}),n.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[n.jsx(ln,{size:14}),n.jsxs("span",{children:[e.participants," attending"]})]})]},e.id))})]}),n.jsxs("div",{className:"flex justify-center gap-2 px-4 py-2 border-y border-white/10 bg-black/50",children:[n.jsxs("button",{onClick:async()=>{if(await bo.light(),t)t();else{const t=S.map(e=>{var t;return{id:e.id,title:e.title,date:e.date instanceof Date?e.date:new Date(e.date),location:e.location||"",description:(null==(t=e.originalEvent)?void 0:t.description)||""}}),a=_g.exportToICS(t,`Trip_${e}`),r=new Blob([a],{type:"text/calendar;charset=utf-8"}),i=`Trip_${e}_calendar.ics`;try{await Ve(r,i,{mimeType:"text/calendar"}),ee.success("Calendar exported")}catch(n){ee.error("Failed to export calendar")}}},className:"flex items-center gap-1.5 px-3 py-2 bg-white/10 hover:bg-white/20 rounded-xl text-xs text-gray-300 transition-colors active:scale-95",children:[n.jsx(Oe,{size:14}),n.jsx("span",{children:"Export"})]}),n.jsxs("button",{onClick:b,className:"flex items-center gap-1.5 px-3 py-2 bg-white/10 hover:bg-white/20 rounded-xl text-xs text-gray-300 transition-colors active:scale-95",children:[n.jsx(da,{size:14}),n.jsx("span",{children:"Month Grid"})]}),n.jsxs("button",{onClick:P,className:"flex items-center gap-1.5 px-3 py-2 bg-white/10 hover:bg-white/20 rounded-xl text-xs text-gray-300 transition-colors active:scale-95",children:[n.jsx(vn,{size:14}),n.jsx("span",{children:"Add"})]})]}),n.jsxs("div",{className:"px-4 py-2 border-t border-white/10 bg-black/30",children:[n.jsxs("div",{className:"flex items-center justify-between py-1.5 mb-1",children:[n.jsx("button",{onClick:M,className:"p-1.5 hover:bg-white/10 rounded-lg active:scale-95 transition-all",children:n.jsx(Bn,{size:16,className:"text-gray-400"})}),n.jsx("span",{className:"text-sm font-medium text-gray-300",children:Nn(o,"MMM yyyy")}),n.jsx("button",{onClick:R,className:"p-1.5 hover:bg-white/10 rounded-lg active:scale-95 transition-all",children:n.jsx(qn,{size:16,className:"text-gray-400"})})]}),n.jsx("div",{className:"grid grid-cols-7 gap-0.5 mb-1",children:T.map(e=>n.jsx("div",{className:"text-center text-[10px] font-medium text-gray-500 py-0.5",children:e},`compact-${e}`))}),n.jsx("div",{className:"grid grid-cols-7 gap-0.5",children:A.slice(0,35).map((e,t)=>{const a=kn(e,o),r=_n(e,i),l=_n(e,new Date),c=S.some(t=>_n(t.date,e));return n.jsxs("button",{onClick:()=>(async e=>{await bo.light(),s(e)})(e),className:`\n                          h-7 rounded flex items-center justify-center text-xs relative\n                          transition-all duration-150 active:scale-95\n                          ${a?"text-gray-300":"text-gray-600"}\n                          ${r?"bg-blue-500 text-white font-medium":l?"bg-blue-500/20 text-blue-400":"hover:bg-white/10"}\n                        `,children:[Nn(e,"d"),c&&!r&&n.jsx("div",{className:"absolute bottom-0.5 w-1 h-1 rounded-full bg-blue-400"})]},`compact-day-${t}`)})})]})]}),"grid"===y&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex justify-center gap-2 px-4 py-3 border-b border-white/10",children:[n.jsxs("button",{onClick:async()=>{if(await bo.light(),t)t();else{const t=S.map(e=>{var t;return{id:e.id,title:e.title,date:e.date instanceof Date?e.date:new Date(e.date),location:e.location||"",description:(null==(t=e.originalEvent)?void 0:t.description)||""}}),a=_g.exportToICS(t,`Trip_${e}`),r=new Blob([a],{type:"text/calendar;charset=utf-8"}),i=`Trip_${e}_calendar.ics`;try{await Ve(r,i,{mimeType:"text/calendar"}),ee.success("Calendar exported")}catch(n){ee.error("Failed to export calendar")}}},className:"flex items-center gap-2 px-4 py-2.5 bg-white/10 hover:bg-white/20 rounded-xl text-sm text-gray-300 transition-colors active:scale-95",children:[n.jsx(Oe,{size:16}),n.jsx("span",{children:"Export"})]}),n.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2.5 bg-white/10 hover:bg-white/20 rounded-xl text-sm text-gray-300 transition-colors active:scale-95",children:[n.jsx(da,{size:16}),n.jsx("span",{children:"Day View"})]}),n.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2.5 bg-white/10 hover:bg-white/20 rounded-xl text-sm text-gray-300 transition-colors active:scale-95",children:[n.jsx(vn,{size:16}),n.jsx("span",{children:"Add Event"})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:n.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[T.map(e=>n.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-2 border-b border-white/10",children:e},`grid-${e}`)),A.map((e,t)=>{const a=kn(e,o),r=_n(e,new Date),i=S.filter(t=>_n(t.date,e));return n.jsxs("div",{className:`\n                          min-h-[80px] p-1 border-b border-r border-white/5 \n                          ${a?"bg-black":"bg-black/50"}\n                        `,children:[n.jsx("div",{className:`\n                          text-xs font-medium mb-1 px-1\n                          ${r?"text-blue-400":a?"text-white":"text-gray-600"}\n                        `,children:Nn(e,"d")}),n.jsxs("div",{className:"space-y-0.5",children:[i.slice(0,3).map(e=>n.jsx("button",{onClick:()=>O(e),className:`w-full text-left truncate text-[10px] px-1 py-0.5 rounded bg-gradient-to-r ${e.color} text-white`,children:e.title},e.id)),i.length>3&&n.jsxs("div",{className:"text-[10px] text-gray-400 px-1",children:["+",i.length-3," more"]})]})]},`grid-day-${t}`)})]})})]})]}),n.jsx(Ng,{isOpen:c,onClose:()=>{d(!1),f(null)},selectedDate:i,tripId:e,editEvent:g,onEventCreated:async e=>{await N()},onEventUpdated:async e=>{await N()}}),u&&n.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center",children:[n.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:z}),n.jsxs("div",{className:"relative w-full max-w-md bg-gray-900 border-t border-white/10 rounded-t-3xl shadow-2xl animate-slide-up max-h-[70vh] overflow-y-auto",children:[n.jsx("div",{className:"flex justify-center pt-3 pb-2",children:n.jsx("div",{className:"w-10 h-1 bg-white/20 rounded-full"})}),n.jsxs("div",{className:"flex items-start justify-between px-6 pb-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h2",{className:"text-xl font-semibold text-white mb-1",children:u.title}),n.jsx("p",{className:"text-sm text-gray-400",children:Nn(u.date,"EEEE, MMMM d, yyyy")})]}),n.jsx("button",{onClick:z,className:"w-8 h-8 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors",children:n.jsx(ae,{className:"w-5 h-5 text-white"})})]}),n.jsxs("div",{className:"px-6 pb-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:n.jsx(Kn,{className:"w-5 h-5 text-blue-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-400",children:"Time"}),n.jsx("p",{className:"text-white font-medium",children:u.time})]})]}),u.location&&n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:n.jsx(Un,{className:"w-5 h-5 text-green-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-400",children:"Location"}),n.jsx("p",{className:"text-white font-medium",children:u.location})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center",children:n.jsx(ln,{className:"w-5 h-5 text-purple-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-400",children:"Attending"}),n.jsxs("p",{className:"text-white font-medium",children:[u.participants," people"]})]})]})]}),n.jsxs("div",{className:"px-6 pb-8 flex gap-3",children:[n.jsxs("button",{onClick:()=>U(u),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-xl transition-colors",children:[n.jsx(ya,{size:18}),n.jsx("span",{children:"Edit"})]}),n.jsxs("button",{onClick:()=>F(u.id),disabled:p,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-xl transition-colors disabled:opacity-50",children:[n.jsx(ie,{size:18}),n.jsx("span",{children:p?"Deleting...":"Delete"})]})]})]})]})]})};var Cg="Radio",[Eg,Dg]=h(Cg),[Pg,Ag]=Eg(Cg),Tg=L.forwardRef((e,t)=>{const{__scopeRadio:a,name:r,checked:i=!1,required:s,disabled:o,value:l="on",onCheck:c,form:d,...u}=e,[m,p]=L.useState(null),h=g(t,e=>p(e)),v=L.useRef(!1),y=!m||(d||!!m.closest("form"));return n.jsxs(Pg,{scope:a,checked:i,disabled:o,children:[n.jsx(f.button,{type:"button",role:"radio","aria-checked":i,"data-state":Og(i),"data-disabled":o?"":void 0,disabled:o,value:l,...u,ref:h,onClick:x(e.onClick,e=>{i||null==c||c(),y&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})}),y&&n.jsx(Ig,{control:m,bubbles:!v.current,name:r,value:l,checked:i,required:s,disabled:o,form:d,style:{transform:"translateX(-100%)"}})]})});Tg.displayName=Cg;var Mg="RadioIndicator",Rg=L.forwardRef((e,t)=>{const{__scopeRadio:a,forceMount:r,...i}=e,s=Ag(Mg,a);return n.jsx(v,{present:r||s.checked,children:n.jsx(f.span,{"data-state":Og(s.checked),"data-disabled":s.disabled?"":void 0,...i,ref:t})})});Rg.displayName=Mg;var Ig=e=>{const{control:t,checked:a,bubbles:r=!0,...i}=e,s=L.useRef(null),o=y(a),l=b(t);return L.useEffect(()=>{const e=s.current,t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"checked").set;if(o!==a&&n){const t=new Event("click",{bubbles:r});n.call(e,a),e.dispatchEvent(t)}},[o,a,r]),n.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:s,style:{...e.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Og(e){return e?"checked":"unchecked"}var Lg=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Fg="RadioGroup",[Ug,zg]=h(Fg,[w,Dg]),$g=w(),Bg=Dg(),[qg,Vg]=Ug(Fg),Hg=L.forwardRef((e,t)=>{const{__scopeRadioGroup:a,name:r,defaultValue:i,value:s,required:o=!1,disabled:l=!1,orientation:c,dir:d,loop:u=!0,onValueChange:m,...p}=e,h=$g(a),g=j(d),[x,v]=N({prop:s,defaultProp:i,onChange:m});return n.jsx(qg,{scope:a,name:r,required:o,disabled:l,value:x,onValueChange:v,children:n.jsx(_,{asChild:!0,...h,orientation:c,dir:g,loop:u,children:n.jsx(f.div,{role:"radiogroup","aria-required":o,"aria-orientation":c,"data-disabled":l?"":void 0,dir:g,...p,ref:t})})})});Hg.displayName=Fg;var Wg="RadioGroupItem",Yg=L.forwardRef((e,t)=>{const{__scopeRadioGroup:a,disabled:r,...i}=e,s=Vg(Wg,a),o=s.disabled||r,l=$g(a),c=Bg(a),d=L.useRef(null),u=g(t,d),m=s.value===i.value,p=L.useRef(!1);return L.useEffect(()=>{const e=e=>{Lg.includes(e.key)&&(p.current=!0)},t=()=>p.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[]),n.jsx(k,{asChild:!0,...l,focusable:!o,active:m,children:n.jsx(Tg,{disabled:o,required:s.required,checked:m,...c,...i,name:s.name,ref:u,onCheck:()=>s.onValueChange(i.value),onKeyDown:x(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:x(i.onFocus,()=>{var e;p.current&&(null==(e=d.current)||e.click())})})})});Yg.displayName=Wg;var Kg=L.forwardRef((e,t)=>{const{__scopeRadioGroup:a,...r}=e,i=Bg(a);return n.jsx(Rg,{...i,...r,ref:t})});Kg.displayName="RadioGroupIndicator";var Gg=Hg,Qg=Yg,Xg=Kg;const Zg=L.forwardRef(({className:e,...t},a)=>n.jsx(Gg,{className:G("grid gap-2",e),...t,ref:a}));Zg.displayName=Gg.displayName;const Jg=L.forwardRef(({className:e,...t},a)=>n.jsx(Qg,{ref:a,className:G("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:n.jsx(Xg,{className:"flex items-center justify-center",children:n.jsx(it,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Jg.displayName=Qg.displayName;const ef=new class{getStorageKey(e){return`tasks_${e}`}async getTasks(e){try{return await xe(this.getStorageKey(e),[])}catch(t){return[]}}async saveTasks(e,t){try{await ve(this.getStorageKey(e),t)}catch(n){}}async createTask(e,t){const n=await this.getTasks(e),a={id:`demo-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,trip_id:e,creator_id:"demo-user",title:t.title,description:t.description,due_at:t.due_at,is_poll:t.is_poll,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),creator:{id:"demo-user",name:"You"},task_status:this.createInitialTaskStatus(t,"demo-user")};return n.unshift(a),await this.saveTasks(e,n),a}createInitialTaskStatus(e,t){if(e.is_poll)return e.assignedTo.map(e=>({task_id:"",user_id:e,completed:!1}));return(e.assignedTo.length>0?e.assignedTo:[t]).map(e=>({task_id:"",user_id:e,completed:!1}))}async toggleTask(e,t,n,a){var r;const i=await this.getTasks(e),s=i.findIndex(e=>e.id===t);if(-1===s)return null;const o=i[s],l=(null==(r=o.task_status)?void 0:r.findIndex(e=>e.user_id===n))??-1;return-1===l?(o.task_status=o.task_status||[],o.task_status.push({task_id:t,user_id:n,completed:a,completed_at:a?(new Date).toISOString():void 0})):o.task_status[l]={...o.task_status[l],completed:a,completed_at:a?(new Date).toISOString():void 0},o.updated_at=(new Date).toISOString(),await this.saveTasks(e,i),o}async deleteTask(e,t){const n=await this.getTasks(e),a=n.filter(e=>e.id!==t);return a.length!==n.length&&(await this.saveTasks(e,a),!0)}async clearTasks(e){await ye(this.getStorageKey(e))}async clearAllDemoTasks(){}};const tf=new class{constructor(){t(this,"QUEUE_KEY","task_offline_queue"),t(this,"MAX_RETRIES",3),t(this,"RETRY_DELAY",5e3)}async getQueue(){try{return await xe(this.QUEUE_KEY,[])}catch(e){return[]}}async enqueue(e){const t=await this.getQueue(),n=`queue-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a={...e,id:n,timestamp:Date.now(),retries:0};return t.push(a),await this.saveQueue(t),n}async dequeue(e){const t=await this.getQueue(),n=t.filter(t=>t.id!==e);return n.length!==t.length&&(await this.saveQueue(n),!0)}async getTripOperations(e){return(await this.getQueue()).filter(t=>t.tripId===e)}async incrementRetry(e){const t=await this.getQueue(),n=t.find(t=>t.id===e);return n?(n.retries+=1,await this.saveQueue(t),n):null}async clearTripQueue(e){const t=(await this.getQueue()).filter(t=>t.tripId!==e);await this.saveQueue(t)}async clearQueue(){await this.saveQueue([])}async getReadyOperations(){const e=await this.getQueue(),t=Date.now();return e.filter(e=>t-e.timestamp>=this.RETRY_DELAY*(e.retries+1)&&e.retries<this.MAX_RETRIES)}async getFailedOperations(){return(await this.getQueue()).filter(e=>e.retries>=this.MAX_RETRIES)}isOnline(){return!1!==navigator.onLine}async saveQueue(e){try{await ve(this.QUEUE_KEY,e)}catch(t){}}async processQueue(e,t){if(!this.isOnline())return{processed:0,failed:0};const n=await this.getReadyOperations();let a=0,r=0;for(const s of n)try{"create"===s.type?(await e(s.tripId,s.data),await this.dequeue(s.id),a++):"toggle"===s.type&&(await t(s.data),await this.dequeue(s.id),a++)}catch(i){const e=await this.incrementRetry(s.id);e&&e.retries>=this.MAX_RETRIES&&r++}return{processed:a,failed:r}}},nf=(e,t)=>{var n;const{isDemoMode:a}=X(),{user:r}=Y(),i=ne(),{toast:s}=ue(),[o,l]=L.useState(""),[c,d]=L.useState(""),[u,m]=L.useState(),[p,h]=L.useState("solo"),[g,f]=L.useState([]),[x,v]=L.useState("all"),[y,b]=L.useState(),[w,j]=L.useState({}),[N,_]=L.useState("dueDate"),k=L.useCallback(()=>o.trim()?o.length>140?{isValid:!1,error:"Task title must be 140 characters or less"}:{isValid:!0}:{isValid:!1,error:"Task title is required"},[o]),S=L.useCallback(()=>k().isValid?{title:o.trim(),description:c.trim()||void 0,due_at:null==u?void 0:u.toISOString(),is_poll:"poll"===p,assignedTo:g.length>0?g:void 0}:null,[o,c,u,p,g,k]),C=L.useCallback(()=>{l(""),d(""),m(void 0),h("solo"),f([])},[]),E=L.useCallback(async(e,t)=>{try{return!0}catch(n){return s({title:"Failed to assign task",variant:"destructive"}),!1}},[s]),D=L.useCallback(async e=>{try{const{taskId:t,userIds:n}=e;return s({title:`Assigned to ${n.length} members`}),!0}catch(t){return s({title:"Failed to assign task to members",variant:"destructive"}),!1}},[s]),P=L.useCallback(e=>{const t=e.filter(e=>{var t,n,a,r,i;const s=e.is_poll?((null==(t=e.task_status)?void 0:t.filter(e=>e.completed).length)||0)>=((null==(n=e.task_status)?void 0:n.length)||1):(null==(r=null==(a=e.task_status)?void 0:a[0])?void 0:r.completed)||!1;if("open"===x&&s)return!1;if("completed"===x&&!s)return!1;if(y){if(!(null==(i=e.task_status)?void 0:i.some(e=>e.user_id===y)))return!1}if(e.due_at){const t=new Date(e.due_at);if(w.start&&t<w.start)return!1;if(w.end&&t>w.end)return!1}return!0});return t.sort((e,t)=>{switch(N){case"dueDate":return e.due_at?t.due_at?new Date(e.due_at).getTime()-new Date(t.due_at).getTime():-1:1;case"created":return new Date(t.created_at).getTime()-new Date(e.created_at).getTime();case"priority":{const n=e.due_at?1:0;return(t.due_at?1:0)-n}default:return 0}}),t},[x,y,w,N]),A=L.useCallback(()=>{v("all"),b(void 0),j({}),_("dueDate")},[]),T=L.useMemo(()=>"all"!==x||void 0!==y||void 0!==w.start||void 0!==w.end,[x,y,w]),[M,R]=L.useState(!1);L.useEffect(()=>{if(!e||a)return;const t=W.channel(`trip_tasks:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"trip_tasks",filter:`trip_id=eq.${e}`},t=>{i.invalidateQueries({queryKey:["tripTasks",e,a]}),s({title:"New Task Added",description:`${t.new.title} was added.`,duration:3e3})}).on("postgres_changes",{event:"DELETE",schema:"public",table:"trip_tasks",filter:`trip_id=eq.${e}`},t=>{i.invalidateQueries({queryKey:["tripTasks",e,a]})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"task_status"},t=>{i.invalidateQueries({queryKey:["tripTasks",e,a]})}).subscribe();return()=>{W.removeChannel(t)}},[e,a,i,s]);const I=Te({queryKey:["tripTasks",e,a],queryFn:async()=>{if(a){const t=await ef.getTasks(e);if(0===t.length){const t=(e=>["1","2","3","4","5","6","7","8","9","10","11","12"].includes(e)&&{1:[{id:"seed-1-1",trip_id:e,creator_id:"seed-user",title:"Pack reef-safe sunscreen",description:"Make sure to bring sunscreen that won't damage the coral reefs",due_at:new Date(Date.now()+6048e5).toISOString(),is_poll:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),creator:{id:"seed-user",name:"Trip Organizer"},task_status:[{task_id:"seed-1-1",user_id:"demo-user",completed:!1}]},{id:"seed-1-2",trip_id:e,creator_id:"seed-user",title:"Download offline maps for Cancun",description:"Download Google Maps offline for the hotel and downtown areas",due_at:new Date(Date.now()+432e6).toISOString(),is_poll:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),creator:{id:"seed-user",name:"Trip Organizer"},task_status:[{task_id:"seed-1-2",user_id:"demo-user",completed:!1}]}],4:[{id:"seed-4-1",trip_id:e,creator_id:"seed-user",title:"Coordinate ride to Broadway bars",description:"Book Uber/Lyft for the group to hit the honky-tonk scene",due_at:new Date(Date.now()+2592e5).toISOString(),is_poll:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),creator:{id:"seed-user",name:"Ashley"},task_status:[{task_id:"seed-4-1",user_id:"demo-user",completed:!1}]}],6:[{id:"seed-6-1",trip_id:e,creator_id:"seed-user",title:"Pack hiking boots for everyone",description:"Make sure everyone has proper footwear for the mountain trails",due_at:new Date(Date.now()+3456e5).toISOString(),is_poll:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),creator:{id:"seed-user",name:"Dad (Mike)"},task_status:[{task_id:"seed-6-1",user_id:"demo-user",completed:!1}]}],7:[{id:"seed-7-1",trip_id:e,creator_id:"seed-user",title:"Bring poker chips for evening games",description:"Someone needs to pack the poker set for our nightly tournaments",due_at:new Date(Date.now()+5184e5).toISOString(),is_poll:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),creator:{id:"seed-user",name:"Commissioner Mike"},task_status:[{task_id:"seed-7-1",user_id:"demo-user",completed:!1}]}]}[e]||[])(e);for(const n of t)await ef.createTask(e,{title:n.title,description:n.description||void 0,due_at:n.due_at,is_poll:n.is_poll||!1,assignedTo:["demo-user"]});return await ef.getTasks(e)}return t}if(!r)return[];try{const t=W.from("trip_tasks").select("\n          *,\n          task_status(*),\n          creator:creator_id (\n            id,\n            display_name,\n            avatar_url\n          )\n        ").eq("trip_id",e).order("created_at",{ascending:!1});M||t.limit(100);const{data:n,error:a}=await t;if(a)throw a;return n&&0!==n.length?n.map(e=>{var t,n;return{id:e.id,trip_id:e.trip_id,creator_id:e.creator_id,title:e.title,description:e.description,due_at:e.due_at,is_poll:e.is_poll,created_at:e.created_at,updated_at:e.updated_at,creator:{id:e.creator_id,name:(null==(t=e.creator)?void 0:t.display_name)||"Unknown User",avatar:null==(n=e.creator)?void 0:n.avatar_url},task_status:e.task_status||[]}}):[]}catch(t){return s({title:"Failed to load tasks",description:"Unable to fetch tasks. Please refresh the page.",variant:"destructive"}),[]}},enabled:!!e}),O=ze({mutationFn:async t=>{if(a||!r){const n=t.assignedTo||["demo-user"];return await ef.createTask(e,{...t,assignedTo:n})}if(!navigator.onLine)throw await tf.enqueue({type:"create",tripId:e,data:t}),new Error("OFFLINE: Task queued for sync when connection is restored.");const{data:{user:n}}=await W.auth.getUser();if(!n)throw new Error("Please sign in to create tasks");const{error:i}=await W.rpc("ensure_trip_membership",{p_trip_id:e,p_user_id:n.id});if(i)throw new Error("Unable to join trip. Please try again.");const{data:s}=await W.from("profiles").select("display_name, avatar_url").eq("user_id",n.id).single(),{data:o,error:l}=await W.from("trip_tasks").insert({trip_id:e,creator_id:n.id,title:t.title,description:t.description,due_at:t.due_at,is_poll:t.is_poll}).select().single();if(l){if("PGRST116"===l.code)throw new Error("Access denied. You must be a trip member to create tasks.");throw l}return await W.from("task_status").insert({task_id:o.id,user_id:n.id,completed:!1}),{id:o.id,trip_id:o.trip_id,creator_id:o.creator_id,title:o.title,description:o.description,due_at:o.due_at,is_poll:o.is_poll,created_at:o.created_at,updated_at:o.updated_at,creator:{id:n.id,name:(null==s?void 0:s.display_name)||"Unknown User",avatar:null==s?void 0:s.avatar_url},task_status:[{task_id:o.id,user_id:n.id,completed:!1}]}},onSuccess:()=>{i.invalidateQueries({queryKey:["tripTasks",e,a]}),s({title:"Task created",description:"Your task has been added to the list."})},onError:e=>{var t,n,a,r,i,o;let l="Error Creating Task",c="Failed to create task. Please try again.",d="destructive";(null==(t=e.message)?void 0:t.includes("OFFLINE:"))?(l="Task Queued",c="Task will be created when you're back online.",d="default"):(null==(n=e.message)?void 0:n.includes("Access denied"))||"PGRST116"===e.code?(l="Access Denied",c="You must be a trip member to create tasks."):(null==(a=e.message)?void 0:a.includes("Network error"))||(null==(r=e.message)?void 0:r.includes("fetch"))?(l="Connection Error",c="Please check your internet connection and try again."):(null==(i=e.message)?void 0:i.includes("validation"))||(null==(o=e.message)?void 0:o.includes("required"))?(l="Validation Error",c=e.message):e.message&&(c=e.message),s({title:l,description:c,variant:d})}}),F=async(t,n,i=0)=>{var s,o,l,c,d,u;if(a||!r){const a=(null==r?void 0:r.id)||"demo-user",i=await ef.toggleTask(e,t,a,n),o=null==(s=null==i?void 0:i.task_status)?void 0:s.find(e=>e.user_id===a);return{taskId:t,completed:(null==o?void 0:o.completed)??n}}const{data:{user:m}}=await W.auth.getUser();if(!m)throw new Error("User not authenticated");if(!navigator.onLine)throw await tf.enqueue({type:"toggle",tripId:e,data:{taskId:t,completed:n}}),new Error("OFFLINE: Task update queued for sync when connection is restored.");try{const{data:e,error:a}=await W.from("trip_tasks").select("version").eq("id",t).maybeSingle();if(a)throw new Error(`Failed to fetch task: ${a.message}`);const r=(null==e?void 0:e.version)||1,{error:s}=await W.rpc("toggle_task_status",{p_task_id:t,p_user_id:m.id,p_current_version:r,p_completed:n});if(s){const e=(null==(o=s.message)?void 0:o.includes("modified by another user"))||(null==(l=s.message)?void 0:l.includes("version"))||"P0001"===s.code;if(e&&i<3)return await new Promise(e=>setTimeout(e,1e3*(i+1))),F(t,n,i+1);if(e)throw new Error("CONFLICT: This task was modified by another user. Please refresh and try again.");if("PGRST116"===s.code)throw new Error("Access denied. You must be a trip member to update tasks.");throw new Error(s.message||"Failed to update task status")}return{taskId:t,completed:n}}catch(p){if(null==(c=p.message)?void 0:c.includes("CONFLICT:"))throw p;if((null==(d=p.message)?void 0:d.includes("fetch"))||(null==(u=p.message)?void 0:u.includes("network")))throw new Error("Network error. Please check your connection and try again.");throw p}},U=ze({mutationFn:async({taskId:e,completed:t})=>F(e,t),onMutate:async({taskId:t,completed:n})=>{await i.cancelQueries({queryKey:["tripTasks",e,a]});const s=i.getQueryData(["tripTasks",e,a]);return i.setQueryData(["tripTasks",e,a],e=>e?e.map(e=>{var i;if(e.id===t){const t=a||!r?"demo-user":r.id,s=null==(i=e.task_status)?void 0:i.map(e=>e.user_id===t?{...e,completed:n,completed_at:n?(new Date).toISOString():void 0}:e);return{...e,task_status:s}}return e}):e),{previousTasks:s}},onError:(t,n,r)=>{var o,l,c,d,u;(null==r?void 0:r.previousTasks)&&!(null==(o=null==t?void 0:t.message)?void 0:o.includes("OFFLINE:"))&&i.setQueryData(["tripTasks",e,a],r.previousTasks);let m="Error Updating Task",p="Failed to update task. Please try again.",h="destructive";(null==(l=null==t?void 0:t.message)?void 0:l.includes("OFFLINE:"))?(m="Task Update Queued",p="Update will be synced when you're back online.",h="default"):(null==(c=null==t?void 0:t.message)?void 0:c.includes("CONFLICT:"))?(m="Conflict Detected",p=t.message.replace("CONFLICT: ","")):(null==(d=null==t?void 0:t.message)?void 0:d.includes("Access denied"))?(m="Access Denied",p=t.message):(null==(u=null==t?void 0:t.message)?void 0:u.includes("Network error"))?(m="Connection Error",p=t.message):(null==t?void 0:t.message)&&(p=t.message),s({title:m,description:p,variant:h})},onSettled:()=>{i.invalidateQueries({queryKey:["tripTasks",e,a]})}});L.useEffect(()=>{const e=async()=>{navigator.onLine&&r&&!a&&await tf.processQueue(async(e,t)=>{await O.mutateAsync(t)},async e=>{await U.mutateAsync(e)})};return e(),window.addEventListener("online",e),()=>window.removeEventListener("online",e)},[null==r?void 0:r.id,a,e]);const z=ze({mutationFn:async t=>{if(a||!r){if(!(await ef.deleteTask(e,t)))throw new Error("Failed to delete task");return t}const{error:n}=await W.from("trip_tasks").delete().eq("id",t);if(n)throw n;return t},onSuccess:()=>{i.invalidateQueries({queryKey:["tripTasks",e,a]}),s({title:"Task deleted",description:"The task has been removed."})},onError:e=>{s({title:"Error",description:e.message||"Failed to delete task.",variant:"destructive"})}}),$=((null==(n=I.data)?void 0:n.length)||0)>=100&&!M,B=L.useCallback(()=>{M||I.isLoading||(R(!0),i.invalidateQueries({queryKey:["tripTasks",e,a]}))},[M,I.isLoading,i,e,a]);return{tasks:I.data||[],isLoading:I.isLoading,error:I.error,hasMoreTasks:$,loadAllTasks:B,title:o,description:c,dueDate:u,taskMode:p,assignedMembers:g,isValid:k().isValid,characterCount:o.length,maxCharacters:140,setTitle:l,setDescription:d,setDueDate:m,setTaskMode:h,updateAssignedMembers:f,toggleMember:e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},validateTask:k,getTaskData:S,resetForm:C,status:x,assignee:y,dateRange:w,sortBy:N,hasActiveFilters:T,setStatus:v,setAssignee:b,setDateRange:j,setSortBy:_,applyFilters:P,clearFilters:A,assignTask:E,bulkAssign:D,autoAssignByRole:async(e,t)=>{},createTaskMutation:O,toggleTaskMutation:U,deleteTaskMutation:z}},af=({tripId:e,selectedMembers:t,onMembersChange:a,isSingleTask:r})=>{const{tripMembers:i,loading:s}=Uh(e),o=Array.isArray(i)?i:[],[l,c]=$.useState(!1);$.useEffect(()=>{!r&&o.length>0&&0===t.length&&a(o.map(e=>e.id))},[r,o,t.length,a]);const d=o.filter(e=>t.includes(e.id)).map(e=>e.name).join(", "),u=0===t.length?r?"Assign to someone":"Assign to group":t.length!==o.length||r?d:"Everyone";return s?n.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[n.jsx(ln,{size:16}),n.jsx("span",{children:"Loading members..."})]}):n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-gray-300",children:r?"Assign to:":"Group members:"}),!r&&n.jsx(Q,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const e=t.length===o.length;a(e?[]:o.map(e=>e.id))},className:"text-xs text-gray-400 hover:text-white",children:t.length===o.length?"Deselect All":"Select All"})]}),n.jsxs(Vt,{open:l,onOpenChange:c,children:[n.jsx(Ht,{asChild:!0,children:n.jsxs(Q,{variant:"outline",role:"combobox","aria-expanded":l,className:"w-full justify-between bg-gray-800 border-gray-600 text-white hover:bg-gray-700",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[r?n.jsx(hn,{size:16,className:"text-gray-400 shrink-0"}):n.jsx(ln,{size:16,className:"text-gray-400 shrink-0"}),n.jsx("span",{className:"truncate",children:u})]}),n.jsx(Xt,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),n.jsx(Wt,{className:"w-full p-0 bg-gray-800 border-gray-600 z-50",children:n.jsxs(ts,{className:"bg-gray-800",children:[n.jsx(ns,{placeholder:"Search members...",className:"bg-gray-800 border-gray-600 text-white"}),n.jsxs(as,{children:[n.jsx(rs,{children:"No members found."}),n.jsx(is,{children:o.map(e=>n.jsxs(os,{onSelect:()=>{return n=e.id,void(t.includes(n)?a(t.filter(e=>e!==n)):a([...t,n]));var n},className:"flex items-center gap-3 cursor-pointer hover:bg-gray-700",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[n.jsxs(Vn,{className:"w-6 h-6",children:[n.jsx(Hn,{src:e.avatar}),n.jsx(Wn,{className:"text-xs",children:e.name.charAt(0).toUpperCase()})]}),n.jsx("span",{className:"text-white",children:e.name})]}),n.jsx(Qt,{className:"h-4 w-4 "+(t.includes(e.id)?"opacity-100":"opacity-0")})]},e.id))})]})]})})]}),t.length>0&&n.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:o.filter(e=>t.includes(e.id)).map(e=>n.jsx(It,{variant:"secondary",className:"text-xs bg-gray-700 text-gray-200",children:e.name},e.id))})]})},rf=({tripId:e,onClose:t})=>{const[a,r]=L.useState(""),[i,s]=L.useState(""),[o,l]=L.useState(),[c,d]=L.useState("solo"),[u,m]=L.useState(!1),[p,h]=L.useState([]),{createTaskMutation:g}=nf(e),{accentColors:f}=be();return n.jsx(Ot,{open:!0,onOpenChange:t,children:n.jsxs(Lt,{className:"sm:max-w-md bg-gray-900 border-gray-700",children:[n.jsx(Ft,{children:n.jsx(Ut,{className:"text-white",children:"Create New Task"})}),n.jsxs("form",{onSubmit:e=>{e.preventDefault(),a.trim()&&g.mutate({title:a.trim(),description:i.trim()||void 0,due_at:null==o?void 0:o.toISOString(),is_poll:"poll"===c,assignedTo:p},{onSuccess:()=>{r(""),s(""),l(void 0),d("solo"),h([]),t()},onError:e=>{}})},className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ot,{htmlFor:"title",className:"text-gray-300",children:"Task Title"}),n.jsx(st,{id:"title",value:a,onChange:e=>r(e.target.value),placeholder:"What needs to be done?",maxLength:140,className:"bg-gray-800 border-gray-600 text-white",autoFocus:!0}),n.jsxs("div",{className:"text-xs text-gray-500 text-right",children:[a.length,"/140"]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ot,{htmlFor:"description",className:"text-gray-300",children:"Description (Optional)"}),n.jsx(xn,{id:"description",value:i,onChange:e=>s(e.target.value),placeholder:"Add more details...",className:"bg-gray-800 border-gray-600 text-white min-h-[80px]"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ot,{className:"text-gray-300",children:"Due Date (Optional)"}),n.jsxs(Vt,{open:u,onOpenChange:m,children:[n.jsx(Ht,{asChild:!0,children:n.jsxs(Q,{variant:"outline",className:"w-full justify-start text-left bg-gray-800 border-gray-600 text-white hover:bg-gray-700",children:[n.jsx(dn,{size:16,className:"mr-2"}),o?Nn(o,"PPP"):"Set due date"]})}),n.jsx(Wt,{className:"w-auto p-0 bg-gray-800 border-gray-600",children:n.jsx(Yt,{mode:"single",selected:o,onSelect:e=>{l(e),m(!1)},disabled:e=>e<new Date,className:"text-white"})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx(ot,{className:"text-gray-300",children:"Task Type"}),n.jsxs(Zg,{value:c,onValueChange:e=>d(e),children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Jg,{value:"solo",id:"solo"}),n.jsxs(ot,{htmlFor:"solo",className:"flex items-center gap-2 text-gray-300",children:[n.jsx(hn,{size:16}),"Single Task - Assign to specific people"]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Jg,{value:"poll",id:"poll"}),n.jsxs(ot,{htmlFor:"poll",className:"flex items-center gap-2 text-gray-300",children:[n.jsx(ln,{size:16}),"Group Task - Everyone needs to complete this"]})]})]})]}),n.jsx(af,{tripId:e,selectedMembers:p,onMembersChange:h,isSingleTask:"solo"===c}),n.jsxs("div",{className:"flex gap-3 pt-4",children:[n.jsx(Q,{type:"button",variant:"outline",onClick:t,className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700",children:"Cancel"}),n.jsx(Q,{type:"submit",disabled:!a.trim()||g.isPending,className:`flex-1 bg-gradient-to-r ${f.gradient} hover:opacity-90`,children:g.isPending?"Creating...":"Create Task"})]})]})]})})},sf=({tripId:e})=>{const[t,a]=L.useState(!1),[r,i]=L.useState(!0),[s,o]=L.useState(null),{user:l}=Y(),{isDemoMode:c}=X(),d=ne(),{tasks:u,isLoading:m,toggleTaskMutation:p}=nf(e),{isRefreshing:h,pullDistance:g}=wg({onRefresh:async()=>{await d.invalidateQueries({queryKey:["tripTasks",e,c]})}}),f=e=>{if(!l)return e.completed||!1;const t=(e.task_status||[]).find(e=>e.user_id===l.id);return(null==t?void 0:t.completed)||!1},x=async e=>{await bo.success();const t=u.find(t=>t.id===e);if(!t)return;const n=f(t);p.mutate({taskId:e,completed:!n})},v=u.filter(e=>!f(e)),y=u.filter(e=>f(e));return n.jsxs("div",{className:"flex flex-col flex-1 bg-black px-4 py-4 relative min-h-0",children:[n.jsx(jg,{isRefreshing:h,pullDistance:g,threshold:80}),n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-white",children:"Trip Tasks"}),n.jsxs("p",{className:"text-sm text-gray-400",children:[v.length," pending Â· ",y.length," completed"]})]}),n.jsx("button",{onClick:async()=>{await bo.medium(),a(!0)},className:"p-3 bg-blue-600 rounded-lg active:scale-95 transition-transform",children:n.jsx(vn,{size:20,className:"text-white"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0",children:[m?n.jsx(Lh,{}):n.jsxs("div",{className:"space-y-3 mb-6",children:[0===v.length&&n.jsx("div",{className:"text-center py-8 text-gray-500",children:n.jsx("p",{children:"No tasks yet. Tap + to add one!"})}),v.map(e=>{const t=s===e.id;return n.jsxs("div",{className:"relative overflow-hidden rounded-xl",onTouchStart:t=>{const n=t.touches[0].clientX,a=t=>{const a=t.touches[0].clientX;n-a>80&&(o(e.id),bo.light())},r=()=>{document.removeEventListener("touchmove",a),document.removeEventListener("touchend",r)};document.addEventListener("touchmove",a),document.addEventListener("touchend",r)},onClick:()=>{t&&o(null)},children:[n.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 bg-red-500/20",children:n.jsx("button",{onClick:t=>{t.stopPropagation(),(async()=>{await bo.heavy(),o(null)})(e.id)},className:"p-3 bg-red-500 rounded-lg",children:n.jsx(ie,{size:18,className:"text-white"})})}),n.jsx("div",{className:"bg-white/10 rounded-xl p-4 transition-transform "+(t?"-translate-x-24":"translate-x-0"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("button",{onClick:()=>x(e.id),className:"mt-0.5 flex-shrink-0 w-6 h-6 rounded-full border-2 border-gray-400 flex items-center justify-center active:scale-95 transition-transform",children:f(e)&&n.jsx(Qt,{size:14,className:"text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"text-white font-medium",children:e.title}),n.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.description&&n.jsx("span",{className:"text-xs text-gray-400 line-clamp-1",children:e.description}),e.due_at&&n.jsx("span",{className:"text-xs text-orange-400",children:new Date(e.due_at).toLocaleDateString()})]})]})]})})]},e.id)})]}),y.length>0&&n.jsxs("div",{children:[n.jsxs("button",{onClick:async()=>{await bo.light(),i(!r)},className:"flex items-center justify-between w-full mb-3 py-2",children:[n.jsxs("h3",{className:"text-sm font-semibold text-gray-400",children:["Completed (",y.length,")"]}),n.jsx("span",{className:"text-gray-400",children:r?"âˆ’":"+"})]}),r&&n.jsx("div",{className:"space-y-3",children:y.map(e=>n.jsx("div",{className:"bg-white/5 rounded-xl p-4 opacity-60",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("button",{onClick:()=>x(e.id),className:"mt-0.5 flex-shrink-0 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center active:scale-95 transition-transform",children:n.jsx(Qt,{size:14,className:"text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"text-gray-300 line-through",children:e.title}),e.description&&n.jsx("span",{className:"text-xs text-gray-500 line-clamp-1",children:e.description})]})]})},e.id))})]})]}),t&&n.jsx(rf,{tripId:e,onClose:()=>a(!1)})]})},of=({option:e,totalVotes:t,userVote:a,selectedOptions:r=[],onVote:i,disabled:s=!1,isMultiple:o=!1})=>{const l=t>0?e.votes/t*100:0,c=Array.isArray(a)?a.includes(e.id):a===e.id,d=r.includes(e.id);return n.jsxs("button",{onClick:()=>i(e.id),disabled:s&&!o,className:`w-full text-left space-y-1.5 p-2 rounded-lg transition-colors ${!s||o?"cursor-pointer hover:bg-white/5":"cursor-default"} ${d?"bg-white/5":""}`,children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"text-sm font-medium "+(c?"text-primary":"text-white"),children:e.text}),n.jsxs("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:[e.votes," vote",1!==e.votes?"s":""," (",l.toFixed(0),"%)"]})]}),n.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:n.jsx("div",{className:"h-2 rounded-full transition-all duration-500 bg-gradient-to-r from-blue-500 via-blue-400 to-orange-500",style:{width:`${Math.max(l,0)}%`}})})]})},lf=({poll:e,onVote:t,onRemoveVote:a,onClose:r,onDelete:i,onExport:s,disabled:o=!1,isVoting:l=!1,isClosing:c=!1,isRemovingVote:d=!1,isDeleting:u=!1})=>{const{user:m}=Y(),[p,h]=L.useState([]),[g,f]=L.useState("");L.useEffect(()=>{if(!e.deadline_at||"closed"===e.status)return;const t=()=>{const t=new Date(e.deadline_at),n=new Date,a=t.getTime()-n.getTime();if(a<=0)return void f("Voting ended");const r=Math.floor(a/864e5),i=Math.floor(a%864e5/36e5),s=Math.floor(a%36e5/6e4);f(r>0?`${r}d ${i}h remaining`:i>0?`${i}h ${s}m remaining`:`${s}m remaining`)};t();const n=setInterval(t,6e4);return()=>clearInterval(n)},[e.deadline_at,e.status]);const x=!!e.deadline_at&&new Date(e.deadline_at)<new Date,v=!o&&!l&&"active"===e.status&&!x,y=e.allow_multiple?Array.isArray(e.userVote)&&e.userVote.length>0:!!e.userVote,b=y&&e.allow_vote_change&&v,w=(null==m?void 0:m.id)===e.createdBy,j=n=>{(v||b)&&(e.allow_multiple?h(e=>e.includes(n)?e.filter(e=>e!==n):[...e,n]):t(e.id,n))};return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsx("h3",{className:"text-base font-semibold text-white",children:e.question}),"closed"===e.status&&n.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-red-500/20 text-red-400",children:"Closed"})]}),e.deadline_at&&"active"===e.status&&!x&&n.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[n.jsx(Kn,{size:12}),n.jsx("span",{children:g})]}),n.jsx("div",{className:"space-y-2",children:e.options.map(t=>n.jsx(of,{option:t,totalVotes:e.totalVotes,userVote:e.userVote,selectedOptions:p,onVote:j,disabled:!v&&!b,isMultiple:e.allow_multiple},t.id))}),e.allow_multiple&&v&&!y&&n.jsx(Q,{onClick:()=>{p.length>0&&t(e.id,p)},disabled:0===p.length||l,className:"w-full h-9 rounded-lg bg-primary hover:bg-primary/90 font-medium text-primary-foreground text-sm",children:l?"Submitting...":`Submit ${p.length} Vote${1!==p.length?"s":""}`}),n.jsxs("div",{className:"flex items-center justify-between pt-1",children:[n.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.totalVotes," vote",1!==e.totalVotes?"s":""]}),n.jsxs("div",{className:"flex items-center gap-2",children:[y&&e.allow_vote_change&&a&&n.jsxs(Q,{onClick:()=>{a&&a(e.id)},disabled:d,variant:"ghost",size:"sm",className:"h-7 px-2 text-xs text-muted-foreground hover:text-white",children:[n.jsx(ie,{size:12,className:"mr-1"}),d?"Removing...":"Remove Vote"]}),w&&"active"===e.status&&r&&n.jsx(Q,{onClick:()=>{r&&w&&r(e.id)},disabled:c,variant:"ghost",size:"sm",className:"h-7 px-2 text-xs text-muted-foreground hover:text-white",children:c?"Closing...":"Close Poll"}),w&&i&&n.jsxs(Q,{onClick:()=>{i&&w&&i(e.id)},disabled:u,variant:"ghost",size:"sm",className:"h-7 px-2 text-xs text-destructive hover:text-destructive/80",children:[n.jsx(ie,{size:12,className:"mr-1"}),u?"Deleting...":"Delete"]})]})]})]})},cf=({onCreatePoll:e,onCancel:t,isSubmitting:a=!1})=>{const[r,i]=L.useState(""),[s,o]=L.useState(["",""]),[l,c]=L.useState({allow_multiple:!1,is_anonymous:!1,allow_vote_change:!0}),[d,u]=L.useState(""),[m,p]=L.useState(""),h=()=>{i(""),o(["",""]),c({allow_multiple:!1,is_anonymous:!1,allow_vote_change:!0}),u(""),p(""),t()},g=""!==r.trim()&&s.filter(e=>""!==e.trim()).length>=2;return n.jsxs("div",{className:"bg-glass-slate-card border border-glass-slate-border rounded-2xl p-6 shadow-enterprise-lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"text-lg font-semibold text-white",children:"Create New Poll"}),n.jsx("button",{onClick:h,className:"w-8 h-8 rounded-full bg-glass-slate-bg hover:bg-glass-slate-border flex items-center justify-center transition-colors",children:n.jsx(ae,{size:16,className:"text-gray-400"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Poll Question"}),n.jsx(st,{type:"text",value:r,onChange:e=>i(e.target.value),placeholder:"What would you like to ask the group?",className:"w-full bg-glass-slate-bg border-glass-slate-border text-white placeholder-gray-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Options"}),n.jsxs("div",{className:"space-y-2",children:[s.map((e,t)=>n.jsxs("div",{className:"flex gap-2",children:[n.jsx(st,{type:"text",value:e,onChange:e=>((e,t)=>{const n=[...s];n[e]=t,o(n)})(t,e.target.value),placeholder:`Option ${t+1}`,className:"flex-1 bg-glass-slate-bg border-glass-slate-border text-white placeholder-gray-500"}),s.length>2&&n.jsx("button",{onClick:()=>(e=>{s.length>2&&o(s.filter((t,n)=>n!==e))})(t),className:"w-8 h-8 rounded-lg bg-red-500/10 hover:bg-red-500/20 flex items-center justify-center text-red-400 transition-colors",children:n.jsx(ae,{size:14})})]},t)),s.length<10&&n.jsxs("button",{onClick:()=>{s.length<10&&o([...s,""])},className:"w-full h-10 border-2 border-dashed border-glass-slate-border rounded-lg text-gray-400 hover:border-glass-enterprise-blue hover:text-glass-enterprise-blue transition-colors flex items-center justify-center gap-2",children:[n.jsx(vn,{size:16}),"Add Option"]})]})]}),n.jsxs("div",{className:"space-y-3 p-4 bg-glass-slate-bg/30 rounded-xl border border-glass-slate-border/50",children:[n.jsx("p",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3",children:"Poll Settings"}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ot,{htmlFor:"multiple-choice",className:"text-sm text-gray-300 cursor-pointer",children:"Allow multiple selections"}),n.jsx(we,{children:n.jsxs(je,{children:[n.jsx(Ne,{asChild:!0,children:n.jsx(ia,{size:14,className:"text-gray-500"})}),n.jsx(_e,{children:n.jsx("p",{className:"text-xs",children:"Voters can select more than one option"})})]})})]}),n.jsx(rn,{id:"multiple-choice",checked:l.allow_multiple,onCheckedChange:e=>c({...l,allow_multiple:e})})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ot,{htmlFor:"anonymous",className:"text-sm text-gray-300 cursor-pointer",children:"Anonymous voting"}),n.jsx(we,{children:n.jsxs(je,{children:[n.jsx(Ne,{asChild:!0,children:n.jsx(ia,{size:14,className:"text-gray-500"})}),n.jsx(_e,{children:n.jsx("p",{className:"text-xs",children:"Hide who voted for what"})})]})})]}),n.jsx(rn,{id:"anonymous",checked:l.is_anonymous,onCheckedChange:e=>c({...l,is_anonymous:e})})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ot,{htmlFor:"allow-changes",className:"text-sm text-gray-300 cursor-pointer",children:"Allow vote changes"}),n.jsx(we,{children:n.jsxs(je,{children:[n.jsx(Ne,{asChild:!0,children:n.jsx(ia,{size:14,className:"text-gray-500"})}),n.jsx(_e,{children:n.jsx("p",{className:"text-xs",children:"Voters can change their vote after submitting"})})]})})]}),n.jsx(rn,{id:"allow-changes",checked:l.allow_vote_change,onCheckedChange:e=>c({...l,allow_vote_change:e})})]}),n.jsxs("div",{className:"pt-3 border-t border-glass-slate-border/50",children:[n.jsxs(ot,{className:"text-sm text-gray-300 mb-2 flex items-center gap-2",children:[n.jsx(Kn,{size:14}),"Optional Deadline"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(st,{type:"date",value:d,onChange:e=>u(e.target.value),min:(new Date).toISOString().split("T")[0],className:"flex-1 bg-glass-slate-bg border-glass-slate-border text-white text-sm h-9"}),n.jsx(st,{type:"time",value:m,onChange:e=>p(e.target.value),disabled:!d,className:"w-28 bg-glass-slate-bg border-glass-slate-border text-white text-sm h-9"})]}),d&&n.jsx("button",{onClick:()=>{u(""),p("")},className:"text-xs text-red-400 hover:text-red-300 mt-1.5",children:"Clear deadline"})]})]}),n.jsxs("div",{className:"flex gap-3 pt-2",children:[n.jsx(Q,{onClick:h,variant:"outline",className:"flex-1 h-10 rounded-lg border-glass-slate-border text-gray-300 hover:text-white hover:bg-glass-slate-bg",children:"Cancel"}),n.jsx(Q,{onClick:async()=>{const t=s.filter(e=>""!==e.trim());if(r.trim()&&t.length>=2){let n;if(d){n=`${d}T${m||"23:59"}:00`}await e(r.trim(),t,{...l,deadline_at:n}),i(""),o(["",""]),c({allow_multiple:!1,is_anonymous:!1,allow_vote_change:!0}),u(""),p("")}},disabled:!g||a,className:"flex-1 h-10 rounded-lg bg-gradient-to-r from-glass-enterprise-blue to-glass-enterprise-blue-light hover:from-glass-enterprise-blue-light hover:to-glass-enterprise-blue font-semibold shadow-enterprise border border-glass-enterprise-blue/50 text-white",children:a?"Creating...":"Create Poll"})]})]})]})},df=({onCreatePoll:e})=>{const{accentColors:t}=be();return n.jsxs("div",{className:"text-center py-6 px-4",children:[n.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${t.gradient} opacity-20 rounded-full flex items-center justify-center mx-auto mb-4`,children:n.jsx(Gn,{size:28,className:`text-${t.primary}`})}),n.jsx("h3",{className:"text-lg font-bold mb-2 text-white",children:"No polls yet"}),n.jsx("p",{className:"text-gray-400 mb-4 max-w-sm mx-auto text-sm",children:"Create polls to get everyone's input on destinations, activities, and more."}),n.jsxs(Q,{onClick:e,className:`inline-flex items-center gap-2 bg-gradient-to-r ${t.gradient} hover:opacity-90 text-white px-6 py-2 rounded-xl font-medium text-sm transition-all duration-300 hover:scale-105 shadow-lg`,children:[n.jsx(vn,{size:16}),"Create Poll"]}),n.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-3 max-w-2xl mx-auto text-left",children:[n.jsxs("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10",children:[n.jsx("h4",{className:"font-medium mb-1 text-white text-sm",children:"Group Decisions"}),n.jsx("p",{className:"text-xs text-gray-400",children:"Vote on plans and activities"})]}),n.jsxs("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10",children:[n.jsx("h4",{className:"font-medium mb-1 text-white text-sm",children:"Real-Time Results"}),n.jsx("p",{className:"text-xs text-gray-400",children:"See votes update live"})]}),n.jsxs("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10",children:[n.jsx("h4",{className:"font-medium mb-1 text-white text-sm",children:"Multiple Options"}),n.jsx("p",{className:"text-xs text-gray-400",children:"Add as many choices as needed"})]})]})]})};const uf=new class{getStorageKey(e){return`polls_${e}`}async getPolls(e){try{return await xe(this.getStorageKey(e),[])}catch(t){return[]}}async savePolls(e,t){try{await ve(this.getStorageKey(e),t)}catch(n){}}async createPoll(e,t){var n,a,r,i;const s=await this.getPolls(e),o=t.options.map((e,t)=>({id:`option_${t}`,text:e,votes:0,voters:[]})),l={id:`demo-poll-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,trip_id:e,question:t.question,options:o,total_votes:0,status:"active",created_by:"demo-user",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),allow_multiple:(null==(n=t.settings)?void 0:n.allow_multiple)||!1,is_anonymous:(null==(a=t.settings)?void 0:a.is_anonymous)||!1,allow_vote_change:!1!==(null==(r=t.settings)?void 0:r.allow_vote_change),deadline_at:null==(i=t.settings)?void 0:i.deadline_at};return s.unshift(l),await this.savePolls(e,s),l}async voteOnPoll(e,t,n,a="demo-user"){const r=await this.getPolls(e),i=r.findIndex(e=>e.id===t);if(-1===i)return null;const s=r[i];if(s.options.some(e=>e.voters.includes(a))&&!s.allow_vote_change)return null;(!s.allow_multiple||s.allow_multiple&&s.allow_vote_change)&&s.options.forEach(e=>{const t=e.voters.indexOf(a);-1!==t&&(e.voters.splice(t,1),e.votes=Math.max(0,e.votes-1),s.total_votes=Math.max(0,s.total_votes-1))});for(const o of n){const e=s.options.findIndex(e=>e.id===o);-1!==e&&(s.options[e].voters.includes(a)||(s.is_anonymous||s.options[e].voters.push(a),s.options[e].votes+=1,s.total_votes+=1))}return s.updated_at=(new Date).toISOString(),await this.savePolls(e,r),s}async removeVote(e,t,n="demo-user"){const a=await this.getPolls(e),r=a.findIndex(e=>e.id===t);if(-1===r)return null;const i=a[r];return i.options.forEach(e=>{const t=e.voters.indexOf(n);-1!==t&&(e.voters.splice(t,1),e.votes=Math.max(0,e.votes-1),i.total_votes=Math.max(0,i.total_votes-1))}),i.updated_at=(new Date).toISOString(),await this.savePolls(e,a),i}async closePoll(e,t){const n=await this.getPolls(e),a=n.findIndex(e=>e.id===t);return-1===a?null:(n[a].status="closed",n[a].updated_at=(new Date).toISOString(),await this.savePolls(e,n),n[a])}async deletePoll(e,t){const n=await this.getPolls(e),a=n.filter(e=>e.id!==t);return a.length!==n.length&&(await this.savePolls(e,a),!0)}async clearPolls(e){await ye(this.getStorageKey(e))}async clearAllDemoPolls(){}},mf=async e=>await xe(`mock_poll_votes_${e}`,{}),pf=async(e,t)=>{await ve(`mock_poll_votes_${e}`,t)},hf=({tripId:e})=>{const[t,a]=L.useState(!1),{user:r}=Y(),{isDemoMode:i}=X(),{polls:s,isLoading:o,createPollAsync:l,votePollAsync:c,removeVote:d,closePollAsync:u,deletePollAsync:m,isCreatingPoll:p,isVoting:h,isRemovingVote:g,isClosing:f,isDeleting:x}=(e=>{const t=ne(),{toast:n}=ue(),{isDemoMode:a}=X(),{data:r=[],isLoading:i}=Te({queryKey:["tripPolls",e],queryFn:async()=>{if(a){const t=await uf.getPolls(e),n=await mf(e),a=ke.filter(t=>t.trip_id===e).map(e=>{const t=n[e.id],a=e.options.map(e=>{var n;const a=e.voteCount,r=null==(n=null==t?void 0:t.optionIds)?void 0:n.includes(e.id);return{id:e.id,text:e.text,votes:r?a+1:a,voters:r?[...e.voters,"demo-user"]:e.voters}}),r=t?e.total_votes+t.optionIds.length:e.total_votes;return{id:e.id,trip_id:e.trip_id,question:e.question,options:a,total_votes:r,status:e.status,created_by:e.created_by,created_at:e.created_at,updated_at:e.updated_at,allow_multiple:e.allow_multiple??!1,is_anonymous:e.is_anonymous??!1,allow_vote_change:e.allow_vote_change??!0}});return[...t,...a]}const{data:t,error:n}=await W.from("trip_polls").select("*").eq("trip_id",e).order("created_at",{ascending:!1});if(n)throw n;return(t||[]).map(e=>({...e,options:Array.isArray(e.options)?e.options.filter(e=>e&&"object"==typeof e):[],status:e.status}))},enabled:!!e}),s=ze({mutationFn:async t=>{var n,r,i,s;if(a)return await uf.createPoll(e,t);const{data:{user:o}}=await W.auth.getUser();if(!o)throw new Error("User not authenticated");const l=t.options.map((e,t)=>({id:`option_${t}`,text:e,votes:0,voters:[]})),{data:c,error:d}=await W.from("trip_polls").insert({trip_id:e,question:t.question,options:l,total_votes:0,status:"active",created_by:o.id,allow_multiple:(null==(n=t.settings)?void 0:n.allow_multiple)||!1,is_anonymous:(null==(r=t.settings)?void 0:r.is_anonymous)||!1,allow_vote_change:!1!==(null==(i=t.settings)?void 0:i.allow_vote_change),deadline_at:(null==(s=t.settings)?void 0:s.deadline_at)||null}).select().single();if(d)throw d;return c},onSuccess:()=>{t.invalidateQueries({queryKey:["tripPolls",e]}),n({title:"Poll created",description:"Your poll has been added to the trip."})},onError:()=>{n({title:"Error",description:"Failed to create poll. Please try again.",variant:"destructive"})}}),o=ze({mutationFn:async({pollId:r,optionIds:i})=>{var s;const o=Array.isArray(i)?i:[i];if(a){if(await uf.voteOnPoll(e,r,o))return{pollId:r,optionIds:o};const t=await mf(e);return t[r]={optionIds:o,votedAt:(new Date).toISOString()},await pf(e,t),{pollId:r,optionIds:o}}const{data:{user:l}}=await W.auth.getUser();if(!l)throw new Error("User not authenticated");const{data:c,error:d}=await W.from("trip_polls").select("version, allow_multiple, allow_vote_change").eq("id",r).maybeSingle();if(d)throw d;if(!c)throw new Error("Poll not found");for(const a of o){const{error:i}=await W.rpc("vote_on_poll",{p_poll_id:r,p_option_id:a,p_user_id:l.id,p_current_version:c.version??null});if(i){if(null==(s=i.message)?void 0:s.includes("modified by another user"))throw n({title:"Poll Updated",description:"This poll was updated by someone else. Refreshing..."}),await t.invalidateQueries({queryKey:["tripPolls",e]}),i;throw i}}return{pollId:r,optionIds:o}},onSuccess:()=>{t.invalidateQueries({queryKey:["tripPolls",e]}),n({title:"Vote recorded",description:"Your vote has been saved."})},onError:e=>{var t;(null==(t=e.message)?void 0:t.includes("modified by another user"))||n({title:"Error",description:"Failed to record vote. Please try again.",variant:"destructive"})}}),l=ze({mutationFn:async({pollId:t})=>{if(a){if(await uf.removeVote(e,t))return{pollId:t};const n=await mf(e);return n[t]&&(delete n[t],await pf(e,n)),{pollId:t}}const{data:{user:n}}=await W.auth.getUser();if(!n)throw new Error("User not authenticated");const{error:r}=await W.rpc("remove_vote_from_poll",{p_poll_id:t,p_user_id:n.id});if(r)throw r;return{pollId:t}},onSuccess:()=>{t.invalidateQueries({queryKey:["tripPolls",e]}),n({title:"Vote removed",description:"Your vote has been removed."})},onError:()=>{n({title:"Error",description:"Failed to remove vote. Please try again.",variant:"destructive"})}}),c=ze({mutationFn:async({pollId:t})=>{if(a)return await uf.closePoll(e,t);const{data:{user:n}}=await W.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:r,error:i}=await W.from("trip_polls").update({status:"closed",closed_at:(new Date).toISOString(),closed_by:n.id}).eq("id",t).eq("created_by",n.id).select().single();if(i)throw i;return r},onSuccess:()=>{t.invalidateQueries({queryKey:["tripPolls",e]}),n({title:"Poll closed",description:"No more votes will be accepted."})},onError:()=>{n({title:"Error",description:"Failed to close poll. Please try again.",variant:"destructive"})}}),d=ze({mutationFn:async t=>{if(a){if(!(await uf.deletePoll(e,t)))throw new Error("Failed to delete poll");return t}const{data:{user:n}}=await W.auth.getUser();if(!n)throw new Error("User not authenticated");const{error:r}=await W.from("trip_polls").delete().eq("id",t).eq("created_by",n.id);if(r)throw r;return t},onSuccess:()=>{t.invalidateQueries({queryKey:["tripPolls",e]}),n({title:"Poll deleted",description:"The poll has been removed."})},onError:()=>{n({title:"Error",description:"Failed to delete poll. Only the creator can delete.",variant:"destructive"})}});return{polls:r,isLoading:i,createPoll:s.mutate,createPollAsync:s.mutateAsync,votePoll:o.mutate,votePollAsync:o.mutateAsync,removeVote:l.mutate,removeVoteAsync:l.mutateAsync,closePoll:c.mutate,closePollAsync:c.mutateAsync,deletePoll:d.mutate,deletePollAsync:d.mutateAsync,isCreatingPoll:s.isPending,isVoting:o.isPending,isRemovingVote:l.isPending,isClosing:c.isPending,isDeleting:d.isPending}})(e),v=null==r?void 0:r.id,y=L.useMemo(()=>s.map(e=>{var t;const n=e.options.filter(e=>{var t;return null==(t=e.voters)?void 0:t.includes(v||"")}),a=e.allow_multiple?n.map(e=>e.id):null==(t=n[0])?void 0:t.id;return{id:e.id,question:e.question,options:e.options.map(e=>({id:e.id,text:e.text,votes:e.votes,voters:e.voters})),totalVotes:e.total_votes,userVote:a,status:e.status,createdAt:e.created_at,createdBy:e.created_by,allow_multiple:e.allow_multiple,is_anonymous:e.is_anonymous,allow_vote_change:e.allow_vote_change,deadline_at:e.deadline_at,closed_at:e.closed_at,closed_by:e.closed_by}}),[s,v]),b=async(e,t)=>{try{await c({pollId:e,optionIds:t})}catch(n){}},w=async(e,t,n)=>{try{await l({question:e,options:t,settings:n}),a(!1)}catch(r){}},j=async e=>{try{await u({pollId:e})}catch(t){}},N=e=>{d({pollId:e})},_=async e=>{try{await m(e)}catch(t){}},k=e=>{const t=y.find(t=>t.id===e);if(!t)return;const n=[["Poll Question",t.question],["Total Votes",t.totalVotes.toString()],["Status",t.status],[],["Option","Votes","Percentage",...t.is_anonymous?[]:["Voters"]]];t.options.forEach(e=>{var a;const r=t.totalVotes>0?(e.votes/t.totalVotes*100).toFixed(1):"0",i=[e.text,e.votes.toString(),`${r}%`,...t.is_anonymous?[]:[(null==(a=e.voters)?void 0:a.join(", "))||""]];n.push(i)});const a=n.map(e=>e.join(",")).join("\n"),r=new Blob([a],{type:"text/csv"}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=`poll-${e}-results.csv`,s.click(),URL.revokeObjectURL(i),ee.success("Poll exported",{description:"Results saved as CSV file."})};return o||0!==y.length||t||i?n.jsxs("div",{className:"space-y-3 mobile-safe-scroll",children:[!t&&n.jsxs(Q,{onClick:()=>a(!0),className:"w-full h-10 rounded-xl bg-gradient-to-r from-glass-enterprise-blue to-glass-enterprise-blue-light hover:from-glass-enterprise-blue-light hover:to-glass-enterprise-blue font-semibold shadow-enterprise border border-glass-enterprise-blue/50 text-white text-sm",children:[n.jsx(Gn,{size:18,className:"mr-2"}),"Create Poll"]}),t&&n.jsx(cf,{onCreatePoll:w,onCancel:()=>a(!1),isSubmitting:p}),o?n.jsx("div",{className:"flex justify-center py-6",children:n.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):0===y.length?n.jsx("div",{className:"text-center py-6 text-muted-foreground text-sm",children:"No polls have been created yet."}):y.map(e=>n.jsx(lf,{poll:e,onVote:b,onRemoveVote:N,onClose:j,onDelete:_,onExport:k,disabled:"closed"===e.status||!v,isVoting:h,isRemovingVote:g,isClosing:f,isDeleting:x},e.id))]}):n.jsxs("div",{className:"space-y-3 mobile-safe-scroll",children:[n.jsx(df,{onCreatePoll:()=>a(!0)}),t&&n.jsx(cf,{onCreatePoll:w,onCancel:()=>a(!1),isSubmitting:p})]})},gf=({tripId:e})=>n.jsx("div",{className:"p-4 space-y-3 bg-glass-slate-bg rounded-2xl",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"text-base font-semibold text-white mb-3 flex items-center gap-2",children:[n.jsx(Ct,{size:18,className:"text-glass-enterprise-blue"}),"Group Polls"]}),n.jsx(hf,{tripId:e})]})}),ff=Object.freeze(Object.defineProperty({__proto__:null,CommentsWall:gf},Symbol.toStringTag,{value:"Module"})),xf=({tripId:e,showDetails:t=!0})=>{const{quota:a,loading:r}=(e=>{const{isPlus:t}=te(),{isDemoMode:n}=X(),[a,r]=L.useState({usedMB:0,quotaMB:t?5e4:500,percentUsed:0,isNearLimit:!1,isOverLimit:!1}),[i,s]=L.useState(!0);L.useEffect(()=>{if(n)return r({usedMB:127,quotaMB:500,percentUsed:25.4,isNearLimit:!1,isOverLimit:!1}),void s(!1);o()},[e,t,n]);const o=async()=>{s(!0);try{let n=0;const a=W.from("trip_media_index").select("file_size");e&&a.eq("trip_id",e);const{data:i}=await a;i&&(n=i.reduce((e,t)=>e+(t.file_size||0),0));const s=n/1048576,o=t?5e4:500,l=s/o*100;r({usedMB:Math.round(10*s)/10,quotaMB:o,percentUsed:Math.round(10*l)/10,isNearLimit:l>=80,isOverLimit:l>=100})}catch(n){}finally{s(!1)}};return{quota:a,loading:i,refresh:o,canUpload:!a.isOverLimit||t||n}})(e),{isSubscribed:i,upgradeToTier:s}=te();if(r)return n.jsx("div",{className:"animate-pulse bg-white/5 h-2 rounded-full w-full"});const o=()=>a.isOverLimit?"text-red-400":a.isNearLimit?"text-yellow-400":"text-green-400";return n.jsxs("div",{className:"space-y-2",children:[t&&n.jsxs("div",{className:"flex items-center justify-between text-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ma,{size:16,className:o()}),n.jsxs("span",{className:"text-gray-300",children:["Storage: ",a.usedMB.toFixed(1)," MB / ",a.quotaMB," MB"]})]}),n.jsxs("span",{className:`font-medium ${o()}`,children:[a.percentUsed.toFixed(1),"%"]})]}),n.jsx("div",{className:"relative w-full h-2 bg-white/10 rounded-full overflow-hidden",children:n.jsx("div",{className:`absolute left-0 top-0 h-full ${a.isOverLimit?"bg-red-500":a.isNearLimit?"bg-yellow-500":"bg-green-500"} transition-all duration-500`,style:{width:`${Math.min(a.percentUsed,100)}%`}})}),a.isOverLimit&&!i&&n.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3 flex items-start gap-3",children:[n.jsx(Se,{size:20,className:"text-red-400 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-red-300 text-sm font-medium mb-1",children:"Storage Limit Reached"}),n.jsx("p",{className:"text-red-200/80 text-xs mb-2",children:"You've reached your 500 MB storage limit. Upgrade for unlimited storage."}),n.jsxs("button",{onClick:()=>s("explorer","annual"),className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-4 py-1.5 rounded-lg text-xs font-bold hover:scale-105 transition-transform",children:[n.jsx(Qn,{size:14,className:"inline mr-1"}),"View Plans"]})]})]}),a.isNearLimit&&!a.isOverLimit&&!i&&n.jsxs("div",{className:"bg-yellow-500/20 border border-yellow-500/30 rounded-lg p-3 flex items-start gap-3",children:[n.jsx(Se,{size:20,className:"text-yellow-400 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-yellow-300 text-sm font-medium mb-1",children:"Approaching Storage Limit"}),n.jsxs("p",{className:"text-yellow-200/80 text-xs mb-2",children:["You've used ",a.percentUsed.toFixed(0),"% of your storage. Upgrade for unlimited storage."]}),n.jsxs("button",{onClick:()=>s("explorer","annual"),className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-4 py-1.5 rounded-lg text-xs font-bold hover:scale-105 transition-transform",children:[n.jsx(Qn,{size:14,className:"inline mr-1"}),"View Plans"]})]})]}),i&&t&&n.jsx("div",{className:"text-center",children:n.jsx("span",{className:"text-xs text-gray-400",children:"âœ¨ Unlimited storage with your plan"})})]})};class vf{static getUniversalMockData(e){const t=He(e),n=this.fallbackPhotos.map((t,n)=>({...t,id:`${e}-photo-${n+1}`})),a=this.fallbackVideos.map((t,n)=>({...t,id:`${e}-video-${n+1}`})),r=this.fallbackFiles.map((t,n)=>({...t,id:`${e}-file-${n+1}`})),i=this.fallbackLinks.map((t,n)=>({...t,id:`${e}-link-${n+1}`}));return"pro"===t&&r.push({id:`${e}-pro-file-1`,media_url:"/mock/files/tour_rider.pdf",filename:"Tour Rider Requirements.pdf",media_type:"document",metadata:{extractedEvents:5},created_at:new Date(Date.now()-12e5).toISOString(),source:"upload",file_size:1024e3,mime_type:"application/pdf"}),"event"===t&&r.push({id:`${e}-event-file-1`,media_url:"/mock/files/speaker_guidelines.pdf",filename:"Speaker Guidelines.pdf",media_type:"document",metadata:{extractedEvents:3},created_at:new Date(Date.now()-15e5).toISOString(),source:"upload",file_size:896e3,mime_type:"application/pdf"}),{photos:n,videos:a,files:r,links:i}}static getCombinedMediaItems(e){const t=this.getUniversalMockData(e);return[...t.photos,...t.videos,...t.files]}static getLinkItems(e){return this.getUniversalMockData(e).links}}t(vf,"fallbackPhotos",[{id:"fallback-photo-1",media_url:"/mock/images/travel-selfie.jpg",filename:"Group Travel Selfie.jpg",media_type:"image",metadata:{width:1920,height:1080},created_at:new Date(Date.now()-36e5).toISOString(),source:"chat",file_size:2457600,mime_type:"image/jpeg"},{id:"fallback-photo-2",media_url:"/mock/images/group-mountain-photo.jpg",filename:"Mountain Adventure.jpg",media_type:"image",metadata:{width:1920,height:1080},created_at:new Date(Date.now()-72e5).toISOString(),source:"upload",file_size:3145728,mime_type:"image/jpeg"},{id:"fallback-photo-3",media_url:"/mock/images/dinner-receipt-preview.jpg",filename:"Group Dinner.jpg",media_type:"image",metadata:{width:1920,height:1080},created_at:new Date(Date.now()-108e5).toISOString(),source:"chat",file_size:1843200,mime_type:"image/jpeg"},{id:"fallback-photo-4",media_url:"/mock/images/wedding-ceremony.jpg",filename:"Ceremony Moment.jpg",media_type:"image",metadata:{width:1920,height:1080},created_at:new Date(Date.now()-144e5).toISOString(),source:"upload",file_size:2621440,mime_type:"image/jpeg"}]),t(vf,"fallbackVideos",[{id:"fallback-video-1",media_url:"/mock/videos/team-celebration.mp4",filename:"Team Celebration.mp4",media_type:"video",metadata:{duration:45,width:1920,height:1080},created_at:new Date(Date.now()-54e5).toISOString(),source:"chat",file_size:15728640,mime_type:"video/mp4"},{id:"fallback-video-2",media_url:"/mock/videos/venue-tour.mp4",filename:"Venue Walkthrough.mp4",media_type:"video",metadata:{duration:120,width:1920,height:1080},created_at:new Date(Date.now()-9e6).toISOString(),source:"upload",file_size:45875200,mime_type:"video/mp4"}]),t(vf,"fallbackFiles",[{id:"fallback-file-1",media_url:"/mock/files/dinner_receipt.jpg",filename:"Group Dinner Receipt.jpg",media_type:"document",metadata:{isReceipt:!0,totalAmount:127.45,splitCount:4,perPersonAmount:31.86,preferredMethod:"venmo"},created_at:new Date(Date.now()-18e5).toISOString(),source:"upload",file_size:2048e3,mime_type:"image/jpeg"},{id:"fallback-file-2",media_url:"/mock/files/dodgers_tickets.pdf",filename:"Event Tickets.pdf",media_type:"document",metadata:{isTicket:!0,extractedEvents:1},created_at:new Date(Date.now()-54e5).toISOString(),source:"upload",file_size:512e3,mime_type:"application/pdf"},{id:"fallback-file-3",media_url:"/mock/images/conference-schedule-preview.jpg",filename:"Event Schedule.jpg",media_type:"document",metadata:{isSchedule:!0,extractedEvents:12},created_at:new Date(Date.now()-9e6).toISOString(),source:"chat",file_size:1536e3,mime_type:"image/jpeg"},{id:"fallback-file-4",media_url:"/mock/files/travel_itinerary.pdf",filename:"Travel Itinerary.pdf",media_type:"document",metadata:{extractedEvents:8},created_at:new Date(Date.now()-126e5).toISOString(),source:"upload",file_size:768e3,mime_type:"application/pdf"}]),t(vf,"fallbackLinks",[{id:"fallback-link-1",url:"https://airbnb.com/rooms/12345",title:"Beautiful Downtown Loft - Perfect for Groups",description:"Spacious 3BR/2BA loft in the heart of downtown. Sleeps 8 comfortably with modern amenities.",domain:"airbnb.com",image_url:"/mock/images/airbnb-home.png",created_at:new Date(Date.now()-36e5).toISOString(),source:"places"},{id:"fallback-link-2",url:"https://opentable.com/restaurant/profile/54321",title:"Sunset Rooftop Restaurant - Reservations Available",description:"Award-winning rooftop dining with panoramic city views. Perfect for group celebrations.",domain:"opentable.com",image_url:"/mock/images/restaurant-rooftop.png",created_at:new Date(Date.now()-72e5).toISOString(),source:"places"},{id:"fallback-link-3",url:"https://viator.com/tours/city-walking-tour",title:"Historic City Walking Tour - Small Groups Welcome",description:"Discover hidden gems and local history on this 3-hour guided walking tour.",domain:"viator.com",image_url:"/mock/images/walking-tour.png",created_at:new Date(Date.now()-108e5).toISOString(),source:"places"},{id:"fallback-link-4",url:"https://eventbrite.com/e/concert-tickets",title:"Live Music Concert - Group Discount Available",description:"Don't miss this incredible live performance. Group rates available for 6+ people.",domain:"eventbrite.com",created_at:new Date(Date.now()-144e5).toISOString(),source:"places"}]);const yf=e=>{const[t,n]=L.useState([]),[a,r]=L.useState([]),[i,s]=L.useState(!0),{isDemoMode:o}=X(),l=L.useCallback(async()=>{s(!0);try{let t=[];const a=He(e);if(o)if("consumer"===a&&Ce.getTripMediaItems(parseInt(e)).length>0)t=Ce.getTripMediaItems(parseInt(e));else if("pro"===a&&Bt[e]){const n=Bt[e];t=[...(n.photos||[]).map(e=>({...e,media_type:"image"})),...(n.videos||[]).map(e=>({...e,media_type:"video"})),...(n.files||[]).map(e=>({...e,media_type:"document"}))]}else if("event"===a&&qt[e]){const n=qt[e];t=[...(n.photos||[]).map(e=>({...e,media_type:"image"})),...(n.videos||[]).map(e=>({...e,media_type:"video"})),...(n.files||[]).map(e=>({...e,media_type:"document"}))]}else t=vf.getCombinedMediaItems(e);else{const[n,a]=await Promise.all([W.from("trip_media_index").select("*").eq("trip_id",e).order("created_at",{ascending:!1}),W.from("trip_files").select("*").eq("trip_id",e).order("created_at",{ascending:!1})]);t=[...(n.data||[]).map(e=>({id:e.id,media_url:e.media_url,filename:e.filename||"Untitled",media_type:e.media_type,metadata:e.metadata||{},created_at:e.created_at,source:"chat",mime_type:e.mime_type})),...(a.data||[]).map(e=>({id:e.id,media_url:`/storage/trip-files/${e.name}`,filename:e.name,media_type:e.file_type,metadata:{extracted_events:e.extracted_events},created_at:e.created_at,source:"upload"}))]}n(t)}catch(t){n(o?vf.getCombinedMediaItems(e):[])}finally{s(!1)}},[e,o]),c=L.useCallback(async()=>{try{let t=[];const n=He(e);if(o)t="consumer"===n&&Ce.getTripLinkItems(parseInt(e)).length>0?Ce.getTripLinkItems(parseInt(e)):"pro"===n&&Bt[e]?Bt[e].links||[]:"event"===n&&qt[e]?qt[e].links||[]:vf.getLinkItems(e);else{const[n,a]=await Promise.all([W.from("trip_link_index").select("*").eq("trip_id",e).order("created_at",{ascending:!1}),W.from("trip_links").select("*").eq("trip_id",e).order("created_at",{ascending:!1})]);t=[...(n.data||[]).map(e=>{var t,n;const a=(null==(t=e.og_description)?void 0:t.includes("place_id:"))||(null==(n=e.og_description)?void 0:n.includes("Saved from Places"));return{id:e.id,url:e.url,title:e.og_title||"Untitled Link",description:e.og_description||"",domain:e.domain||new URL(e.url).hostname,image_url:e.og_image_url,created_at:e.created_at,source:a?"places":"chat",tags:[]}}),...(a.data||[]).map(e=>({id:e.id,url:e.url,title:e.title||"Untitled Link",description:e.description||"",domain:new URL(e.url).hostname,image_url:void 0,created_at:e.created_at,source:"manual",tags:[]}))]}r(t)}catch(t){r(o?vf.getLinkItems(e):[])}},[e,o]);L.useEffect(()=>{l(),c()},[l,c]);const d=L.useCallback(e=>"all"===e?[...t,...a]:"photos"===e?t.filter(e=>"image"===e.media_type):"videos"===e?t.filter(e=>"video"===e.media_type):"files"===e?t.filter(e=>"document"===e.media_type):"links"===e?a:t,[t,a]),u=L.useCallback(()=>[...t,...a].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),[t,a]);return{mediaItems:t,linkItems:a,loading:i,totalItems:t.length+a.length,filterByType:d,getAllItemsSorted:u,refetch:()=>{l(),c()}}},bf=({onDelete:e,threshold:t=100})=>{const n=L.useRef(null),a=L.useRef(null),[r,i]=L.useState({isSwiping:!1,swipeDistance:0,shouldShowDelete:!1}),s=L.useCallback(e=>{const t=e.touches[0];n.current={x:t.clientX,y:t.clientY},a.current={x:t.clientX,y:t.clientY}},[]),o=L.useCallback(e=>{if(!n.current)return;const s=e.touches[0];a.current={x:s.clientX,y:s.clientY};const o=n.current.x-a.current.x,l=Math.abs(n.current.y-a.current.y);o>10&&l<30&&(i({isSwiping:!0,swipeDistance:Math.min(o,1.5*t),shouldShowDelete:o>t/2}),o>t&&!r.shouldShowDelete&&bo.medium())},[t,r.shouldShowDelete]);return{handlers:{onTouchStart:s,onTouchMove:o,onTouchEnd:L.useCallback(()=>{if(!n.current||!a.current)return void i({isSwiping:!1,swipeDistance:0,shouldShowDelete:!1});n.current.x-a.current.x>t&&(bo.heavy(),e()),i({isSwiping:!1,swipeDistance:0,shouldShowDelete:!1}),n.current=null,a.current=null},[t,e]),onTouchCancel:L.useCallback(()=>{i({isSwiping:!1,swipeDistance:0,shouldShowDelete:!1}),n.current=null,a.current=null},[])},swipeState:r}};function wf(e){return e.startsWith("video/")?"video":e.startsWith("image/")?"image":"document"}const jf=({url:e,mimeType:t,alt:a="Trip media",poster:r,mode:i="thumbnail",className:s="",onClick:o,autoPlay:l=!1,onError:c})=>{const[d,u]=L.useState(!1),[m,p]=L.useState(!1),[h,g]=L.useState(null),[f,x]=L.useState(!1),v=wf(t),y=L.useMemo(()=>h??e,[h,e]);L.useEffect(()=>{u(!1),x(!1),g(null)},[e]),L.useEffect(()=>()=>{if(h)try{URL.revokeObjectURL(h)}catch{}},[h]);const b=L.useCallback(async()=>{if(f)return!1;if(function(e){return e.startsWith("blob:")||e.startsWith("data:")}(e))return!1;if(!t.startsWith("video/"))return!1;x(!0);try{const n=await fetch(e,{mode:"cors"});if(!n.ok)return!1;const a=await n.blob(),r=a.type&&"application/octet-stream"!==a.type?a:new Blob([a],{type:t}),i=URL.createObjectURL(r);return g(i),!0}catch{return!1}},[f,t,e]),w=L.useCallback(async e=>{!function(e){var t;const n=null==(t=null==e?void 0:e.error)?void 0:t.code;if(n)switch(n){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:;}}(e.currentTarget);if("video"===v){if(await b())return}u(!0),null==c||c(e)},[e,t,c,v,b]),j=L.useCallback(()=>{p(!0)},[]);return d?n.jsxs("div",{className:`flex flex-col items-center justify-center bg-black/50 rounded-lg p-4 ${s}`,style:{minHeight:"thumbnail"===i?"100%":"200px"},children:[n.jsx(Yn,{className:"w-8 h-8 text-orange-400 mb-2"}),n.jsx("p",{className:"text-white/70 text-sm text-center mb-3",children:"Unable to preview"}),n.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-400 text-sm hover:text-blue-300 transition-colors",children:[n.jsx(Oe,{className:"w-4 h-4"}),"Download file"]})]}):"video"===v?"thumbnail"===i?n.jsxs("div",{className:`relative w-full h-full bg-black flex items-center justify-center cursor-pointer ${s}`,onClick:o,children:[n.jsx("video",{preload:"metadata",muted:!0,playsInline:!0,poster:r,onError:w,onLoadedData:j,className:"w-full h-full object-cover",children:n.jsx("source",{src:y,type:t})}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:n.jsx("div",{className:"bg-white/20 backdrop-blur-sm rounded-full p-3",children:n.jsx(Kt,{className:"w-8 h-8 text-white drop-shadow-lg",fill:"white"})})})]}):n.jsx("video",{controls:!0,playsInline:!0,muted:l,autoPlay:l,preload:"metadata",poster:r,className:`max-w-full max-h-full ${s}`,style:{backgroundColor:"#000",borderRadius:"12px"},onError:w,onLoadedData:j,onClick:e=>e.stopPropagation(),children:n.jsx("source",{src:y,type:t})}):"image"===v?n.jsx("img",{src:e,alt:a,loading:"lazy",decoding:"async",className:`w-full h-full object-cover ${s}`,style:{borderRadius:"full"===i?"12px":void 0},onClick:o,onError:w,onLoad:j}):n.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:`flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors ${s}`,children:[n.jsx(Oe,{className:"w-4 h-4"}),"Download file"]})},Nf=({media:e,onClose:t})=>{const[a,r]=L.useState(!1),i=wf(e.mimeType);return n.jsxs("div",{className:"fixed inset-0 z-50 bg-black/95 flex items-center justify-center",onClick:t,children:[n.jsx("button",{className:"absolute top-4 right-4 z-10 text-white bg-white/20 rounded-full p-2 hover:bg-white/30 transition-colors",onClick:t,"aria-label":"Close viewer",children:n.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),n.jsx("a",{href:e.url,download:e.fileName||"media",target:"_blank",rel:"noopener noreferrer",className:"absolute top-4 left-4 z-10 text-white bg-white/20 rounded-full p-2 hover:bg-white/30 transition-colors",onClick:e=>e.stopPropagation(),"aria-label":"Download media",children:n.jsx(Oe,{className:"w-6 h-6"})}),a&&n.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[n.jsx(Yn,{className:"w-12 h-12 text-orange-400 mb-4"}),n.jsx("p",{className:"text-white text-lg mb-4",children:"Unable to preview"}),n.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-500 transition-colors",onClick:e=>e.stopPropagation(),children:[n.jsx(Oe,{className:"w-5 h-5"}),"Download instead"]})]}),"video"===i&&!a&&n.jsx("video",{src:e.url,controls:!0,autoPlay:!0,playsInline:!0,muted:!0,controlsList:"nodownload",preload:"metadata",className:"max-w-full max-h-full",style:{maxWidth:"95vw",maxHeight:"95vh",width:"auto",height:"auto"},onClick:e=>e.stopPropagation(),onError:()=>r(!0)}),"image"===i&&!a&&n.jsx("img",{src:e.url,alt:e.fileName||"Trip media",className:"max-w-full max-h-full object-contain",style:{maxWidth:"95vw",maxHeight:"95vh"},onClick:e=>e.stopPropagation(),onError:()=>r(!0)})]})},_f=({item:e,onPress:t,onLongPress:a})=>{const r=kh({onLongPress:async()=>{await bo.medium(),a()}}),{handlers:i,swipeState:s}=bf({onDelete:()=>{a()}}),o="video"===e.type?"video/mp4":"image/jpeg";return n.jsxs("div",{className:"relative overflow-hidden rounded-md",style:{WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none"},children:[n.jsx("div",{className:"absolute inset-0 bg-red-600 flex items-center justify-end px-4 rounded-md",style:{opacity:s.shouldShowDelete?1:0,transition:s.isSwiping?"none":"opacity 0.2s ease-out"},children:n.jsx(ie,{size:24,className:"text-white"})}),n.jsx("button",{...r,...i,onClick:async e=>{s.isSwiping?e.preventDefault():(await bo.light(),t())},className:"media-grid-item rounded-md bg-white/5 relative",style:{transform:`translateX(-${s.swipeDistance}px)`,transition:s.isSwiping?"none":"transform 0.2s ease-out"},children:n.jsx(jf,{url:e.url,mimeType:o,mode:"thumbnail",className:"w-full h-full"})})]})},kf=({children:e,onDelete:t,className:a=""})=>{const{handlers:r,swipeState:i}=bf({onDelete:t});return n.jsxs("div",{className:`relative overflow-hidden ${a}`,style:{WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none"},children:[n.jsx("div",{className:"absolute inset-0 bg-red-600 flex items-center justify-end px-6",style:{opacity:i.shouldShowDelete?1:0,transition:i.isSwiping?"none":"opacity 0.2s ease-out"},children:n.jsx(ie,{size:20,className:"text-white"})}),n.jsx("div",{...r,style:{transform:`translateX(-${i.swipeDistance}px)`,transition:i.isSwiping?"none":"transform 0.2s ease-out"},children:e})]})};function Sf(e){return`demo_trip_links_${e}`}function Cf(e){try{const t=parseInt(e,10);if(t>=1&&t<=12){const n=Ce.getTripLinkItems(t);if(n.length>0){const t=n.map((t,n)=>{return{id:`${e}-link-${n+1}`,trip_id:e,url:t.url,title:t.title,description:t.description||null,category:(a=t.source,{places:"attraction",manual:"other",chat:"other"}[a]||"other"),votes:0,added_by:"demo-user",created_at:t.created_at,updated_at:t.created_at};var a}),a=localStorage.getItem(Sf(e));if(a){const n=JSON.parse(a).filter(t=>!t.id.startsWith(`${e}-link-`));return[...t,...n]}return t}}const n=localStorage.getItem(Sf(e));return n?JSON.parse(n):[]}catch(t){return[]}}function Ef(e,t){try{localStorage.setItem(Sf(e),JSON.stringify(t))}catch(n){}}async function Df(e,t){if(t){const t={id:`demo-link-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,trip_id:e.tripId,url:e.url,title:e.title,description:e.description||null,category:e.category||null,votes:0,added_by:e.addedBy,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},n=Cf(e.tripId);return n.push(t),Ef(e.tripId,n),ee.success("Link added to trip"),t}try{const t={trip_id:e.tripId,url:e.url,title:e.title,description:e.description,category:e.category,added_by:e.addedBy},{data:n,error:a}=await W.from("trip_links").insert(t).select().single();return a?(ee.error("Failed to add link"),null):(ee.success("Link added to trip"),n)}catch(n){return ee.error("Failed to add link"),null}}const Pf=["video/*","video/mp4","video/quicktime","video/x-msvideo",".mp4",".mov",".m4v",".avi"].join(","),Af=["image/*","image/heic","image/heif",".jpg",".jpeg",".png",".heic",".heif"].join(","),Tf=["application/pdf",".pdf","application/msword",".doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docx","application/vnd.ms-excel",".xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsx","application/vnd.ms-powerpoint",".ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptx","text/plain",".txt","text/csv",".csv","application/rtf",".rtf","application/zip",".zip","application/x-zip-compressed","application/vnd.apple.pages",".pages","application/vnd.apple.numbers",".numbers","application/vnd.apple.keynote",".key"].join(","),Mf=({tripId:e})=>{const{isDemoMode:t}=X(),{user:a}=Y(),{mediaItems:r,linkItems:i,loading:s,refetch:o}=yf(e),[l,c]=L.useState("all"),[d,u]=L.useState(!1),[m,p]=L.useState(!1),[h,g]=L.useState(""),[f,x]=L.useState(""),[v,y]=L.useState(""),[b,w]=L.useState([]),[j,N]=L.useState([]),[_,k]=L.useState(null),[S,C]=L.useState(null),[E,D]=L.useState(null),[P,A]=L.useState(!1),T=L.useRef(null),M=L.useRef(null),R=L.useRef(null),I=L.useRef(null),O=L.useRef(null),{isPulling:F,isRefreshing:U,pullDistance:z}=wg({onRefresh:async()=>{await o()}}),$=L.useRef([]);L.useEffect(()=>()=>{for(const e of $.current)try{URL.revokeObjectURL(e)}catch{}$.current=[]},[]);const B=L.useMemo(()=>{const e=r.filter(e=>"image"===e.media_type||"video"===e.media_type||"document"===e.media_type).map(e=>({id:e.id,type:"video"===e.media_type?"video":"document"===e.media_type?"file":"image",url:e.media_url,uploadedBy:"User",uploadedAt:new Date(e.created_at),filename:e.filename,fileSize:void 0,mimeType:e.mime_type??null,metadata:e.metadata??void 0}));return t?[...b,...e]:e},[b,t,r]),q=L.useMemo(()=>t?[...j,...i]:i,[j,t,i]);Mh({url:(null==_?void 0:_.url)??null,metadata:null==_?void 0:_.metadata});const V=B.filter(e=>"image"===e.type).length,H=B.filter(e=>"video"===e.type).length,K=B.filter(e=>"file"===e.type).length,G=q.length,Q=B.length+q.length,Z=B.filter(e=>"all"===l||("photos"===l?"image"===e.type:"videos"===l?"video"===e.type:"files"!==l||"file"===e.type)),J="urls"===l||"all"===l?q:[],te=async(n,r)=>{if(!n||0===n.length)return;const i=t?{ok:!0}:(null==a?void 0:a.id)?{ok:!0,userId:a.id}:(ee.error("Please sign in to upload"),{ok:!1});if(i.ok){u(!0),await bo.medium();try{if(t){const e=new Date,t=[];for(const a of Array.from(n)){const n="photos"===r?"image":"videos"===r?"video":"file";if("video"===n&&!(a.type||"").startsWith("video/")){ee.error(`"${a.name}" is not a video`);continue}if("image"===n&&!(a.type||"").startsWith("image/")){ee.error(`"${a.name}" is not a photo`);continue}const i=URL.createObjectURL(a);$.current.push(i),t.push({id:`demo-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,type:n,url:i,uploadedBy:"Demo User",uploadedAt:e,filename:a.name,fileSize:`${Math.round(a.size/1024)} KB`})}return void(t.length>0&&(w(e=>[...t,...e]),ee.success(`${t.length} upload(s) added (demo)`)))}const a=[];for(const t of Array.from(n)){const n=Zs(t),s=n||"",o=/\.(mp4|mov|m4v|avi|webm|mkv)$/i.test(t.name),l=s.startsWith("image/")?"image":s.startsWith("video/")||o?"video":"document",c="photos"===r?"image":"videos"===r?"video":"document";if("image"===c&&"image"!==l){ee.error(`"${t.name}" is not a photo`);continue}if("video"===c&&"video"!==l){ee.error(`"${t.name}" is not a video`);continue}const d=t.name.replace(/\//g,"-"),u=`${e}/${i.userId}/${Date.now()}-${d}`,{error:m}=await W.storage.from("trip-media").upload(u,t,{cacheControl:"3600",upsert:!1,contentType:n});if(m){ee.error(`Failed to upload ${t.name}`);continue}const{data:p}=W.storage.from("trip-media").getPublicUrl(u),h=p.publicUrl;a.push(h);const{error:g}=await W.from("trip_media_index").insert({trip_id:e,media_url:h,filename:t.name,media_type:c,file_size:t.size,mime_type:n,metadata:{upload_path:u,uploaded_by:i.userId}});g&&ee.error(`Failed to save ${t.name}`)}a.length>0&&(ee.success(`${a.length} file(s) uploaded`),await new Promise(e=>setTimeout(e,600)),await o())}catch(s){ee.error("Upload failed")}finally{u(!1)}}},ne=L.useMemo(()=>"videos"===l?{label:"Take Video",Icon:_a}:"files"===l?{label:"Upload File",Icon:Re}:"urls"===l?{label:"Add Link",Icon:ha}:{label:"Take Photo",Icon:yn},[l]),ae=L.useMemo(()=>"urls"===l?{label:"Add Link",Icon:ha}:{label:"Upload",Icon:pn},[l]);return n.jsxs("div",{className:"flex flex-col h-full bg-black relative",children:[n.jsx("input",{ref:T,type:"file",accept:Af,capture:"environment",className:"hidden",onChange:e=>te(e.target.files,"photos")}),n.jsx("input",{ref:M,type:"file",accept:Af,className:"hidden",onChange:e=>te(e.target.files,"photos")}),n.jsx("input",{ref:R,type:"file",accept:Pf,capture:"environment",className:"hidden",onChange:e=>te(e.target.files,"videos")}),n.jsx("input",{ref:I,type:"file",accept:Pf,className:"hidden",onChange:e=>te(e.target.files,"videos")}),n.jsx("input",{ref:O,type:"file",accept:Tf,className:"hidden",onChange:e=>te(e.target.files,"files")}),n.jsx(jg,{isRefreshing:U,pullDistance:z,threshold:80}),n.jsx("div",{className:"px-4 py-4 border-b border-white/10 safe-container",children:n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("button",{onClick:async()=>{var e,t,n;await bo.medium(),d||("videos"!==l?"files"!==l?"urls"!==l?null==(n=T.current)||n.click():p(!0):null==(t=O.current)||t.click():null==(e=R.current)||e.click())},disabled:d,className:"native-button flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-xl font-medium shadow-lg disabled:opacity-70 disabled:cursor-not-allowed",children:[d?n.jsx(bn,{size:20,className:"animate-spin"}):n.jsx(ne.Icon,{size:20}),n.jsx("span",{children:ne.label})]}),n.jsxs("button",{onClick:async()=>{var e,t,n;await bo.medium(),d||("videos"!==l?"files"!==l?"urls"!==l?null==(n=M.current)||n.click():p(!0):null==(t=O.current)||t.click():null==(e=I.current)||e.click())},disabled:d,className:"native-button flex items-center justify-center gap-2 bg-white/10 text-white px-4 py-3 rounded-xl font-medium backdrop-blur-sm disabled:opacity-70 disabled:cursor-not-allowed",children:[d?n.jsx(bn,{size:20,className:"animate-spin"}):n.jsx(ae.Icon,{size:20}),n.jsx("span",{children:ae.label})]})]})}),n.jsx("div",{className:"px-4 py-3 border-b border-white/10 safe-container",children:n.jsx(xf,{tripId:e,showDetails:!0})}),n.jsx("div",{className:"flex gap-2 px-4 py-3 border-b border-white/10 safe-container overflow-x-auto native-scroll scrollbar-hide",children:[{id:"all",label:"All",count:Q},{id:"photos",label:"Photos",count:V},{id:"videos",label:"Videos",count:H},{id:"files",label:"Files",count:K},{id:"urls",label:"Links",count:G}].map(e=>n.jsxs("button",{onClick:async()=>{await bo.light(),c(e.id)},className:`\n              native-tab px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap flex-shrink-0\n              ${l===e.id?"bg-blue-600 text-white shadow-md":"bg-white/10 text-gray-300"}\n            `,children:[e.label," ",e.count>0&&n.jsxs("span",{className:l===e.id?"text-blue-200":"text-gray-500",children:["(",e.count,")"]})]},e.id))}),n.jsx("div",{className:"flex-1 overflow-y-auto px-2 py-2 native-scroll safe-container-bottom",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:s?n.jsx("div",{className:"media-grid",children:[...Array(9)].map((e,t)=>n.jsx("div",{className:"aspect-square rounded-md bg-white/5 skeleton-shimmer"},t))}):0===Z.length&&0===J.length?n.jsx("div",{className:"text-center py-12 animate-fade-in",children:n.jsxs("div",{className:"ios-bounce",children:[n.jsx(fn,{size:48,className:"text-gray-600 mx-auto mb-3"}),n.jsx("p",{className:"text-gray-400 mb-2 font-medium",children:"urls"===l?"No links yet":"No media yet"}),n.jsx("p",{className:"text-sm text-gray-500",children:"urls"===l?"Links from chat appear here â€” or add one quietly":"videos"===l?"Tap â€œTake Videoâ€ to record or upload from your library":"files"===l?"Tap â€œUpload Fileâ€ to add PDFs, docs, spreadsheets, and more":"Tap â€œTake Photoâ€ to add photos"})]})}):n.jsxs(n.Fragment,{children:["urls"!==l&&Z.length>0&&n.jsx("div",{className:"media-grid animate-fade-in mb-4",children:Z.filter(e=>"image"===e.type||"video"===e.type).map((e,t)=>n.jsx("div",{style:{animationDelay:30*t+"ms",animation:"fade-in 0.3s ease-out both"},children:n.jsx(_f,{item:e,onPress:()=>{const t="video"===e.type?"video/mp4":"image/jpeg";k({url:e.url,mimeType:t,fileName:e.filename})},onLongPress:()=>{C(e)}})},e.id))}),"files"===l&&Z.length>0&&n.jsx("div",{className:"space-y-3 px-2 animate-fade-in mb-4",children:Z.filter(e=>"file"===e.type).map((e,t)=>n.jsx(kf,{onDelete:()=>C(e),className:"rounded-xl",children:n.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"block bg-white/5 rounded-xl p-4 border border-white/10 hover:bg-white/10 transition-colors active:scale-98",style:{animationDelay:30*t+"ms",animation:"fade-in 0.3s ease-out both"},children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Re,{size:18,className:"text-blue-400 flex-shrink-0"}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("p",{className:"text-white text-sm font-medium truncate",children:e.filename||"File"}),n.jsx("p",{className:"text-gray-500 text-xs truncate",children:e.url})]})]})})},e.id))}),("urls"===l||"all"===l)&&J.length>0&&n.jsx("div",{className:"space-y-3 px-2 animate-fade-in",children:J.map((e,t)=>n.jsx(kf,{onDelete:()=>D({id:e.id,title:e.title}),className:"rounded-xl",children:n.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"block bg-white/5 rounded-xl p-4 border border-white/10 hover:bg-white/10 transition-colors active:scale-98",style:{animationDelay:30*t+"ms",animation:"fade-in 0.3s ease-out both"},children:n.jsxs("div",{className:"flex items-start gap-3",children:[e.image_url&&n.jsx("img",{src:e.image_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"text-white font-medium text-sm mb-1 line-clamp-2",children:e.title}),n.jsx("p",{className:"text-gray-400 text-xs mb-2 line-clamp-2",children:e.description}),n.jsx("p",{className:"text-blue-400 text-xs truncate",children:e.domain})]})]})})},e.id))})]})}),_&&n.jsx(Nf,{media:_,onClose:()=>k(null)}),S&&n.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-4 max-w-sm w-full",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center",children:n.jsx(ie,{size:20,className:"text-red-400"})}),n.jsxs("h3",{className:"text-white font-semibold",children:["Delete ",S.type,"?"]})]}),n.jsxs("p",{className:"text-gray-400 text-sm mb-4",children:['This will permanently remove "',S.filename||"this item",'" from the trip.']}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx("button",{onClick:()=>C(null),className:"native-button bg-white/10 text-white py-3 rounded-xl font-medium",disabled:P,children:"Cancel"}),n.jsx("button",{onClick:()=>(async e=>{if((null==a?void 0:a.id)||t){A(!0);try{if(t)return w(t=>t.filter(t=>t.id!==e.id)),ee.success("Deleted (demo)"),C(null),void A(!1);const n=e.url.split("/trip-media/");if(n.length>1){const e=decodeURIComponent(n[1]);await W.storage.from("trip-media").remove([e])}const{error:a}=await W.from("trip_media_index").delete().eq("id",e.id);if(a)throw a;ee.success("Deleted successfully"),await o()}catch(ws){ee.error("Failed to delete")}finally{A(!1),C(null)}}else ee.error("Please sign in to delete")})(S),className:"native-button bg-red-600 text-white py-3 rounded-xl font-medium flex items-center justify-center gap-2",disabled:P,children:P?n.jsx(bn,{size:18,className:"animate-spin"}):"Delete"})]})]})}),E&&n.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-4 max-w-sm w-full",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center",children:n.jsx(ie,{size:20,className:"text-red-400"})}),n.jsx("h3",{className:"text-white font-semibold",children:"Delete link?"})]}),n.jsxs("p",{className:"text-gray-400 text-sm mb-4",children:['This will permanently remove "',E.title,'" from the trip.']}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx("button",{onClick:()=>D(null),className:"native-button bg-white/10 text-white py-3 rounded-xl font-medium",disabled:P,children:"Cancel"}),n.jsx("button",{onClick:()=>(async e=>{if((null==a?void 0:a.id)||t){A(!0);try{if(t)return N(t=>t.filter(t=>t.id!==e)),ee.success("Link deleted (demo)"),D(null),void A(!1);const{error:n}=await W.from("trip_links").delete().eq("id",e);if(n)throw n;ee.success("Link deleted successfully"),await o()}catch(ws){ee.error("Failed to delete link")}finally{A(!1),D(null)}}else ee.error("Please sign in to delete")})(E.id),className:"native-button bg-red-600 text-white py-3 rounded-xl font-medium flex items-center justify-center gap-2",disabled:P,children:P?n.jsx(bn,{size:18,className:"animate-spin"}):"Delete"})]})]})}),m&&n.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-4",children:n.jsxs("div",{className:"w-full max-w-md bg-slate-900 border border-white/10 rounded-2xl p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-white font-semibold",children:"Add Link"}),n.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-gray-300 mb-1",children:"URL *"}),n.jsx("input",{value:h,onChange:e=>g(e.target.value),type:"url",placeholder:"https://...",className:"w-full rounded-xl bg-black/40 border border-white/10 px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/40"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-gray-300 mb-1",children:"Title (optional)"}),n.jsx("input",{value:f,onChange:e=>x(e.target.value),type:"text",placeholder:"e.g., Late night tacos",className:"w-full rounded-xl bg-black/40 border border-white/10 px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/40"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-gray-300 mb-1",children:"Note (optional)"}),n.jsx("textarea",{value:v,onChange:e=>y(e.target.value),rows:3,placeholder:"Add context for the groupâ€¦",className:"w-full rounded-xl bg-black/40 border border-white/10 px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/40 resize-none"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[n.jsx("button",{onClick:()=>p(!1),className:"native-button bg-white/10 text-white px-4 py-3 rounded-xl font-medium",children:"Cancel"}),n.jsx("button",{onClick:async()=>{const n=(e=>{const t=e.trim();if(!t)return null;const n=/^https?:\/\//i.test(t)?t:`https://${t}`;try{const e=new URL(n);return"http:"!==e.protocol&&"https:"!==e.protocol?null:e.toString()}catch{return null}})(h);if(!n)return void ee.error("Please enter a valid URL");const r=f.trim()||new URL(n).hostname,i=v.trim()||void 0;if(t){const e=(new Date).toISOString();return N(t=>[{id:`demo-link-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,url:n,title:r,description:i??"",domain:new URL(n).hostname,created_at:e,source:"manual",tags:[]},...t]),ee.success("Link added (demo)"),p(!1),g(""),x(""),void y("")}if(!(null==a?void 0:a.id))return void ee.error("Please sign in to add links");await Df({tripId:e,url:n,title:r,description:i,category:"other",addedBy:a.id},!1)&&(p(!1),g(""),x(""),y(""),await o())},className:"native-button bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-xl font-medium shadow-lg",children:"Save"})]}),n.jsx("p",{className:"text-[11px] text-gray-500 pt-1",children:"This saves the link to the trip without posting a chat message."})]})]})})]})},Rf=({src:e,alt:t,lazy:a=!0,placeholder:r,aspectRatio:i,sizes:s,priority:o=!1,className:l,...c})=>{const[d,u]=L.useState(!1),[m,p]=L.useState(!a||o),[h,g]=L.useState(!1),f=L.useRef(null);L.useEffect(()=>{if(!a||o||m)return;const e=new IntersectionObserver(([t])=>{t.isIntersecting&&(p(!0),e.disconnect())},{rootMargin:"50px",threshold:.1});return f.current&&e.observe(f.current),()=>e.disconnect()},[a,o,m]);return n.jsxs("div",{ref:f,className:G("relative overflow-hidden",i&&`aspect-[${i}]`,l),children:[!d&&!h&&n.jsx("div",{className:G("absolute inset-0 bg-muted animate-pulse","flex items-center justify-center"),children:r?n.jsx("div",{className:"text-muted-foreground text-sm",children:r}):n.jsx("div",{className:"w-8 h-8 bg-muted-foreground/20 rounded animate-pulse"})}),h&&n.jsx("div",{className:"absolute inset-0 bg-muted flex items-center justify-center",children:n.jsx("div",{className:"text-muted-foreground text-sm",children:"Failed to load image"})}),m&&n.jsx("img",{src:e,alt:t,srcSet:(x=e,void x.includes("http")),sizes:s,loading:a?"lazy":"eager",decoding:"async",onLoad:()=>{u(!0)},onError:()=>{g(!0),u(!0)},className:G("transition-opacity duration-300",d?"opacity-100":"opacity-0","w-full h-full object-cover"),...c})]});var x},If=({photos:e,placeName:t,maxPhotos:a=3,className:r})=>{const i=(null==e?void 0:e.slice(0,a))||[];return 0===i.length?n.jsx("div",{className:G("w-full h-32 bg-muted rounded-lg flex items-center justify-center",r),children:n.jsx(fn,{className:"w-8 h-8 text-muted-foreground/40"})}):1===i.length?n.jsx("div",{className:G("w-full h-32 rounded-lg overflow-hidden",r),children:n.jsx(Rf,{src:i[0],alt:`${t} - Photo 1`,className:"w-full h-full",lazy:!0})}):2===i.length?n.jsx("div",{className:G("grid grid-cols-2 gap-1 h-32 rounded-lg overflow-hidden",r),children:i.map((e,a)=>n.jsx(Rf,{src:e,alt:`${t} - Photo ${a+1}`,className:"w-full h-full",lazy:!0},a))}):n.jsxs("div",{className:G("grid grid-cols-2 gap-1 h-32 rounded-lg overflow-hidden",r),children:[n.jsx(Rf,{src:i[0],alt:`${t} - Photo 1`,className:"w-full h-full row-span-2",lazy:!0}),n.jsxs("div",{className:"grid grid-rows-2 gap-1",children:[n.jsx(Rf,{src:i[1],alt:`${t} - Photo 2`,className:"w-full h-full",lazy:!0}),n.jsx(Rf,{src:i[2],alt:`${t} - Photo 3`,className:"w-full h-full",lazy:!0})]})]})},Of=({place:e,onClose:t,onViewDirections:a,activeContext:r="trip"})=>{if(!e)return null;return n.jsxs("div",{className:"absolute top-4 left-4 z-20 bg-white rounded-xl shadow-2xl border border-gray-200 max-w-sm w-full md:w-80 overflow-hidden",children:[n.jsx(If,{photos:e.photos,placeName:e.name,maxPhotos:3}),n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-gray-900 font-semibold text-base mb-1 truncate",children:e.name}),e.address&&n.jsxs("p",{className:"text-gray-600 text-sm flex items-start gap-1",children:[n.jsx(Un,{size:14,className:"flex-shrink-0 mt-0.5"}),n.jsx("span",{className:"line-clamp-2",children:e.address})]}),e.rating&&n.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[n.jsx("span",{className:"text-yellow-500 text-sm",children:"â˜…"}),n.jsx("span",{className:"text-gray-700 text-sm font-medium",children:e.rating})]})]}),n.jsx("button",{onClick:t,className:"ml-2 p-1 rounded-lg hover:bg-gray-100 transition-colors flex-shrink-0","aria-label":"Close",children:n.jsx(ae,{size:18,className:"text-gray-500"})})]}),e.distance&&n.jsxs("div",{className:"mb-3 pb-3 border-b border-gray-200 bg-blue-50 rounded-lg p-3",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx(Et,{size:14,className:"text-blue-600 flex-shrink-0"}),n.jsxs("span",{className:"text-xs font-semibold text-blue-800",children:["From ","trip"===r?"Trip":"Personal"," Base Camp"]})]}),n.jsxs("div",{className:"text-sm text-blue-900 font-medium",children:[e.distance.distance," Â· ",e.distance.duration]})]}),e.website&&n.jsx("div",{className:"mb-3 pb-3 border-b border-gray-200",children:n.jsx("a",{href:e.website,target:"_blank",rel:"noopener noreferrer",className:"block",children:n.jsxs("div",{className:"flex items-start gap-2 text-blue-600 hover:text-blue-700 group",children:[n.jsx(zn,{size:14,className:"flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("span",{className:"text-sm font-medium group-hover:underline block",children:"Visit Website"}),n.jsx("span",{className:"text-xs text-gray-500 truncate block mt-0.5",children:e.website})]})]})})}),n.jsxs("div",{className:"flex gap-2",children:[a&&e.coordinates&&n.jsxs("button",{onClick:a,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:[n.jsx(va,{size:14}),"Directions"]}),n.jsxs("button",{onClick:()=>{e.placeId?window.open(`https://www.google.com/maps/place/?q=place_id:${e.placeId}`,"_blank"):e.coordinates&&window.open(`https://www.google.com/maps/search/?api=1&query=${e.coordinates.lat},${e.coordinates.lng}`,"_blank")},className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors",children:[n.jsx(zn,{size:14}),"View Larger Map"]})]})]})]})};class Lf{static async callProxy(e,t){const{data:n,error:a}=await W.functions.invoke("google-maps-proxy",{body:{endpoint:e,...t},headers:{"Content-Type":"application/json"}});if(a)throw new Error(`Google Maps API error: ${a.message}`);if(!n)throw new Error("No response from Google Maps service");return n}static async getEmbedUrl(e){return(await this.callProxy("embed-url",{query:e})).embedUrl}static async getDistanceMatrix(e,t,n="DRIVING"){return await this.callProxy("distance-matrix",{origins:e,destinations:t,mode:n})}static async geocodeAddress(e){var t;try{const n=await this.callProxy("geocode",{address:e});if(n.results&&n.results.length>0){const e=null==(t=n.results[0].geometry)?void 0:t.location;if(e&&e.lat&&e.lng)return{lat:e.lat,lng:e.lng}}return null}catch(n){return this.geocodeWithNominatim(e)}}static async geocodeWithNominatim(e){try{const t=encodeURIComponent(e),n=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${t}&limit=1`,{headers:{"User-Agent":"Chravel-App/1.0"}});if(!n.ok)throw new Error(`Nominatim request failed: ${n.status}`);const a=await n.json();if(a&&a.length>0){const e=a[0];return{lat:parseFloat(e.lat),lng:parseFloat(e.lon),displayName:e.display_name}}return null}catch(t){return null}}static async autocompleteWithNominatim(e,t=5){try{const n=encodeURIComponent(e),a=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${n}&limit=${t}&addressdetails=1`,{headers:{"User-Agent":"Chravel-App/1.0"}});if(!a.ok)throw new Error(`Nominatim request failed: ${a.status}`);return(await a.json()).map(e=>({place_id:`nominatim-${e.place_id}`,description:e.display_name,structured_formatting:{main_text:e.name||e.display_name.split(",")[0],secondary_text:e.display_name.split(",").slice(1).join(",").trim()},_coords:{lat:parseFloat(e.lat),lng:parseFloat(e.lon)}}))}catch(n){return[]}}static async getPlaceAutocomplete(e,t=["establishment","geocode"]){try{return await this.callProxy("autocomplete",{input:e,types:t.join("|")})}catch(n){return{predictions:[]}}}static async getPlaceDetailsById(e){try{return await this.callProxy("place-details",{placeId:e})}catch(t){return null}}static async searchPlacesNearBasecamp(e,t,n=5e3){return await this.callProxy("places-search",{query:e,location:`${t.lat},${t.lng}`,radius:n})}static async getPlaceDetails(e){return await this.callProxy("place-details",{placeId:e})}static buildEmbeddableUrl(e,t,n){try{const a="https://www.google.com/maps";if(n&&e){const t=encodeURIComponent(e);return`${a}?output=embed&saddr=${t}&daddr=${encodeURIComponent(n)}`}if(e){return`${a}?output=embed&q=${encodeURIComponent(e)}`}return t?`${a}?output=embed&ll=${t.lat},${t.lng}&z=15`:`${a}/embed?pb=!1m14!1m12!1m3!1d25211418.31451683!2d-95.665!3d37.6!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sus`}catch(a){return"https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d25211418.31451683!2d-95.665!3d37.6!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sus"}}static async searchPlacesByText(e,t){try{const n=(null==t?void 0:t.language)||navigator.language.split("-")[0];return await this.callProxy("text-search",{query:e,language:n,...(null==t?void 0:t.location)&&{location:t.location},...(null==t?void 0:t.region)&&{region:t.region},...(null==t?void 0:t.type)&&{type:t.type}})}catch(n){return{results:[],status:"ZERO_RESULTS"}}}static detectQueryType(e){return/\d+\s+\w+\s+(st|street|ave|avenue|blvd|road|rd|drive|dr|lane|ln|way|court|ct)/i.test(e)?"address":/(city|town|village|region|state|country|province)/i.test(e)?"region":(!/\d/.test(e)||/(restaurant|hotel|bar|cafe|club|lounge|stadium|arena|theater|museum|scandallo|scandalo)/i.test(e),"venue")}}const Ff=Object.freeze(Object.defineProperty({__proto__:null,GoogleMapsService:Lf},Symbol.toStringTag,{value:"Module"})),Uf=({className:e,searchLocation:t,onSaveAsBasecamp:a})=>{const{basecamp:r,isBasecampSet:i}=Ee(),[s,o]=L.useState(!0),[l,c]=L.useState(!1),[d,u]=L.useState(""),[m,p]=L.useState(0),h="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d25211418.31451683!2d-95.665!3d37.6!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sus";L.useEffect(()=>{o(!0),c(!1);try{let e;e=(null==t?void 0:t.lat)&&(null==t?void 0:t.lng)?Lf.buildEmbeddableUrl(t.address,{lat:t.lat,lng:t.lng}):i&&(null==r?void 0:r.address)?Lf.buildEmbeddableUrl(r.address,r.coordinates):h,u(e)}catch(n){u(h)}const e=setTimeout(()=>{o(!1)},100);return()=>clearTimeout(e)},[i,r,m,t]);return n.jsxs("div",{className:`relative w-full h-full ${e}`,children:[s&&n.jsx("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center z-10 rounded-3xl",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-3"}),n.jsx("p",{className:"text-gray-300 text-sm",children:"Loading map..."})]})}),l&&n.jsx("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center z-10 rounded-3xl",children:n.jsxs("div",{className:"text-center p-6",children:[n.jsx(Un,{size:48,className:"text-gray-500 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-300 mb-2",children:"Map unavailable"}),n.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Unable to load Google Maps"}),n.jsx("button",{onClick:()=>{p(e=>e+1),c(!1),o(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"Retry"})]})}),t&&a&&t.address&&n.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-20",children:n.jsxs("button",{onClick:()=>a({lat:t.lat,lng:t.lng,address:t.address||""}),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-lg transition-colors flex items-center gap-2",children:[n.jsx(Un,{size:16}),"Save as Trip Base Camp"]})}),n.jsx("iframe",{src:d||h,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",allow:"geolocation; camera; microphone",className:"absolute inset-0 w-full h-full z-0",onLoad:()=>{o(!1),c(!1)},onError:e=>{o(!1),c(!0)},title:"Google Maps"},`${d}-${m}`)]})};const zf=L.forwardRef(({className:e="",activeContext:t,tripBasecamp:a,personalBasecamp:r,markers:i=[],onMapReady:s,onSaveSearchAsBasecamp:o},l)=>{const[c,d]=L.useState(null),u=(()=>{const e=L.useRef(null),t=L.useRef(null),n=L.useRef(null),[a,r]=L.useState(!0),[i,s]=L.useState(null),[o,l]=L.useState(!1),[c,d]=L.useState(!1),[u,m]=L.useState(null),p=L.useCallback(()=>{s(null)},[]);return{mapRef:e,mapContainerRef:t,loadingTimeoutRef:n,isMapLoading:a,mapError:i,useFallbackEmbed:o,forceIframeFallback:c,userGeolocation:u,setIsMapLoading:r,setMapError:s,setUseFallbackEmbed:l,setForceIframeFallback:d,setUserGeolocation:m,clearMapError:p}})(),m=(()=>{const[e,t]=L.useState(""),[n,a]=L.useState(!1),[r,i]=L.useState(null),[s,o]=L.useState(null),[l,c]=L.useState(!1),[d,u]=L.useState([]),[m,p]=L.useState(""),[h,g]=L.useState(null),f=L.useRef(0),x=L.useRef(null),v=L.useRef(null),y=L.useCallback(()=>{t(""),o(null),u([]),c(!1),i(null),a(!1),x.current&&(x.current.setMap(null),x.current=null)},[]);return{searchQuery:e,isSearching:n,searchError:r,selectedPlace:s,showSuggestions:l,suggestions:d,sessionToken:m,searchOrigin:h,activeAutocompleteRequestRef:f,searchMarkerRef:x,overlayObserverRef:v,setSearchQuery:t,setIsSearching:a,setSearchError:i,setSelectedPlace:o,setShowSuggestions:c,setSuggestions:u,setSessionToken:p,setSearchOrigin:g,clearSearch:y}})(),p=(()=>{const[e,t]=L.useState(null),[n,a]=L.useState(!1),[r,i]=L.useState(null),s=L.useRef([]),o=L.useRef(new Map),l=L.useCallback((e,t)=>{const n=`${e}â†’${t}`,a=o.current.get(n);return a&&Date.now()-a.timestamp<36e5?{distance:a.distance,duration:a.duration}:null},[]),c=L.useCallback((e,t,n)=>{const a=`${e}â†’${t}`;o.current.set(a,{...n,timestamp:Date.now()})},[]),d=L.useCallback(()=>{e&&e.setMap(null),t(null),a(!1),i(null)},[e]);return{routePolyline:e,showRoute:n,routeInfo:r,markersRef:s,distanceCacheRef:o,setRoutePolyline:t,setShowRoute:a,setRouteInfo:i,getCachedDistance:l,setCachedDistance:c,clearRoute:d}})(),{mapRef:h,mapContainerRef:g,loadingTimeoutRef:f,isMapLoading:x,mapError:v,useFallbackEmbed:y,forceIframeFallback:b,userGeolocation:w,setIsMapLoading:j,setMapError:N,setUseFallbackEmbed:_,setForceIframeFallback:k,setUserGeolocation:S}=u,{searchQuery:C,isSearching:E,searchError:D,selectedPlace:P,showSuggestions:A,suggestions:T,sessionToken:M,searchOrigin:R,activeAutocompleteRequestRef:I,searchMarkerRef:O,overlayObserverRef:F,setSearchQuery:U,setIsSearching:z,setSearchError:$,setSelectedPlace:B,setShowSuggestions:q,setSuggestions:V,setSessionToken:H,setSearchOrigin:W,clearSearch:Y}=m,{routePolyline:K,showRoute:G,routeInfo:Q,markersRef:X,setRoutePolyline:Z,setShowRoute:J,setRouteInfo:te,getCachedDistance:ne,setCachedDistance:ae,clearRoute:re}=p,ie=parseInt("300",10),se=async(e,t)=>{var n,a;if(h.current&&window.google){K&&K.setMap(null);try{const r=window.google,i=new r.maps.DirectionsService,s=await i.route({origin:new r.maps.LatLng(e.lat,e.lng),destination:new r.maps.LatLng(t.lat,t.lng),travelMode:r.maps.TravelMode.DRIVING});if(s.routes[0]){const e=s.routes[0],t=e.legs[0],i=new r.maps.Polyline({path:e.overview_path,geodesic:!0,strokeColor:"#3B82F6",strokeOpacity:.8,strokeWeight:4,map:h.current});Z(i),J(!0),te({distance:(null==(n=t.distance)?void 0:n.text)||"Unknown",duration:(null==(a=t.duration)?void 0:a.text)||"Unknown"});const o=new r.maps.LatLngBounds;e.overview_path.forEach(e=>o.extend(e)),h.current.fitBounds(o)}}catch(r){}}},oe=re;L.useImperativeHandle(l,()=>({centerOn:(e,t=15)=>{if(y||b)d({lat:e.lat,lng:e.lng,address:void 0});else if(h.current&&window.google&&e){h.current.panTo(e),h.current.setZoom(t);const n=new window.google.maps.Marker({position:e,map:h.current,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#fde047",fillOpacity:1,strokeColor:"#f97316",strokeWeight:2},animation:window.google.maps.Animation.DROP,zIndex:300});setTimeout(()=>{n.setMap(null)},2500)}},fitBounds:e=>{h.current&&h.current.fitBounds(e)},highlight:e=>{const t=i.find(t=>t.id===e);t&&h.current&&(h.current.setCenter(t.position),h.current.setZoom(15))},getMap:()=>h.current,search:async e=>{y||b?await(async e=>{const{GoogleMapsService:t}=await cn(async()=>{const{GoogleMapsService:e}=await Promise.resolve().then(()=>Ff);return{GoogleMapsService:e}},void 0),n=await t.geocodeWithNominatim(e);if(!n)throw new Error("Location not found");d({lat:n.lat,lng:n.lng,address:n.displayName||e})})(e):await le(e)},clearSearch:()=>{d(null),ce()},showRoute:async(e,t)=>{await se(e,t)},clearRoute:()=>{oe()},getAutocomplete:async(e,t)=>{if(y||b)return(async e=>{const{GoogleMapsService:t}=await cn(async()=>{const{GoogleMapsService:e}=await Promise.resolve().then(()=>Ff);return{GoogleMapsService:e}},void 0);return t.autocompleteWithNominatim(e,5)})(e);if(!M)return[];try{return await Mn(e,M,t||R)}catch(n){return[]}},isInFallbackMode:()=>y||b}),[y,b,M,R,i]),L.useEffect(()=>{let e=!0;f.current=setTimeout(()=>{e&&x&&(ee.warning("Using simplified map view. Interactive search requires API access.",{duration:5e3}),k(!0),_(!0),j(!1),null==s||s())},8e3);try{(async()=>{try{j(!0),N(null);const t=await Fn();if(!e||!g.current)return;let n={lat:40.758,lng:-73.9855},i=12;(null==a?void 0:a.coordinates)?(n=a.coordinates,i=12):(null==r?void 0:r.coordinates)?(n=r.coordinates,i=12):w&&(n=w,i=13);const o=new t.Map(g.current,{center:n,zoom:i,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0,zoomControl:!0,gestureHandling:"greedy",styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"on"}]}]});h.current=o;const l=setInterval(()=>{var e;(null==(e=g.current)?void 0:e.querySelector(".gm-err-container"))&&(clearInterval(l),_(!0),N("Google Maps API Error: Please check your API key, enabled APIs, and billing status in Google Cloud Console."),j(!1))},500);setTimeout(()=>clearInterval(l),3e3),H(Ln()),f.current&&(clearTimeout(f.current),f.current=null),j(!1),null==s||s()}catch(t){if(e){f.current&&(clearTimeout(f.current),f.current=null),_(!0),k(!0);const e=t instanceof Error?t.message:"Failed to load Google Maps JavaScript API.";N(e),j(!1),null==s||s()}}})()}catch(t){k(!0),_(!0),j(!1),null==s||s()}return()=>{e=!1,f.current&&(clearTimeout(f.current),f.current=null)}},[]),L.useEffect(()=>{a||r||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{S({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{S({lat:40.758,lng:-73.9855}),cn(async()=>{const{toast:e}=await import("./index-Ta7FH5xW-mjd3dogn.js").then(e=>e.ac);return{toast:e}},__vite__mapDeps([1,2,3,4,5,6])).then(({toast:e})=>{e.info("Location access denied. Defaulting to New York City. Set a Base Camp for better results.",{duration:5e3})})})},[a,r]),L.useEffect(()=>{if(!h.current)return;let e=null;"trip"===t?e=a||null:"personal"===t&&(e=r||null),W((null==e?void 0:e.coordinates)||null),!a&&!r&&w&&h.current&&(h.current.setCenter(w),h.current.setZoom(13)),(null==P?void 0:P.name)&&M&&le(P.name)},[t,a,r,w]),L.useEffect(()=>{if(!(null==P?void 0:P.coordinates))return;const e="trip"===t?a:r;if(!(null==e?void 0:e.coordinates))return;(async()=>{var t,n;try{const a=`${e.coordinates.lat},${e.coordinates.lng}`,r=`${P.coordinates.lat},${P.coordinates.lng}`,i=ne(a,r);if(i)return void B(e=>(null==e?void 0:e.placeId)===P.placeId?{...e,distance:{...i,mode:"driving"}}:e);const{GoogleMapsService:s}=await cn(async()=>{const{GoogleMapsService:e}=await Promise.resolve().then(()=>Ff);return{GoogleMapsService:e}},void 0),o=await Rn(s.getDistanceMatrix(a,r,"DRIVING"),5e3,"Distance calculation timed out");if("OK"===o.status&&"OK"===(null==(n=null==(t=o.rows[0])?void 0:t.elements[0])?void 0:n.status)){const e=o.rows[0].elements[0],t={distance:e.distance.text,duration:e.duration.text};ae(a,r,t),B(e=>(null==e?void 0:e.placeId)===P.placeId?{...e,distance:{...t,mode:"driving"}}:e)}}catch(a){}})()},[null==P?void 0:P.placeId,t,null==a?void 0:a.coordinates,null==r?void 0:r.coordinates]),L.useEffect(()=>{if(!h.current)return;X.current.forEach(e=>e.setMap(null)),X.current=[];const e=window.google;if(!(null==e?void 0:e.maps))return;const n=(t,n,a,r)=>new e.maps.Marker({position:t,map:h.current,title:n,icon:{path:e.maps.SymbolPath.CIRCLE,scale:r?12:10,fillColor:a,fillOpacity:r?1:.5,strokeColor:r?"#ffffff":"#9ca3af",strokeWeight:r?3:1},zIndex:r?150:100,opacity:r?1:.6});if(null==a?void 0:a.coordinates){const e=n(a.coordinates,a.name||"Trip Base Camp","#3b82f6","trip"===t);X.current.push(e)}if(null==r?void 0:r.coordinates){const e=n(r.coordinates,r.name||"Personal Base Camp","#10b981","personal"===t);X.current.push(e)}},[a,r,t]),function(e,t=300){const n=L.useRef(),a=L.useCallback((...a)=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{e(...a)},t)},[e,t]);L.useEffect(()=>()=>{n.current&&clearTimeout(n.current)},[])}(async e=>{if(!e.trim()||!M)return V([]),void q(!1);const t=++I.current;try{const n=await Mn(e,M,R);t===I.current&&(V(n),q(n.length>0))}catch(n){t===I.current&&(V([]),q(!1),H(Ln()))}},ie);const le=async(e,t)=>{var n,a;const r=e.trim();if(r&&h.current&&M){z(!0),$(null),q(!1);try{const e=t||R,i=await Rn(In(r,e,M),1e4,"Search timed out after 10 seconds");if(!i)return void $("No results found. Try a different search term.");if(On(h.current,i),O.current&&O.current.setMap(null),null==(n=i.geometry)?void 0:n.location){const e=window.google;O.current=new e.maps.Marker({position:i.geometry.location,map:h.current,title:i.name||r,animation:e.maps.Animation.DROP,zIndex:200})}const s={name:i.name||r,address:i.formatted_address,coordinates:(null==(a=i.geometry)?void 0:a.location)?{lat:i.geometry.location.lat(),lng:i.geometry.location.lng()}:void 0,placeId:i.place_id,rating:i.rating,website:i.website,distance:null,photos:i.photos};B(s),H(Ln())}catch(i){const e=i instanceof Error?i.message:"Search failed. Please try again.";$(e),H(Ln())}finally{z(!1)}}},ce=()=>{Y(),oe()};return y||b?n.jsx("div",{className:`relative w-full h-full bg-gray-900 rounded-2xl overflow-hidden ${e}`,children:n.jsx(Uf,{className:"w-full h-full",searchLocation:c,onSaveAsBasecamp:o})}):n.jsxs("div",{className:`relative w-full h-full bg-gray-900 rounded-2xl overflow-hidden ${e}`,children:[Q&&G&&n.jsx("div",{className:"absolute top-20 left-4 z-20 bg-blue-600 text-white rounded-lg px-4 py-3 shadow-xl",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"}),n.jsx("circle",{cx:"7",cy:"17",r:"2"}),n.jsx("path",{d:"M9 17h6"}),n.jsx("circle",{cx:"17",cy:"17",r:"2"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-bold",children:Q.distance}),n.jsx("div",{className:"text-xs opacity-90",children:Q.duration})]})]})}),P&&n.jsx(Of,{place:P,onClose:()=>B(null),onViewDirections:async()=>{if(!(null==P?void 0:P.coordinates))return;const e="trip"===t?a:r;(null==e?void 0:e.coordinates)&&await se(e.coordinates,P.coordinates)},activeContext:t}),x&&n.jsx("div",{className:"absolute inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-10",children:n.jsx("div",{className:"bg-gray-900/95 backdrop-blur-sm border border-gray-800 rounded-xl p-6 shadow-2xl",children:n.jsxs("div",{className:"flex flex-col items-center gap-3",children:[n.jsx("div",{className:"w-8 h-8 border-3 border-sky-500 border-t-transparent rounded-full animate-spin"}),n.jsx("p",{className:"text-sm text-white font-medium",children:"Loading map..."})]})})}),v&&n.jsx("div",{className:"absolute inset-0 bg-gray-900/95 backdrop-blur-sm flex items-center justify-center z-10 p-4",children:n.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-2xl max-w-lg w-full",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ðŸ—ºï¸ Google Maps Setup Required"}),n.jsx("p",{className:"text-red-700 text-sm mb-4",children:v}),n.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[n.jsx("p",{className:"text-xs text-blue-900 font-semibold mb-3",children:"Quick Setup Guide:"}),n.jsxs("ol",{className:"text-xs text-blue-800 space-y-2 list-decimal list-inside",children:[n.jsxs("li",{children:["Go to ",n.jsx("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"Google Cloud Console"})]}),n.jsx("li",{children:"Create a new API key (or use existing)"}),n.jsxs("li",{children:["Enable these APIs:",n.jsxs("ul",{className:"ml-5 mt-1 space-y-0.5 list-disc list-inside",children:[n.jsx("li",{children:"Maps JavaScript API"}),n.jsx("li",{children:"Places API (New)"}),n.jsx("li",{children:"Geocoding API"})]})]}),n.jsx("li",{children:"Enable billing on your Google Cloud project"}),n.jsxs("li",{children:["Add key to ",n.jsx("code",{className:"bg-gray-100 px-1.5 py-0.5 rounded text-xs",children:".env"})," as ",n.jsx("code",{className:"bg-gray-100 px-1.5 py-0.5 rounded text-xs",children:"VITE_GOOGLE_MAPS_API_KEY"})]}),n.jsxs("li",{children:["Restart your dev server: ",n.jsx("code",{className:"bg-gray-100 px-1.5 py-0.5 rounded text-xs",children:"npm run dev"})]})]})]}),n.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4",children:n.jsxs("p",{className:"text-xs text-amber-900",children:[n.jsx("strong",{children:"Note:"})," Google Maps requires an active billing account. You'll get $200/month free credit."]})}),n.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Reload After Setup"})]})}),n.jsx("div",{ref:g,className:"w-full h-full"})]})});zf.displayName="MapCanvas";const $f=({searchQuery:e,onSearchChange:t,onSearchSubmit:a,isSearching:r,searchError:i,onClearSearch:s,isMapLoading:o})=>n.jsx("div",{className:"absolute top-2 right-2 z-20 w-64 md:w-56 sm:portrait:w-48",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-lg rounded-lg p-3 shadow-lg border border-white/10",children:[n.jsxs("form",{onSubmit:a,className:"relative",children:[n.jsx($t,{size:14,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none z-10"}),n.jsx("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:r?"Searching...":"Search locations...",disabled:o||r,className:"w-full bg-white/95 backdrop-blur-sm border border-gray-300 rounded-md pl-9 pr-9 py-2 md:py-1.5 sm:py-1.5 text-gray-800 placeholder-gray-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all text-sm md:text-xs sm:text-[10px] disabled:opacity-70 disabled:cursor-not-allowed "+(r?"opacity-75":"")}),r?n.jsx(bn,{size:14,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-blue-500 animate-spin z-10"}):e&&n.jsx("button",{type:"button",onClick:s,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-10","aria-label":"Clear search",children:n.jsx(ae,{size:14})})]}),i&&n.jsx("div",{className:"mt-2 bg-red-50 border border-red-200 rounded-md px-2 py-1.5 text-[10px] md:text-[9px] sm:text-[8px] text-red-700",children:i})]})}),Bf=({isOpen:e,onClose:t,onBasecampSet:a,onBasecampClear:r,currentBasecamp:i})=>{const[s,o]=L.useState((null==i?void 0:i.address)||""),[l,c]=L.useState((null==i?void 0:i.name)||""),[d,u]=L.useState((null==i?void 0:i.type)||"hotel"),[m,p]=L.useState(!1);return e?n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-gray-900 rounded-3xl w-full max-w-md shadow-2xl border border-gray-800",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-800",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-600 to-green-700 rounded-xl flex items-center justify-center",children:n.jsx(We,{size:20,className:"text-white"})}),n.jsx("h2",{className:"text-xl font-bold text-white",children:i?"Update Basecamp":"Set Basecamp"})]}),n.jsx("button",{onClick:t,className:"w-8 h-8 rounded-full bg-gray-800 hover:bg-gray-700 flex items-center justify-center transition-colors border border-gray-700",children:n.jsx(ae,{size:16,className:"text-gray-400"})})]}),n.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!s.trim()){if(i&&r){p(!0);try{await Promise.resolve(r()),ee.success("Basecamp cleared"),t()}catch{ee.error("Failed to clear basecamp")}finally{p(!1)}return}return i?void ee.error("Cannot clear basecamp"):void t()}p(!0);try{const e=s.trim(),n={address:e,name:l.trim()||void 0,type:d,coordinates:void 0};await Promise.resolve(a(n)),ee.success("Basecamp saved!"),t()}catch{ee.error("Failed to set basecamp. Please try again.")}finally{p(!1)}},className:"p-6 space-y-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Basecamp Location *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Un,{size:18,className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 z-10"}),n.jsx("input",{type:"text",value:s,onChange:e=>o(e.target.value),placeholder:"e.g., Grandma's house, Hotel lobby, 123 Main St",className:"w-full bg-gray-800 border border-gray-700 rounded-xl pl-12 pr-4 py-4 text-white placeholder-gray-500 focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all"})]}),n.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Enter any description - no exact address needed"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Nickname (optional)"}),n.jsx("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"e.g., 'The Beach House' or 'Mom's Place'",className:"w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-4 text-white placeholder-gray-500 focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Type"}),n.jsxs("select",{value:d,onChange:e=>u(e.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all",children:[n.jsx("option",{value:"hotel",children:"Hotel"}),n.jsx("option",{value:"short-term",children:"Short-term Rental"}),n.jsx("option",{value:"other",children:"Other"})]})]}),n.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[n.jsxs("div",{className:"flex gap-3",children:[n.jsx(Q,{type:"button",onClick:t,variant:"outline",className:"flex-1",disabled:m,children:"Cancel"}),n.jsx(Q,{type:"submit",className:"flex-1 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800",disabled:m,children:m?"Saving...":"Save Basecamp"})]}),i&&r&&n.jsx(Q,{type:"button",variant:"destructive",onClick:async()=>{p(!0);try{await Promise.resolve(r()),ee.success("Basecamp cleared"),t()}catch{ee.error("Failed to clear basecamp")}finally{p(!1)}},disabled:m,className:"w-full",children:"Clear Basecamp"})]})]})]})}):null};const qf=new class{async getTripBasecamp(e){try{const{data:t,error:n}=await W.from("trips").select("basecamp_name, basecamp_address, basecamp_latitude, basecamp_longitude").eq("id",e).single();return n?null:(null==t?void 0:t.basecamp_address)?{address:t.basecamp_address,name:t.basecamp_name||void 0,type:"other",coordinates:t.basecamp_latitude&&t.basecamp_longitude?{lat:t.basecamp_latitude,lng:t.basecamp_longitude}:void 0}:null}catch(t){return null}}async setTripBasecamp(e,t,n){try{const a=(null==n?void 0:n.currentVersion)??await this.getBasecampVersion(e),r=t.latitude||null,i=t.longitude||null,{data:{user:s}}=await W.auth.getUser(),o=null==s?void 0:s.id;if(!o)return{success:!1,error:"User not authenticated"};const{data:l,error:c}=await W.rpc("update_trip_basecamp_with_version",{p_trip_id:e,p_current_version:a,p_name:t.name||null,p_address:t.address,p_latitude:r||null,p_longitude:i||null,p_user_id:o});return c?{success:!1,error:c.message}:l&&"object"==typeof l&&!0===l.conflict?{success:!1,conflict:!0,error:"Basecamp was modified by another user. Please refresh and try again."}:{success:!0,coordinates:r&&i?{lat:r,lng:i}:void 0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}async getBasecampVersion(e){const{data:t,error:n}=await W.from("trips").select("basecamp_version").eq("id",e).single();return(null==t?void 0:t.basecamp_version)??1}async getPersonalBasecamp(e,t){var n;try{const a=t||(null==(n=(await W.auth.getUser()).data.user)?void 0:n.id);if(!a)return null;const{data:r,error:i}=await W.from("trip_personal_basecamps").select("*").eq("trip_id",e).eq("user_id",a).maybeSingle();return i?null:r}catch(a){return null}}async upsertPersonalBasecamp(e,t){try{const{data:{user:r}}=await W.auth.getUser();if(!r)throw new Error("User not authenticated");const i=await this.getPersonalBasecamp(e.trip_id,r.id),s=!!i;let o=e.latitude||null,l=e.longitude||null;if(!o&&!l&&e.address)try{const t=await this.geocodeAddress(e.address);t&&(o=t.lat,l=t.lng)}catch(n){0}const{data:c,error:d}=await W.from("trip_personal_basecamps").upsert({trip_id:e.trip_id,user_id:r.id,name:e.name,address:e.address,latitude:o,longitude:l},{onConflict:"trip_id,user_id"}).select().single();if(d)throw d;if(!(null==t?void 0:t.skipHistory))try{await W.rpc("log_basecamp_change",{p_trip_id:e.trip_id,p_user_id:r.id,p_scope:"personal",p_action:s?"updated":"created",p_old_name:(null==i?void 0:i.name)||null,p_old_address:(null==i?void 0:i.address)||null,p_old_lat:(null==i?void 0:i.latitude)||null,p_old_lng:(null==i?void 0:i.longitude)||null,p_new_name:e.name||null,p_new_address:e.address,p_new_lat:o||null,p_new_lng:l||null})}catch(a){0}return c}catch(r){return null}}async deletePersonalBasecamp(e,t){try{const{data:a,error:r}=await W.from("trip_personal_basecamps").select("*").eq("id",e).single();if(r)return!1;const{data:{user:i}}=await W.auth.getUser();if(!i)throw new Error("User not authenticated");const{error:s}=await W.from("trip_personal_basecamps").delete().eq("id",e);if(s)return!1;if(!(null==t?void 0:t.skipHistory)&&a)try{await W.rpc("log_basecamp_change",{p_trip_id:a.trip_id,p_user_id:i.id,p_scope:"personal",p_action:"deleted",p_old_name:a.name||null,p_old_address:a.address||null,p_old_lat:a.latitude||null,p_old_lng:a.longitude||null,p_new_name:null,p_new_address:null,p_new_lat:null,p_new_lng:null})}catch(n){0}return!0}catch(a){return!1}}async getBasecampHistory(e,t){try{let n=W.from("basecamp_change_history").select("*").eq("trip_id",e).order("created_at",{ascending:!1});(null==t?void 0:t.basecampType)&&(n=n.eq("basecamp_type",t.basecampType)),(null==t?void 0:t.limit)&&(n=n.limit(t.limit));const{data:a,error:r}=await n;return r?[]:a||[]}catch(n){return[]}}async geocodeAddress(e){try{if("undefined"!=typeof google&&google.maps&&google.maps.Geocoder){const t=new google.maps.Geocoder;return new Promise(n=>{t.geocode({address:e},(e,t)=>{if("OK"===t&&e&&e.length>0){const t=e[0].geometry.location;n({lat:t.lat(),lng:t.lng()})}else n(null)})})}return null}catch(t){return null}}toBasecampLocation(e){return{address:e.address||"",name:e.name,type:"other",coordinates:e.latitude&&e.longitude?{lat:e.latitude,lng:e.longitude}:void 0}}},Vf=({tripId:e,tripBasecamp:t,onTripBasecampSet:a,personalBasecamp:r,onPersonalBasecampUpdate:i})=>{const{user:s}=Y(),{isDemoMode:o}=X(),{clearBasecamp:l}=Ee(),[c,d]=L.useState(null),[u,m]=L.useState(!1),[p,h]=L.useState(!1),[g,f]=L.useState(!0),x=void 0!==r?r:c,v=i||d,y=(null==s?void 0:s.id)||(()=>{let e=sessionStorage.getItem("demo-user-id");return e||(e=`demo-user-${Date.now()}`,sessionStorage.setItem("demo-user-id",e)),e})();L.useEffect(()=>{if(void 0!==r)return void f(!1);(async()=>{f(!0);try{if(o){const t=he.getSessionPersonalBasecamp(e,y);d(t)}else if(s){const t=await qf.getPersonalBasecamp(e,s.id);d(t)}else d(null)}catch(t){}finally{f(!1)}})()},[e,s,o,y,r]);return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mobile-safe-scroll",children:[n.jsx("div",{className:"rounded-xl bg-gray-900/80 border border-white/10 shadow-lg overflow-hidden",children:n.jsx("div",{className:"p-2.5",children:t?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Un,{size:16,className:"text-sky-400 flex-shrink-0"}),n.jsx("h3",{className:"text-white font-semibold text-sm md:text-base",children:"Trip Base Camp"})]}),n.jsx("button",{onClick:()=>m(!0),className:"bg-sky-600/20 hover:bg-sky-600/30 text-sky-400 px-2 py-1 rounded-lg transition-colors text-xs border border-sky-500/30",children:"Edit"})]}),n.jsx("div",{className:"bg-gray-800/50 rounded-lg p-2.5 border border-gray-700",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Un,{size:18,className:"text-sky-400 flex-shrink-0"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[t.name&&n.jsx("p",{className:"text-white font-semibold text-base md:text-lg truncate",children:t.name}),n.jsx("p",{className:"text-gray-300 text-base md:text-lg break-words",children:t.address})]})]})})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(Un,{size:16,className:"text-sky-400 flex-shrink-0"}),n.jsx("h3",{className:"text-white font-semibold text-sm md:text-base",children:"Trip Base Camp"})]}),n.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"No basecamp set. Set one so the group can align meetups & recs."}),n.jsxs("button",{onClick:()=>m(!0),className:"w-full bg-sky-600 hover:bg-sky-700 text-white py-1.5 px-3 rounded-lg transition-colors flex items-center justify-center gap-2 text-xs",children:[n.jsx(vn,{size:12}),"Set Trip Base Camp"]})]})})}),n.jsx("div",{className:"rounded-xl bg-gray-900/80 border border-white/10 shadow-lg overflow-hidden",children:n.jsx("div",{className:"p-2.5",children:g?n.jsxs("div",{className:"animate-pulse",children:[n.jsx("div",{className:"h-5 bg-gray-800 rounded mb-2 w-1/2"}),n.jsx("div",{className:"h-12 bg-gray-800 rounded"})]}):x?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(hn,{size:16,className:"text-emerald-400 flex-shrink-0"}),n.jsx("h3",{className:"text-white font-semibold text-sm md:text-base",children:"Personal Base Camp"}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 text-xs bg-emerald-900/40 text-emerald-200 border border-emerald-500/30",children:[n.jsx($e,{size:8}),"Private"]})]}),n.jsx("button",{onClick:()=>h(!0),className:"bg-emerald-600/20 hover:bg-emerald-600/30 text-emerald-400 px-2 py-1 rounded-lg transition-colors text-xs border border-emerald-500/30",children:"Edit"})]}),n.jsx("div",{className:"bg-gray-800/50 rounded-lg p-2.5 border border-gray-700",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Un,{size:18,className:"text-emerald-400 flex-shrink-0"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[x.name&&n.jsx("p",{className:"text-white font-semibold text-base md:text-lg truncate",children:x.name}),n.jsx("p",{className:"text-gray-300 text-base md:text-lg break-words",children:x.address})]})]})})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(hn,{size:16,className:"text-emerald-400 flex-shrink-0"}),n.jsx("h3",{className:"text-white font-semibold text-sm md:text-base",children:"Personal Base Camp"}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 text-xs bg-emerald-900/40 text-emerald-200 border border-emerald-500/30",children:[n.jsx($e,{size:8}),"Private"]})]}),n.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Add the location of your accommodations. Only you can see this."}),n.jsxs("button",{onClick:()=>h(!0),className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white py-1.5 px-3 rounded-lg transition-colors flex items-center justify-center gap-2 text-xs",children:[n.jsx(vn,{size:12}),"Set Your Location"]})]})})})]}),u&&n.jsx(Bf,{isOpen:u,onClose:()=>m(!1),onBasecampSet:async e=>{await a(e),m(!1)},onBasecampClear:async()=>{if(t)try{o&&he.clearSessionTripBasecamp(e),l(),ee.success("Trip basecamp cleared")}catch(n){ee.error("Failed to clear trip basecamp")}},currentBasecamp:t||void 0}),p&&n.jsx(Bf,{isOpen:p,onClose:()=>h(!1),onBasecampSet:async t=>{try{let n=null;o?(n=he.setSessionPersonalBasecamp({trip_id:e,user_id:y,name:t.name,address:t.address,latitude:void 0,longitude:void 0}),v(n)):s&&(n=await qf.upsertPersonalBasecamp({trip_id:e,name:t.name,address:t.address,latitude:void 0,longitude:void 0}),v(n)),h(!1),ee.success("Personal basecamp saved")}catch(n){ee.error("Failed to set personal base camp")}},onBasecampClear:async()=>{if(x)try{if(o)he.deleteSessionPersonalBasecamp(e,y),v(null);else if(s){await qf.deletePersonalBasecamp(x.id)&&v(null)}}catch(t){}},currentBasecamp:x?(b=x,{address:b.address||"",name:b.name,type:"other",coordinates:b.latitude&&b.longitude?{lat:b.latitude,lng:b.longitude}:void 0}):void 0})]});var b},Hf=["Appetite","Activity","Accommodation","Attraction","Other"],Wf=()=>{const[e,t]=L.useState(!1),[n,a]=L.useState(null);return{resolvePlaceName:async e=>{if(!e.trim())return{success:!1,error:"Place name is required"};t(!0),a(null);try{const{data:t,error:n}=await W.functions.invoke("venue-enricher",{body:{action:"resolve_place_links",query:e}});if(n)throw n;return t.success?{success:!0,place:t.place,linkOptions:t.linkOptions}:{success:!1,error:t.error||"Failed to resolve place"}}catch(yN){const t=yN instanceof Error?yN.message:"Unknown error occurred";return a(t),{success:!1,error:t}}finally{t(!1)}},categorizePlaceType:e=>{const t={Accommodation:["lodging","hotel","motel","resort","hostel","rv_park"],Appetite:["restaurant","cafe","bar","bakery","meal_takeaway","meal_delivery","food","night_club"],Activity:["tourist_attraction","museum","amusement_park","zoo","aquarium","art_gallery","park","church","mosque","synagogue","hindu_temple","movie_theater","casino","spa"],Attraction:["stadium","landmark","point_of_interest"]};for(const[n,a]of Object.entries(t))if(a.some(t=>e.includes(t)))return n;return"Other"},isLoading:e,error:n}},Yf=[/^https?:\/\/.+/i,/^www\..+\..+/i,/\.(com|org|net|edu|gov|co|io|ai|app|ly|me|tv|fm|xyz|biz|info)[\s/]?/i],Kf=[/(.+)\s+(in|at|near|@)\s+([a-zA-Z\s,]+)/i,/(.+),\s*([a-zA-Z\s,]+)/i,/(.+)\s+([A-Z]{2,})\s*(\d{5})?/i],Gf=e=>{var t,n,a,r,i;const s=e.trim();for(const o of Kf){const e=s.match(o);if(e)return{businessName:null==(t=e[1])?void 0:t.trim(),location:(null==(n=e[2])?void 0:n.trim())||(null==(a=e[3])?void 0:a.trim()),fullLocation:`${(null==(r=e[2])?void 0:r.trim())||""} ${(null==(i=e[3])?void 0:i.trim())||""}`.trim()}}return{businessName:s,location:"",fullLocation:""}},Qf={Appetite:{icon:"ðŸ½ï¸",description:"Restaurants, bars, lounges, food trucks"},Activity:{icon:"ðŸŽ¢",description:"Hiking, jet skiing, beach, museums"},Accommodation:{icon:"ðŸ¨",description:"Hotels, rentals, hostels"},Attraction:{icon:"ðŸŽ¯",description:"Stadiums, music venues, famous landmarks"},Other:{icon:"ðŸ“",description:"Other points of interest"}},Xf=({isOpen:e,onClose:t,onPlaceAdded:a,basecamp:r})=>{const[i,s]=L.useState(""),[o,l]=L.useState(""),[c,d]=L.useState(!!r),[u,m]=L.useState(""),[p,h]=L.useState(!0),[g,f]=L.useState(!1),[x,v]=L.useState(!1),[y,b]=L.useState([]),[w,j]=L.useState(null),[N,_]=L.useState(null),{resolvePlaceName:k,isLoading:S}=Wf(),C=e=>{const t={Appetite:["restaurant","food","cafe","bar","bakery","meal_takeaway","meal_delivery"],Accommodation:["lodging","hotel","motel","resort"],Activity:["gym","park","amusement_park","aquarium","zoo","museum","spa"],Attraction:["tourist_attraction","point_of_interest","stadium","church","art_gallery"]};for(const[n,a]of Object.entries(t))if(e.some(e=>a.includes(e)))return n;return"Other"};L.useEffect(()=>{if(!i.trim())return _(null),b([]),void j(null);const e=(e=>{const t=e.trim();if(!t)return{type:"place_name",isValid:!1};if(Yf.some(e=>e.test(t)))try{const e=t.startsWith("http")?t:`https://${t}`;return new URL(e),{type:"url",isValid:!0}}catch{return{type:"url",isValid:!1}}const n=Gf(t),a=n.businessName.length>0,r=[];return a&&(n.location?r.push(`${n.businessName} in ${n.location}`):(r.push(`${n.businessName} near me`),r.push(`${n.businessName} locations`))),{type:"place_name",isValid:a,suggestions:r.length>0?r:void 0}})(i);if(_(e.type),"place_name"===e.type&&e.isValid){const e=setTimeout(async()=>{const e=(e=>{const t=Gf(e);return t.location?`${t.businessName} ${t.location}`:t.businessName})(i),t=await k(e);if(t.success&&t.place&&(b([t.place]),j(t.place),o||t.place.name===o||l(t.place.name),p&&t.place.types)){const e=C(t.place.types);e!==u&&m(e)}},500);return()=>clearTimeout(e)}},[i,k,p,u,o]);return e?x?n.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg w-full max-w-md p-8 text-center",children:[n.jsx("div",{className:"flex justify-center mb-4",children:n.jsx($n,{size:48,className:"text-green-400"})}),n.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Pin saved!"}),n.jsx("p",{className:"text-slate-300",children:"Added to your trip links and visible in Places > Links tab."})]})}):n.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white",children:"Save Trip Pin"}),n.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:n.jsx(ae,{size:20})})]}),n.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i.trim()&&o.trim()){f(!0);try{let e="",n=u;e="url"===N?(e=>{const t=e.trim();return t.startsWith("http")?t:`https://${t}`})(i):w?w.website||`https://www.google.com/maps/place/?q=place_id:${w.place_id}`:`https://www.google.com/search?q=${encodeURIComponent(i)}`,n||(n=w&&w.types?C(w.types):"attraction");const c={id:Date.now().toString(),name:o.trim(),url:e,category:n,calculatedAt:(new Date).toISOString(),...w&&{address:w.formatted_address,rating:w.rating,placeId:w.place_id,website:w.website,coordinates:w.coordinates}};a&&a(c),v(!0),setTimeout(()=>{s(""),l(""),d(!!r),m(""),h(!0),b([]),j(null),_(null),v(!1),t()},1500)}catch(n){}finally{f(!1)}}},className:"p-6 space-y-4",children:[n.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-sm text-blue-300",children:'Enter a place name (e.g., "Starbucks Chicago IL") or URL to save it to your trip links.'}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Place or URL *"}),n.jsxs("div",{className:"relative",children:["url"===N?n.jsx(sn,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}):n.jsx($t,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),n.jsx("input",{type:"text",value:i,onChange:e=>s(e.target.value),placeholder:"Target Chicago IL, https://target.com, or business name...",required:!0,className:"w-full bg-slate-900/50 border border-slate-600 rounded-lg pl-10 pr-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:border-blue-500"}),S&&n.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400"})})]}),N&&n.jsx("div",{className:"mt-2 text-xs text-slate-400 flex items-center gap-1",children:"url"===N?n.jsxs(n.Fragment,{children:[n.jsx(sn,{size:12}),"Detected as URL"]}):n.jsxs(n.Fragment,{children:[n.jsx(Un,{size:12}),"Searching for places..."]})})]}),w&&"place_name"===N&&n.jsx("div",{className:"bg-slate-900/30 border border-slate-700 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Un,{size:16,className:"text-green-400 mt-1 flex-shrink-0"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"font-medium text-white text-sm",children:w.name}),w.formatted_address&&n.jsx("p",{className:"text-xs text-slate-400 mt-1",children:w.formatted_address}),w.rating&&n.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[n.jsx("span",{className:"text-xs text-yellow-400",children:"â˜…"}),n.jsx("span",{className:"text-xs text-slate-300",children:w.rating})]})]})]})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Place Name *"}),n.jsx("input",{type:"text",value:o,onChange:e=>l(e.target.value),placeholder:"Give this place a name...",required:!0,className:"w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),n.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-900/30 rounded-lg border border-slate-700/50",children:[n.jsx("input",{type:"checkbox",id:"ai-sorting",checked:p,onChange:e=>h(e.target.checked),className:"w-4 h-4 text-blue-600 bg-slate-800 border-slate-600 rounded focus:ring-blue-500"}),n.jsxs("label",{htmlFor:"ai-sorting",className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx(pt,{size:16,className:"text-blue-400"}),"Auto-categorize based on place type"]})]}),!p&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Category (optional)"}),n.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-64 overflow-y-auto",children:Hf.map(e=>n.jsxs("button",{type:"button",onClick:()=>m(e===u?"":e),className:"flex items-center gap-3 p-3 rounded-lg border text-left transition-all "+(u===e?"bg-blue-600/20 border-blue-600 text-white":"bg-slate-900/30 border-slate-700 text-slate-300 hover:border-slate-600"),children:[n.jsx("span",{className:"text-lg",children:Qf[e].icon}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium",children:e}),n.jsx("div",{className:"text-xs text-slate-400",children:Qf[e].description})]})]},e))})]}),r&&n.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-semibold text-white",children:"Calculate distance from Basecamp"}),n.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:c,onChange:e=>d(e.target.checked),className:"sr-only peer"}),n.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-500/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"})]})]}),n.jsx("p",{className:"text-xs text-green-300",children:"See how far your options are from your base"})]}),n.jsxs("div",{className:"flex gap-3 pt-4",children:[n.jsx(Q,{type:"button",variant:"outline",onClick:t,className:"flex-1",children:"Cancel"}),n.jsx(Q,{type:"submit",disabled:g||!i.trim()||!o.trim(),className:"flex-1 bg-blue-600 hover:bg-blue-700",children:g?"Saving...":"Save Pin"})]})]})]})}):null},Zf=({isOpen:e,onClose:t,tripId:a,onEventAdded:r,prefilledData:i,editEvent:s})=>{const[o,l]=L.useState(!1),[c,d]=L.useState({title:(null==i?void 0:i.title)||(null==s?void 0:s.title)||"",date:(null==i?void 0:i.date)||(null==s?void 0:s.date)||new Date,time:(null==i?void 0:i.time)||(null==s?void 0:s.time)||"",location:(null==i?void 0:i.location)||(null==s?void 0:s.location)||"",description:(null==i?void 0:i.description)||(null==s?void 0:s.description)||"",category:(null==i?void 0:i.category)||(null==s?void 0:s.event_category)||"other",include_in_itinerary:(null==i?void 0:i.include_in_itinerary)??(null==s?void 0:s.include_in_itinerary)??!0});L.useEffect(()=>{s?d({title:s.title,date:s.date,time:s.time,location:s.location||"",description:s.description||"",category:s.event_category||"other",include_in_itinerary:s.include_in_itinerary??!0}):i&&d({title:i.title||"",date:i.date||new Date,time:i.time||"",location:i.location||"",description:i.description||"",category:i.category||"other",include_in_itinerary:i.include_in_itinerary??!0})},[s,i]);const u=()=>{d({title:"",date:new Date,time:"",location:"",description:"",category:"other",include_in_itinerary:!0}),t()};return n.jsx(Ot,{open:e,onOpenChange:u,children:n.jsxs(Lt,{className:"max-w-md",children:[n.jsx(Ft,{children:n.jsx(Ut,{children:s?"Edit Event":"Add to Calendar"})}),n.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),c.title&&c.time){l(!0);try{const[e,t]=c.time.split(":"),n=new Date(c.date);let i;if(n.setHours(parseInt(e,10),parseInt(t,10),0,0),c.endTime){const[e,t]=c.endTime.split(":"),n=new Date(c.date);n.setHours(parseInt(e,10),parseInt(t,10),0,0),i=n.toISOString()}if(s){await Z.updateEvent(s.id,{title:c.title,description:c.description||void 0,start_time:n.toISOString(),end_time:i,location:c.location||void 0,event_category:c.category||"other",include_in_itinerary:c.include_in_itinerary??!0})?(ee.success("Event updated"),null==r||r(c,s.id),u()):ee.error("Failed to update event")}else{const e=await Z.createEvent({trip_id:a,title:c.title,description:c.description||void 0,start_time:n.toISOString(),end_time:i,location:c.location||void 0,event_category:c.category||"other",include_in_itinerary:c.include_in_itinerary??!0,source_type:"manual",source_data:{}});e.event?(e.conflicts.length>0?ee.success("Event created",{description:`Note: This event overlaps with "${e.conflicts[0]}"${e.conflicts.length>1?` and ${e.conflicts.length-1} other event(s)`:""}.`}):ee.success("Event created"),null==r||r(c,e.event.id),u()):ee.error("Failed to create event")}}catch(t){const e=t instanceof Error?t.message:"Unknown error";ee.error("Failed to save event",{description:e.includes("permission")||e.includes("RLS")?"You may not have permission to modify events on this trip.":e})}finally{l(!1)}}},className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(ot,{htmlFor:"title",children:"Event Title *"}),n.jsx(st,{id:"title",value:c.title,onChange:e=>d({...c,title:e.target.value}),placeholder:"Event name",required:!0})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(ot,{children:"Date *"}),n.jsxs(Vt,{children:[n.jsx(Ht,{asChild:!0,children:n.jsxs(Q,{variant:"outline",className:G("w-full justify-start text-left font-normal text-xs px-3",!c.date&&"text-muted-foreground"),children:[n.jsx(dn,{className:"mr-2 h-3.5 w-3.5 flex-shrink-0"}),n.jsx("span",{className:"truncate",children:c.date?Nn(c.date,"MMM d, yyyy"):"Pick a date"})]})}),n.jsx(Wt,{className:"w-auto p-0",align:"start",children:n.jsx(Yt,{mode:"single",selected:c.date,onSelect:e=>e&&d({...c,date:e}),initialFocus:!0,className:"p-3 pointer-events-auto"})})]})]}),n.jsxs("div",{children:[n.jsx(ot,{htmlFor:"time",children:"Time *"}),n.jsx(st,{id:"time",type:"time",value:c.time,onChange:e=>d({...c,time:e.target.value}),required:!0})]})]}),n.jsxs("div",{children:[n.jsx(ot,{htmlFor:"location",children:"Location"}),n.jsx(st,{id:"location",value:c.location,onChange:e=>d({...c,location:e.target.value}),placeholder:"Event location"})]}),n.jsxs("div",{children:[n.jsx(ot,{htmlFor:"description",children:"Description"}),n.jsx(xn,{id:"description",value:c.description,onChange:e=>d({...c,description:e.target.value}),placeholder:"Additional details...",rows:2})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(rn,{id:"include-itinerary",checked:c.include_in_itinerary,onCheckedChange:e=>d({...c,include_in_itinerary:e})}),n.jsx(ot,{htmlFor:"include-itinerary",children:"Include in trip itinerary"})]}),n.jsxs("div",{className:"flex gap-2 pt-4",children:[n.jsx(Q,{type:"submit",className:"flex-1",disabled:o,children:o?"Saving...":s?"Update Event":"Add Event"}),n.jsx(Q,{type:"button",variant:"outline",onClick:u,disabled:o,children:"Cancel"})]})]})]})})},Jf=({tripId:e,placeName:t,placeAddress:a,category:r="other",onEventAdded:i,variant:s="default"})=>{const[o,l]=L.useState(!1),c=e=>{null==i||i(e),l(!1)},d={title:t,location:a||t,category:r,include_in_itinerary:!0};return"icon"===s?n.jsxs(n.Fragment,{children:[n.jsx(Q,{variant:"outline",size:"sm",onClick:()=>l(!0),className:"p-2",children:n.jsx(dn,{size:16})}),n.jsx(Zf,{isOpen:o,onClose:()=>l(!1),tripId:e,onEventAdded:c,prefilledData:d})]}):"pill"===s?n.jsxs(n.Fragment,{children:[n.jsxs(Q,{variant:"outline",size:"sm",onClick:()=>l(!0),className:"text-xs md:text-sm md:px-3 md:py-2",children:[n.jsx(dn,{className:"w-3.5 h-3.5 md:w-4 md:h-4 mr-1"}),"Add to Calendar"]}),n.jsx(Zf,{isOpen:o,onClose:()=>l(!1),tripId:e,onEventAdded:c,prefilledData:d})]}):n.jsxs(n.Fragment,{children:[n.jsxs(Q,{variant:"outline",onClick:()=>l(!0),className:"w-full",children:[n.jsx(vn,{size:16,className:"mr-2"}),"Add to Calendar"]}),n.jsx(Zf,{isOpen:o,onClose:()=>l(!1),tripId:e,onEventAdded:c,prefilledData:d})]})};const ex="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function tx(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function nx(e){return"nodeType"in e}function ax(e){var t,n;return e?tx(e)?e:nx(e)&&null!=(t=null==(n=e.ownerDocument)?void 0:n.defaultView)?t:window:window}function rx(e){const{Document:t}=ax(e);return e instanceof t}function ix(e){return!tx(e)&&e instanceof ax(e).HTMLElement}function sx(e){return e instanceof ax(e).SVGElement}function ox(e){return e?tx(e)?e.document:nx(e)?rx(e)?e:ix(e)||sx(e)?e.ownerDocument:document:document:document}const lx=ex?L.useLayoutEffect:L.useEffect;function cx(e){const t=L.useRef(e);return lx(()=>{t.current=e}),L.useCallback(function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return null==t.current?void 0:t.current(...n)},[])}function dx(e,t){void 0===t&&(t=[e]);const n=L.useRef(e);return lx(()=>{n.current!==e&&(n.current=e)},t),n}function ux(e,t){const n=L.useRef();return L.useMemo(()=>{const t=e(n.current);return n.current=t,t},[...t])}function mx(e){const t=cx(e),n=L.useRef(null),a=L.useCallback(e=>{e!==n.current&&(null==t||t(e,n.current)),n.current=e},[]);return[n,a]}function px(e){const t=L.useRef();return L.useEffect(()=>{t.current=e},[e]),t.current}let hx={};function gx(e,t){return L.useMemo(()=>{if(t)return t;const n=null==hx[e]?0:hx[e]+1;return hx[e]=n,e+"-"+n},[e,t])}function fx(e){return function(t){for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return a.reduce((t,n)=>{const a=Object.entries(n);for(const[r,i]of a){const n=t[r];null!=n&&(t[r]=n+e*i)}return t},{...t})}}const xx=fx(1),vx=fx(-1);function yx(e){if(!e)return!1;const{KeyboardEvent:t}=ax(e.target);return t&&e instanceof t}function bx(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=ax(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const wx=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[wx.Translate.toString(e),wx.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:a}=e;return t+" "+n+"ms "+a}}}),jx="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Nx(e){return e.matches(jx)?e:e.querySelector(jx)}const _x={display:"none"};function kx(e){let{id:t,value:n}=e;return $.createElement("div",{id:t,style:_x},n)}function Sx(e){let{id:t,announcement:n,ariaLiveType:a="assertive"}=e;return $.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":a,"aria-atomic":!0},n)}const Cx=L.createContext(null);const Ex={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},Dx={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Px(e){let{announcements:t=Dx,container:n,hiddenTextDescribedById:a,screenReaderInstructions:r=Ex}=e;const{announce:i,announcement:s}=function(){const[e,t]=L.useState("");return{announce:L.useCallback(e=>{null!=e&&t(e)},[]),announcement:e}}(),o=gx("DndLiveRegion"),[l,c]=L.useState(!1);if(L.useEffect(()=>{c(!0)},[]),function(e){const t=L.useContext(Cx);L.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}(L.useMemo(()=>({onDragStart(e){let{active:n}=e;i(t.onDragStart({active:n}))},onDragMove(e){let{active:n,over:a}=e;t.onDragMove&&i(t.onDragMove({active:n,over:a}))},onDragOver(e){let{active:n,over:a}=e;i(t.onDragOver({active:n,over:a}))},onDragEnd(e){let{active:n,over:a}=e;i(t.onDragEnd({active:n,over:a}))},onDragCancel(e){let{active:n,over:a}=e;i(t.onDragCancel({active:n,over:a}))}}),[i,t])),!l)return null;const d=$.createElement($.Fragment,null,$.createElement(kx,{id:a,value:r.draggable}),$.createElement(Sx,{id:o,announcement:s}));return n?U.createPortal(d,n):d}var Ax,Tx;function Mx(){}function Rx(e,t){return L.useMemo(()=>({sensor:e,options:null!=t?t:{}}),[e,t])}(Tx=Ax||(Ax={})).DragStart="dragStart",Tx.DragMove="dragMove",Tx.DragEnd="dragEnd",Tx.DragCancel="dragCancel",Tx.DragOver="dragOver",Tx.RegisterDroppable="registerDroppable",Tx.SetDroppableDisabled="setDroppableDisabled",Tx.UnregisterDroppable="unregisterDroppable";const Ix=Object.freeze({x:0,y:0});function Ox(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Lx(e,t){let{data:{value:n}}=e,{data:{value:a}}=t;return n-a}function Fx(e,t){let{data:{value:n}}=e,{data:{value:a}}=t;return a-n}function Ux(e){let{left:t,top:n,height:a,width:r}=e;return[{x:t,y:n},{x:t+r,y:n},{x:t,y:n+a},{x:t+r,y:n+a}]}function zx(e,t){if(!e||0===e.length)return null;const[n]=e;return n[t]}function $x(e,t,n){return void 0===t&&(t=e.left),void 0===n&&(n=e.top),{x:t+.5*e.width,y:n+.5*e.height}}const Bx=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:a}=e;const r=$x(t,t.left,t.top),i=[];for(const s of a){const{id:e}=s,t=n.get(e);if(t){const n=Ox($x(t),r);i.push({id:e,data:{droppableContainer:s,value:n}})}}return i.sort(Lx)};function qx(e,t){const n=Math.max(t.top,e.top),a=Math.max(t.left,e.left),r=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),s=r-a,o=i-n;if(a<r&&n<i){const n=t.width*t.height,a=e.width*e.height,r=s*o;return Number((r/(n+a-r)).toFixed(4))}return 0}const Vx=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:a}=e;const r=[];for(const i of a){const{id:e}=i,a=n.get(e);if(a){const n=qx(a,t);n>0&&r.push({id:e,data:{droppableContainer:i,value:n}})}}return r.sort(Fx)};function Hx(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Ix}function Wx(e){return function(t){for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return a.reduce((t,n)=>({...t,top:t.top+e*n.y,bottom:t.bottom+e*n.y,left:t.left+e*n.x,right:t.right+e*n.x}),{...t})}}const Yx=Wx(1);const Kx={ignoreTransform:!1};function Gx(e,t){void 0===t&&(t=Kx);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:a}=ax(e).getComputedStyle(e);t&&(n=function(e,t,n){const a=function(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!a)return e;const{scaleX:r,scaleY:i,x:s,y:o}=a,l=e.left-s-(1-r)*parseFloat(n),c=e.top-o-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),d=r?e.width/r:e.width,u=i?e.height/i:e.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}(n,t,a))}const{top:a,left:r,width:i,height:s,bottom:o,right:l}=n;return{top:a,left:r,width:i,height:s,bottom:o,right:l}}function Qx(e){return Gx(e,{ignoreTransform:!0})}function Xx(e,t){const n=[];return e?function a(r){if(null!=t&&n.length>=t)return n;if(!r)return n;if(rx(r)&&null!=r.scrollingElement&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!ix(r)||sx(r))return n;if(n.includes(r))return n;const i=ax(e).getComputedStyle(r);return r!==e&&function(e,t){void 0===t&&(t=ax(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const a=t[e];return"string"==typeof a&&n.test(a)})}(r,i)&&n.push(r),function(e,t){return void 0===t&&(t=ax(e).getComputedStyle(e)),"fixed"===t.position}(r,i)?n:a(r.parentNode)}(e):n}function Zx(e){const[t]=Xx(e,1);return null!=t?t:null}function Jx(e){return ex&&e?tx(e)?e:nx(e)?rx(e)||e===ox(e).scrollingElement?window:ix(e)?e:null:null:null}function ev(e){return tx(e)?e.scrollX:e.scrollLeft}function tv(e){return tx(e)?e.scrollY:e.scrollTop}function nv(e){return{x:ev(e),y:tv(e)}}var av,rv;function iv(e){return!(!ex||!e)&&e===document.scrollingElement}function sv(e){const t={x:0,y:0},n=iv(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},a={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=a.y,isRight:e.scrollLeft>=a.x,maxScroll:a,minScroll:t}}(rv=av||(av={}))[rv.Forward=1]="Forward",rv[rv.Backward=-1]="Backward";const ov={x:.2,y:.2};function lv(e,t,n,a,r){let{top:i,left:s,right:o,bottom:l}=n;void 0===a&&(a=10),void 0===r&&(r=ov);const{isTop:c,isBottom:d,isLeft:u,isRight:m}=sv(e),p={x:0,y:0},h={x:0,y:0},g=t.height*r.y,f=t.width*r.x;return!c&&i<=t.top+g?(p.y=av.Backward,h.y=a*Math.abs((t.top+g-i)/g)):!d&&l>=t.bottom-g&&(p.y=av.Forward,h.y=a*Math.abs((t.bottom-g-l)/g)),!m&&o>=t.right-f?(p.x=av.Forward,h.x=a*Math.abs((t.right-f-o)/f)):!u&&s<=t.left+f&&(p.x=av.Backward,h.x=a*Math.abs((t.left+f-s)/f)),{direction:p,speed:h}}function cv(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:n,right:a,bottom:r}=e.getBoundingClientRect();return{top:t,left:n,right:a,bottom:r,width:e.clientWidth,height:e.clientHeight}}function dv(e){return e.reduce((e,t)=>xx(e,nv(t)),Ix)}const uv=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+ev(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+tv(t),0)}]];class mv{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=Xx(t),a=dv(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[r,i,s]of uv)for(const e of i)Object.defineProperty(this,e,{get:()=>{const t=s(n),i=a[r]-t;return this.rect[e]+i},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class pv{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,n){var a;null==(a=this.target)||a.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function hv(e,t){const n=Math.abs(e.x),a=Math.abs(e.y);return"number"==typeof t?Math.sqrt(n**2+a**2)>t:"x"in t&&"y"in t?n>t.x&&a>t.y:"x"in t?n>t.x:"y"in t&&a>t.y}var gv,fv,xv,vv;function yv(e){e.preventDefault()}function bv(e){e.stopPropagation()}(fv=gv||(gv={})).Click="click",fv.DragStart="dragstart",fv.Keydown="keydown",fv.ContextMenu="contextmenu",fv.Resize="resize",fv.SelectionChange="selectionchange",fv.VisibilityChange="visibilitychange",(vv=xv||(xv={})).Space="Space",vv.Down="ArrowDown",vv.Right="ArrowRight",vv.Left="ArrowLeft",vv.Up="ArrowUp",vv.Esc="Escape",vv.Enter="Enter",vv.Tab="Tab";const wv={start:[xv.Space,xv.Enter],cancel:[xv.Esc],end:[xv.Space,xv.Enter,xv.Tab]},jv=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case xv.Right:return{...n,x:n.x+25};case xv.Left:return{...n,x:n.x-25};case xv.Down:return{...n,y:n.y+25};case xv.Up:return{...n,y:n.y-25}}};class Nv{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new pv(ox(t)),this.windowListeners=new pv(ax(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(gv.Resize,this.handleCancel),this.windowListeners.add(gv.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(gv.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&function(e,t){if(void 0===t&&(t=Gx),!e)return;const{top:n,left:a,bottom:r,right:i}=t(e);Zx(e)&&(r<=0||i<=0||n>=window.innerHeight||a>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(n),t(Ix)}handleKeyDown(e){if(yx(e)){const{active:t,context:n,options:a}=this.props,{keyboardCodes:r=wv,coordinateGetter:i=jv,scrollBehavior:s="smooth"}=a,{code:o}=e;if(r.end.includes(o))return void this.handleEnd(e);if(r.cancel.includes(o))return void this.handleCancel(e);const{collisionRect:l}=n.current,c=l?{x:l.left,y:l.top}:Ix;this.referenceCoordinates||(this.referenceCoordinates=c);const d=i(e,{active:t,context:n.current,currentCoordinates:c});if(d){const t=vx(d,c),a={x:0,y:0},{scrollableAncestors:r}=n.current;for(const n of r){const r=e.code,{isTop:i,isRight:o,isLeft:l,isBottom:c,maxScroll:u,minScroll:m}=sv(n),p=cv(n),h={x:Math.min(r===xv.Right?p.right-p.width/2:p.right,Math.max(r===xv.Right?p.left:p.left+p.width/2,d.x)),y:Math.min(r===xv.Down?p.bottom-p.height/2:p.bottom,Math.max(r===xv.Down?p.top:p.top+p.height/2,d.y))},g=r===xv.Right&&!o||r===xv.Left&&!l,f=r===xv.Down&&!c||r===xv.Up&&!i;if(g&&h.x!==d.x){const e=n.scrollLeft+t.x,i=r===xv.Right&&e<=u.x||r===xv.Left&&e>=m.x;if(i&&!t.y)return void n.scrollTo({left:e,behavior:s});a.x=i?n.scrollLeft-e:r===xv.Right?n.scrollLeft-u.x:n.scrollLeft-m.x,a.x&&n.scrollBy({left:-a.x,behavior:s});break}if(f&&h.y!==d.y){const e=n.scrollTop+t.y,i=r===xv.Down&&e<=u.y||r===xv.Up&&e>=m.y;if(i&&!t.x)return void n.scrollTo({top:e,behavior:s});a.y=i?n.scrollTop-e:r===xv.Down?n.scrollTop-u.y:n.scrollTop-m.y,a.y&&n.scrollBy({top:-a.y,behavior:s});break}}this.handleMove(e,xx(vx(d,this.referenceCoordinates),a))}}}handleMove(e,t){const{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function _v(e){return Boolean(e&&"distance"in e)}function kv(e){return Boolean(e&&"delay"in e)}Nv.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:a=wv,onActivation:r}=t,{active:i}=n;const{code:s}=e.nativeEvent;if(a.start.includes(s)){const t=i.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==r||r({event:e.nativeEvent}),!0)}return!1}}];class Sv{constructor(e,t,n){var a;void 0===n&&(n=function(e){const{EventTarget:t}=ax(e);return e instanceof t?e:ox(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:r}=e,{target:i}=r;this.props=e,this.events=t,this.document=ox(i),this.documentListeners=new pv(this.document),this.listeners=new pv(n),this.windowListeners=new pv(ax(i)),this.initialCoordinates=null!=(a=bx(r))?a:Ix,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(gv.Resize,this.handleCancel),this.windowListeners.add(gv.DragStart,yv),this.windowListeners.add(gv.VisibilityChange,this.handleCancel),this.windowListeners.add(gv.ContextMenu,yv),this.documentListeners.add(gv.Keydown,this.handleKeydown),t){if(null!=n&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(kv(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(_v(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:n,onPending:a}=this.props;a(n,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(gv.Click,bv,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(gv.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:n,initialCoordinates:a,props:r}=this,{onMove:i,options:{activationConstraint:s}}=r;if(!a)return;const o=null!=(t=bx(e))?t:Ix,l=vx(a,o);if(!n&&s){if(_v(s)){if(null!=s.tolerance&&hv(l,s.tolerance))return this.handleCancel();if(hv(l,s.distance))return this.handleStart()}return kv(s)&&hv(l,s.tolerance)?this.handleCancel():void this.handlePending(s,l)}e.cancelable&&e.preventDefault(),i(o)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===xv.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const Cv={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ev extends Sv{constructor(e){const{event:t}=e,n=ox(t.target);super(e,Cv,n)}}Ev.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:a}=t;return!(!n.isPrimary||0!==n.button)&&(null==a||a({event:n}),!0)}}];const Dv={move:{name:"mousemove"},end:{name:"mouseup"}};var Pv,Av;(Av=Pv||(Pv={}))[Av.RightClick=2]="RightClick";(class extends Sv{constructor(e){super(e,Dv,ox(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:a}=t;return n.button!==Pv.RightClick&&(null==a||a({event:n}),!0)}}];const Tv={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var Mv,Rv,Iv,Ov;function Lv(e){let{acceleration:t,activator:n=Mv.Pointer,canScroll:a,draggingRect:r,enabled:i,interval:s=5,order:o=Iv.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:d,delta:u,threshold:m}=e;const p=function(e){let{delta:t,disabled:n}=e;const a=px(t);return ux(e=>{if(n||!a||!e)return Fv;const r={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[av.Backward]:e.x[av.Backward]||-1===r.x,[av.Forward]:e.x[av.Forward]||1===r.x},y:{[av.Backward]:e.y[av.Backward]||-1===r.y,[av.Forward]:e.y[av.Forward]||1===r.y}}},[n,t,a])}({delta:u,disabled:!i}),[h,g]=function(){const e=L.useRef(null);return[L.useCallback((t,n)=>{e.current=setInterval(t,n)},[]),L.useCallback(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),f=L.useRef({x:0,y:0}),x=L.useRef({x:0,y:0}),v=L.useMemo(()=>{switch(n){case Mv.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case Mv.DraggableRect:return r}},[n,r,l]),y=L.useRef(null),b=L.useCallback(()=>{const e=y.current;if(!e)return;const t=f.current.x*x.current.x,n=f.current.y*x.current.y;e.scrollBy(t,n)},[]),w=L.useMemo(()=>o===Iv.TreeOrder?[...c].reverse():c,[o,c]);L.useEffect(()=>{if(i&&c.length&&v){for(const e of w){if(!1===(null==a?void 0:a(e)))continue;const n=c.indexOf(e),r=d[n];if(!r)continue;const{direction:i,speed:o}=lv(e,r,v,t,m);for(const e of["x","y"])p[e][i[e]]||(o[e]=0,i[e]=0);if(o.x>0||o.y>0)return g(),y.current=e,h(b,s),f.current=o,void(x.current=i)}f.current={x:0,y:0},x.current={x:0,y:0},g()}else g()},[t,b,a,g,i,s,JSON.stringify(v),JSON.stringify(p),h,c,w,d,JSON.stringify(m)])}(class extends Sv{constructor(e){super(e,Tv)}static setup(){return window.addEventListener(Tv.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Tv.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:a}=t;const{touches:r}=n;return!(r.length>1)&&(null==a||a({event:n}),!0)}}],(Rv=Mv||(Mv={}))[Rv.Pointer=0]="Pointer",Rv[Rv.DraggableRect=1]="DraggableRect",(Ov=Iv||(Iv={}))[Ov.TreeOrder=0]="TreeOrder",Ov[Ov.ReversedTreeOrder=1]="ReversedTreeOrder";const Fv={x:{[av.Backward]:!1,[av.Forward]:!1},y:{[av.Backward]:!1,[av.Forward]:!1}};var Uv,zv,$v;(zv=Uv||(Uv={}))[zv.Always=0]="Always",zv[zv.BeforeDragging=1]="BeforeDragging",zv[zv.WhileDragging=2]="WhileDragging",($v||($v={})).Optimized="optimized";const Bv=new Map;function qv(e,t){return ux(n=>e?n||("function"==typeof t?t(e):e):null,[t,e])}function Vv(e){let{callback:t,disabled:n}=e;const a=cx(t),r=L.useMemo(()=>{if(n||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(a)},[n]);return L.useEffect(()=>()=>null==r?void 0:r.disconnect(),[r]),r}function Hv(e){return new mv(Gx(e),e)}function Wv(e,t,n){void 0===t&&(t=Hv);const[a,r]=L.useState(null);function i(){r(a=>{if(!e)return null;var r;if(!1===e.isConnected)return null!=(r=null!=a?a:n)?r:null;const i=t(e);return JSON.stringify(a)===JSON.stringify(i)?a:i})}const s=function(e){let{callback:t,disabled:n}=e;const a=cx(t),r=L.useMemo(()=>{if(n||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(a)},[a,n]);return L.useEffect(()=>()=>null==r?void 0:r.disconnect(),[r]),r}({callback(t){if(e)for(const n of t){const{type:t,target:a}=n;if("childList"===t&&a instanceof HTMLElement&&a.contains(e)){i();break}}}}),o=Vv({callback:i});return lx(()=>{i(),e?(null==o||o.observe(e),null==s||s.observe(document.body,{childList:!0,subtree:!0})):(null==o||o.disconnect(),null==s||s.disconnect())},[e]),a}const Yv=[];function Kv(e,t){void 0===t&&(t=[]);const n=L.useRef(null);return L.useEffect(()=>{n.current=null},t),L.useEffect(()=>{const t=e!==Ix;t&&!n.current&&(n.current=e),!t&&n.current&&(n.current=null)},[e]),n.current?vx(e,n.current):Ix}function Gv(e){return L.useMemo(()=>e?function(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}(e):null,[e])}const Qv=[];function Xv(e){let{measure:t}=e;const[n,a]=L.useState(null),r=Vv({callback:L.useCallback(e=>{for(const{target:n}of e)if(ix(n)){a(e=>{const a=t(n);return e?{...e,width:a.width,height:a.height}:a});break}},[t])}),i=L.useCallback(e=>{const n=function(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ix(t)?t:e}(e);null==r||r.disconnect(),n&&(null==r||r.observe(n)),a(n?t(n):null)},[t,r]),[s,o]=mx(i);return L.useMemo(()=>({nodeRef:s,rect:n,setRef:o}),[n,s,o])}const Zv=[{sensor:Ev,options:{}},{sensor:Nv,options:{}}],Jv={current:{}},ey={draggable:{measure:Qx},droppable:{measure:Qx,strategy:Uv.WhileDragging,frequency:$v.Optimized},dragOverlay:{measure:Gx}};class ty extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return null!=(t=null==(n=this.get(e))?void 0:n.node.current)?t:void 0}}const ny={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new ty,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Mx},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:ey,measureDroppableContainers:Mx,windowRect:null,measuringScheduled:!1},ay={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Mx,draggableNodes:new Map,over:null,measureDroppableContainers:Mx},ry=L.createContext(ay),iy=L.createContext(ny);function sy(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new ty}}}function oy(e,t){switch(t.type){case Ax.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Ax.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case Ax.DragEnd:case Ax.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ax.RegisterDroppable:{const{element:n}=t,{id:a}=n,r=new ty(e.droppable.containers);return r.set(a,n),{...e,droppable:{...e.droppable,containers:r}}}case Ax.SetDroppableDisabled:{const{id:n,key:a,disabled:r}=t,i=e.droppable.containers.get(n);if(!i||a!==i.key)return e;const s=new ty(e.droppable.containers);return s.set(n,{...i,disabled:r}),{...e,droppable:{...e.droppable,containers:s}}}case Ax.UnregisterDroppable:{const{id:n,key:a}=t,r=e.droppable.containers.get(n);if(!r||a!==r.key)return e;const i=new ty(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function ly(e){let{disabled:t}=e;const{active:n,activatorEvent:a,draggableNodes:r}=L.useContext(ry),i=px(a),s=px(null==n?void 0:n.id);return L.useEffect(()=>{if(!t&&!a&&i&&null!=s){if(!yx(i))return;if(document.activeElement===i.target)return;const e=r.get(s);if(!e)return;const{activatorNode:t,node:n}=e;if(!t.current&&!n.current)return;requestAnimationFrame(()=>{for(const e of[t.current,n.current]){if(!e)continue;const t=Nx(e);if(t){t.focus();break}}})}},[a,t,r,s,i]),null}const cy=L.createContext({...Ix,scaleX:1,scaleY:1});var dy,uy;(uy=dy||(dy={}))[uy.Uninitialized=0]="Uninitialized",uy[uy.Initializing=1]="Initializing",uy[uy.Initialized=2]="Initialized";const my=L.memo(function(e){var t,n,a,r;let{id:i,accessibility:s,autoScroll:o=!0,children:l,sensors:c=Zv,collisionDetection:d=Vx,measuring:u,modifiers:m,...p}=e;const h=L.useReducer(oy,void 0,sy),[g,f]=h,[x,v]=function(){const[e]=L.useState(()=>new Set),t=L.useCallback(t=>(e.add(t),()=>e.delete(t)),[e]);return[L.useCallback(t=>{let{type:n,event:a}=t;e.forEach(e=>{var t;return null==(t=e[n])?void 0:t.call(e,a)})},[e]),t]}(),[y,b]=L.useState(dy.Uninitialized),w=y===dy.Initialized,{draggable:{active:j,nodes:N,translate:_},droppable:{containers:k}}=g,S=null!=j?N.get(j):null,C=L.useRef({initial:null,translated:null}),E=L.useMemo(()=>{var e;return null!=j?{id:j,data:null!=(e=null==S?void 0:S.data)?e:Jv,rect:C}:null},[j,S]),D=L.useRef(null),[P,A]=L.useState(null),[T,M]=L.useState(null),R=dx(p,Object.values(p)),I=gx("DndDescribedBy",i),O=L.useMemo(()=>k.getEnabled(),[k]),F=(z=u,L.useMemo(()=>({draggable:{...ey.draggable,...null==z?void 0:z.draggable},droppable:{...ey.droppable,...null==z?void 0:z.droppable},dragOverlay:{...ey.dragOverlay,...null==z?void 0:z.dragOverlay}}),[null==z?void 0:z.draggable,null==z?void 0:z.droppable,null==z?void 0:z.dragOverlay]));var z;const{droppableRects:B,measureDroppableContainers:q,measuringScheduled:V}=function(e,t){let{dragging:n,dependencies:a,config:r}=t;const[i,s]=L.useState(null),{frequency:o,measure:l,strategy:c}=r,d=L.useRef(e),u=function(){switch(c){case Uv.Always:return!1;case Uv.BeforeDragging:return n;default:return!n}}(),m=dx(u),p=L.useCallback(function(e){void 0===e&&(e=[]),m.current||s(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[m]),h=L.useRef(null),g=ux(t=>{if(u&&!n)return Bv;if(!t||t===Bv||d.current!==e||null!=i){const t=new Map;for(let n of e){if(!n)continue;if(i&&i.length>0&&!i.includes(n.id)&&n.rect.current){t.set(n.id,n.rect.current);continue}const e=n.node.current,a=e?new mv(l(e),e):null;n.rect.current=a,a&&t.set(n.id,a)}return t}return t},[e,i,n,u,l]);return L.useEffect(()=>{d.current=e},[e]),L.useEffect(()=>{u||p()},[n,u]),L.useEffect(()=>{i&&i.length>0&&s(null)},[JSON.stringify(i)]),L.useEffect(()=>{u||"number"!=typeof o||null!==h.current||(h.current=setTimeout(()=>{p(),h.current=null},o))},[o,u,p,...a]),{droppableRects:g,measureDroppableContainers:p,measuringScheduled:null!=i}}(O,{dragging:w,dependencies:[_.x,_.y],config:F.droppable}),H=function(e,t){const n=null!=t?e.get(t):void 0,a=n?n.node.current:null;return ux(e=>{var n;return null==t?null:null!=(n=null!=a?a:e)?n:null},[a,t])}(N,j),W=L.useMemo(()=>T?bx(T):null,[T]),Y=function(){const e=!1===(null==P?void 0:P.autoScrollEnabled),t="object"==typeof o?!1===o.enabled:!1===o,n=w&&!e&&!t;if("object"==typeof o)return{...o,enabled:n};return{enabled:n}}(),K=function(e,t){return qv(e,t)}(H,F.draggable.measure);!function(e){let{activeNode:t,measure:n,initialRect:a,config:r=!0}=e;const i=L.useRef(!1),{x:s,y:o}="boolean"==typeof r?{x:r,y:r}:r;lx(()=>{if(!s&&!o||!t)return void(i.current=!1);if(i.current||!a)return;const e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;const r=Hx(n(e),a);if(s||(r.x=0),o||(r.y=0),i.current=!0,Math.abs(r.x)>0||Math.abs(r.y)>0){const t=Zx(e);t&&t.scrollBy({top:r.y,left:r.x})}},[t,s,o,a,n])}({activeNode:null!=j?N.get(j):null,config:Y.layoutShiftCompensation,initialRect:K,measure:F.draggable.measure});const G=Wv(H,F.draggable.measure,K),Q=Wv(H?H.parentElement:null),X=L.useRef({activatorEvent:null,active:null,activeNode:H,collisionRect:null,collisions:null,droppableRects:B,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:k,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Z=k.getNodeFor(null==(t=X.current.over)?void 0:t.id),J=Xv({measure:F.dragOverlay.measure}),ee=null!=(n=J.nodeRef.current)?n:H,te=w?null!=(a=J.rect)?a:G:null,ne=Boolean(J.nodeRef.current&&J.rect),ae=Hx(re=ne?null:G,qv(re));var re;const ie=Gv(ee?ax(ee):null),se=function(e){const t=L.useRef(e),n=ux(n=>e?n&&n!==Yv&&e&&t.current&&e.parentNode===t.current.parentNode?n:Xx(e):Yv,[e]);return L.useEffect(()=>{t.current=e},[e]),n}(w?null!=Z?Z:H:null),oe=function(e,t){void 0===t&&(t=Gx);const[n]=e,a=Gv(n?ax(n):null),[r,i]=L.useState(Qv);function s(){i(()=>e.length?e.map(e=>iv(e)?a:new mv(t(e),e)):Qv)}const o=Vv({callback:s});return lx(()=>{null==o||o.disconnect(),s(),e.forEach(e=>null==o?void 0:o.observe(e))},[e]),r}(se),le=function(e,t){let{transform:n,...a}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...a}),n):n}(m,{transform:{x:_.x-ae.x,y:_.y-ae.y,scaleX:1,scaleY:1},activatorEvent:T,active:E,activeNodeRect:G,containerNodeRect:Q,draggingNodeRect:te,over:X.current.over,overlayNodeRect:J.rect,scrollableAncestors:se,scrollableAncestorRects:oe,windowRect:ie}),ce=W?xx(W,_):null,de=function(e){const[t,n]=L.useState(null),a=L.useRef(e),r=L.useCallback(e=>{const t=Jx(e.target);t&&n(e=>e?(e.set(t,nv(t)),new Map(e)):null)},[]);return L.useEffect(()=>{const t=a.current;if(e!==t){i(t);const s=e.map(e=>{const t=Jx(e);return t?(t.addEventListener("scroll",r,{passive:!0}),[t,nv(t)]):null}).filter(e=>null!=e);n(s.length?new Map(s):null),a.current=e}return()=>{i(e),i(t)};function i(e){e.forEach(e=>{const t=Jx(e);null==t||t.removeEventListener("scroll",r)})}},[r,e]),L.useMemo(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>xx(e,t),Ix):dv(e):Ix,[e,t])}(se),ue=Kv(de),me=Kv(de,[G]),pe=xx(le,ue),he=te?Yx(te,le):null,ge=E&&he?d({active:E,collisionRect:he,droppableRects:B,droppableContainers:O,pointerCoordinates:ce}):null,fe=zx(ge,"id"),[xe,ve]=L.useState(null),ye=function(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}(ne?le:xx(le,me),null!=(r=null==xe?void 0:xe.rect)?r:null,G),be=L.useRef(null),we=L.useCallback((e,t)=>{let{sensor:n,options:a}=t;if(null==D.current)return;const r=N.get(D.current);if(!r)return;const i=e.nativeEvent,s=new n({active:D.current,activeNode:r,event:i,options:a,context:X,onAbort(e){if(!N.get(e))return;const{onDragAbort:t}=R.current,n={id:e};null==t||t(n),x({type:"onDragAbort",event:n})},onPending(e,t,n,a){if(!N.get(e))return;const{onDragPending:r}=R.current,i={id:e,constraint:t,initialCoordinates:n,offset:a};null==r||r(i),x({type:"onDragPending",event:i})},onStart(e){const t=D.current;if(null==t)return;const n=N.get(t);if(!n)return;const{onDragStart:a}=R.current,r={activatorEvent:i,active:{id:t,data:n.data,rect:C}};U.unstable_batchedUpdates(()=>{null==a||a(r),b(dy.Initializing),f({type:Ax.DragStart,initialCoordinates:e,active:t}),x({type:"onDragStart",event:r}),A(be.current),M(i)})},onMove(e){f({type:Ax.DragMove,coordinates:e})},onEnd:o(Ax.DragEnd),onCancel:o(Ax.DragCancel)});function o(e){return async function(){const{active:t,collisions:n,over:a,scrollAdjustedTranslate:r}=X.current;let s=null;if(t&&r){const{cancelDrop:o}=R.current;if(s={activatorEvent:i,active:t,collisions:n,delta:r,over:a},e===Ax.DragEnd&&"function"==typeof o){await Promise.resolve(o(s))&&(e=Ax.DragCancel)}}D.current=null,U.unstable_batchedUpdates(()=>{f({type:e}),b(dy.Uninitialized),ve(null),A(null),M(null),be.current=null;const t=e===Ax.DragEnd?"onDragEnd":"onDragCancel";if(s){const e=R.current[t];null==e||e(s),x({type:t,event:s})}})}}be.current=s},[N]),je=function(e,t){return L.useMemo(()=>e.reduce((e,n)=>{const{sensor:a}=n;return[...e,...a.activators.map(e=>({eventName:e.eventName,handler:t(e.handler,n)}))]},[]),[e,t])}(c,L.useCallback((e,t)=>(n,a)=>{const r=n.nativeEvent,i=N.get(a);if(null!==D.current||!i||r.dndKit||r.defaultPrevented)return;const s={active:i};!0===e(n,t.options,s)&&(r.dndKit={capturedBy:t.sensor},D.current=a,we(n,t))},[N,we]));!function(e){L.useEffect(()=>{if(!ex)return;const t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}(c),lx(()=>{G&&y===dy.Initializing&&b(dy.Initialized)},[G,y]),L.useEffect(()=>{const{onDragMove:e}=R.current,{active:t,activatorEvent:n,collisions:a,over:r}=X.current;if(!t||!n)return;const i={active:t,activatorEvent:n,collisions:a,delta:{x:pe.x,y:pe.y},over:r};U.unstable_batchedUpdates(()=>{null==e||e(i),x({type:"onDragMove",event:i})})},[pe.x,pe.y]),L.useEffect(()=>{const{active:e,activatorEvent:t,collisions:n,droppableContainers:a,scrollAdjustedTranslate:r}=X.current;if(!e||null==D.current||!t||!r)return;const{onDragOver:i}=R.current,s=a.get(fe),o=s&&s.rect.current?{id:s.id,rect:s.rect.current,data:s.data,disabled:s.disabled}:null,l={active:e,activatorEvent:t,collisions:n,delta:{x:r.x,y:r.y},over:o};U.unstable_batchedUpdates(()=>{ve(o),null==i||i(l),x({type:"onDragOver",event:l})})},[fe]),lx(()=>{X.current={activatorEvent:T,active:E,activeNode:H,collisionRect:he,collisions:ge,droppableRects:B,draggableNodes:N,draggingNode:ee,draggingNodeRect:te,droppableContainers:k,over:xe,scrollableAncestors:se,scrollAdjustedTranslate:pe},C.current={initial:te,translated:he}},[E,H,ge,he,N,ee,te,B,k,xe,se,pe]),Lv({...Y,delta:_,draggingRect:he,pointerCoordinates:ce,scrollableAncestors:se,scrollableAncestorRects:oe});const Ne=L.useMemo(()=>({active:E,activeNode:H,activeNodeRect:G,activatorEvent:T,collisions:ge,containerNodeRect:Q,dragOverlay:J,draggableNodes:N,droppableContainers:k,droppableRects:B,over:xe,measureDroppableContainers:q,scrollableAncestors:se,scrollableAncestorRects:oe,measuringConfiguration:F,measuringScheduled:V,windowRect:ie}),[E,H,G,T,ge,Q,J,N,k,B,xe,q,se,oe,F,V,ie]),_e=L.useMemo(()=>({activatorEvent:T,activators:je,active:E,activeNodeRect:G,ariaDescribedById:{draggable:I},dispatch:f,draggableNodes:N,over:xe,measureDroppableContainers:q}),[T,je,E,G,f,I,N,xe,q]);return $.createElement(Cx.Provider,{value:v},$.createElement(ry.Provider,{value:_e},$.createElement(iy.Provider,{value:Ne},$.createElement(cy.Provider,{value:ye},l)),$.createElement(ly,{disabled:!1===(null==s?void 0:s.restoreFocus)})),$.createElement(Px,{...s,hiddenTextDescribedById:I}))}),py=L.createContext(null),hy="button";function gy(e){let{id:t,data:n,disabled:a=!1,attributes:r}=e;const i=gx("Draggable"),{activators:s,activatorEvent:o,active:l,activeNodeRect:c,ariaDescribedById:d,draggableNodes:u,over:m}=L.useContext(ry),{role:p=hy,roleDescription:h="draggable",tabIndex:g=0}=null!=r?r:{},f=(null==l?void 0:l.id)===t,x=L.useContext(f?cy:py),[v,y]=mx(),[b,w]=mx(),j=function(e,t){return L.useMemo(()=>e.reduce((e,n)=>{let{eventName:a,handler:r}=n;return e[a]=e=>{r(e,t)},e},{}),[e,t])}(s,t),N=dx(n);lx(()=>(u.set(t,{id:t,key:i,node:v,activatorNode:b,data:N}),()=>{const e=u.get(t);e&&e.key===i&&u.delete(t)}),[u,t]);return{active:l,activatorEvent:o,activeNodeRect:c,attributes:L.useMemo(()=>({role:p,tabIndex:g,"aria-disabled":a,"aria-pressed":!(!f||p!==hy)||void 0,"aria-roledescription":h,"aria-describedby":d.draggable}),[a,p,g,f,h,d.draggable]),isDragging:f,listeners:a?void 0:j,node:v,over:m,setNodeRef:y,setActivatorNodeRef:w,transform:x}}const fy={timeout:25};function xy(e,t,n){const a=e.slice();return a.splice(n<0?a.length+n:n,0,a.splice(t,1)[0]),a}function vy(e,t){return e.reduce((e,n,a)=>{const r=t.get(n);return r&&(e[a]=r),e},Array(e.length))}function yy(e){return null!==e&&e>=0}const by=e=>{let{rects:t,activeIndex:n,overIndex:a,index:r}=e;const i=xy(t,a,n),s=t[r],o=i[r];return o&&s?{x:o.left-s.left,y:o.top-s.top,scaleX:o.width/s.width,scaleY:o.height/s.height}:null},wy={scaleX:1,scaleY:1},jy=e=>{var t;let{activeIndex:n,activeNodeRect:a,index:r,rects:i,overIndex:s}=e;const o=null!=(t=i[n])?t:a;if(!o)return null;if(r===n){const e=i[s];return e?{x:0,y:n<s?e.top+e.height-(o.top+o.height):e.top-o.top,...wy}:null}const l=function(e,t,n){const a=e[t],r=e[t-1],i=e[t+1];if(!a)return 0;if(n<t)return r?a.top-(r.top+r.height):i?i.top-(a.top+a.height):0;return i?i.top-(a.top+a.height):r?a.top-(r.top+r.height):0}(i,r,n);return r>n&&r<=s?{x:0,y:-o.height-l,...wy}:r<n&&r>=s?{x:0,y:o.height+l,...wy}:{x:0,y:0,...wy}};const Ny="Sortable",_y=$.createContext({activeIndex:-1,containerId:Ny,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:by,disabled:{draggable:!1,droppable:!1}});function ky(e){let{children:t,id:n,items:a,strategy:r=by,disabled:i=!1}=e;const{active:s,dragOverlay:o,droppableRects:l,over:c,measureDroppableContainers:d}=L.useContext(iy),u=gx(Ny,n),m=Boolean(null!==o.rect),p=L.useMemo(()=>a.map(e=>"object"==typeof e&&"id"in e?e.id:e),[a]),h=null!=s,g=s?p.indexOf(s.id):-1,f=c?p.indexOf(c.id):-1,x=L.useRef(p),v=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(p,x.current),y=-1!==f&&-1===g||v,b=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(i);lx(()=>{v&&h&&d(p)},[v,p,h,d]),L.useEffect(()=>{x.current=p},[p]);const w=L.useMemo(()=>({activeIndex:g,containerId:u,disabled:b,disableTransforms:y,items:p,overIndex:f,useDragOverlay:m,sortedRects:vy(p,l),strategy:r}),[g,u,b.draggable,b.droppable,y,p,f,l,m,r]);return $.createElement(_y.Provider,{value:w},t)}const Sy=e=>{let{id:t,items:n,activeIndex:a,overIndex:r}=e;return xy(n,a,r).indexOf(t)},Cy=e=>{let{containerId:t,isSorting:n,wasDragging:a,index:r,items:i,newIndex:s,previousItems:o,previousContainerId:l,transition:c}=e;return!(!c||!a)&&((o===i||r!==s)&&(!!n||s!==r&&t===l))},Ey={duration:200,easing:"ease"},Dy="transform",Py=wx.Transition.toString({property:Dy,duration:0,easing:"linear"}),Ay={roleDescription:"sortable"};function Ty(e){let{animateLayoutChanges:t=Cy,attributes:n,disabled:a,data:r,getNewIndex:i=Sy,id:s,strategy:o,resizeObserverConfig:l,transition:c=Ey}=e;const{items:d,containerId:u,activeIndex:m,disabled:p,disableTransforms:h,sortedRects:g,overIndex:f,useDragOverlay:x,strategy:v}=L.useContext(_y),y=function(e,t){var n,a;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(n=null==e?void 0:e.draggable)?n:t.draggable,droppable:null!=(a=null==e?void 0:e.droppable)?a:t.droppable}}(a,p),b=d.indexOf(s),w=L.useMemo(()=>({sortable:{containerId:u,index:b,items:d},...r}),[u,r,b,d]),j=L.useMemo(()=>d.slice(d.indexOf(s)),[d,s]),{rect:N,node:_,isOver:k,setNodeRef:S}=function(e){let{data:t,disabled:n=!1,id:a,resizeObserverConfig:r}=e;const i=gx("Droppable"),{active:s,dispatch:o,over:l,measureDroppableContainers:c}=L.useContext(ry),d=L.useRef({disabled:n}),u=L.useRef(!1),m=L.useRef(null),p=L.useRef(null),{disabled:h,updateMeasurementsFor:g,timeout:f}={...fy,...r},x=dx(null!=g?g:a),v=Vv({callback:L.useCallback(()=>{u.current?(null!=p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{c(Array.isArray(x.current)?x.current:[x.current]),p.current=null},f)):u.current=!0},[f]),disabled:h||!s}),y=L.useCallback((e,t)=>{v&&(t&&(v.unobserve(t),u.current=!1),e&&v.observe(e))},[v]),[b,w]=mx(y),j=dx(t);return L.useEffect(()=>{v&&b.current&&(v.disconnect(),u.current=!1,v.observe(b.current))},[b,v]),L.useEffect(()=>(o({type:Ax.RegisterDroppable,element:{id:a,key:i,disabled:n,node:b,rect:m,data:j}}),()=>o({type:Ax.UnregisterDroppable,key:i,id:a})),[a]),L.useEffect(()=>{n!==d.current.disabled&&(o({type:Ax.SetDroppableDisabled,id:a,key:i,disabled:n}),d.current.disabled=n)},[a,i,n,o]),{active:s,rect:m,isOver:(null==l?void 0:l.id)===a,node:b,over:l,setNodeRef:w}}({id:s,data:w,disabled:y.droppable,resizeObserverConfig:{updateMeasurementsFor:j,...l}}),{active:C,activatorEvent:E,activeNodeRect:D,attributes:P,setNodeRef:A,listeners:T,isDragging:M,over:R,setActivatorNodeRef:I,transform:O}=gy({id:s,data:w,attributes:{...Ay,...n},disabled:y.draggable}),F=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return L.useMemo(()=>e=>{t.forEach(t=>t(e))},t)}(S,A),U=Boolean(C),z=U&&!h&&yy(m)&&yy(f),$=!x&&M,B=$&&z?O:null,q=z?null!=B?B:(null!=o?o:v)({rects:g,activeNodeRect:D,activeIndex:m,overIndex:f,index:b}):null,V=yy(m)&&yy(f)?i({id:s,items:d,activeIndex:m,overIndex:f}):b,H=null==C?void 0:C.id,W=L.useRef({activeId:H,items:d,newIndex:V,containerId:u}),Y=d!==W.current.items,K=t({active:C,containerId:u,isDragging:M,isSorting:U,id:s,index:b,items:d,newIndex:W.current.newIndex,previousItems:W.current.items,previousContainerId:W.current.containerId,transition:c,wasDragging:null!=W.current.activeId}),G=function(e){let{disabled:t,index:n,node:a,rect:r}=e;const[i,s]=L.useState(null),o=L.useRef(n);return lx(()=>{if(!t&&n!==o.current&&a.current){const e=r.current;if(e){const t=Gx(a.current,{ignoreTransform:!0}),n={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(n.x||n.y)&&s(n)}}n!==o.current&&(o.current=n)},[t,n,a,r]),L.useEffect(()=>{i&&s(null)},[i]),i}({disabled:!K,index:b,node:_,rect:N});return L.useEffect(()=>{U&&W.current.newIndex!==V&&(W.current.newIndex=V),u!==W.current.containerId&&(W.current.containerId=u),d!==W.current.items&&(W.current.items=d)},[U,V,u,d]),L.useEffect(()=>{if(H===W.current.activeId)return;if(null!=H&&null==W.current.activeId)return void(W.current.activeId=H);const e=setTimeout(()=>{W.current.activeId=H},50);return()=>clearTimeout(e)},[H]),{active:C,activeIndex:m,attributes:P,data:w,rect:N,index:b,newIndex:V,items:d,isOver:k,isSorting:U,isDragging:M,listeners:T,node:_,overIndex:f,over:R,setNodeRef:F,setActivatorNodeRef:I,setDroppableNodeRef:S,setDraggableNodeRef:A,transform:null!=G?G:q,transition:function(){if(G||Y&&W.current.newIndex===b)return Py;if($&&!yx(E)||!c)return;if(U||K)return wx.Transition.toString({...c,property:Dy});return}()}}function My(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&"object"==typeof t.sortable&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Ry=[xv.Down,xv.Right,xv.Up,xv.Left],Iy=(e,t)=>{let{context:{active:n,collisionRect:a,droppableRects:r,droppableContainers:i,over:s,scrollableAncestors:o}}=t;if(Ry.includes(e.code)){if(e.preventDefault(),!n||!a)return;const t=[];i.getEnabled().forEach(n=>{if(!n||null!=n&&n.disabled)return;const i=r.get(n.id);if(i)switch(e.code){case xv.Down:a.top<i.top&&t.push(n);break;case xv.Up:a.top>i.top&&t.push(n);break;case xv.Left:a.left>i.left&&t.push(n);break;case xv.Right:a.left<i.left&&t.push(n)}});const l=(e=>{let{collisionRect:t,droppableRects:n,droppableContainers:a}=e;const r=Ux(t),i=[];for(const s of a){const{id:e}=s,t=n.get(e);if(t){const n=Ux(t),a=r.reduce((e,t,a)=>e+Ox(n[a],t),0),o=Number((a/4).toFixed(4));i.push({id:e,data:{droppableContainer:s,value:o}})}}return i.sort(Lx)})({active:n,collisionRect:a,droppableRects:r,droppableContainers:t,pointerCoordinates:null});let c=zx(l,"id");if(c===(null==s?void 0:s.id)&&l.length>1&&(c=l[1].id),null!=c){const e=i.get(n.id),t=i.get(c),s=t?r.get(t.id):null,l=null==t?void 0:t.node.current;if(l&&s&&e&&t){const n=Xx(l).some((e,t)=>o[t]!==e),r=Oy(e,t),i=function(e,t){if(!My(e)||!My(t))return!1;if(!Oy(e,t))return!1;return e.data.current.sortable.index<t.data.current.sortable.index}(e,t),c=n||!r?{x:0,y:0}:{x:i?a.width-s.width:0,y:i?a.height-s.height:0},d={x:s.left,y:s.top};return c.x&&c.y?d:vx(d,c)}}}};function Oy(e,t){return!(!My(e)||!My(t))&&e.data.current.sortable.containerId===t.data.current.sortable.containerId}const Ly=({tripId:e,link:t,onEdit:a,onDelete:r,onAddToCalendar:i})=>{const{attributes:s,listeners:o,setNodeRef:l,transform:c,transition:d,isDragging:u}=Ty({id:t.id}),m={transform:wx.Transform.toString(c),transition:d,opacity:u?.5:1};return n.jsxs("div",{ref:l,style:m,className:"bg-gray-900/80 border border-white/10 rounded-2xl p-3 md:p-4 hover:border-sky-500/30 transition-all shadow-lg",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("button",{...s,...o,className:"cursor-grab active:cursor-grabbing p-1 text-gray-400 hover:text-white touch-none",title:"Drag to reorder",children:n.jsx(ua,{className:"w-4 h-4"})}),n.jsx("h4",{className:"text-white font-semibold text-sm md:text-base truncate",children:t.title}),t.category&&n.jsx(It,{variant:"secondary",className:"text-xs capitalize flex-shrink-0",children:t.category})]}),n.jsxs("div",{className:"flex gap-1.5 flex-shrink-0",children:[n.jsx(Jf,{tripId:e,placeName:t.title,placeAddress:t.url,category:"other",onEventAdded:e=>i(e,t),variant:"icon"}),n.jsxs("button",{onClick:()=>a(t),className:"text-gray-400 hover:text-white text-xs px-2 py-1 rounded bg-gray-800 hover:bg-gray-700 transition-colors flex items-center gap-1",title:"Edit",children:[n.jsx(xt,{className:"w-3 h-3"}),n.jsx("span",{className:"hidden md:inline",children:"Edit"})]}),n.jsxs("button",{onClick:()=>r(t.id),className:"text-red-400 hover:text-red-300 text-xs px-2 py-1 rounded bg-red-500/10 hover:bg-red-500/20 transition-colors flex items-center gap-1",title:"Remove",children:[n.jsx(ie,{className:"w-3 h-3"}),n.jsx("span",{className:"hidden md:inline",children:"Remove"})]})]})]}),n.jsxs("div",{className:"flex items-start gap-2 pl-6",children:[n.jsx(sn,{className:"w-3 h-3 md:w-3.5 md:h-3.5 text-sky-400 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2 flex-wrap",children:[n.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sky-400 hover:text-sky-300 underline truncate max-w-[200px] md:max-w-xs",title:t.url,children:t.url.replace(/^https?:\/\/(www\.)?/,"")}),t.description&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-gray-600 hidden md:inline",children:"â€¢"}),n.jsx("p",{className:"text-xs text-gray-400 truncate flex-1 min-w-0",children:t.description})]})]})]})]})},Fy=({tripId:e})=>{const{user:t}=Y(),{isDemoMode:a}=X(),[r,i]=L.useState([]),[s,o]=L.useState(!0),[l,c]=L.useState(!1),[d,u]=L.useState(null),[m,p]=L.useState(""),[h,g]=L.useState(""),[f,x]=L.useState(""),[v,y]=L.useState("other"),b=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return L.useMemo(()=>[...t].filter(e=>null!=e),[...t])}(Rx(Ev,{activationConstraint:{distance:8}}),Rx(Nv,{coordinateGetter:Iy})),w=(null==t?void 0:t.id)||(()=>{let e=sessionStorage.getItem("demo-user-id");return e||(e=`demo-user-${Date.now()}`,sessionStorage.setItem("demo-user-id",e)),e})();L.useEffect(()=>{j()},[e,a]);const j=async()=>{o(!0);try{const t=await async function(e,t){if(t)return Cf(e);try{const{data:t,error:n}=await W.from("trip_links").select("*").eq("trip_id",e).order("created_at",{ascending:!1});return n?(ee.error("Failed to load links"),[]):t||[]}catch(n){return ee.error("Failed to load links"),[]}}(e,a);i(t)}catch(t){}finally{o(!1)}},N=async t=>{const n=await async function(e,t,n){if(n){const n=Cf(t),a=n.filter(t=>t.id!==e);return a.length===n.length?(ee.error("Link not found"),!1):(Ef(t,a),ee.success("Link removed"),!0)}try{const{error:t}=await W.from("trip_links").delete().eq("id",e);return t?(ee.error("Failed to remove link"),!1):(ee.success("Link removed"),!0)}catch(a){return ee.error("Failed to remove link"),!1}}(t,e,a);n&&i(e=>e.filter(e=>e.id!==t))},_=()=>{p(""),g(""),x(""),y("other")},k=e=>{u(e),p(e.url),g(e.title),x(e.description||""),y(e.category||"other")},S=async(t,n)=>{try{const a=new Date(t.date),[r,i]=t.time.split(":");let s;if(a.setHours(parseInt(r,10),parseInt(i,10)),t.endTime){const e=new Date(t.date),[n,a]=t.endTime.split(":");e.setHours(parseInt(n,10),parseInt(a,10)),s=e.toISOString()}const o=`${t.description||""}\n\nLink: ${n.url}`.trim();await Z.createEvent({trip_id:e,title:t.title,description:o,start_time:a.toISOString(),end_time:s,location:t.location||n.url,event_category:t.category||"other",include_in_itinerary:t.include_in_itinerary??!0,source_type:"places_tab",source_data:{link_id:n.id,link_url:n.url}})?ee.success("Event added to calendar!"):ee.error("Failed to add event to calendar")}catch(a){ee.error("Failed to add event to calendar")}};return s?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"bg-gray-900/80 border border-white/10 rounded-2xl p-4 md:p-6 shadow-lg",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-xl flex items-center justify-center bg-gradient-to-r from-red-600 to-red-700",children:n.jsx(ha,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg md:text-xl font-bold text-white",children:"Trip Links"}),n.jsx("p",{className:"text-gray-400 text-xs md:text-sm",children:r.length>0?`${r.length} saved links â€¢ Drag to reorder`:"Save your trip links"})]})]}),n.jsx(we,{children:n.jsxs(je,{children:[n.jsx(Ne,{asChild:!0,children:n.jsxs(Ot,{open:l,onOpenChange:c,children:[n.jsx(zt,{asChild:!0,children:n.jsxs("button",{onClick:()=>_(),className:"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-4 py-2 md:px-5 md:py-2.5 rounded-xl transition-all font-medium text-sm md:text-base flex items-center shadow-lg shadow-green-500/25",children:[n.jsx(vn,{className:"w-4 h-4 md:w-5 md:h-5 mr-1"}),"Add Link"]})}),n.jsxs(Lt,{className:"bg-gray-900 border-white/10",children:[n.jsx(Ft,{children:n.jsx(Ut,{className:"text-white",children:"Add Trip Link"})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-300 mb-1 block",children:"URL *"}),n.jsx(st,{value:m,onChange:e=>p(e.target.value),placeholder:"https://...",className:"bg-gray-800 border-white/10 text-white"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-300 mb-1 block",children:"Title *"}),n.jsx(st,{value:h,onChange:e=>g(e.target.value),placeholder:"Link title",className:"bg-gray-800 border-white/10 text-white"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-300 mb-1 block",children:"Description"}),n.jsx(xn,{value:f,onChange:e=>x(e.target.value),placeholder:"Optional description",className:"bg-gray-800 border-white/10 text-white",rows:3})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-300 mb-1 block",children:"Category"}),n.jsxs(Zt,{value:v,onValueChange:y,children:[n.jsx(Jt,{className:"bg-gray-800 border-white/10 text-white",children:n.jsx(en,{})}),n.jsxs(tn,{className:"bg-gray-800 border-white/10",children:[n.jsx(nn,{value:"accommodation",children:"Accommodation"}),n.jsx(nn,{value:"activity",children:"Activity"}),n.jsx(nn,{value:"appetite",children:"Appetite"}),n.jsx(nn,{value:"attraction",children:"Attraction"}),n.jsx(nn,{value:"other",children:"Other"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(Q,{variant:"ghost",onClick:()=>c(!1),children:"Cancel"}),n.jsx(Q,{onClick:async()=>{if(!m.trim()||!h.trim())return void ee.error("URL and title are required");const t=await Df({tripId:e,url:m,title:h,description:f||void 0,category:v,addedBy:w},a);t&&(i(e=>[t,...e]),c(!1),_())},children:"Add Link"})]})]})]})]})}),n.jsx(_e,{children:n.jsx("p",{className:"text-xs",children:"ðŸ’¡ Add important links for your trip here. You can also promote links from the Media tab."})})]})})]})}),n.jsx(Ot,{open:!!d,onOpenChange:e=>!e&&u(null),children:n.jsxs(Lt,{className:"bg-gray-900 border-white/10",children:[n.jsx(Ft,{children:n.jsx(Ut,{className:"text-white",children:"Edit Trip Link"})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-300 mb-1 block",children:"URL"}),n.jsx(st,{value:m,disabled:!0,className:"bg-gray-800 border-white/10 text-gray-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-300 mb-1 block",children:"Title *"}),n.jsx(st,{value:h,onChange:e=>g(e.target.value),placeholder:"Link title",className:"bg-gray-800 border-white/10 text-white"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-300 mb-1 block",children:"Description"}),n.jsx(xn,{value:f,onChange:e=>x(e.target.value),placeholder:"Optional description",className:"bg-gray-800 border-white/10 text-white",rows:3})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-300 mb-1 block",children:"Category"}),n.jsxs(Zt,{value:v,onValueChange:y,children:[n.jsx(Jt,{className:"bg-gray-800 border-white/10 text-white",children:n.jsx(en,{})}),n.jsxs(tn,{className:"bg-gray-800 border-white/10",children:[n.jsx(nn,{value:"accommodation",children:"Accommodation"}),n.jsx(nn,{value:"activity",children:"Activity"}),n.jsx(nn,{value:"appetite",children:"Appetite"}),n.jsx(nn,{value:"attraction",children:"Attraction"}),n.jsx(nn,{value:"other",children:"Other"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(Q,{variant:"ghost",onClick:()=>u(null),children:"Cancel"}),n.jsx(Q,{onClick:async()=>{if(!d)return;const t=await async function(e,t,n){if(n){const n=Cf(t),a=n.findIndex(t=>t.id===e.linkId);return-1===a?(ee.error("Link not found"),!1):(void 0!==e.title&&(n[a].title=e.title),void 0!==e.description&&(n[a].description=e.description),void 0!==e.category&&(n[a].category=e.category),n[a].updated_at=(new Date).toISOString(),Ef(t,n),ee.success("Link updated"),!0)}try{const t={};void 0!==e.title&&(t.title=e.title),void 0!==e.description&&(t.description=e.description),void 0!==e.category&&(t.category=e.category),t.updated_at=(new Date).toISOString();const{error:n}=await W.from("trip_links").update(t).eq("id",e.linkId);return n?(ee.error("Failed to update link"),!1):(ee.success("Link updated"),!0)}catch(a){return ee.error("Failed to update link"),!1}}({linkId:d.id,title:h,description:f,category:v},e,a);t&&(i(e=>e.map(e=>e.id===d.id?{...e,title:h,description:f,category:v}:e)),u(null),_())},children:"Save Changes"})]})]})]})}),n.jsx(my,{sensors:b,collisionDetection:Bx,onDragEnd:async t=>{const{active:n,over:s}=t;if(s&&n.id!==s.id){const t=r.findIndex(e=>e.id===n.id),o=r.findIndex(e=>e.id===s.id),l=xy(r,t,o);i(l);const c=l.map(e=>e.id);await async function(e,t,n){if(n){const n=Cf(e),a=[];for(const e of t){const t=n.find(t=>t.id===e);t&&a.push(t)}const r=n.filter(e=>!t.includes(e.id));return a.push(...r),Ef(e,a),!0}try{for(let e=0;e<t.length;e++){const{error:n}=await W.from("trip_links").update({updated_at:new Date(Date.now()-1e3*e).toISOString()}).eq("id",t[e]);if(n)return!1}return!0}catch(a){return!1}}(e,c,a)}},children:n.jsx(ky,{items:r.map(e=>e.id),strategy:jy,children:n.jsx("div",{className:"space-y-3",children:r.map(t=>n.jsx(Ly,{tripId:e,link:t,onEdit:k,onDelete:N,onAddToCalendar:S},t.id))})})})]})},Uy=({tripId:e,places:t,basecamp:a,personalBasecamp:r,onPlaceAdded:i,onPlaceRemoved:s,onAddToLinks:o,linkedPlaceIds:l,onEventAdded:c,onCenterMap:d,distanceUnit:u,preferredMode:m})=>{Y();const{subscription:p}=Ye();null==p||p.plan;const[h,g]=L.useState(!1),[f,x]=L.useState(new Set(["all"]));return Hf.filter(e=>t.some(t=>t.category===e)),f.has("all")||t.filter(e=>e.category&&f.has(e.category)),n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"space-y-6",children:n.jsx(Fy,{tripId:e})}),n.jsx(Xf,{isOpen:h,onClose:()=>g(!1),onPlaceAdded:i,basecamp:a})]})},zy=({tripId:e="1",tripName:t="Your Trip"})=>{be();const{user:a}=Y(),{isDemoMode:r}=X(),{basecamp:i,setBasecamp:s,isBasecampSet:o}=Ee(),l=L.useRef(null),[c,d]=L.useState("basecamps"),[u,m]=L.useState([]),[p,h]=L.useState(new Set),[g,f]=L.useState("trip"),[x,v]=L.useState(null),[y,b]=L.useState(!1),[w,j]=L.useState(null),[N,_]=L.useState(""),[k,S]=L.useState(!1),[C,E]=L.useState(null),[D,P]=L.useState(!0),A="driving",T="miles",{createLinkFromPlace:M,removeLinkByPlaceId:R}=(()=>{const e=e=>e.url?e.url:e.address?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.address)}`:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.name)}`;return{createLinkFromPlace:L.useCallback(async(t,n="You",a,r)=>{try{if(!r){const n=JSON.parse(localStorage.getItem(`demo_trip_links_${a}`)||"[]");return n.push({place_id:t.id,name:t.name,url:e(t),timestamp:Date.now()}),void localStorage.setItem(`demo_trip_links_${a}`,JSON.stringify(n))}const n=e(t),i={trip_id:a,url:n,og_title:t.name,og_description:`Saved from Places${t.address?`: ${t.address}`:""} | place_id:${t.id}${t.coordinates?` | coords:${t.coordinates.lat},${t.coordinates.lng}`:""}${t.category?` | category:${t.category}`:""}`,domain:new URL(n).hostname,og_image_url:null,favicon_url:null},{data:s,error:o}=await W.from("trip_link_index").insert(i).select().single();if(o)throw o;return s}catch(i){throw i}},[]),removeLinkByPlaceId:L.useCallback(async(e,t,n)=>{try{if(!n){const n=JSON.parse(localStorage.getItem(`demo_trip_links_${t}`)||"[]").filter(t=>t.place_id!==e);return void localStorage.setItem(`demo_trip_links_${t}`,JSON.stringify(n))}const{data:a}=await W.from("trip_link_index").select("id, og_description").eq("trip_id",t),r=null==a?void 0:a.find(t=>{var n;return null==(n=t.og_description)?void 0:n.includes(`place_id:${e}`)});r&&await W.from("trip_link_index").delete().eq("id",r.id)}catch(a){}},[]),updateLinkByPlaceId:L.useCallback(async(t,n,a,r)=>{try{if(!r){const r=JSON.parse(localStorage.getItem(`demo_trip_links_${a}`)||"[]").map(a=>a.place_id===t?{...a,name:n.name,url:e(n)}:a);return void localStorage.setItem(`demo_trip_links_${a}`,JSON.stringify(r))}const{data:i}=await W.from("trip_link_index").select("id, og_description").eq("trip_id",a),s=null==i?void 0:i.find(e=>{var n;return null==(n=e.og_description)?void 0:n.includes(`place_id:${t}`)});s&&await W.from("trip_link_index").update({og_title:n.name,url:e(n),og_description:`Saved from Places${n.address?`: ${n.address}`:""} | place_id:${t}`}).eq("id",s.id)}catch(i){}},[])}})(),I=(null==a?void 0:a.id)||(()=>{let e=sessionStorage.getItem("demo-user-id");return e||(e=`demo-user-${Date.now()}`,sessionStorage.setItem("demo-user-id",e)),e})(),O={Cancun:{lat:21.1619,lng:-86.8515},Tokyo:{lat:35.6762,lng:139.6503},Bali:{lat:-8.5069,lng:115.2625},Nashville:{lat:36.1627,lng:-86.7816},Indio:{lat:33.7206,lng:-116.2156},Aspen:{lat:39.1911,lng:-106.8175},Phoenix:{lat:33.4484,lng:-112.074},Tulum:{lat:20.211,lng:-87.4659},"Napa Valley":{lat:38.5,lng:-122.3},"Port Canaveral":{lat:28.4101,lng:-80.6188},Yellowstone:{lat:44.4279,lng:-110.5885}};L.useEffect(()=>{(async()=>{const t=async()=>{const t=Je(Number(e));if(!t)return[];if("number"==typeof t.id&&t.id>6)return[];const{links:n}=et(t),a=t.location.split(",")[0].trim(),r=O[a];return n.slice(0,5).map((e,n)=>{return{id:`mock-link-${t.id}-${n+1}`,name:e.title,address:"",coordinates:r,category:(a=e.category,{Accommodation:"Accommodation",Activities:"Activity",Attractions:"Attraction",Food:"Appetite",Nightlife:"Other",Event:"Other",Tips:"Other",Entrance:"Other",Cruise:"Other",General:"Other",Transportation:"Other"}[a]||"Other"),rating:0,url:e.url};var a})};if(r)try{const e=await t();m(e)}catch(n){}else{const{data:n,error:a}=await W.from("trip_link_index").select("*").eq("trip_id",e);if(a)return;if(!n||0===n.length){const e=await t();return void m(e)}const r=n.map(e=>{var t,n,a,r;const i=null==(t=e.og_description)?void 0:t.match(/place_id:([^ |]+)/),s=i?i[1]:e.id.toString(),o=null==(n=e.og_description)?void 0:n.match(/coords:([^,]+),([^ |]+)/),l=o?{lat:parseFloat(o[1]),lng:parseFloat(o[2])}:void 0,c=null==(a=e.og_description)?void 0:a.match(/category:([^ |]+)/),d=c?c[1]:"other",u=null==(r=e.og_description)?void 0:r.match(/Saved from Places: ([^|]+)/),m=u?u[1].trim():"";return{id:s,name:e.og_title||"Unnamed Place",address:m,coordinates:l,category:d,rating:0,url:e.url||""}});m(r)}})()},[e,r]),L.useEffect(()=>{(async()=>{try{if(r){const t=he.getSessionPersonalBasecamp(e,I);v(t)}else if(a){const t=await qf.getPersonalBasecamp(e,a.id);v(t)}}catch(t){}})()},[e,a,r,I]);const F=L.useRef(null);L.useEffect(()=>{if(r||!e)return;const t=W.channel(`trip_basecamp_${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"trips",filter:`id=eq.${e}`},async t=>{const n=await qf.getTripBasecamp(e);if(!n)return;const a=Date.now();F.current&&a-F.current.timestamp<2e3&&n.address===F.current.address?s(n):(s(n),ee.success("Trip Base Camp updated by another member!",{description:n.name||n.address}))}).subscribe();return()=>{W.removeChannel(t)}},[e,r,s]);const U=async e=>{F.current={timestamp:Date.now(),address:e.address},s(e)};return n.jsxs("div",{className:"mb-12 mobile-safe-scroll",children:[n.jsxs("div",{className:"mb-6 flex flex-row items-center justify-between w-full px-0 relative",children:[n.jsx("h2",{className:"flex-none text-3xl font-bold text-white",children:"Places"}),n.jsx("div",{className:"absolute left-1/2 -translate-x-1/2",children:n.jsx("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-1 flex gap-1",children:["basecamps","links"].map(e=>n.jsx("button",{onClick:()=>d(e),className:"py-2.5 px-4 rounded-lg text-xs sm:text-sm font-medium transition-all capitalize "+(c===e?"bg-white/10 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-white/5"),children:"basecamps"===e?"Base Camps":e},e))})}),n.jsx("div",{className:"flex-none w-[100px]"})]}),n.jsxs("div",{className:"w-full px-0 mb-2 md:mb-6",children:["basecamps"===c&&n.jsx(Vf,{tripId:e,tripBasecamp:i,onTripBasecampSet:U,onCenterMap:(e,t)=>{var n;(null==e?void 0:e.lat)&&(null==e?void 0:e.lng)&&(e.lat<-90||e.lat>90||e.lng<-180||e.lng>180||(null==(n=l.current)||n.centerOn(e,15),t&&(j({type:t,timestamp:Date.now(),coords:e}),"search"!==t&&f(t))))},activeContext:g,onContextChange:e=>{f(e),"personal"!==e||x||b(!0)},personalBasecamp:x,onPersonalBasecampUpdate:e=>{v(e)}}),"links"===c&&n.jsx(Uy,{tripId:e,places:u,basecamp:i,personalBasecamp:x,onPlaceAdded:e=>{m(t=>[...t,e])},onPlaceRemoved:t=>{m(e=>e.filter(e=>e.id!==t)),R(e,t)},onAddToLinks:async t=>(await M(t,"You",e,I),!0),linkedPlaceIds:p,onEventAdded:e=>{},onCenterMap:e=>{l.current&&l.current.centerOn(e,15)},distanceUnit:T,preferredMode:A})]}),"basecamps"===c&&n.jsx("div",{className:"mb-2 md:mb-6",children:n.jsxs("div",{className:"relative h-[52.5vh] md:h-[450px] rounded-2xl overflow-hidden shadow-2xl",children:[n.jsx(zf,{ref:l,activeContext:g,tripBasecamp:i,personalBasecamp:x?(z=x,{address:z.address||"",name:z.name,type:"other",coordinates:z.latitude&&z.longitude?{lat:z.latitude,lng:z.longitude}:void 0}):null,className:"w-full h-full",onMapReady:()=>{P(!1)},onSaveSearchAsBasecamp:e=>{const t={address:e.address,name:e.address.split(",")[0],type:"other",coordinates:{lat:e.lat,lng:e.lng}};U(t),ee.success("Saved as Trip Base Camp!",{description:t.name})}}),n.jsx($f,{searchQuery:N,onSearchChange:e=>{_(e),E(null)},onSearchSubmit:async e=>{var t;e.preventDefault();const n=N.trim();if(!n)return;S(!0),E(null);const a=setTimeout(()=>{S(!1),E("Search timed out. Please try again.")},1e4);try{const{GoogleMapsService:e}=await cn(async()=>{const{GoogleMapsService:e}=await Promise.resolve().then(()=>Ff);return{GoogleMapsService:e}},void 0),r=await e.geocodeWithNominatim(n);clearTimeout(a),r?(null==(t=l.current)||t.centerOn({lat:r.lat,lng:r.lng},15),E(null)):E("Location not found")}catch(r){clearTimeout(a),E("Search failed. Please try again.")}finally{S(!1)}},isSearching:k,searchError:C,onClearSearch:()=>{var e;_(""),E(null),null==(e=l.current)||e.clearSearch()},isMapLoading:D})]})})]});var z},$y=Object.freeze(Object.defineProperty({__proto__:null,PlacesSection:zy},Symbol.toStringTag,{value:"Module"}));class By{static async getTripContext(e,t=!1){try{return t?this.getProTripContext(e):this.getConsumerTripContext(e)}catch(n){throw new Error("Failed to fetch trip context")}}static getConsumerTripContext(e){const t=Je(parseInt(e));if(!t)throw new Error("Trip not found");const n=et(t),a=(new Date).toISOString().split("T")[0];return{tripId:e,title:t.title,location:t.location,dateRange:t.dateRange,participants:t.participants.map(e=>({id:e.id.toString(),name:e.name,role:"participant"})),itinerary:n.itinerary.map((e,t)=>({id:t.toString(),title:`Day ${t+1}`,date:e.date,events:e.events})),accommodation:n.basecamp.name,currentDate:a,upcomingEvents:this.getUpcomingEvents(n.itinerary,a),recentUpdates:n.broadcasts.map((e,t)=>({id:t.toString(),type:"broadcast",message:e.content,timestamp:e.timestamp})),confirmationNumbers:{hotel:"HTL-"+Math.random().toString(36).substr(2,9),rental_car:"CAR-"+Math.random().toString(36).substr(2,9),flight:"FLT-"+Math.random().toString(36).substr(2,9)}}}static getProTripContext(e){const t=Bt[e];if(!t)throw new Error("Pro trip not found");const n=(new Date).toISOString().split("T")[0];return{tripId:e,title:t.title,location:t.location,dateRange:t.dateRange,participants:t.participants.map(e=>({id:e.id.toString(),name:e.name,role:e.role})),itinerary:(t.itinerary||[]).map((e,t)=>({id:t.toString(),title:`Day ${t+1}`,date:e.date,events:e.events})),accommodation:`${t.location} Accommodation`,currentDate:n,upcomingEvents:this.getUpcomingEvents(t.itinerary||[],n),recentUpdates:[{id:"1",type:"description",message:t.description,timestamp:n}],confirmationNumbers:{venue:"VEN-"+Math.random().toString(36).substr(2,9),transportation:"TRN-"+Math.random().toString(36).substr(2,9)}}}static getUpcomingEvents(e,t){return e.filter(e=>e.date>=t).flatMap(e=>{var t;return(null==(t=e.events)?void 0:t.map(t=>({...t,date:e.date})))||[]}).slice(0,5)}static formatContextForAI(e){const t=e.participants.map(e=>e.name).join(", "),n=e.upcomingEvents.map(e=>`- ${e.title} at ${e.time} (${e.location})`).join("\n"),a=Object.entries(e.confirmationNumbers).map(([e,t])=>`- ${e.replace("_"," ")}: ${t}`).join("\n");return`\nTRIP INFORMATION:\n- Trip: ${e.title}\n- Location: ${e.location}\n- Dates: ${e.dateRange}\n- Participants: ${t}\n- Accommodation: ${e.accommodation||"Not specified"}\n\nTODAY'S DATE: ${e.currentDate}\n\nUPCOMING EVENTS:\n${n||"No upcoming events scheduled"}\n\nCONFIRMATION NUMBERS:\n${a}\n\nRECENT UPDATES:\n${e.recentUpdates.map(e=>`- ${e.message}`).join("\n")}\n    `.trim()}}class qy{static async getEnhancedTripContext(e,t=!1,n=!1){try{let a;a=n?t?await this.getProTripContext(e):await this.getConsumerTripContext(e):await this.getAuthenticatedTripContext(e);return await this.enhanceWithContextualData(a)}catch(a){throw new Error("Failed to fetch enhanced trip context")}}static async getAuthenticatedTripContext(e){const{data:t,error:n}=await W.from("trips").select("*").eq("id",e).single();if(n||!t)throw new Error("Trip not found in database");const a=(new Date).toISOString().split("T")[0];return{tripId:t.id,title:t.name,location:t.destination||"",dateRange:`${t.start_date} - ${t.end_date}`,participants:[],itinerary:[],accommodation:t.basecamp_name||t.destination||"",currentDate:a,upcomingEvents:[],recentUpdates:[],confirmationNumbers:{},basecamp:t.basecamp_name?{name:t.basecamp_name,address:t.basecamp_address||""}:null}}static async getConsumerTripContext(e){const t=Je(parseInt(e));if(!t)throw new Error("Trip not found");const n=et(t),a=(new Date).toISOString().split("T")[0];return{tripId:e,title:t.title,location:t.location,dateRange:t.dateRange,participants:t.participants.map(e=>({id:e.id.toString(),name:e.name,role:"participant"})),itinerary:n.itinerary.map((e,t)=>({id:t.toString(),title:`Day ${t+1}`,date:e.date,events:e.events})),accommodation:"object"==typeof n.basecamp?{name:n.basecamp.name,address:n.basecamp.address,checkIn:"",checkOut:""}:n.basecamp,currentDate:a,upcomingEvents:this.getUpcomingEvents(n.itinerary,a),recentUpdates:n.broadcasts.map((e,t)=>({id:t.toString(),type:"broadcast",message:e.content,timestamp:e.timestamp})),confirmationNumbers:{hotel:"HTL-"+Math.random().toString(36).substr(2,9),rental_car:"CAR-"+Math.random().toString(36).substr(2,9),flight:"FLT-"+Math.random().toString(36).substr(2,9)},basecamp:n.basecamp}}static async getProTripContext(e){const t=Bt[e];if(!t)throw new Error("Pro trip not found");const n=(new Date).toISOString().split("T")[0];return{tripId:e,title:t.title,location:t.location,dateRange:t.dateRange,participants:t.participants.map(e=>({id:e.id.toString(),name:e.name,role:e.role})),itinerary:(t.itinerary||[]).map((e,t)=>({id:t.toString(),title:`Day ${t+1}`,date:e.date,events:e.events})),accommodation:`${t.location} Accommodation`,currentDate:n,upcomingEvents:this.getUpcomingEvents(t.itinerary||[],n),recentUpdates:[{id:"1",type:"description",message:t.description,timestamp:n}],confirmationNumbers:{venue:"VEN-"+Math.random().toString(36).substr(2,9),transportation:"TRN-"+Math.random().toString(36).substr(2,9)},isPro:!0,proData:{category:t.category||"professional"}}}static async enhanceWithContextualData(e){const t=await this.getTripFiles(e.tripId),n=await this.getTripPhotos(e.tripId),a=await this.getTripLinks(e.tripId),r=await this.getTripPolls(e.tripId),i=await this.getChatHistory(e.tripId),s=await this.getTripReceipts(e.tripId),o=await this.getTripPreferences(e.tripId),l=await this.getTripTasks(e.tripId);if(await this.getTripPayments(e.tripId),await this.getTripCalendar(e.tripId),e.basecamp&&"object"==typeof e.basecamp){const t=e.basecamp;if(t.address&&!t.lat&&!t.lng)try{const e=await this.geocodeAddress(t.address);e&&(t.lat=e.lat,t.lng=e.lng)}catch(p){}}const c=this.analyzeSpendingPatterns(s),d=this.analyzeGroupDynamics(i,r),u=this.extractVisitedPlaces(e.itinerary,n),m=await this.getWeatherContext(e.location);return{...e,files:t,photos:n,links:a,polls:r,chatHistory:i.slice(-20),receipts:s,preferences:o,spendingPatterns:c,groupDynamics:d,visitedPlaces:u,weatherContext:m,tasks:l}}static async geocodeAddress(e){var t;try{const{data:n,error:a}=await W.functions.invoke("google-maps-proxy",{body:{action:"geocode",address:e}});if(a||!(null==(t=null==n?void 0:n.results)?void 0:t[0]))return null;const r=n.results[0].geometry.location;return{lat:r.lat,lng:r.lng}}catch(n){return null}}static async getTripFiles(e){try{const{data:t,error:n}=await W.from("trip_files").select("\n          id,\n          name,\n          file_type,\n          content_text,\n          ai_summary,\n          extracted_events,\n          uploaded_by,\n          created_at\n        ").eq("trip_id",e).order("created_at",{ascending:!1});return n?[]:(t||[]).map(e=>({id:e.id,name:e.name,type:e.file_type,content:e.content_text,extractedEvents:e.extracted_events||0,aiSummary:e.ai_summary,uploadedBy:"Unknown",uploadedAt:e.created_at}))}catch(t){return[]}}static async getTripPhotos(e){return[{id:"photo-1",url:"/src/assets/vacation-beach-group.jpg",caption:"Beach day with the crew! ðŸ–ï¸",location:"Santa Monica Beach",timestamp:new Date(Date.now()-1728e5).toISOString(),uploadedBy:"Marcus",aiTags:["beach","group","outdoor","sunny","recreational"]},{id:"photo-2",url:"/src/assets/vacation-landmark-selfie.jpg",caption:"Epic group selfie at the landmark!",location:"Hollywood Sign Viewpoint",timestamp:new Date(Date.now()-864e5).toISOString(),uploadedBy:"Sarah",aiTags:["landmark","selfie","group","tourist","scenic"]}]}static async getTripLinks(e){try{const{data:t,error:n}=await W.from("trip_links").select("\n          id,\n          url,\n          title,\n          description,\n          category,\n          votes,\n          added_by,\n          created_at\n        ").eq("trip_id",e).order("votes",{ascending:!1});return n?[]:(t||[]).map(e=>({id:e.id,url:e.url,title:e.title,description:e.description,category:e.category,votes:e.votes||0,addedBy:"Unknown",addedAt:e.created_at}))}catch(t){return[]}}static async getTripPolls(e){try{const{data:t,error:n}=await W.from("trip_polls").select("\n          id,\n          question,\n          options,\n          total_votes,\n          status,\n          created_by,\n          created_at\n        ").eq("trip_id",e).order("created_at",{ascending:!1});return n?[]:(t||[]).map(e=>({id:e.id,question:e.question,options:Array.isArray(e.options)?e.options:[],totalVotes:e.total_votes||0,createdBy:"Unknown",createdAt:e.created_at,status:e.status||"active"}))}catch(t){return[]}}static async getChatHistory(e){try{const{data:t,error:n}=await W.from("trip_chat_messages").select("\n          id,\n          content,\n          author_name,\n          sentiment,\n          created_at\n        ").eq("trip_id",e).order("created_at",{ascending:!1}).limit(50);return n?[]:(t||[]).map(e=>({id:e.id,content:e.content,author:e.author_name,timestamp:e.created_at,sentiment:e.sentiment}))}catch(t){return[]}}static async getTripReceipts(e){return[{id:"receipt-1",amount:156.8,currency:"USD",description:"Dinner at Le Comptoir",category:"food",splitBetween:4,uploadedBy:"Emma",uploadedAt:"2025-01-15T19:30:00Z"},{id:"receipt-2",amount:89.5,currency:"USD",description:"Uber to airport",category:"transport",splitBetween:3,uploadedBy:"Alex",uploadedAt:"2025-01-15T08:15:00Z"}]}static async getTripPreferences(e){try{const{data:t,error:n}=await W.from("trip_preferences").select("*").eq("trip_id",e).maybeSingle();return n||!t?{dietary:[],vibe:[],accessibility:[],business:[],entertainment:[],lifestyle:[],budgetMin:0,budgetMax:1e3,timePreference:"flexible"}:{dietary:t.dietary||[],vibe:t.vibe||[],accessibility:t.accessibility||[],business:t.business||[],entertainment:t.entertainment||[],lifestyle:t.lifestyle||[],budgetMin:t.budget_min||0,budgetMax:t.budget_max||1e3,timePreference:t.time_preference||"flexible"}}catch(t){return{dietary:[],vibe:[],accessibility:[],business:[],entertainment:[],lifestyle:[],budgetMin:0,budgetMax:1e3,timePreference:"flexible"}}}static analyzeSpendingPatterns(e){const t=e.reduce((e,t)=>e+t.amount,0),n=e.reduce((e,t)=>(e[t.category]=(e[t.category]||0)+t.amount,e),{}),a=e.reduce((e,t)=>e+t.amount/t.splitBetween,0);return{totalSpent:t,categories:n,avgPerPerson:a}}static analyzeGroupDynamics(e,t){const n=e.reduce((e,t)=>(e[t.author]=(e[t.author]||0)+1,e),{}),a=Object.entries(n).sort(([,e],[,t])=>t-e).slice(0,3).map(([e])=>e),r=t.filter(e=>"closed"===e.status).map(e=>{const t=e.options.reduce((e,t)=>t.votes>e.votes?t:e);return`${e.question}: ${t.text}`}),i=e.filter(e=>"positive"===e.sentiment).length,s=e.length?i/e.length:0;return{mostActiveParticipants:a,recentDecisions:r,consensusLevel:s>.7?"high":s>.4?"medium":"low"}}static extractVisitedPlaces(e,t){const n=new Set;return e.forEach(e=>{var t;null==(t=e.events)||t.forEach(e=>{e.location&&n.add(e.location)})}),t.forEach(e=>{e.location&&n.add(e.location)}),Array.from(n)}static async getWeatherContext(e){return{current:"Sunny, 72Â°F",forecast:["Sunny, 75Â°F","Partly cloudy, 70Â°F","Sunny, 78Â°F"]}}static getUpcomingEvents(e,t){return e.filter(e=>e.date>=t).flatMap(e=>{var t;return(null==(t=e.events)?void 0:t.map(t=>({...t,date:e.date})))||[]}).slice(0,5)}static async getTripTasks(e){try{const{data:t,error:n}=await W.from("trip_tasks").select("*").eq("trip_id",e).order("created_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){return[]}}static async getTripPayments(e){try{return[]}catch(t){return[]}}static async getTripCalendar(e){try{const{data:t,error:n}=await W.from("trip_events").select("*").eq("trip_id",e).order("start_date",{ascending:!0});if(n)throw n;return t||[]}catch(t){return[]}}}const Vy=({message:e,showMapWidgets:t=!1})=>{const a=e.media_type&&e.media_url,r=e.link_preview,i=e.attachments&&Array.isArray(e.attachments)&&e.attachments.length>0,s=Mh({url:e.media_url??null}),o="user"===e.type;return n.jsxs("div",{className:G("flex w-full gap-2",o?"justify-end":"justify-start"),children:[!o&&n.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0",children:n.jsx("span",{className:"text-xs text-white",children:"AI"})}),n.jsxs("div",{className:G("flex flex-col",o?"items-end":"items-start","max-w-[78%]"),children:[n.jsxs("div",{className:G("px-3.5 py-2.5 rounded-2xl backdrop-blur-sm border transition-all",o?"bg-blue-600 text-white border-blue-600/20 shadow-[0_1px_3px_rgba(0,0,0,0.25)] rounded-br-sm":"bg-muted/80 text-white border-border shadow-sm rounded-bl-sm"),children:[e.content&&n.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content}),(()=>{if(!a)return null;switch(e.media_type){case"image":return n.jsxs("div",{className:"mt-2 relative group",children:[n.jsx("img",{src:s??e.media_url,alt:"Shared image",className:"rounded-lg max-w-full h-auto cursor-pointer hover:opacity-95 transition-opacity",style:{maxHeight:"400px"},onClick:()=>window.open(s??e.media_url,"_blank")}),n.jsx("button",{onClick:()=>window.open(s??e.media_url,"_blank"),className:"absolute top-2 right-2 bg-black/50 text-white p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"View full size",children:n.jsx(fa,{size:16})})]});case"video":return n.jsx("div",{className:"mt-2 relative",children:n.jsx("video",{src:s??e.media_url,controls:!0,playsInline:!0,className:"rounded-lg max-w-full h-auto",style:{maxHeight:"400px"},children:"Your browser does not support the video tag."})});default:return null}})(),i?n.jsx("div",{className:"mt-2 space-y-2",children:e.attachments.map((t,a)=>"file"===t.type?n.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-gray-800 hover:bg-gray-700 px-3 py-2 rounded-lg transition-colors",children:[n.jsx(Re,{size:16,className:"text-gray-400"}),n.jsx("span",{className:"text-sm truncate flex-1",children:e.content||"File attachment"}),n.jsx(Oe,{size:14,className:"text-gray-400"})]},a):null)}):null,(()=>{if(!r||"object"!=typeof e.link_preview)return null;const t=e.link_preview;return n.jsxs("a",{href:t.url||e.content,target:"_blank",rel:"noopener noreferrer",className:"mt-2 block bg-gray-800 hover:bg-gray-700 rounded-lg overflow-hidden transition-colors",children:[t.image&&n.jsx("img",{src:t.image,alt:t.title||"Link preview",className:"w-full h-48 object-cover"}),n.jsx("div",{className:"p-3",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(ga,{size:14,className:"text-gray-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"text-sm font-medium text-white truncate",children:t.title||t.domain||"Link"}),t.description&&n.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:t.description}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.domain})]})]})})]})})()]}),e.timestamp&&n.jsx("span",{className:G("text-[10px] text-muted-foreground/70 mt-1 px-1",o?"text-right":"text-left"),children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},Hy=({messages:e,isTyping:t,showMapWidgets:a=!1})=>0===e.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Ct,{size:48,className:"text-gray-600 mx-auto mb-4"}),n.jsx("h4",{className:"text-lg font-medium text-gray-400 mb-2",children:"Start the conversation"}),n.jsx("p",{className:"text-gray-500 text-sm",children:"Send a message to get the chat started!"})]}):n.jsxs(n.Fragment,{children:[e.map(e=>{const t=e;return n.jsxs("div",{className:"space-y-2",children:[n.jsx(Vy,{message:e,showMapWidgets:a}),a&&t.googleMapsWidget&&n.jsx("div",{className:"flex "+("user"===e.type?"justify-end":"justify-start"),children:n.jsx(ko,{widgetToken:t.googleMapsWidget})}),t.sources&&t.sources.length>0&&n.jsx("div",{className:"flex "+("user"===e.type?"justify-end":"justify-start"),children:n.jsxs("div",{className:"space-y-1 px-2 max-w-xs lg:max-w-md",children:[n.jsxs("div",{className:"text-xs font-medium text-gray-400 flex items-center gap-2",children:[n.jsx("span",{children:"Sources:"}),t.sources.some(e=>"google_maps_grounding"===e.source)&&n.jsx("span",{className:"bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded text-[10px]",children:"Verified by Google Maps"})]}),t.sources.map((e,t)=>n.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"block text-xs text-blue-400 hover:text-blue-300",children:e.title},t))]})})]},e.id)}),t&&n.jsx("div",{className:"flex justify-start",children:n.jsx("div",{className:"bg-gradient-to-r from-blue-600/20 to-purple-600/20 rounded-2xl p-4 border border-blue-500/20",children:n.jsxs("div",{className:"flex space-x-1",children:[n.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce"}),n.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),n.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),Wy=({inputMessage:e,onInputChange:t,onSendMessage:a,onKeyPress:r,isTyping:i,disabled:s=!1,usageStatus:o,onUpgradeClick:l})=>{const c="limit_reached"===(null==o?void 0:o.status);return n.jsxs("div",{className:"space-y-2",children:[o&&n.jsxs("div",{className:"flex items-center justify-between px-1",children:[n.jsx(It,{variant:c?"destructive":"warning"===o.status?"secondary":"outline",className:"text-xs",children:o.message}),c&&l&&n.jsxs("button",{onClick:l,className:"text-xs text-primary hover:underline flex items-center gap-1",children:[n.jsx(pt,{className:"w-3 h-3"}),"Upgrade for unlimited"]})]}),n.jsxs("div",{className:"chat-composer flex gap-3 items-end",children:[n.jsx("textarea",{value:e,onChange:e=>t(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey?r(e):(e.preventDefault(),a())},placeholder:c?"Upgrade to continue chatting...":"Ask about your trip...",rows:2,disabled:s||c,className:"flex-1 bg-white/5 border border-white/10 rounded-full px-4 py-3 text-white placeholder-neutral-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500/40 backdrop-blur-sm resize-none disabled:opacity-50 disabled:cursor-not-allowed"}),n.jsx("button",{onClick:a,disabled:!e.trim()||i||s||c,className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:opacity-90 text-white size-10 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:n.jsx(wa,{size:16})})]})]})};const Yy=new class{constructor(){t(this,"storageKey","concierge-usage")}getDailyLimit(e){return"pro"===e?1/0:"plus"===e?50:5}async getUsage(e,t,n="free"){if(await he.isDemoModeEnabled())return this.getUsageFromStorage(e,t,n);const a=new Date;a.setHours(0,0,0,0);const{data:r,error:i}=await W.from("concierge_usage").select("id").eq("user_id",e).eq("context_type","event").eq("context_id",t).gte("created_at",a.toISOString());if(i)return this.getUsageFromStorage(e,t,n);const s=(null==r?void 0:r.length)||0,o=this.getNextMidnight();return{userId:e,eventId:t,queriesUsed:s,dailyLimit:this.getDailyLimit(n),resetAt:o}}getUsageFromStorage(e,t,n){const a=this.loadFromStorage(),r=`${e}-${t}`,i=a[r];if(i&&new Date(i.resetAt)>new Date)return i;const s=this.getNextMidnight(),o={userId:e,eventId:t,queriesUsed:0,dailyLimit:this.getDailyLimit(n),resetAt:s};return a[r]=o,this.saveToStorage(a),o}async incrementUsage(e,t,n="free"){const a=await this.getUsage(e,t,n);if("pro"!==n&&a.queriesUsed>=a.dailyLimit)throw new Error("Daily query limit reached");if(await he.isDemoModeEnabled()){a.queriesUsed++;const n=this.loadFromStorage();return n[`${e}-${t}`]=a,this.saveToStorage(n),a}const{error:r}=await W.from("concierge_usage").insert({user_id:e,context_type:"event",context_id:t,query_count:1});if(r){a.queriesUsed++;const n=this.loadFromStorage();n[`${e}-${t}`]=a,this.saveToStorage(n)}else a.queriesUsed++;return a}async canQuery(e,t,n="free"){if("pro"===n)return!0;const a=await this.getUsage(e,t,n);return a.queriesUsed<a.dailyLimit}async getRemainingQueries(e,t,n){if("pro"===n)return 1/0;const a=await this.getUsage(e,t,n);return Math.max(0,a.dailyLimit-a.queriesUsed)}async getTimeUntilReset(e,t,n){const a=await this.getUsage(e,t,n),r=new Date,i=new Date(a.resetAt),s=Math.ceil((i.getTime()-r.getTime())/36e5);return 1===s?"1 hour":s<24?`${s} hours`:"tomorrow"}getNextMidnight(){const e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),e.toISOString()}loadFromStorage(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{}}catch{return{}}}saveToStorage(e){try{const t=new Date,n=Object.entries(e).reduce((e,[n,a])=>(new Date(a.resetAt)>t&&(e[n]=a),e),{});localStorage.setItem(this.storageKey,JSON.stringify(n))}catch(t){}}resetUsage(e,t){const n=this.loadFromStorage();delete n[`${e}-${t}`],this.saveToStorage(n)}},Ky=e=>"free"===e?"/settings/billing?plan=explorer":"/settings/billing",Gy="concierge_cache_",Qy="concierge_messages_",Xy=864e5;const Zy=new class{cacheMessage(e,t,n,a){try{const r=`${Gy}${e}_${a||"anonymous"}`,i=this.getCachedResponses(e,a);i.push({query:t.toLowerCase().trim(),response:n,timestamp:Date.now(),tripId:e});const s=i.slice(-50);localStorage.setItem(r,JSON.stringify(s)),this.updateMessagesCache(e,n,a)}catch(r){}}getCachedResponse(e,t,n){try{const a=this.getCachedResponses(e,n),r=t.toLowerCase().trim();let i=null,s=0;for(const e of a){if(Date.now()-e.timestamp>Xy)continue;const t=this.calculateSimilarity(r,e.query);t>s&&t>=.6&&(s=t,i=e)}return i?i.response:null}catch(a){return null}}getCachedMessages(e,t){try{const n=`${Qy}${e}_${t||"anonymous"}`,a=localStorage.getItem(n);if(!a)return[];const r=JSON.parse(a);return Date.now()-r.timestamp>Xy?(this.clearCache(e),[]):r.messages||[]}catch(n){return[]}}updateMessagesCache(e,t,n){try{const a=`${Qy}${e}_${n||"anonymous"}`,r=this.getCachedMessages(e,n),i={messages:[...r,t].slice(-100),timestamp:Date.now(),tripId:e};localStorage.setItem(a,JSON.stringify(i))}catch(a){}}getCachedResponses(e,t){try{const n=`${Gy}${e}_${t||"anonymous"}`,a=localStorage.getItem(n);if(!a)return[];const r=JSON.parse(a),i=Date.now(),s=r.filter(e=>i-e.timestamp<=Xy);return s.length!==r.length&&localStorage.setItem(n,JSON.stringify(s)),s}catch(n){return[]}}calculateSimilarity(e,t){const n=new Set(e.split(/\s+/).filter(e=>e.length>2)),a=new Set(t.split(/\s+/).filter(e=>e.length>2));if(0===n.size||0===a.size)return 0;let r=0;for(const i of n)a.has(i)&&r++;return r/new Set([...n,...a]).size}clearCache(e){try{localStorage.removeItem(`${Gy}${e}`),localStorage.removeItem(`${Qy}${e}`)}catch(t){}}clearAllCaches(){try{Object.keys(localStorage).forEach(e=>{(e.startsWith(Gy)||e.startsWith(Qy))&&localStorage.removeItem(e)})}catch(e){}}getCacheStats(){try{const e=Object.keys(localStorage),t=e.filter(e=>e.startsWith(Gy)),n=e.filter(e=>e.startsWith(Qy));let a=0,r=0,i=null;return t.forEach(e=>{const t=localStorage.getItem(e);if(t){const e=JSON.parse(t);a+=e.length,e.forEach(e=>{(!i||e.timestamp<i)&&(i=e.timestamp)})}}),n.forEach(e=>{var t;const n=localStorage.getItem(e);if(n){const e=JSON.parse(n);r+=(null==(t=e.messages)?void 0:t.length)||0,e.timestamp&&(!i||e.timestamp<i)&&(i=e.timestamp)}}),{totalTrips:new Set(t.map(e=>e.replace(Gy,""))).size,totalResponses:a,totalMessages:r,oldestCache:i}}catch(e){return{totalTrips:0,totalResponses:0,totalMessages:0,oldestCache:null}}}},Jy=({tripId:e,basecamp:t,preferences:a,isDemoMode:r=!1,isEvent:i=!1})=>{const{isPlus:s}=te(),{basecamp:o}=Ee(),{user:l}=Y(),{usage:c,getUsageStatus:d,formatTimeUntilReset:u,isFreeUser:m,upgradeUrl:p}=(e=>{const{user:t}=Y(),n=null==t?void 0:t.id,{data:a}=Te({queryKey:["user-profile",n],queryFn:async()=>{if(!n)return null;const{data:e,error:t}=await W.from("profiles").select("app_role").eq("id",n).single();return t?null:e},enabled:!!n,staleTime:3e5}),r=(i=null==a?void 0:a.app_role)&&"consumer"!==i?"plus"===i||"explorer"===i?"explorer":"frequent-chraveler"===i?"frequent-chraveler":"pro"===i||"enterprise"===i||"advertiser"===i?"pro":"free":"free";var i;const s="free"===r?10:-1,{data:o,isLoading:l,error:c,refetch:d}=Te({queryKey:["concierge-usage",e,n,r],queryFn:async()=>{if(!n||!e)return{dailyCount:0,limit:10,remaining:10,isLimitReached:!1,resetTime:(new Date).toISOString()};if(-1===s)return{dailyCount:0,limit:-1,remaining:-1,isLimitReached:!1,resetTime:(new Date).toISOString()};const{data:t,error:a}=await W.from("concierge_usage").select("id").eq("user_id",n).eq("context_id",e);if(a)return{dailyCount:0,limit:s,remaining:s,isLimitReached:!1,resetTime:(new Date).toISOString()};const r=(null==t?void 0:t.length)||0,i=Math.max(0,s-r);return{dailyCount:r,limit:s,remaining:i,isLimitReached:r>=s,resetTime:(new Date).toISOString()}},enabled:!!n&&!!e,staleTime:1e4,refetchInterval:3e4});return{usage:o,isLoading:l,error:c,refetch:d,formatTimeUntilReset:e=>{const t=new Date,n=new Date(e).getTime()-t.getTime();if(n<=0)return"Reset now";const a=Math.floor(n/36e5),r=Math.floor(n%36e5/6e4);return a>0?`${a}h ${r}m`:`${r}m`},getUsageStatus:()=>o?-1===o.limit?{status:"ok",message:"Unlimited queries",color:"text-green-500"}:o.isLimitReached?{status:"limit_reached",message:`Trip limit reached (${o.dailyCount}/${o.limit})`,color:"text-red-500"}:o.remaining<=2&&o.remaining>0?{status:"warning",message:`${o.remaining} ${1===o.remaining?"query":"queries"} left for this trip`,color:"text-yellow-500"}:{status:"ok",message:`${o.remaining}/${o.limit} queries left`,color:"text-green-500"}:{status:"ok",message:"Loading...",color:"text-muted-foreground"},isFreeUser:"free"===r,userTier:r,upgradeUrl:Ky(r)}})(e),{isOffline:h}=me(),[g,f]=L.useState([]),[x,v]=L.useState(""),[y,b]=L.useState(!1),[w,j]=L.useState("connected"),[N,_]=L.useState(1/0),[k,S]=L.useState(""),[C,E]=L.useState(!1),D=L.useRef(!0),P=L.useRef(null),A=()=>(null==l?void 0:l.isPro)?"pro":s?"plus":"free";L.useEffect(()=>(D.current=!0,()=>{D.current=!1,P.current&&clearInterval(P.current)}),[]),L.useEffect(()=>{i&&l&&(Yy.getRemainingQueries(l.id,e,A()).then(e=>{D.current&&_(e)}).catch(e=>{}),Yy.getTimeUntilReset(l.id,e,A()).then(e=>{D.current&&S(e)}).catch(e=>{}));const t=Zy.getCachedMessages(e,null==l?void 0:l.id);t&&t.length>0&&D.current&&f(t)},[i,l,e,s]),L.useEffect(()=>{if(i&&l&&N!==1/0){const t=async()=>{try{const t=await Yy.getTimeUntilReset(l.id,e,A());D.current&&S(t)}catch(yN){}};return t(),P.current=setInterval(t,6e4),()=>{P.current&&clearInterval(P.current)}}},[i,l,e,N]),L.useEffect(()=>{h?j("offline"):"offline"===w&&j("connected")},[h]);const T=async()=>{if(!x.trim()||y)return;if(h){const t=Zy.getCachedResponse(e,x,null==l?void 0:l.id);return t?(E(!0),f(e=>[...e,{id:Date.now().toString(),type:"user",content:x,timestamp:(new Date).toISOString()},{...t,id:(Date.now()+1).toString(),timestamp:(new Date).toISOString()}]),void v("")):(f(e=>[...e,{id:Date.now().toString(),type:"user",content:x,timestamp:(new Date).toISOString()},{id:(Date.now()+1).toString(),type:"assistant",content:"ðŸ“¡ **Offline Mode**\n\nI'm currently offline and don't have a cached response for this query. Please check your connection and try again when online.",timestamp:(new Date).toISOString()}]),void v(""))}if(i&&l){if(!(await Yy.canQuery(l.id,e,A()))){const t=await Yy.getTimeUntilReset(l.id,e,A());return void f(e=>[...e,{id:Date.now().toString(),type:"assistant",content:`âš ï¸ **Daily Limit Reached**\n\nYou've used all ${"free"===A()?5:50} AI Concierge queries for today. Your limit will reset in ${t}.\n\nðŸ’Ž Upgrade to Chravel+ for unlimited AI assistance!`,timestamp:(new Date).toISOString()}])}}const n={id:Date.now().toString(),type:"user",content:x,timestamp:(new Date).toISOString()};f(e=>[...e,n]);const s=x;let c,d;v(""),b(!0),j("thinking");try{try{c=await qy.getEnhancedTripContext(e,!1)}catch(u){0;try{c=await By.getTripContext(e,!1)}catch(m){0,c={tripId:e,title:"Current Trip",location:(null==o?void 0:o.address)||(null==t?void 0:t.address)||"Unknown location",dateRange:(new Date).toISOString().split("T")[0],participants:[],itinerary:[],accommodation:(null==o?void 0:o.name)||(null==t?void 0:t.name),currentDate:(new Date).toISOString().split("T")[0],upcomingEvents:[],recentUpdates:[],confirmationNumbers:{}}}}const n=3e3,h=g.slice(-6).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content.length>n?e.content.substring(0,n)+"...[truncated]":e.content}));d=o?{name:o.name||"Basecamp",address:o.address}:t?{name:t.name||"Basecamp",address:t.address}:void 0;let x=0;const v=2;let y,w,N=null;for(;x<=v;)try{const e=await W.functions.invoke("lovable-concierge",{body:{message:s,tripContext:c,basecampLocation:d,preferences:a,chatHistory:h,isDemoMode:r}});if(y=e.data,w=e.error,w&&x<v){x++,N=w,await new Promise(e=>setTimeout(e,1e3*x));continue}if(w)throw N=w,w;break}catch(p){if(N=p,x<v){x++,await new Promise(e=>setTimeout(e,1e3*x));continue}break}if(!y||w||N){0,j("degraded");const t=M(s,c,d),n={id:(Date.now()+1).toString(),type:"assistant",content:t,timestamp:(new Date).toISOString()};return f(e=>[...e,n]),Zy.cacheMessage(e,s,n,null==l?void 0:l.id),void b(!1)}if(j("connected"),E(!1),i&&l)try{await Yy.incrementUsage(l.id,e,A());const t=await Yy.getRemainingQueries(l.id,e,A()),n=await Yy.getTimeUntilReset(l.id,e,A());D.current&&(_(t),S(n))}catch(u){0}const k={id:(Date.now()+1).toString(),type:"assistant",content:y.response||"Sorry, I encountered an error processing your request.",timestamp:(new Date).toISOString(),usage:y.usage,sources:y.sources||y.citations,googleMapsWidget:y.googleMapsWidget};f(e=>[...e,k]),Zy.cacheMessage(e,s,k,null==l?void 0:l.id)}catch(w){j("error");try{const t=M(s,c,d),n={id:(Date.now()+1).toString(),type:"assistant",content:`âš ï¸ **AI Service Temporarily Unavailable**\n\n${t}\n\n*Note: This is a basic response. Full AI features will return once the service is restored.*`,timestamp:(new Date).toISOString()};f(e=>[...e,n]),Zy.cacheMessage(e,s,n,null==l?void 0:l.id)}catch{const e={id:(Date.now()+1).toString(),type:"assistant",content:"I'm having trouble connecting to my AI services right now. Please try again in a moment.",timestamp:(new Date).toISOString()};f(t=>[...t,e])}}finally{b(!1)}},M=(e,t,n)=>{var a,r,i;const s=e.toLowerCase();if(s.match(/\b(where|location|address|directions|near|around|close)\b/))return n?`ðŸ“ **Location Information**\n\nBased on your trip basecamp:\n\n**${n.name}**\n${n.address}\n\nYou can use Google Maps to find directions and nearby places.`:"ðŸ“ I can help with location queries once the AI service is restored. For now, you can use the Places tab to search for locations.";if(s.match(/\b(when|time|schedule|calendar|event|agenda|upcoming)\b/)){if((null==(a=null==t?void 0:t.itinerary)?void 0:a.length)||(null==(r=null==t?void 0:t.calendar)?void 0:r.length)){const e=(t.itinerary||t.calendar||[]).slice(0,3);let n="ðŸ“… **Upcoming Events**\n\n";return e.forEach(e=>{n+=`â€¢ ${e.title||e.name}`,e.startTime&&(n+=` - ${e.startTime}`),e.location&&(n+=` at ${e.location}`),n+="\n"}),n}return"ðŸ“… Check the Calendar tab for your trip schedule."}if(s.match(/\b(payment|money|owe|spent|cost|budget|expense)\b/)){if(null==(i=null==t?void 0:t.payments)?void 0:i.length){const e=t.payments.filter(e=>!e.isSettled&&!e.settled);if(e.length>0){const t=e.reduce((e,t)=>e+(t.amount||0),0);let n="ðŸ’° **Outstanding Payments**\n\n";return e.slice(0,5).forEach(e=>{var t;const a=e.paidBy||e.createdByName||"Someone";n+=`â€¢ ${e.description}: $${(null==(t=e.amount)?void 0:t.toFixed(2))||"0.00"} (paid by ${a})\n`}),n+=`\n**Total Outstanding:** $${t.toFixed(2)}`,e.length>5&&(n+=`\n\n_...and ${e.length-5} more payments. Check the Payments tab for full details._`),n}return"ðŸ’° **All Settled!**\n\nNo outstanding payments for this trip. Check the Payments tab to add new expenses."}return"ðŸ’° No payment data available yet. Add expenses in the Payments tab to track who owes what."}return s.match(/\b(task|todo|complete|done|pending|assigned)\b/)?"âœ… Check the Tasks tab to see what needs to be completed.":"I'm temporarily unavailable, but you can:\n\nâ€¢ Use the **Places** tab to find locations\nâ€¢ Check the **Calendar** for your schedule\nâ€¢ View **Payments** for expense tracking\nâ€¢ See **Tasks** for what needs to be done\n\nFull AI assistance will return shortly!"};return n.jsx("div",{className:"flex flex-col px-0 py-4 overflow-hidden flex-1 min-h-0",children:n.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 shadow-[inset_0_1px_0_rgba(255,255,255,0.06)] overflow-hidden flex flex-col flex-1",children:[n.jsx("div",{className:"border-b border-white/10 bg-black/30 p-3 flex-shrink-0",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:n.jsx($t,{size:20,className:"text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg font-semibold text-white",children:"AI Concierge"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx($n,{size:16,className:"text-green-400"}),n.jsx("span",{className:"text-xs text-green-400",children:"Ready with Web Search"})]}),m&&c&&n.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[n.jsx(It,{variant:"limit_reached"===d().status?"destructive":"warning"===d().status?"secondary":"default",className:"text-xs",children:d().message}),"limit_reached"===d().status&&n.jsxs(Q,{size:"sm",variant:"outline",className:"text-xs h-6 px-2",onClick:()=>window.open(p,"_blank"),children:[n.jsx(Qn,{size:12,className:"mr-1"}),"Upgrade"]})]}),i&&!s&&l&&N!==1/0&&n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[n.jsx(Yn,{size:16,className:N<=2?"text-orange-400":"text-blue-400"}),n.jsxs("span",{className:"text-xs "+(N<=2?"text-orange-400":"text-blue-400"),children:[N," ",1===N?"query":"queries"," left"]}),k&&n.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(resets in ",k,")"]})]}),h&&n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[n.jsx(Yn,{size:16,className:"text-yellow-400"}),n.jsx("span",{className:"text-xs text-yellow-400",children:"Offline Mode"})]}),"degraded"===w&&n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[n.jsx(Yn,{size:16,className:"text-orange-400"}),n.jsx("span",{className:"text-xs text-orange-400",children:"Limited Mode"})]}),C&&n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[n.jsx(Kn,{size:16,className:"text-blue-400"}),n.jsx("span",{className:"text-xs text-blue-400",children:"Cached"})]})]})]})]})}),m&&(null==c?void 0:c.isLimitReached)&&n.jsxs("div",{className:"text-center py-8 mb-6 flex-shrink-0",children:[n.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Qn,{size:24,className:"text-white"})}),n.jsx("h4",{className:"text-white font-medium mb-3",children:"Daily Limit Reached"}),n.jsxs("div",{className:"text-sm text-gray-300 space-y-3 max-w-md mx-auto",children:[n.jsxs("p",{children:["You've used all ",c.limit," free AI queries today."]}),n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-400",children:[n.jsx(Kn,{size:14}),n.jsxs("span",{children:["Resets in ",u(c.resetTime)]})]}),n.jsx("div",{className:"mt-4",children:n.jsxs(Q,{onClick:()=>window.open(p,"_blank"),className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:[n.jsx(Qn,{size:16,className:"mr-2"}),"Upgrade to Pro for Unlimited Access"]})})]})]}),0===g.length&&!(m&&(null==c?void 0:c.isLimitReached))&&n.jsxs("div",{className:"text-center py-6 px-4 flex-shrink-0",children:[n.jsx("h4",{className:"text-base font-semibold mb-1.5 text-white sm:text-lg sm:mb-2",children:"Your AI Travel Concierge"}),n.jsxs("div",{className:"text-sm text-gray-300 space-y-1 max-w-md mx-auto",children:[n.jsx("p",{className:"text-xs sm:text-sm mb-1.5",children:"Ask me anything about your trip:"}),n.jsxs("div",{className:"text-xs text-gray-400 space-y-0.5 leading-snug",children:[n.jsx("p",{children:'â€¢ "Suggest activities based on our preferences"'}),n.jsx("p",{children:'â€¢ "What hidden gems should we check out?"'}),n.jsx("p",{children:'â€¢ "What\'s in the calendar agenda for the rest of the week"'}),n.jsx("p",{children:'â€¢ "What tasks still need to be completed"'}),n.jsx("p",{children:'â€¢ "Can you summarize my payments owed?"'})]}),n.jsx("div",{className:"mt-2 text-xs text-green-400 bg-green-500/10 rounded px-2.5 py-1 inline-block",children:"âœ¨ Powered by AI - ask me anything!"})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-4 chat-scroll-container native-scroll",children:g.length>0&&n.jsx(Hy,{messages:g,isTyping:y,showMapWidgets:!0})}),n.jsxs("div",{className:"chat-composer sticky bottom-0 z-10 bg-black/30 px-3 py-2 pb-[env(safe-area-inset-bottom)] flex-shrink-0",children:[n.jsx(Wy,{inputMessage:x,onInputChange:v,onSendMessage:T,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())},isTyping:y,disabled:"error"===w||m&&(null==c?void 0:c.isLimitReached),usageStatus:d(),onUpgradeClick:()=>window.location.href=p}),n.jsx("div",{className:"text-center mt-1",children:n.jsx("span",{className:"text-xs text-gray-500",children:"ðŸ”’ This conversation is private to you"})})]})]})})},eb=Object.freeze(Object.defineProperty({__proto__:null,AIConciergeChat:Jy},Symbol.toStringTag,{value:"Module"}));const tb=new class{constructor(){t(this,"channels",new Map),t(this,"messageCallbacks",new Map)}async subscribeToTrip(e,t){if(this.messageCallbacks.has(e)||this.messageCallbacks.set(e,new Set),this.messageCallbacks.get(e).add(t),!this.channels.has(e)){const t=W.channel(`trip-messages:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"trip_chat_messages",filter:`trip_id=eq.${e}`},t=>{var n;const a=this.transformMessage(t.new);null==(n=this.messageCallbacks.get(e))||n.forEach(e=>e(a))}).subscribe();this.channels.set(e,t)}return()=>{const n=this.messageCallbacks.get(e);if(n&&(n.delete(t),0===n.size)){const t=this.channels.get(e);t&&(W.removeChannel(t),this.channels.delete(e)),this.messageCallbacks.delete(e)}}}async sendMessage(e){return De(async()=>{const{data:t,error:n}=await W.from("trip_chat_messages").insert({trip_id:e.tripId,content:e.content,author_name:e.userName,user_id:e.userId,privacy_mode:e.privacyMode||"standard",reply_to_id:e.replyToId,thread_id:e.threadId,attachments:e.attachments||[]}).select().single();if(n)throw n;return this.transformMessage(t)},{maxRetries:3,onRetry:(e,t)=>{}})}async getMessages(e,t=50,n){let a=W.from("trip_chat_messages").select("*").eq("trip_id",e).eq("is_deleted",!1).order("created_at",{ascending:!1}).limit(t);n&&(a=a.lt("created_at",n.toISOString()));const{data:r,error:i}=await a;if(i)throw i;return(r||[]).map(this.transformMessage).reverse()}async editMessage(e,t){const{error:n}=await W.from("trip_chat_messages").update({content:t,is_edited:!0,edited_at:(new Date).toISOString()}).eq("id",e);if(n)throw n}async deleteMessage(e){const{error:t}=await W.from("trip_chat_messages").update({is_deleted:!0,deleted_at:(new Date).toISOString()}).eq("id",e);if(t)throw t}async getUnreadCount(e,t,n){const{count:a,error:r}=await W.from("trip_chat_messages").select("*",{count:"exact",head:!0}).eq("trip_id",e).neq("user_id",t).gt("created_at",n.toISOString());if(r)throw r;return a||0}async scheduleMessage(e){var t;try{const{data:n,error:a}=await W.functions.invoke("schedule-message",{body:{content:e.content,send_at:e.sendAt.toISOString(),trip_id:e.tripId,tour_id:e.tourId,user_id:e.userId,priority:e.priority||"fyi",is_recurring:e.isRecurring||!1,recurrence_type:e.recurrenceType,recurrence_end:null==(t=e.recurrenceEnd)?void 0:t.toISOString(),template_id:e.templateId}});if(a)throw a;return{success:!0,id:n.id}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async getMessageTemplates(e,t){try{const{data:n,error:a}=await W.functions.invoke("get-message-templates",{body:{tripType:e,category:t}});if(a)throw a;return n.templates||[]}catch(n){return[]}}fillTemplate(e,t){let n=e;return Object.entries(t).forEach(([e,t])=>{const a=new RegExp(`\\{\\{${e}\\}\\}`,"g");n=n.replace(a,t||`[${e}]`)}),n}cleanup(){this.channels.forEach(e=>{W.removeChannel(e)}),this.channels.clear(),this.messageCallbacks.clear()}transformMessage(e){return{id:e.id,trip_id:e.trip_id,content:e.content,author_name:e.author_name,user_id:e.user_id,created_at:e.created_at,updated_at:e.updated_at,reply_to_id:e.reply_to_id,thread_id:e.thread_id,is_edited:e.is_edited,edited_at:e.edited_at,is_deleted:e.is_deleted,deleted_at:e.deleted_at,attachments:e.attachments||[],media_type:e.media_type,media_url:e.media_url,link_preview:e.link_preview,privacy_mode:e.privacy_mode,privacy_encrypted:e.privacy_encrypted,message_type:e.message_type}}async getScheduledMessages(e,t,n){try{const{data:a,error:r}=await W.from("scheduled_messages").select("*").eq("user_id",e).eq(t?"trip_id":"tour_id",t||n).order("send_at",{ascending:!0});if(r)throw r;return a||[]}catch(a){return[]}}async updateScheduledMessage(e,t){try{const{error:n}=await W.from("scheduled_messages").update(t).eq("id",e);if(n)throw n;return{success:!0}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async cancelScheduledMessage(e){try{const{error:t}=await W.from("scheduled_messages").delete().eq("id",e);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}};const nb=({activeFilter:e,onFilterChange:t,hasChannels:a=!1,isPro:r=!1,broadcastCount:i=0,unreadCount:s=0,onSearchClick:o,availableChannels:l=[],activeChannel:c,onChannelSelect:d})=>{const[u,m]=L.useState(!1);return n.jsx("div",{className:"sticky top-0 z-10 backdrop-blur-lg px-2 py-1 rounded-t-2xl overflow-hidden",children:n.jsx("div",{className:"flex items-center justify-center",children:n.jsxs("div",{className:"inline-flex items-center bg-neutral-900/70 backdrop-blur-md border border-white/10 rounded-xl p-0.5 shadow-lg",children:[n.jsxs("button",{onClick:()=>t("all"),className:G("relative flex items-center gap-1.5 px-3 py-2 rounded-xl","text-sm font-medium transition-all duration-200","all"===e?"bg-blue-600 text-white shadow-md":"text-white/70 hover:text-white hover:bg-white/5"),"aria-pressed":"all"===e,children:[n.jsx(Ct,{className:"w-4 h-4"}),n.jsx("span",{children:"Messages"}),s>0&&"all"!==e&&n.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-xs rounded-full bg-blue-500 text-white font-semibold",children:s})]}),n.jsxs("button",{onClick:()=>t("broadcasts"),className:G("relative flex items-center gap-1.5 px-3 py-2 rounded-xl","text-sm font-medium transition-all duration-200","broadcasts"===e?"bg-orange-500 text-white shadow-md":"text-orange-400/70 hover:text-orange-400 hover:bg-orange-500/10"),"aria-pressed":"broadcasts"===e,children:[n.jsx(Me,{className:"w-4 h-4"}),n.jsx("span",{children:"Broadcasts"}),i>0&&"broadcasts"!==e&&n.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-xs rounded-full bg-orange-500 text-white font-semibold",children:i})]}),r&&n.jsxs(Vt,{open:u,onOpenChange:m,children:[n.jsx(Ht,{asChild:!0,children:n.jsxs("button",{onClick:()=>{a&&t("channels")},disabled:!a,className:G("relative flex items-center gap-1.5 px-3 py-2 rounded-xl","text-sm font-medium transition-all duration-200",!a&&"opacity-40 cursor-not-allowed","channels"===e&&a?"bg-purple-500 text-white shadow-md":"text-purple-400/70 hover:text-purple-400 hover:bg-purple-500/10",!a&&"hover:bg-transparent"),"aria-pressed":"channels"===e,title:a?void 0:"No role-based channels for this trip",children:[n.jsx(pa,{className:"w-4 h-4"}),n.jsx("span",{children:c?c.channelName.toLowerCase().replace(/\s+/g,"-"):"Channels"}),c&&a&&n.jsx(Xt,{className:"w-3 h-3 opacity-70"})]})}),a&&l.length>0&&n.jsx(Wt,{side:"bottom",align:"center",className:"channel-dropdown rounded-xl backdrop-blur-md bg-neutral-900 border border-white/10 shadow-lg p-2 mt-1 z-50 w-auto",sideOffset:4,children:n.jsxs("div",{className:"flex flex-col gap-1 min-w-[200px]",children:[n.jsxs("button",{onClick:()=>{null==d||d(null),t("all"),m(!1)},className:G("flex items-center justify-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200",c?"text-white/70 hover:text-white hover:bg-white/10":"bg-blue-500 text-white shadow-md"),children:[n.jsx(Ct,{className:"w-3.5 h-3.5 flex-shrink-0"}),n.jsx("span",{className:"whitespace-nowrap",children:"All Messages"})]}),n.jsx("div",{className:"h-px bg-white/10 my-1"}),l.sort((e,t)=>e.channelName.localeCompare(t.channelName)).map(e=>n.jsxs("button",{onClick:()=>(e=>{null==d||d(e),m(!1)})(e),className:G("flex items-center justify-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200",(null==c?void 0:c.id)===e.id?"bg-purple-500 text-white shadow-md":"text-white/70 hover:text-white hover:bg-white/10"),children:[n.jsx(pa,{className:"w-3.5 h-3.5 flex-shrink-0"}),n.jsx("span",{className:"whitespace-nowrap",children:e.channelName.toLowerCase().replace(/\s+/g,"-")})]},e.id))]})})]}),n.jsxs("button",{onClick:o,className:G("relative flex items-center gap-1.5 px-3 py-2 rounded-xl","text-sm font-medium transition-all duration-200","text-cyan-400/70 hover:text-cyan-400 hover:bg-cyan-500/10"),title:"Search messages and broadcasts",children:[n.jsx($t,{className:"w-4 h-4"}),n.jsx("span",{children:"Search"})]})]})})})},ab=({tripId:e,isEvent:t=!1,isPro:a=!1,userRole:r="member"})=>{(()=>{const[e,t]=L.useState(()=>window.innerHeight>window.innerWidth?"portrait":"landscape");L.useEffect(()=>{const e=()=>{const e=window.innerHeight>window.innerWidth?"portrait":"landscape";t(e)};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),e(),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[])})();const i=L.useRef(null);L.useRef(null);const[s,o]=L.useState({}),[l,c]=L.useState("all"),[d,u]=L.useState(null),[m,p]=L.useState(!1),[h,g]=L.useState({}),{availableChannels:f,activeChannel:x,setActiveChannel:v}=og(e,r,[]);L.useEffect(()=>{W.auth.getUser().then(({data:e})=>{var t;u((null==(t=e.user)?void 0:t.id)||null)})},[]);const{messages:y,isLoading:b,sendMessage:w,loadMore:j,hasMore:N,isLoadingMore:_}=function({tripId:e,enabled:t=!0}){const{toast:n}=ue(),[a,r]=L.useState([]),[i,s]=L.useState(!0),[o,l]=L.useState(!1),[c,d]=L.useState(!0),[u,m]=L.useState(!1),[p,h]=L.useState(null),g=L.useRef(null);L.useEffect(()=>{W.auth.getUser().then(({data:e})=>{h(e.user)})},[]),L.useEffect(()=>{if(t&&p&&e)return(async()=>{try{const t=await Gh(e);t.length>0&&(r(t),s(!1));const n=await tb.getMessages(e,10);r(n),d(10===n.length),await Kh(e,n);const a=await tb.subscribeToTrip(e,e=>{r(t=>t.some(t=>t.id===e.id)?t:[...t,e])});g.current=a,s(!1)}catch(t){n({title:"Connection Error",description:"Failed to connect to messaging service",variant:"destructive"}),s(!1)}})(),()=>{g.current&&g.current()}},[t,p,e,n]);const f=L.useCallback(async(t,a)=>{var i;if(!p)return void n({title:"Not Authenticated",description:"Please sign in to send messages",variant:"destructive"});l(!0);const s=(null==(i=p.email)?void 0:i.split("@")[0])||"Unknown User",o=`optimistic-${Date.now()}`,c={id:o,trip_id:e,content:t,author_name:s,user_id:p.id,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),privacy_mode:a||"standard",is_deleted:!1,is_edited:!1,attachments:[],media_type:null,media_url:null,reply_to_id:void 0,thread_id:void 0,link_preview:null,privacy_encrypted:!1,edited_at:void 0,deleted_at:void 0,status:"sending",originalContent:t};r(e=>[...e,c]);try{const n=await tb.sendMessage({content:t,tripId:e,userName:s,userId:p.id,privacyMode:a||"standard"});r(e=>e.map(e=>e.id===o?{...n,status:"sent"}:e)),await Kh(e,[n])}catch(d){const e=null==d?void 0:d.code,t=d instanceof Error?d.message:"Unknown error";r(e=>e.map(e=>e.id===o?{...e,status:"failed"}:e));let a="Failed to send message. Tap to retry.";"42501"===e?a="You may not have permission to send messages in this trip.":"PGRST301"===e?a="Connection lost. Please refresh the page.":d instanceof TypeError&&t.includes("fetch")?a="Network error. Please check your connection and try again.":"23503"===e&&(a="You must be a trip member to send messages."),n({title:"Send Failed",description:a,variant:"destructive"})}finally{l(!1)}},[p,e,n]),x=L.useCallback(async e=>{const t=a.find(t=>t.id===e&&"failed"===t.status);t&&p&&(r(t=>t.filter(t=>t.id!==e)),await f(t.content,t.privacy_mode))},[a,p,f]),v=L.useCallback(async()=>{if(0!==a.length&&c&&!u){m(!0);try{const t=a[0],n=await tb.getMessages(e,20,new Date(t.created_at));n.length>0?(r(e=>[...n,...e]),d(20===n.length)):d(!1)}catch(t){}finally{m(!1)}}},[e,a,c,u]),y=L.useCallback(async e=>{try{await tb.deleteMessage(e),r(t=>t.filter(t=>t.id!==e))}catch(t){n({title:"Delete Failed",description:"Failed to delete message",variant:"destructive"})}},[n]);return{messages:a,isLoading:i,isSending:o,sendMessage:f,loadMore:v,deleteMessage:y,retrySendMessage:x,isConnected:!0,hasMore:c,isLoadingMore:u}}({tripId:e,enabled:!0});L.useEffect(()=>{(async()=>{const e=Array.from(new Set(y.map(e=>e.user_id).filter(e=>!!e)));if(0===e.length)return void g({});const{data:t,error:n}=await W.from("profiles").select("user_id, display_name, avatar_url").in("user_id",e);if(n)return;const a={};for(const r of t??[])a[r.user_id]={display_name:r.display_name,avatar_url:r.avatar_url};g(a)})().catch(()=>{})},[y]);const k=y.map(e=>{var t,n;return{id:e.id,text:e.content,sender:{id:e.user_id||"unknown",name:(null==(t=h[e.user_id||""])?void 0:t.display_name)||e.author_name,avatar:(null==(n=h[e.user_id||""])?void 0:n.avatar_url)||void 0},createdAt:new Date(e.created_at).toISOString(),isBroadcast:"broadcast"===e.privacy_mode}}),{unreadCount:S,broadcastCount:C}=hg({tripId:e,messages:y,userId:d,enabled:!0});L.useEffect(()=>{if(!d||0===y.length)return;const e=setTimeout(async()=>{const e=y.filter(e=>e.user_id!==d).map(e=>e.id);if(e.length>0)try{await pg(e,0,d)}catch(t){}},1e3);return()=>clearTimeout(e)},[y,e,d]);const{inputMessage:E,setInputMessage:D,replyingTo:P,clearReply:A,sendMessage:T,filterMessages:M}=Ca({tripId:e});Ea({preventZoom:!0,adjustViewport:!0,onShow:()=>{setTimeout(()=>{var e;null==(e=i.current)||e.scrollIntoView({behavior:"smooth"})},300)}});const R=async(e=!1,t=!1,n)=>{await bo.light(),E.trim()&&(await w(E,e?"broadcast":"standard"),D(""))},I=async(e,t)=>{await bo.light();const n={...s};n[e]||(n[e]={});const a=n[e][t]||{count:0,userReacted:!1};a.userReacted=!a.userReacted,a.count+=a.userReacted?1:-1,n[e][t]=a,o(n)},O=M(k);return n.jsxs("div",{className:"flex flex-col h-full bg-black relative",children:[m&&n.jsx(vg,{tripId:e,onClose:()=>p(!1),onResultSelect:(e,t)=>{p(!1),"broadcast"===t&&"broadcasts"!==l?c("broadcasts"):"message"===t&&"all"!==l&&c("all"),setTimeout(()=>{const t=document.querySelector(`[data-message-id="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("search-highlight-flash"),setTimeout(()=>{t.classList.remove("search-highlight-flash")},1e3))},100)},isDemoMode:!1,demoMessages:[]}),n.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:n.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 shadow-[inset_0_1px_0_rgba(255,255,255,0.06)] overflow-hidden flex-1 flex flex-col mx-4 mt-4 mb-2",children:[n.jsx(nb,{activeFilter:l,onFilterChange:c,hasChannels:f.length>0,isPro:a,broadcastCount:C,unreadCount:S,onSearchClick:()=>p(!0),availableChannels:f,activeChannel:x,onChannelSelect:e=>{v(e),e&&c("channels")}}),b?n.jsx("div",{className:"flex-1 overflow-y-auto p-4 min-h-0",children:n.jsx(Oh,{})}):n.jsx(wo,{messages:O,renderMessage:e=>n.jsx(Ih,{message:e,reactions:s[e.id],onReaction:I}),onLoadMore:j,hasMore:N,isLoading:_,initialVisibleCount:10,className:"flex-1 min-h-0 overflow-y-auto chat-scroll-container native-scroll"}),P&&n.jsx("div",{className:"border-t border-white/10 bg-black/30 px-4 py-2 flex-shrink-0",children:n.jsx(mo,{replyTo:P,onCancel:A})})]})}),n.jsx("div",{className:"flex-shrink-0 sticky bottom-0 z-20 bg-black/95 backdrop-blur-xl border-t border-white/10 pb-[env(safe-area-inset-bottom)]",children:n.jsx("div",{className:"px-4 py-3",children:n.jsx(uo,{inputMessage:E,onInputChange:D,onSendMessage:R,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},apiKey:"",isTyping:!1,tripMembers:[],hidePayments:!0,tripId:e})})})]})},rb=({isOpen:e,onClose:t,tripId:a,tripMembers:r,onPaymentCreated:i})=>{const[s,o]=L.useState(!1),{amount:l,currency:c,description:d,selectedParticipants:u,selectedPaymentMethods:m,perPersonAmount:p,allParticipantsSelected:h,setAmount:g,setCurrency:f,setDescription:x,toggleParticipant:v,togglePaymentMethod:y,selectAllParticipants:b,getPaymentData:w,resetForm:j}=Pa(r);if(!e)return null;return n.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",children:[n.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:t}),n.jsxs("div",{className:"relative w-full max-w-md bg-glass-slate-card border border-glass-slate-border rounded-t-3xl sm:rounded-3xl shadow-enterprise-2xl flex flex-col max-h-[calc(100vh-80px)] animate-slide-up",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:n.jsx(an,{className:"w-5 h-5 text-green-400"})}),n.jsx("h2",{className:"text-xl font-semibold text-white",children:"Add Payment"})]}),n.jsx("button",{onClick:t,className:"w-8 h-8 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors",children:n.jsx(ae,{className:"w-5 h-5 text-white"})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6 pb-24 native-scroll",children:n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(!0);try{const e=w();if(!e)return void o(!1);he.addSessionPayment(a,e),j(),null==i||i(),t()}catch(n){}finally{o(!1)}},className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),n.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"e.g., Dinner at restaurant",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500/50",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Amount"}),n.jsxs("div",{className:"relative",children:[n.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:"$"}),n.jsx("input",{type:"number",step:"0.01",value:l||"",onChange:e=>g(Number(e.target.value)),placeholder:"0.00",className:"w-full pl-8 pr-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500/50",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Currency"}),n.jsxs("select",{value:c,onChange:e=>f(e.target.value),className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-green-500/50",children:[n.jsx("option",{value:"USD",children:"USD ($)"}),n.jsx("option",{value:"EUR",children:"EUR (â‚¬)"}),n.jsx("option",{value:"GBP",children:"GBP (Â£)"}),n.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),n.jsx("option",{value:"CAD",children:"CAD ($)"}),n.jsx("option",{value:"AUD",children:"AUD ($)"})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300",children:[n.jsx(ln,{size:16}),"Split between ",u.length," people"]}),n.jsx("button",{type:"button",onClick:b,className:"text-xs text-green-400 hover:text-green-300 font-medium px-2 py-1 rounded bg-white/5 hover:bg-white/10 transition-colors",children:h?"Deselect All":"Select All"})]}),n.jsx("div",{className:"max-h-32 overflow-y-auto flex flex-wrap gap-2 p-3 bg-white/5 border border-white/10 rounded-xl native-scroll",children:0===r.length?n.jsx("p",{className:"text-sm text-gray-400 text-center py-2 w-full",children:"No trip members found"}):r.map(e=>{const t=u.includes(e.id);return n.jsxs("button",{type:"button",onClick:()=>v(e.id),className:`\n                        inline-flex items-center gap-2 rounded-lg px-2 py-1.5 cursor-pointer transition-all w-auto shrink-0\n                        ${t?"bg-green-500/20 border-2 border-green-500 ring-1 ring-green-500/30":"bg-white/5 hover:bg-white/10 border-2 border-transparent"}\n                      `,children:[n.jsx("div",{className:`\n                        w-5 h-5 rounded-full flex items-center justify-center shrink-0 transition-all\n                        ${t?"bg-green-500 text-white":"bg-gray-700 border border-gray-600"}\n                      `,children:t&&n.jsx(Qt,{size:12,strokeWidth:3})}),n.jsxs(Vn,{className:"w-6 h-6 shrink-0",children:[n.jsx(Hn,{src:e.avatar,alt:e.name}),n.jsx(Wn,{className:"bg-primary/20 text-primary font-semibold text-xs",children:St(e.name)})]}),n.jsx("span",{className:"text-sm whitespace-nowrap "+(t?"text-white font-medium":"text-gray-300"),children:e.name})]},e.id)})}),p>0&&u.length>0&&n.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["$",p.toFixed(2)," per person"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Preferred Payment Methods"}),n.jsx("div",{className:"space-y-2",children:[{id:"venmo",label:"Venmo"},{id:"cashapp",label:"Cash App"},{id:"zelle",label:"Zelle"},{id:"paypal",label:"PayPal"},{id:"applecash",label:"Apple Cash"}].map(e=>{const t=m.includes(e.id);return n.jsxs("button",{type:"button",onClick:()=>y(e.id),className:`\n                      flex items-center gap-3 w-full p-3 rounded-xl cursor-pointer transition-all\n                      ${t?"bg-green-500/20 border-2 border-green-500 ring-1 ring-green-500/30":"bg-white/5 hover:bg-white/10 border-2 border-transparent"}\n                    `,children:[n.jsx("div",{className:`\n                      w-5 h-5 rounded-md flex items-center justify-center shrink-0 transition-all\n                      ${t?"bg-green-500 text-white":"bg-gray-700 border border-gray-600"}\n                    `,children:t&&n.jsx(Qt,{size:12,strokeWidth:3})}),n.jsx("span",{className:""+(t?"text-white font-medium":"text-gray-300"),children:e.label})]},e.id)})})]}),n.jsxs("div",{className:"flex gap-3 pt-2",children:[n.jsx(Q,{type:"button",variant:"outline",onClick:t,className:"flex-1 bg-white/5 border-white/10 text-white hover:bg-white/10",children:"Cancel"}),n.jsx(Q,{type:"submit",disabled:s||0===u.length||!l||!d,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:s?"Creating...":"Create Payment"})]})]})})]})]})},ib=new Map,sb=36e5;async function ob(e,t,n){if(t===n)return e;const a=await async function(e,t){var n;if(e===t)return 1;const a=`${e}_${t}`,r=ib.get(a);if(r&&Date.now()-r.timestamp<sb)return r.rate;try{const n=await fetch(`https://api.exchangerate-api.com/v4/latest/${e}`);if(!n.ok)throw new Error("Failed to fetch exchange rates");const r=(await n.json()).rates[t];if(!r)throw new Error(`Exchange rate not found for ${t}`);return ib.set(a,{rate:r,timestamp:Date.now()}),r}catch(i){const r=null==(n={USD:{EUR:.92,GBP:.79,CAD:1.35,JPY:150},EUR:{USD:1.09,GBP:.86,CAD:1.47,JPY:163},GBP:{USD:1.27,EUR:1.16,CAD:1.71,JPY:190},CAD:{USD:.74,EUR:.68,GBP:.58,JPY:111}}[e])?void 0:n[t];return r?(ib.set(a,{rate:r,timestamp:Date.now()-18e5}),r):1}}(t,n);return e*a}const lb={async getBalanceSummary(e,t,n="USD"){try{const{data:{user:a},error:r}=await W.auth.getUser();if(r||!a)throw new Error("Unauthorized: Authentication required");const{data:i,error:s}=await W.from("trip_members").select("id").eq("trip_id",e).eq("user_id",a.id).maybeSingle();if(s)throw new Error(`Failed to verify trip membership: ${s.message}`);if(!i)throw new Error("Unauthorized: Not a trip member");const{data:o,error:l}=await W.from("trip_payment_messages").select("*").eq("trip_id",e);if(l)throw l;if(!o||0===o.length)return{totalOwed:0,totalOwedToYou:0,netBalance:0,baseCurrency:n,balances:[]};const{data:c,error:d}=await W.from("payment_splits").select("*, confirmation_status, confirmed_by, confirmed_at").in("payment_message_id",(null==o?void 0:o.map(e=>e.id))||[]);if(d)throw d;const u=new Set;null==o||o.forEach(e=>u.add(e.created_by)),null==c||c.forEach(e=>u.add(e.debtor_user_id));const{data:m,error:p}=await W.from("profiles").select("user_id, display_name, avatar_url").in("user_id",Array.from(u));if(p)throw p;const{data:h,error:g}=await W.from("user_payment_methods").select("*").in("user_id",Array.from(u));if(g)throw g;const f=e=>{if(!e||0===e.length)return null;const t=e.find(e=>e.is_preferred);if(t)return t;const n=["venmo","cashapp","zelle","paypal","applecash","cash","other"];return[...e].sort((e,t)=>{const a=n.indexOf(e.method_type),r=n.indexOf(t.method_type);return(-1===a?999:a)-(-1===r?999:r)})[0]},x=o.map(e=>({amount:parseFloat(e.amount.toString()),currency:e.currency||"USD"})),v=await async function(e,t="USD"){return await Promise.all(e.map(async({amount:e,currency:n})=>({amount:await ob(e,n,t),currency:t,originalAmount:e,originalCurrency:n})))}(x,n),y=new Map;o.forEach((e,t)=>{y.set(e.id,v[t].amount)});const b=new Map;b.set(t,{netAmount:0,payments:[],confirmationStatus:"none"});const w=[];null==o||o.forEach(e=>{if(e.created_by===t){((null==c?void 0:c.filter(n=>n.payment_message_id===e.id&&n.debtor_user_id!==t))||[]).forEach(n=>{n.is_settled||w.push({splitId:n.id,amount:parseFloat(n.amount_owed.toString()),currency:e.currency||"USD",paymentId:e.id,debtorId:n.debtor_user_id,payerId:t,isDebtor:!1})})}}),null==c||c.forEach(e=>{if(e.debtor_user_id===t&&!e.is_settled){const n=null==o?void 0:o.find(t=>t.id===e.payment_message_id);n&&w.push({splitId:e.id,amount:parseFloat(e.amount_owed.toString()),currency:n.currency||"USD",paymentId:n.id,debtorId:t,payerId:n.created_by,isDebtor:!0})}});(await Promise.all(w.map(async e=>{const t=e.currency===n?e.amount:await ob(e.amount,e.currency,n);return{...e,normalizedAmount:t}}))).forEach(({splitId:e,normalizedAmount:t,paymentId:a,debtorId:r,payerId:i,isDebtor:s})=>{const l=null==o?void 0:o.find(e=>e.id===a),d=null==c?void 0:c.find(t=>t.id===e);if(!l||!d)return;const u=d.confirmation_status||"none",m=s?i:r;b.has(m)||b.set(m,{netAmount:0,payments:[],confirmationStatus:u});const p=b.get(m);s?p.netAmount-=t:p.netAmount+=t,p.confirmationStatus=u,p.payments.push({paymentId:l.id,description:l.description,amount:s?-t:t,amountCurrency:n,date:l.created_at})});const j=[];let N=0,_=0;return b.forEach((e,a)=>{if(a===t)return;const r=null==m?void 0:m.find(e=>e.user_id===a),i=(null==h?void 0:h.filter(e=>e.user_id===a))||[],s=f(i.map(e=>({...e,type:e.method_type})));j.push({userId:a,userName:(null==r?void 0:r.display_name)||"Unknown User",avatar:null==r?void 0:r.avatar_url,amountOwed:e.netAmount,amountOwedCurrency:n,preferredPaymentMethod:s?{id:s.id,type:s.method_type,identifier:s.identifier,displayName:s.display_name||void 0,isPreferred:s.is_preferred||!1}:null,unsettledPayments:e.payments,confirmationStatus:e.confirmationStatus}),e.netAmount<0?N+=Math.abs(e.netAmount):e.netAmount>0&&(_+=e.netAmount)}),j.sort((e,t)=>e.amountOwed-t.amountOwed),{totalOwed:N,totalOwedToYou:_,netBalance:_-N,baseCurrency:n,balances:j.filter(e=>0!==e.amountOwed)}}catch(a){if(a instanceof Error&&a.message.includes("Unauthorized"))throw a;return{totalOwed:0,totalOwedToYou:0,netBalance:0,baseCurrency:n,balances:[]}}}},cb=({tripId:e})=>{const{user:t}=Y(),{toast:a}=ue(),[r,i]=L.useState(!1),[s,o]=L.useState([]),[l,c]=L.useState([]),[d,u]=L.useState(null),[m,p]=L.useState(!0),[h,g]=L.useState(!0),{isDemoMode:f,isLoading:x}=X(),{tier:v,upgradeToTier:y}=te(),b=/^\d+$/.test(e),w=parseInt(e,10),j=b&&!isNaN(w)&&w>=1&&w<=12,N=f&&j,_=L.useMemo(()=>l.filter(e=>e.payerId===(null==t?void 0:t.id)).length,[l,t]),k="free"===v?5:-1,S=-1===k?-1:Math.max(0,k-_),C=-1===k||_<k,E=L.useMemo(()=>l.filter(e=>!e.isSettled),[l]),D=L.useMemo(()=>l.filter(e=>e.isSettled),[l]);L.useEffect(()=>{if(x)return;(async()=>{var n;p(!0),g(!0);try{if(N){const t=Je(w),n=he.getMockMembers(e);let a;a=t&&t.participants?t.participants.map(e=>({id:String(e.id),name:e.name,avatar:e.avatar})):n.map(e=>({id:e.user_id,name:e.display_name,avatar:e.avatar_url})),o(a);const r=(e,t)=>{const r=a.find(t=>t.id===e);if(r)return r.name;const i=n.find(t=>t.user_id===e);return(null==i?void 0:i.display_name)||"Unknown"},i=he.getMockPayments(e,!1),s=he.getSessionPayments(e),l=s.map(e=>({id:e.id,payer:e.createdByName||r(e.created_by),payerId:e.created_by||"demo-user",payerAvatar:Dt(e.createdByName||r(e.created_by)),amount:e.amount,currency:e.currency||"USD",description:e.description,status:e.is_settled?"settled":"pending",splitWith:e.split_participants||[],splitCount:e.split_count||1,date:e.created_at,isSettled:e.is_settled||!1})),d=i.map(e=>({id:e.id,payer:r(e.created_by),payerId:e.created_by,payerAvatar:Dt(r(e.created_by)),amount:e.amount,currency:e.currency||"USD",description:e.description,status:e.is_settled?"settled":"pending",splitWith:e.split_participants||[],splitCount:e.split_count||1,date:e.created_at,isSettled:e.is_settled||!1}));c([...l,...d]),g(!1);const m=[...s,...i],h=m.reduce((e,t)=>e+t.amount,0)/Math.max(n.length,1);return u({totalOwed:.6*h,totalOwedToYou:.4*h,netBalance:.2*h,baseCurrency:"USD",balances:n.slice(0,3).map((e,t)=>({userId:e.user_id,userName:e.display_name,avatar:e.avatar_url,amountOwed:(0===t?.5*h:.3*h)*(t%2==0?1:-1),amountOwedCurrency:"USD",preferredPaymentMethod:null,unsettledPayments:[]}))}),void p(!1)}const[a,i]=await Promise.all([Ue.getTripMembers(e),Pt.getTripPaymentMessages(e)]),s=a.map(e=>{var t,n,a,r;return{id:e.user_id,name:(null==(t=e.profiles)?void 0:t.display_name)||(null==(a=null==(n=e.profiles)?void 0:n.email)?void 0:a.split("@")[0])||"Unknown User",avatar:(null==(r=e.profiles)?void 0:r.avatar_url)||void 0}});let l=s;if(t&&!s.find(e=>e.id===t.id)){const{data:e}=await W.from("profiles").select("display_name, avatar_url").eq("user_id",t.id).single();l=[{id:t.id,name:(null==e?void 0:e.display_name)||(null==(n=t.email)?void 0:n.split("@")[0])||"Unknown",avatar:null==e?void 0:e.avatar_url},...s]}o(l);const d=i.map(e=>{const t=l.find(t=>t.id===e.createdBy);return{id:e.id,payer:(null==t?void 0:t.name)||"Unknown",payerId:e.createdBy,payerAvatar:(null==t?void 0:t.avatar)||Dt((null==t?void 0:t.name)||"Unknown"),amount:e.amount,currency:e.currency,description:e.description,status:e.isSettled?"settled":"pending",splitWith:e.splitParticipants,splitCount:e.splitCount,date:e.createdAt,isSettled:e.isSettled}});if(c(d),g(!1),null==t?void 0:t.id)try{const n=await lb.getBalanceSummary(e,t.id);u(n)}catch(r){u({totalOwed:0,totalOwedToYou:0,netBalance:0,baseCurrency:"USD",balances:[]})}}catch(r){a({title:"Error",description:"Failed to load payment information",variant:"destructive"}),c([])}finally{p(!1),g(!1)}})()},[e,t,N,x,a]),L.useEffect(()=>{if(!e||N)return;const t=W.channel(`mobile-payments-profiles-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"profiles"},e=>{const t=e.new,n=null==t?void 0:t.user_id;n&&o(e=>e.map(e=>e.id===n?{...e,name:t.display_name??e.name,avatar:t.avatar_url??e.avatar}:e))}).subscribe();return()=>{W.removeChannel(t).catch(()=>{})}},[e,N]);const P=L.useCallback(async()=>{if(N){const t=he.getMockPayments(e,!1),n=he.getSessionPayments(e),a=he.getMockMembers(e),r=(e,t)=>{const n=s.find(t=>t.id===e);if(n)return n.name;const r=a.find(t=>t.user_id===e);return(null==r?void 0:r.display_name)||"Unknown"},i=n.map(e=>({id:e.id,payer:e.createdByName||r(e.created_by),payerId:e.created_by||"demo-user",payerAvatar:Dt(e.createdByName||r(e.created_by)),amount:e.amount,currency:e.currency||"USD",description:e.description,status:e.is_settled?"settled":"pending",splitWith:e.split_participants||[],splitCount:e.split_count||1,date:e.created_at,isSettled:e.is_settled||!1})),o=t.map(e=>({id:e.id,payer:r(e.created_by),payerId:e.created_by,payerAvatar:Dt(r(e.created_by)),amount:e.amount,currency:e.currency||"USD",description:e.description,status:e.is_settled?"settled":"pending",splitWith:e.split_participants||[],splitCount:e.split_count||1,date:e.created_at,isSettled:e.is_settled||!1}));c([...i,...o])}else{const a=(await Pt.getTripPaymentMessages(e)).map(e=>{const t=s.find(t=>t.id===e.createdBy);return{id:e.id,payer:(null==t?void 0:t.name)||"Unknown",payerId:e.createdBy,payerAvatar:(null==t?void 0:t.avatar)||Dt((null==t?void 0:t.name)||"Unknown"),amount:e.amount,currency:e.currency,description:e.description,status:e.isSettled?"settled":"pending",splitWith:e.splitParticipants,splitCount:e.splitCount,date:e.createdAt,isSettled:e.isSettled}});if(c(a),null==t?void 0:t.id)try{const n=await lb.getBalanceSummary(e,t.id);u(n)}catch(n){}}},[e,N,s,t]),A=async e=>{await bo.light()},T=e=>{switch(e){case"settled":return n.jsx($n,{size:16,className:"text-green-500"});case"pending":return n.jsx(Kn,{size:16,className:"text-yellow-500"});case"overdue":return n.jsx(Yn,{size:16,className:"text-red-500"})}},M=(e,t="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:2}).format(e);return m||x?n.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-black py-12",children:[n.jsx(bn,{className:"w-8 h-8 animate-spin text-primary mb-2"}),n.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading payments..."})]}):n.jsxs("div",{className:"flex flex-col h-full bg-black",children:[n.jsx("div",{className:"px-4 pt-4 pb-2",children:n.jsx("div",{className:"bg-card/50 border border-border rounded-xl p-4",children:n.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[n.jsx(ra,{size:14,className:"text-orange-500"}),n.jsx("span",{className:"text-xs text-muted-foreground",children:"You Owe"})]}),n.jsx("p",{className:"text-lg font-bold text-orange-500",children:M((null==d?void 0:d.totalOwed)||0)})]}),n.jsxs("div",{className:"text-center border-x border-border",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[n.jsx(aa,{size:14,className:"text-green-500"}),n.jsx("span",{className:"text-xs text-muted-foreground",children:"You're Owed"})]}),n.jsx("p",{className:"text-lg font-bold text-green-500",children:M((null==d?void 0:d.totalOwedToYou)||0)})]}),n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[n.jsx(an,{size:14,className:"text-muted-foreground"}),n.jsx("span",{className:"text-xs text-muted-foreground",children:"Net"})]}),n.jsx("p",{className:"text-lg font-bold "+(((null==d?void 0:d.netBalance)||0)>=0?"text-green-500":"text-orange-500"),children:M((null==d?void 0:d.netBalance)||0)})]})]})})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-2 space-y-4 native-scroll mobile-safe-scroll",children:0===l.length?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(an,{size:48,className:"text-muted-foreground mx-auto mb-4"}),n.jsx("h4",{className:"text-lg font-medium text-muted-foreground mb-2",children:"No payments yet"}),n.jsx("p",{className:"text-muted-foreground text-sm",children:"Split expenses and track who owes what"})]}):n.jsxs(n.Fragment,{children:[E.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(Kn,{size:16,className:"text-yellow-500"}),n.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Outstanding Payments"}),n.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",E.length,")"]})]}),n.jsx("div",{className:"space-y-2",children:E.map(e=>n.jsx(db,{payment:e,onTap:A,formatCurrency:M,getStatusIcon:T},e.id))})]}),D.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx($n,{size:16,className:"text-green-500"}),n.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Completed Payments"}),n.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",D.length,")"]})]}),n.jsx("div",{className:"space-y-2",children:D.map(e=>n.jsx(db,{payment:e,onTap:A,formatCurrency:M,getStatusIcon:T},e.id))})]})]})}),n.jsxs("div",{className:"sticky bottom-0 px-4 py-2 pb-[env(safe-area-inset-bottom)] bg-gradient-to-t from-black via-black to-transparent border-t border-border",children:["free"===v&&S>0&&-1!==S&&n.jsxs("div",{className:"text-center text-xs text-blue-400 mb-2",children:[S," of 5 payment requests remaining"]}),C||"free"!==v?n.jsxs("button",{onClick:async()=>{await bo.medium(),i(!0)},className:"w-full bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 text-primary-foreground font-medium py-4 rounded-xl transition-all active:scale-[0.98] shadow-lg flex items-center justify-center gap-2 min-h-[44px]",children:[n.jsx(vn,{size:20}),"Add Payment Request"]}):n.jsxs("button",{onClick:async()=>{await bo.light(),y("explorer","monthly")},className:"w-full bg-gradient-to-r from-amber-600 to-amber-500 text-white font-medium py-4 rounded-xl transition-all active:scale-[0.98] shadow-lg flex items-center justify-center gap-2 min-h-[44px]",children:[n.jsx($e,{size:20}),"Upgrade for Unlimited Payments"]})]}),n.jsx(rb,{isOpen:r,onClose:()=>i(!1),tripId:e,tripMembers:s,onPaymentCreated:P})]})},db=({payment:e,onTap:t,formatCurrency:a,getStatusIcon:r})=>n.jsx("button",{onClick:()=>t(e.id),className:"w-full border rounded-xl p-3 transition-all active:scale-[0.98] text-left "+(e.isSettled?"bg-green-500/5 border-green-500/20 hover:bg-green-500/10":"bg-card/50 border-border hover:bg-card/80"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsxs(Vn,{className:"w-9 h-9",children:[n.jsx(Hn,{src:e.payerAvatar,alt:e.payer}),n.jsx(Wn,{className:"bg-primary/20 text-primary font-semibold text-xs",children:St(e.payer)})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:e.description}),n.jsxs("p",{className:"text-xs text-muted-foreground",children:["Paid by ",e.payer]})]}),n.jsxs("div",{className:"text-right flex-shrink-0",children:[n.jsx("p",{className:"text-sm font-semibold text-foreground",children:a(e.amount,e.currency)}),n.jsxs("p",{className:"text-xs text-muted-foreground",children:[a(e.amount/e.splitCount,e.currency)," each"]})]})]}),n.jsxs("div",{className:"flex items-center justify-between mt-1.5",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[r(e.status),n.jsx("span",{className:"text-xs "+(e.isSettled?"text-green-500":"text-yellow-500"),children:e.isSettled?"Settled":"Pending"})]}),n.jsxs("span",{className:"text-xs text-muted-foreground",children:["Split ",e.splitCount," ways"]})]})]})]})}),ub=({eventId:e,userRole:t,pdfScheduleUrl:a})=>{const[r,i]=L.useState(a),[s,o]=L.useState(!1),[l,c]=L.useState([]),[d,u]=L.useState(!1),{toast:m}=ue(),[p,h]=L.useState({title:"",time:"",endTime:"",location:"",description:""}),g="organizer"===t;return n.jsxs("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(dn,{size:24,className:"text-blue-400 flex-shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-lg md:text-xl font-semibold text-foreground",children:"Event Agenda"}),n.jsx("p",{className:"text-muted-foreground text-sm",children:"View the full event schedule"})]})]}),g&&!d&&n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[!r&&n.jsxs("label",{className:"flex-1 sm:flex-none",children:[n.jsx("input",{type:"file",accept:".pdf",onChange:async e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];if(n){o(!0);try{const e=URL.createObjectURL(n);i(e),m({title:"PDF uploaded successfully",description:"Attendees can now download the schedule"})}catch(a){m({title:"Upload failed",variant:"destructive"})}finally{o(!1)}}},className:"hidden",disabled:s}),n.jsxs(Q,{variant:"outline",className:"w-full sm:w-auto border-border cursor-pointer",disabled:s,type:"button",children:[n.jsx(pn,{size:16,className:"mr-2"}),s?"Uploading...":"Upload PDF"]})]}),n.jsxs(Q,{onClick:()=>u(!0),className:"flex-1 sm:flex-none bg-primary hover:bg-primary/90",children:[n.jsx(vn,{size:16,className:"mr-2"}),"Add Session"]})]})]}),r&&n.jsx(lt,{className:"bg-card/50 border-border",children:n.jsx(ct,{className:"p-4 md:p-6",children:n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Re,{size:32,className:"text-red-400 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-medium text-foreground",children:"Full Event Schedule (PDF)"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Complete agenda with all details"})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("a",{href:r,download:"Event_Schedule.pdf",target:"_blank",rel:"noopener noreferrer",className:"flex-1 sm:flex-none",children:n.jsxs(Q,{variant:"outline",className:"w-full sm:w-auto border-border",children:[n.jsx(Oe,{size:16,className:"mr-2"}),"Download"]})}),g&&n.jsx(Q,{onClick:()=>{confirm("Remove uploaded PDF schedule?")&&i(void 0)},variant:"outline",className:"border-destructive text-destructive hover:bg-destructive/10",children:n.jsx(ie,{size:16})})]})]})})}),r&&l.length>0&&n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-0 flex items-center",children:n.jsx("div",{className:"w-full border-t border-border"})}),n.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:n.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or view by session"})})]}),d&&g&&n.jsx(lt,{className:"bg-card/50 border-border",children:n.jsxs(ct,{className:"p-4 md:p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h3",{className:"font-medium text-foreground",children:"Add Session to Agenda"}),n.jsx(Q,{onClick:()=>{u(!1),h({title:"",time:"",endTime:"",location:"",description:""})},variant:"ghost",size:"sm",children:"Cancel"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ot,{htmlFor:"session-title",children:"Session Title *"}),n.jsx(st,{id:"session-title",value:p.title,onChange:e=>h(t=>({...t,title:e.target.value})),placeholder:"e.g., Keynote: The Future of AI",className:"bg-background border-border"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ot,{htmlFor:"session-location",children:"Location *"}),n.jsx(st,{id:"session-location",value:p.location,onChange:e=>h(t=>({...t,location:e.target.value})),placeholder:"e.g., Main Hall, Room 301",className:"bg-background border-border"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ot,{htmlFor:"session-time",children:"Start Time *"}),n.jsx(st,{id:"session-time",type:"time",value:p.time,onChange:e=>h(t=>({...t,time:e.target.value})),className:"bg-background border-border"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ot,{htmlFor:"session-endtime",children:"End Time"}),n.jsx(st,{id:"session-endtime",type:"time",value:p.endTime,onChange:e=>h(t=>({...t,endTime:e.target.value})),className:"bg-background border-border"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ot,{htmlFor:"session-description",children:"Description (Optional)"}),n.jsx(xn,{id:"session-description",value:p.description,onChange:e=>h(t=>({...t,description:e.target.value})),placeholder:"Brief description of the session...",className:"bg-background border-border",rows:3})]}),n.jsxs(Q,{onClick:()=>{if(!p.title||!p.time||!p.location)return void m({title:"Missing required fields",description:"Please fill in title, time, and location",variant:"destructive"});const e={id:Date.now().toString(),title:p.title,time:p.time,endTime:p.endTime,location:p.location,description:p.description};c(t=>[...t,e].sort((e,t)=>e.time.localeCompare(t.time))),h({title:"",time:"",endTime:"",location:"",description:""}),u(!1),m({title:"Session added",description:"The session will auto-sync with the Calendar tab"})},className:"w-full bg-primary hover:bg-primary/90",disabled:!p.title||!p.time||!p.location,children:[n.jsx(Zn,{size:16,className:"mr-2"}),"Add Session"]})]})}),l.length>0&&n.jsxs("div",{className:"space-y-3",children:[n.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Schedule"}),l.map(e=>n.jsx(lt,{className:"bg-card/50 border-border hover:bg-card/70 transition-colors",children:n.jsx(ct,{className:"p-4",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-foreground font-medium mb-2 truncate",children:e.title}),n.jsxs("div",{className:"space-y-1 text-sm",children:[n.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[n.jsx(Kn,{size:14,className:"flex-shrink-0"}),n.jsxs("span",{children:[e.time,e.endTime&&` - ${e.endTime}`]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[n.jsx(Un,{size:14,className:"flex-shrink-0"}),n.jsx("span",{className:"truncate",children:e.location})]}),e.description&&n.jsx("p",{className:"text-muted-foreground/70 mt-2 line-clamp-2",children:e.description})]})]}),g&&n.jsx(Q,{onClick:()=>{return t=e.id,c(e=>e.filter(e=>e.id!==t)),void m({title:"Session removed"});var t},variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10 flex-shrink-0",children:n.jsx(ie,{size:16})})]})})},e.id))]}),!r&&0===l.length&&!d&&n.jsx(lt,{className:"bg-card/50 border-border",children:n.jsxs(ct,{className:"py-12 px-6 text-center",children:[n.jsx(dn,{size:48,className:"text-muted-foreground/50 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No Agenda Yet"}),n.jsx("p",{className:"text-muted-foreground text-sm max-w-xs mx-auto",children:g?"Use the buttons above to upload a PDF schedule or add sessions manually":"The event organizer hasn't added an agenda yet"})]})})]})},mb=({speakers:e,userRole:t})=>{const[a,r]=L.useState(""),[i,s]=L.useState(null),o=e.filter(e=>{var t,n;return e.name.toLowerCase().includes(a.toLowerCase())||(null==(t=e.title)?void 0:t.toLowerCase().includes(a.toLowerCase()))||(null==(n=e.company)?void 0:n.toLowerCase().includes(a.toLowerCase()))});return n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(ln,{size:24,className:"text-orange-400"}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-semibold text-white",children:"Line-up"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Speakers, artists, and presenters at this event"})]})]}),n.jsxs("div",{className:"relative",children:[n.jsx($t,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),n.jsx(st,{value:a,onChange:e=>r(e.target.value),placeholder:"Search by name, title, or company...",className:"pl-10 bg-gray-800/50 border-gray-700 text-white"})]}),o.length>0?n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(e=>n.jsx(lt,{className:"bg-gray-800/50 border-gray-700 hover:bg-gray-800/70 transition-colors cursor-pointer",onClick:()=>s(e),children:n.jsx(ct,{className:"p-4",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-orange-500 to-pink-500 flex items-center justify-center flex-shrink-0 overflow-hidden",children:e.avatar?n.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full object-cover"}):n.jsx(xa,{size:20,className:"text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-white font-medium truncate",children:e.name}),e.title&&n.jsx("p",{className:"text-gray-400 text-sm truncate",children:e.title}),e.company&&n.jsx("p",{className:"text-orange-400 text-xs truncate",children:e.company})]})]})})},e.id))}):0===e.length?n.jsx(lt,{className:"bg-gray-800/50 border-gray-700",children:n.jsxs(ct,{className:"p-12 text-center",children:[n.jsx(ln,{size:48,className:"text-gray-600 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Line-up Yet"}),n.jsx("p",{className:"text-gray-400",children:"Speakers and performers will be announced soon"})]})}):n.jsx(lt,{className:"bg-gray-800/50 border-gray-700",children:n.jsxs(ct,{className:"p-8 text-center",children:[n.jsx($t,{size:32,className:"text-gray-600 mx-auto mb-3"}),n.jsxs("p",{className:"text-gray-400",children:['No results found for "',a,'"']})]})}),i&&n.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>s(null),children:n.jsx(lt,{className:"bg-gray-900 border-gray-700 max-w-lg w-full max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:n.jsxs(ct,{className:"p-6",children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-orange-500 to-pink-500 flex items-center justify-center overflow-hidden",children:i.avatar?n.jsx("img",{src:i.avatar,alt:i.name,className:"w-full h-full object-cover"}):n.jsx(xa,{size:28,className:"text-white"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-semibold text-white",children:i.name}),i.title&&n.jsx("p",{className:"text-gray-400",children:i.title}),i.company&&n.jsx("p",{className:"text-orange-400 text-sm",children:i.company})]})]}),n.jsx(Q,{onClick:()=>s(null),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white",children:n.jsx(ae,{size:20})})]}),i.bio&&n.jsxs("div",{className:"mb-4",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"About"}),n.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:i.bio})]}),i.sessions&&i.sessions.length>0&&n.jsxs("div",{children:[n.jsxs("h3",{className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[n.jsx(dn,{size:14}),"Sessions"]}),n.jsx("div",{className:"space-y-2",children:i.sessions.map((e,t)=>n.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3 text-sm text-gray-300",children:["Session ",t+1]},e))})]})]})})})]})},pb=[{id:"1",title:"Pick up your badge at the registration desk",description:"Located in the main lobby, open from 8:00 AM",sort_order:0},{id:"2",title:"Visit the welcome booth for your event kit",description:"Includes schedule, map, and swag bag",sort_order:1},{id:"3",title:"Download the event app for real-time updates",description:"Use the link provided at registration",sort_order:2},{id:"4",title:"Check in for your reserved sessions",description:"Some sessions require advance check-in",sort_order:3},{id:"5",title:"Complete the feedback survey after each session",description:"Help us improve future events",sort_order:4}],hb=({eventId:e,isAdmin:t})=>{const{isDemoMode:a}=X(),{toast:r}=ue(),[i,s]=L.useState(a?pb:[]),[o,l]=L.useState(!1),[c,d]=L.useState(null),[u,m]=L.useState({title:"",description:""}),[p,h]=L.useState({title:"",description:""});return n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(sa,{size:24,className:"text-orange-400"}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-semibold text-white",children:"Event Tasks"}),n.jsx("p",{className:"text-gray-400 text-sm",children:t?"Manage attendee action items":"Things to do at this event"})]})]}),t&&!o&&n.jsxs(Q,{onClick:()=>l(!0),className:"bg-orange-600 hover:bg-orange-700",children:[n.jsx(vn,{size:16,className:"mr-2"}),"Add Task"]})]}),o&&t&&n.jsx(lt,{className:"bg-gray-800/50 border-gray-700",children:n.jsxs(ct,{className:"p-4 space-y-3",children:[n.jsx(st,{value:u.title,onChange:e=>m(t=>({...t,title:e.target.value})),placeholder:"Task title (e.g., Pick up badge at registration)",className:"bg-gray-900 border-gray-700 text-white"}),n.jsx(xn,{value:u.description,onChange:e=>m(t=>({...t,description:e.target.value})),placeholder:"Optional description or instructions...",className:"bg-gray-900 border-gray-700 text-white",rows:2}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx(Q,{onClick:()=>{l(!1),m({title:"",description:""})},variant:"ghost",children:"Cancel"}),n.jsx(Q,{onClick:()=>{if(!u.title.trim())return void r({title:"Task title is required",variant:"destructive"});const e={id:Date.now().toString(),title:u.title.trim(),description:u.description.trim()||void 0,sort_order:i.length};s(t=>[...t,e]),m({title:"",description:""}),l(!1),r({title:"Task added successfully"})},className:"bg-orange-600 hover:bg-orange-700",children:"Add Task"})]})]})}),i.length>0?n.jsx("div",{className:"space-y-2",children:i.map((e,a)=>n.jsx(lt,{className:"bg-gray-800/50 border-gray-700 hover:bg-gray-800/70 transition-colors",children:n.jsx(ct,{className:"p-4",children:c===e.id&&t?n.jsxs("div",{className:"space-y-3",children:[n.jsx(st,{value:p.title,onChange:e=>h(t=>({...t,title:e.target.value})),className:"bg-gray-900 border-gray-700 text-white"}),n.jsx(xn,{value:p.description,onChange:e=>h(t=>({...t,description:e.target.value})),className:"bg-gray-900 border-gray-700 text-white",rows:2}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx(Q,{onClick:()=>d(null),variant:"ghost",size:"sm",children:n.jsx(ae,{size:16})}),n.jsx(Q,{onClick:()=>{return t=e.id,void(p.title.trim()?(s(e=>e.map(e=>e.id===t?{...e,title:p.title.trim(),description:p.description.trim()||void 0}:e)),d(null),r({title:"Task updated"})):r({title:"Task title is required",variant:"destructive"}));var t},size:"sm",className:"bg-green-600 hover:bg-green-700",children:n.jsx(Qt,{size:16})})]})]}):n.jsxs("div",{className:"flex items-start gap-3",children:[t&&n.jsx("div",{className:"text-gray-500 cursor-grab mt-1",children:n.jsx(ua,{size:16})}),n.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-orange-600/20 border border-orange-500/50 flex items-center justify-center mt-0.5",children:n.jsx("span",{className:"text-orange-400 text-xs font-medium",children:a+1})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-white font-medium",children:e.title}),e.description&&n.jsx("p",{className:"text-gray-400 text-sm mt-1",children:e.description})]}),t&&n.jsxs("div",{className:"flex gap-1",children:[n.jsx(Q,{onClick:()=>(e=>{d(e.id),h({title:e.title,description:e.description||""})})(e),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white",children:n.jsx(Gt,{size:14})}),n.jsx(Q,{onClick:()=>{return t=e.id,s(e=>e.filter(e=>e.id!==t)),void r({title:"Task removed"});var t},variant:"ghost",size:"sm",className:"text-red-400 hover:text-red-300",children:n.jsx(ie,{size:14})})]})]})})},e.id))}):n.jsx(lt,{className:"bg-gray-800/50 border-gray-700",children:n.jsxs(ct,{className:"p-12 text-center",children:[n.jsx(sa,{size:48,className:"text-gray-600 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Tasks Yet"}),n.jsx("p",{className:"text-gray-400 mb-4",children:t?"Add tasks for attendees to complete during the event":"The organizer hasn't added any tasks yet"}),t&&n.jsxs(Q,{onClick:()=>l(!0),className:"bg-orange-600 hover:bg-orange-700",children:[n.jsx(vn,{size:16,className:"mr-2"}),"Add First Task"]})]})})]})},gb=e=>{const{user:t}=Y(),[n,a]=L.useState([]),[r,i]=L.useState(!1),[s,o]=L.useState(!0),[l,c]=L.useState(new Map),d=L.useCallback(async()=>{if((null==t?void 0:t.id)&&e)try{o(!0);const{data:n,error:r}=await W.from("user_trip_roles").select("\n          id,\n          role_id,\n          is_primary,\n          trip_roles:role_id (\n            id,\n            role_name\n          )\n        ").eq("trip_id",e).eq("user_id",t.id);if(r)return void o(!1);const s=(n||[]).map(e=>{var t;return{roleId:e.role_id,roleName:(null==(t=e.trip_roles)?void 0:t.role_name)||"Unknown",isPrimary:e.is_primary??!0}});a(s);const{data:l,error:c}=await W.from("trip_admins").select("id").eq("trip_id",e).eq("user_id",t.id).single();i(!!l&&!c),await u(s)}catch(n){}finally{o(!1)}else o(!1)},[null==t?void 0:t.id,e]),u=L.useCallback(async n=>{if((null==t?void 0:t.id)&&e)try{const{data:t,error:a}=await W.from("trip_channels").select("\n          id,\n          channel_name,\n          channel_slug,\n          is_private,\n          channel_role_access:channel_role_access (\n            role_id\n          )\n        ").eq("trip_id",e).eq("is_archived",!1);if(a)return;const i=new Map,s=n.map(e=>e.roleId);for(const e of t||[]){const t=(e.channel_role_access||[]).map(e=>e.role_id);(s.some(e=>t.includes(e))||r)&&i.set(e.id,{channelId:e.id,canView:!0,canEdit:r||n.some(e=>e.isPrimary&&t.includes(e.roleId)),canPost:!0})}c(i)}catch(a){}},[null==t?void 0:t.id,e,r]),m=L.useCallback(async e=>{if(!(null==t?void 0:t.id))return!1;if(r)return!0;try{const{data:n,error:a}=await W.rpc("can_access_channel",{_user_id:t.id,_channel_id:e});return!a&&!!n}catch(n){return!1}},[null==t?void 0:t.id,r]),p=L.useCallback(async n=>{if(!(null==t?void 0:t.id)||!e)return!1;try{const{data:a,error:r}=await W.rpc("has_admin_permission",{_user_id:t.id,_trip_id:e,_permission:n});return!r&&!!a}catch(a){return!1}},[null==t?void 0:t.id,e]);return L.useEffect(()=>{d()},[d]),{userRoles:n,isAdmin:r,isLoading:s,channelPermissions:l,canAccessChannel:m,hasAdminPermission:p,refreshPermissions:d}},fb=({activeTab:e,onTabChange:t,tripId:a,basecamp:r,variant:i="consumer",participants:s=[],tripData:o,eventData:l})=>{const{accentColors:c}=be(),{isDemoMode:d}=X(),u=L.useRef(null),m=L.useRef(null),p=Ke(o||{}),[h,g]=L.useState(0),f=L.useCallback(()=>{g(e=>e+1)},[]),{isAdmin:x}=gb("event"===i?a:""),v=(()=>{if("event"===i)return[{id:"agenda",label:"Agenda",icon:dn,enabled:!0},{id:"calendar",label:"Calendar",icon:dn,enabled:!0},{id:"chat",label:"Chat",icon:Ct,enabled:p.showChat},{id:"media",label:"Media",icon:yn,enabled:p.showMedia},{id:"lineup",label:"Line-up",icon:ln,enabled:!0},{id:"polls",label:"Polls",icon:Gn,enabled:p.showPolls},{id:"tasks",label:"Tasks",icon:sa,enabled:!0}];return[{id:"chat",label:"Chat",icon:Ct,enabled:p.showChat},{id:"calendar",label:"Calendar",icon:dn,enabled:p.showCalendar},{id:"concierge",label:"Concierge",icon:pt,enabled:p.showConcierge},{id:"media",label:"Media",icon:yn,enabled:p.showMedia},{id:"payments",label:"Payments",icon:At,enabled:p.showPayments},{id:"places",label:"Places",icon:Un,enabled:p.showPlaces},{id:"polls",label:"Polls",icon:Gn,enabled:p.showPolls},{id:"tasks",label:"Tasks",icon:sa,enabled:p.showTasks}]})();L.useEffect(()=>{if(m.current){const t=m.current.querySelector(`[data-tab="${e}"]`);t&&t.scrollIntoView({behavior:"smooth",inline:"start",block:"nearest"})}const t=()=>{const e=m.current,t=null==e?void 0:e.parentElement,n=((null==t?void 0:t.offsetHeight)??(null==e?void 0:e.offsetHeight))||52;document.documentElement.style.setProperty("--mobile-tabs-h",`${n}px`)};let n;const a=()=>{clearTimeout(n),n=setTimeout(t,100)};return t(),window.addEventListener("resize",a),window.addEventListener("orientationchange",a),()=>{window.removeEventListener("resize",a),window.removeEventListener("orientationchange",a)}},[e]);return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"sticky top-[var(--mobile-header-h,73px)] z-40 bg-black/95 backdrop-blur-md border-b border-white/10",children:n.jsx("div",{ref:m,className:"flex overflow-x-auto scrollbar-hide gap-2 px-4 py-2",style:{scrollbarWidth:"none",msOverflowStyle:"none",scrollSnapType:"x mandatory",WebkitOverflowScrolling:"touch"},children:v.map(a=>{const r=a.icon,i=e===a.id,s=a.enabled;return n.jsxs("button",{"data-tab":a.id,onClick:()=>(async(e,n)=>{n?(await bo.light(),t(e)):ee.info("This feature is disabled for this trip",{description:"Contact trip admin to enable this feature"})})(a.id,s),className:`\n                  flex items-center justify-center gap-2 \n                  px-4 py-2 min-w-max h-[44px]\n                  rounded-lg font-medium text-sm\n                  transition-all duration-200\n                  flex-shrink-0\n                  scroll-snap-align-start\n                  ${s?"active:scale-95":""}\n                  ${i&&s?`bg-gradient-to-r ${c.gradient} text-white shadow-lg`:s?"bg-white/10 text-gray-300":"bg-white/5 text-gray-500 opacity-40 grayscale cursor-not-allowed"}\n                `,children:[n.jsx(r,{size:16,className:"flex-shrink-0"}),n.jsx("span",{className:"whitespace-nowrap text-sm",children:a.label}),!s&&n.jsx($e,{size:12,className:"ml-1 flex-shrink-0"})]},a.id)})})}),n.jsx("div",{ref:u,className:"bg-background flex flex-col min-h-0 flex-1",style:{height:"calc(100dvh - var(--mobile-header-h, 73px) - var(--mobile-tabs-h, 52px))",WebkitOverflowScrolling:"touch"},children:n.jsx(Pe,{compact:!0,onRetry:f,children:(()=>{switch(e){case"agenda":return n.jsx(ub,{eventId:a,userRole:x?"organizer":"attendee"});case"lineup":return n.jsx(mb,{speakers:(null==l?void 0:l.speakers)||[],userRole:"attendee"});case"tasks":return"event"===i?n.jsx(hb,{eventId:a,isAdmin:x}):n.jsx(sf,{tripId:a});case"chat":return n.jsx(yg,{tripId:a,isPro:"pro"===i,isEvent:"event"===i,participants:s});case"calendar":return n.jsx(Sg,{tripId:a});case"polls":return n.jsx(gf,{tripId:a});case"media":return n.jsx(Mf,{tripId:a});case"places":return n.jsx(zy,{tripId:a});case"payments":return n.jsx(cb,{tripId:a});case"concierge":return n.jsx(Jy,{tripId:a,basecamp:r,isDemoMode:d});default:return n.jsx(ab,{tripId:a})}})()},`${e}-${h}`)})]})};class xb extends L.Component{constructor(e){super(e),t(this,"handleReset",async()=>{await bo.light(),this.setState({hasError:!1,error:void 0})}),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){bo.heavy()}render(){var e;return this.state.hasError?this.props.fallback?this.props.fallback:n.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-black p-6",children:n.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-6 max-w-md",children:[n.jsx(Se,{className:"text-red-400 mx-auto mb-4",size:48}),n.jsx("h2",{className:"text-xl font-bold text-white text-center mb-2",children:"Something went wrong"}),n.jsx("p",{className:"text-gray-400 text-center mb-6 text-sm",children:(null==(e=this.state.error)?void 0:e.message)||"An unexpected error occurred"}),n.jsxs("button",{onClick:this.handleReset,className:"w-full bg-blue-600 text-white py-3 rounded-xl flex items-center justify-center gap-2 active:scale-95 transition-transform",children:[n.jsx(fe,{size:20}),n.jsx("span",{children:"Try Again"})]})]})}):this.props.children}}const vb=$.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),yb=()=>{const e=$.useContext(vb);if(!e)throw new Error("useDrawerContext must be used within a Drawer.Root");return e};!function(e){if("undefined"==typeof document)return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}("[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(\n[data-state=closed]\n){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}");const bb="undefined"!=typeof window?L.useLayoutEffect:L.useEffect;function wb(...e){return(...t)=>{for(let n of e)"function"==typeof n&&n(...t)}}function jb(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Nb(){return kb(/^iPad/)||kb(/^Mac/)&&navigator.maxTouchPoints>1}function _b(){return kb(/^iPhone/)||Nb()}function kb(e){return"undefined"!=typeof window&&null!=window.navigator?e.test(window.navigator.platform):void 0}const Sb="undefined"!=typeof document&&window.visualViewport;function Cb(e){let t=window.getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowX+t.overflowY)}function Eb(e){for(Cb(e)&&(e=e.parentElement);e&&!Cb(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement}const Db=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Pb,Ab=0;function Tb(e={}){let{isDisabled:t}=e;bb(()=>{if(!t)return Ab++,1===Ab&&_b()&&(Pb=function(){let e,t=0,n=n=>{e=Eb(n.target),e===document.documentElement&&e===document.body||(t=n.changedTouches[0].pageY)},a=n=>{if(!e||e===document.documentElement||e===document.body)return void n.preventDefault();let a=n.changedTouches[0].pageY,r=e.scrollTop,i=e.scrollHeight-e.clientHeight;0!==i&&((r<=0&&a>t||r>=i&&a<t)&&n.preventDefault(),t=a)},r=e=>{let t=e.target;Ib(t)&&t!==document.activeElement&&(e.preventDefault(),t.style.transform="translateY(-2000px)",t.focus(),requestAnimationFrame(()=>{t.style.transform=""}))},i=e=>{let t=e.target;Ib(t)&&(t.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{t.style.transform="",Sb&&(Sb.height<window.innerHeight?requestAnimationFrame(()=>{Rb(t)}):Sb.addEventListener("resize",()=>Rb(t),{once:!0}))}))},s=()=>{window.scrollTo(0,0)},o=window.pageXOffset,l=window.pageYOffset,c=wb(function(e,t,n){let a=e.style[t];return e.style[t]=n,()=>{e.style[t]=a}}(document.documentElement,"paddingRight",window.innerWidth-document.documentElement.clientWidth+"px"));window.scrollTo(0,0);let d=wb(Mb(document,"touchstart",n,{passive:!1,capture:!0}),Mb(document,"touchmove",a,{passive:!1,capture:!0}),Mb(document,"touchend",r,{passive:!1,capture:!0}),Mb(document,"focus",i,!0),Mb(window,"scroll",s));return()=>{c(),d(),window.scrollTo(o,l)}}()),()=>{Ab--,0===Ab&&(null==Pb||Pb())}},[t])}function Mb(e,t,n,a){return e.addEventListener(t,n,a),()=>{e.removeEventListener(t,n,a)}}function Rb(e){let t=document.scrollingElement||document.documentElement;for(;e&&e!==t;){let t=Eb(e);if(t!==document.documentElement&&t!==document.body&&t!==e){let n=t.getBoundingClientRect().top,a=e.getBoundingClientRect().top;e.getBoundingClientRect().bottom>t.getBoundingClientRect().bottom+24&&(t.scrollTop+=a-n)}e=t.parentElement}}function Ib(e){return e instanceof HTMLInputElement&&!Db.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}function Ob(...e){return L.useCallback(function(...e){return t=>e.forEach(e=>function(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}(e,t))}(...e),e)}const Lb=new WeakMap;function Fb(e,t,n=!1){if(!(e&&e instanceof HTMLElement))return;let a={};Object.entries(t).forEach(([t,n])=>{t.startsWith("--")?e.style.setProperty(t,n):(a[t]=e.style[t],e.style[t]=n)}),n||Lb.set(e,a)}const Ub=e=>{switch(e){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return e}};function zb(e,t){if(!e)return null;const n=window.getComputedStyle(e),a=n.transform||n.webkitTransform||n.mozTransform;let r=a.match(/^matrix3d\((.+)\)$/);return r?parseFloat(r[1].split(", ")[Ub(t)?13:12]):(r=a.match(/^matrix\((.+)\)$/),r?parseFloat(r[1].split(", ")[Ub(t)?5:4]):null)}function $b(e,t){if(!e)return()=>{};const n=e.style.cssText;return Object.assign(e.style,t),()=>{e.style.cssText=n}}const Bb={DURATION:.5,EASE:[.32,.72,0,1]},qb=16,Vb="vaul-dragging";function Hb(e){const t=$.useRef(e);return $.useEffect(()=>{t.current=e}),$.useMemo(()=>(...e)=>null==t.current?void 0:t.current.call(t,...e),[])}function Wb({prop:e,defaultProp:t,onChange:n=()=>{}}){const[a,r]=function({defaultProp:e,onChange:t}){const n=$.useState(e),[a]=n,r=$.useRef(a),i=Hb(t);return $.useEffect(()=>{r.current!==a&&(i(a),r.current=a)},[a,r,i]),n}({defaultProp:t,onChange:n}),i=void 0!==e,s=i?e:a,o=Hb(n);return[s,$.useCallback(t=>{if(i){const n="function"==typeof t?t(e):t;n!==e&&o(n)}else r(t)},[i,e,r,o])]}let Yb=null;function Kb({open:e,onOpenChange:t,children:n,onDrag:a,onRelease:r,snapPoints:i,shouldScaleBackground:s=!1,setBackgroundColorOnScale:o=!0,closeThreshold:l=.25,scrollLockTimeout:c=100,dismissible:d=!0,handleOnly:u=!1,fadeFromIndex:m=i&&i.length-1,activeSnapPoint:p,setActiveSnapPoint:h,fixed:g,modal:f=!0,onClose:x,nested:v,noBodyStyles:y,direction:b="bottom",defaultOpen:w=!1,disablePreventScroll:j=!0,snapToSequentialPoint:N=!1,preventScrollRestoration:_=!1,repositionInputs:k=!0,onAnimationEnd:S,container:C,autoFocus:E=!1}){var D,P;const[A=!1,M]=Wb({defaultProp:w,prop:e,onChange:e=>{null==t||t(e),e||v||de(),setTimeout(()=>{null==S||S(e)},1e3*Bb.DURATION),e&&!f&&"undefined"!=typeof window&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),e||(document.body.style.pointerEvents="auto")}}),[R,I]=$.useState(!1),[O,L]=$.useState(!1),[F,U]=$.useState(!1),z=$.useRef(null),B=$.useRef(null),q=$.useRef(null),V=$.useRef(null),H=$.useRef(null),W=$.useRef(!1),Y=$.useRef(null),K=$.useRef(0),G=$.useRef(!1),Q=$.useRef(0),X=$.useRef(null),Z=$.useRef((null==(D=X.current)?void 0:D.getBoundingClientRect().height)||0),J=$.useRef((null==(P=X.current)?void 0:P.getBoundingClientRect().width)||0),ee=$.useRef(0),te=$.useCallback(e=>{i&&e===se.length-1&&(B.current=new Date)},[]),{activeSnapPoint:ne,activeSnapPointIndex:ae,setActiveSnapPoint:re,onRelease:ie,snapPointsOffset:se,onDrag:oe,shouldFade:le,getPercentageDragged:ce}=function({activeSnapPointProp:e,setActiveSnapPointProp:t,snapPoints:n,drawerRef:a,overlayRef:r,fadeFromIndex:i,onSnapPointChange:s,direction:o="bottom",container:l,snapToSequentialPoint:c}){const[d,u]=Wb({prop:e,defaultProp:null==n?void 0:n[0],onChange:t}),[m,p]=$.useState("undefined"!=typeof window?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);$.useEffect(()=>{function e(){p({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const h=$.useMemo(()=>d===(null==n?void 0:n[n.length-1])||null,[n,d]),g=$.useMemo(()=>null==n?void 0:n.findIndex(e=>e===d),[n,d]),f=n&&n.length>0&&(i||0===i)&&!Number.isNaN(i)&&n[i]===d||!n,x=$.useMemo(()=>{const e=l?{width:l.getBoundingClientRect().width,height:l.getBoundingClientRect().height}:"undefined"!=typeof window?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var t;return null!=(t=null==n?void 0:n.map(t=>{const n="string"==typeof t;let a=0;if(n&&(a=parseInt(t,10)),Ub(o)){const r=n?a:m?t*e.height:0;return m?"bottom"===o?e.height-r:-e.height+r:r}const r=n?a:m?t*e.width:0;return m?"right"===o?e.width-r:-e.width+r:r}))?t:[]},[n,m,l]),v=$.useMemo(()=>null!==g?null==x?void 0:x[g]:null,[x,g]),y=$.useCallback(e=>{var t;const l=null!=(t=null==x?void 0:x.findIndex(t=>t===e))?t:null;s(l),Fb(a.current,{transition:`transform ${Bb.DURATION}s cubic-bezier(${Bb.EASE.join(",")})`,transform:Ub(o)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`}),x&&l!==x.length-1&&l!==i&&l<i?Fb(r.current,{transition:`opacity ${Bb.DURATION}s cubic-bezier(${Bb.EASE.join(",")})`,opacity:"0"}):Fb(r.current,{transition:`opacity ${Bb.DURATION}s cubic-bezier(${Bb.EASE.join(",")})`,opacity:"1"}),u(null==n?void 0:n[Math.max(l,0)])},[a.current,n,x,i,r,u]);return $.useEffect(()=>{if(d||e){var t;const a=null!=(t=null==n?void 0:n.findIndex(t=>t===e||t===d))?t:-1;x&&-1!==a&&"number"==typeof x[a]&&y(x[a])}},[d,e,n,x,y]),{isLastSnapPoint:h,activeSnapPoint:d,shouldFade:f,getPercentageDragged:function(e,t){if(!n||"number"!=typeof g||!x||void 0===i)return null;const a=g===i-1;if(g>=i&&t)return 0;if(a&&!t)return 1;if(!f&&!a)return null;const r=a?g+1:g-1,s=a?x[r]-x[r-1]:x[r+1]-x[r],o=e/Math.abs(s);return a?1-o:o},setActiveSnapPoint:u,activeSnapPointIndex:g,onRelease:function({draggedDistance:e,closeDrawer:t,velocity:a,dismissible:s}){if(void 0===i)return;const l="bottom"===o||"right"===o?(null!=v?v:0)-e:(null!=v?v:0)+e,d=0===g,u=e>0;if(g===i-1&&Fb(r.current,{transition:`opacity ${Bb.DURATION}s cubic-bezier(${Bb.EASE.join(",")})`}),!c&&a>2&&!u)return void(s?t():y(x[0]));if(!c&&a>2&&u&&x&&n)return void y(x[n.length-1]);const m=null==x?void 0:x.reduce((e,t)=>"number"!=typeof e||"number"!=typeof t?e:Math.abs(t-l)<Math.abs(e-l)?t:e),p=Ub(o)?window.innerHeight:window.innerWidth;if(a>.4&&Math.abs(e)<.4*p){const e=u?1:-1;if(e>0&&h)return void y(x[n.length-1]);if(d&&e<0&&s&&t(),null===g)return;return void y(x[g+e])}y(m)},onDrag:function({draggedDistance:e}){if(null===v)return;const t="bottom"===o||"right"===o?v-e:v+e;("bottom"===o||"right"===o)&&t<x[x.length-1]||("top"===o||"left"===o)&&t>x[x.length-1]||Fb(a.current,{transform:Ub(o)?`translate3d(0, ${t}px, 0)`:`translate3d(${t}px, 0, 0)`})},snapPointsOffset:x}}({snapPoints:i,activeSnapPointProp:p,setActiveSnapPointProp:h,drawerRef:X,fadeFromIndex:m,overlayRef:z,onSnapPointChange:te,direction:b,container:C,snapToSequentialPoint:N});Tb({isDisabled:!A||O||!f||F||!R||!k||!j});const{restorePositionSetting:de}=function({isOpen:e,modal:t,nested:n,hasBeenOpened:a,preventScrollRestoration:r,noBodyStyles:i}){const[s,o]=$.useState(()=>"undefined"!=typeof window?window.location.href:""),l=$.useRef(0),c=$.useCallback(()=>{if(jb()&&null===Yb&&e&&!i){Yb={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:e,innerHeight:t}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:-l.current+"px",left:-e+"px",right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const e=t-window.innerHeight;e&&l.current>=t&&(document.body.style.top=-(l.current+e)+"px")}),300)}},[e]),d=$.useCallback(()=>{if(jb()&&null!==Yb&&!i){const e=-parseInt(document.body.style.top,10),t=-parseInt(document.body.style.left,10);Object.assign(document.body.style,Yb),window.requestAnimationFrame(()=>{r&&s!==window.location.href?o(window.location.href):window.scrollTo(t,e)}),Yb=null}},[s]);return $.useEffect(()=>{function e(){l.current=window.scrollY}return e(),window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}},[]),$.useEffect(()=>{!n&&a&&(e?(!window.matchMedia("(display-mode: standalone)").matches&&c(),t||window.setTimeout(()=>{d()},500)):d())},[e,a,s,t,n,c,d]),{restorePositionSetting:d}}({isOpen:A,modal:f,nested:v,hasBeenOpened:R,preventScrollRestoration:_,noBodyStyles:y});function ue(){return(window.innerWidth-26)/window.innerWidth}function me(e,t){var n,a;let r=e;const i=null==(n=window.getSelection())?void 0:n.toString(),s=X.current?zb(X.current,b):null,o=new Date;if(r.hasAttribute("data-vaul-no-drag")||r.closest("[data-vaul-no-drag]"))return!1;if("right"===b||"left"===b)return!0;if(B.current&&o.getTime()-B.current.getTime()<500)return!1;if(null!==s&&("bottom"===b?s>0:s<0))return!0;if(i&&i.length>0)return!1;if(o.getTime()-(null==(a=H.current)?void 0:a.getTime())<c&&0===s)return H.current=o,!1;if(t)return H.current=o,!1;for(;r;){if(r.scrollHeight>r.clientHeight){if(0!==r.scrollTop)return H.current=new Date,!1;if("dialog"===r.getAttribute("role"))return!0}r=r.parentNode}return!0}function pe(e){!function(){if(!O||!X.current)return;X.current.classList.remove(Vb),W.current=!1,L(!1),V.current=new Date}(),null==x||x(),e||M(!1),setTimeout(()=>{i&&re(i[0])},1e3*Bb.DURATION)}function he(){if(!X.current)return;const e=document.querySelector("[data-vaul-drawer-wrapper]"),t=zb(X.current,b);Fb(X.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Bb.DURATION}s cubic-bezier(${Bb.EASE.join(",")})`}),Fb(z.current,{transition:`opacity ${Bb.DURATION}s cubic-bezier(${Bb.EASE.join(",")})`,opacity:"1"}),s&&t&&t>0&&A&&Fb(e,{borderRadius:"8px",overflow:"hidden",...Ub(b)?{transform:`scale(${ue()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${ue()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Bb.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Bb.EASE.join(",")})`},!0)}return $.useEffect(()=>{var e;function t(){if(!X.current||!k)return;if(Ib(document.activeElement)||G.current){var e;const t=(null==(e=window.visualViewport)?void 0:e.height)||0,n=window.innerHeight;let a=n-t;const r=X.current.getBoundingClientRect().height||0,s=r>.8*n;ee.current||(ee.current=r);const o=X.current.getBoundingClientRect().top;if(Math.abs(Q.current-a)>60&&(G.current=!G.current),i&&i.length>0&&se&&ae){a+=se[ae]||0}if(Q.current=a,r>t||G.current){const e=X.current.getBoundingClientRect().height;let n=e;e>t&&(n=t-(s?o:26)),X.current.style.height=g?e-Math.max(a,0)+"px":`${Math.max(n,t-o)}px`}else X.current.style.height=`${ee.current}px`;i&&i.length>0&&!G.current?X.current.style.bottom="0px":X.current.style.bottom=`${Math.max(a,0)}px`}}return null==(e=window.visualViewport)||e.addEventListener("resize",t),()=>{var e;return null==(e=window.visualViewport)?void 0:e.removeEventListener("resize",t)}},[ae,i,se]),$.useEffect(()=>(A&&(Fb(document.documentElement,{scrollBehavior:"auto"}),B.current=new Date),()=>{!function(e,t){if(!(e&&e instanceof HTMLElement))return;let n=Lb.get(e);n&&(e.style[t]=n[t])}(document.documentElement,"scrollBehavior")}),[A]),$.createElement(T,{defaultOpen:w,onOpenChange:e=>{(d||e)&&(e?I(!0):pe(!0),M(e))},open:A},$.createElement(vb.Provider,{value:{activeSnapPoint:ne,snapPoints:i,setActiveSnapPoint:re,drawerRef:X,overlayRef:z,onOpenChange:t,onPress:function(e){var t,n;(d||i)&&(X.current&&!X.current.contains(e.target)||(Z.current=(null==(t=X.current)?void 0:t.getBoundingClientRect().height)||0,J.current=(null==(n=X.current)?void 0:n.getBoundingClientRect().width)||0,L(!0),q.current=new Date,_b()&&window.addEventListener("touchend",()=>W.current=!1,{once:!0}),e.target.setPointerCapture(e.pointerId),K.current=Ub(b)?e.pageY:e.pageX))},onRelease:function(e){if(!O||!X.current)return;X.current.classList.remove(Vb),W.current=!1,L(!1),V.current=new Date;const t=zb(X.current,b);if(!me(e.target,!1)||!t||Number.isNaN(t))return;if(null===q.current)return;const n=V.current.getTime()-q.current.getTime(),a=K.current-(Ub(b)?e.pageY:e.pageX),s=Math.abs(a)/n;if(s>.05&&(U(!0),setTimeout(()=>{U(!1)},200)),i){return ie({draggedDistance:a*("bottom"===b||"right"===b?1:-1),closeDrawer:pe,velocity:s,dismissible:d}),void(null==r||r(e,!0))}if("bottom"===b||"right"===b?a>0:a<0)return he(),void(null==r||r(e,!0));if(s>.4)return pe(),void(null==r||r(e,!1));var o;const c=Math.min(null!=(o=X.current.getBoundingClientRect().height)?o:0,window.innerHeight);var u;const m=Math.min(null!=(u=X.current.getBoundingClientRect().width)?u:0,window.innerWidth),p="left"===b||"right"===b;if(Math.abs(t)>=(p?m:c)*l)return pe(),void(null==r||r(e,!1));null==r||r(e,!0),he()},onDrag:function(e){var t;if(X.current&&O){const n="bottom"===b||"right"===b?1:-1,r=(K.current-(Ub(b)?e.pageY:e.pageX))*n,o=r>0,l=i&&!d&&!o;if(l&&0===ae)return;const c=Math.abs(r),u=document.querySelector("[data-vaul-drawer-wrapper]");let p=c/("bottom"===b||"top"===b?Z.current:J.current);const h=ce(c,o);if(null!==h&&(p=h),l&&p>=1)return;if(!W.current&&!me(e.target,o))return;if(X.current.classList.add(Vb),W.current=!0,Fb(X.current,{transition:"none"}),Fb(z.current,{transition:"none"}),i&&oe({draggedDistance:r}),o&&!i){const e=(t=r,8*(Math.log(t+1)-2)),a=Math.min(-1*e,0)*n;return void Fb(X.current,{transform:Ub(b)?`translate3d(0, ${a}px, 0)`:`translate3d(${a}px, 0, 0)`})}const g=1-p;if((le||m&&ae===m-1)&&(null==a||a(e,p),Fb(z.current,{opacity:`${g}`,transition:"none"},!0)),u&&z.current&&s){const e=Math.min(ue()+p*(1-ue()),1),t=8-8*p,n=Math.max(0,14-14*p);Fb(u,{borderRadius:`${t}px`,transform:Ub(b)?`scale(${e}) translate3d(0, ${n}px, 0)`:`scale(${e}) translate3d(${n}px, 0, 0)`,transition:"none"},!0)}if(!i){const e=c*n;Fb(X.current,{transform:Ub(b)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`})}}},dismissible:d,handleOnly:u,isOpen:A,isDragging:O,shouldFade:le,closeDrawer:pe,onNestedDrag:function(e,t){if(t<0)return;const n=(window.innerWidth-qb)/window.innerWidth,a=n+t*(1-n),r=t*qb-16;Fb(X.current,{transform:Ub(b)?`scale(${a}) translate3d(0, ${r}px, 0)`:`scale(${a}) translate3d(${r}px, 0, 0)`,transition:"none"})},onNestedOpenChange:function(e){const t=e?(window.innerWidth-qb)/window.innerWidth:1,n=e?-16:0;Y.current&&window.clearTimeout(Y.current),Fb(X.current,{transition:`transform ${Bb.DURATION}s cubic-bezier(${Bb.EASE.join(",")})`,transform:`scale(${t}) translate3d(0, ${n}px, 0)`}),!e&&X.current&&(Y.current=setTimeout(()=>{const e=zb(X.current,b);Fb(X.current,{transition:"none",transform:Ub(b)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`})},500))},onNestedRelease:function(e,t){const n=Ub(b)?window.innerHeight:window.innerWidth,a=t?(n-qb)/n:1,r=t?-16:0;t&&Fb(X.current,{transition:`transform ${Bb.DURATION}s cubic-bezier(${Bb.EASE.join(",")})`,transform:Ub(b)?`scale(${a}) translate3d(0, ${r}px, 0)`:`scale(${a}) translate3d(${r}px, 0, 0)`})},keyboardIsOpen:G,modal:f,snapPointsOffset:se,direction:b,shouldScaleBackground:s,setBackgroundColorOnScale:o,noBodyStyles:y,container:C,autoFocus:E}},n))}const Gb=$.forwardRef(function({...e},t){const{overlayRef:n,snapPoints:a,onRelease:r,shouldFade:i,isOpen:s,modal:o}=yb(),l=Ob(t,n),c=a&&a.length>0;return o?$.createElement(S,{onMouseUp:r,ref:l,"data-vaul-overlay":"","data-vaul-snap-points":s&&c?"true":"false","data-vaul-snap-points-overlay":s&&i?"true":"false",...e}):("undefined"!=typeof window&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});Gb.displayName="Drawer.Overlay";const Qb=$.forwardRef(function({onPointerDownOutside:e,style:t,onOpenAutoFocus:n,...a},r){const{drawerRef:i,onPress:s,onRelease:o,onDrag:l,keyboardIsOpen:c,snapPointsOffset:d,modal:u,isOpen:m,direction:p,snapPoints:h,container:g,handleOnly:f,autoFocus:x}=yb(),[v,y]=$.useState(!1),b=Ob(r,i),w=$.useRef(null),j=$.useRef(null),N=$.useRef(!1),_=h&&h.length>0;!function(){const{direction:e,isOpen:t,shouldScaleBackground:n,setBackgroundColorOnScale:a,noBodyStyles:r}=yb(),i=$.useRef(null),s=L.useMemo(()=>document.body.style.backgroundColor,[]);function o(){return(window.innerWidth-26)/window.innerWidth}$.useEffect(()=>{if(t&&n){i.current&&clearTimeout(i.current);const t=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!t)return;a&&!r&&$b(document.body,{background:"black"}),$b(t,{transformOrigin:Ub(e)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Bb.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Bb.EASE.join(",")})`});const n=$b(t,{borderRadius:"8px",overflow:"hidden",...Ub(e)?{transform:`scale(${o()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${o()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{n(),i.current=window.setTimeout(()=>{s?document.body.style.background=s:document.body.style.removeProperty("background")},1e3*Bb.DURATION)}}},[t,n,s])}();function k(e){w.current=null,N.current=!1,o(e)}return $.useEffect(()=>{_&&window.requestAnimationFrame(()=>{y(!0)})},[]),$.createElement(C,{"data-vaul-drawer-direction":p,"data-vaul-drawer":"","data-vaul-delayed-snap-points":v?"true":"false","data-vaul-snap-points":m&&_?"true":"false","data-vaul-custom-container":g?"true":"false",...a,ref:b,style:d&&d.length>0?{"--snap-point-height":`${d[0]}px`,...t}:t,onPointerDown:e=>{f||(null==a.onPointerDown||a.onPointerDown.call(a,e),w.current={x:e.pageX,y:e.pageY},s(e))},onOpenAutoFocus:e=>{null==n||n(e),x||e.preventDefault()},onPointerDownOutside:t=>{null==e||e(t),u&&!t.defaultPrevented?c.current&&(c.current=!1):t.preventDefault()},onFocusOutside:e=>{u||e.preventDefault()},onPointerMove:e=>{if(j.current=e,f)return;if(null==a.onPointerMove||a.onPointerMove.call(a,e),!w.current)return;const t=e.pageY-w.current.y,n=e.pageX-w.current.x,r="touch"===e.pointerType?10:2,i=((e,t,n=0)=>{if(N.current)return!0;const a=Math.abs(e.y),r=Math.abs(e.x),i=r>a,s=["bottom","right"].includes(t)?1:-1;if("left"===t||"right"===t){if(!(e.x*s<0)&&r>=0&&r<=n)return i}else if(!(e.y*s<0)&&a>=0&&a<=n)return!i;return N.current=!0,!0})({x:n,y:t},p,r);i?l(e):(Math.abs(n)>r||Math.abs(t)>r)&&(w.current=null)},onPointerUp:e=>{null==a.onPointerUp||a.onPointerUp.call(a,e),w.current=null,N.current=!1,o(e)},onPointerOut:e=>{null==a.onPointerOut||a.onPointerOut.call(a,e),k(j.current)},onContextMenu:e=>{null==a.onContextMenu||a.onContextMenu.call(a,e),k(j.current)}})});Qb.displayName="Drawer.Content";const Xb=$.forwardRef(function({preventCycle:e=!1,children:t,...n},a){const{closeDrawer:r,isDragging:i,snapPoints:s,activeSnapPoint:o,setActiveSnapPoint:l,dismissible:c,handleOnly:d,isOpen:u,onPress:m,onDrag:p}=yb(),h=$.useRef(null),g=$.useRef(!1);function f(){window.clearTimeout(h.current),g.current=!1}return $.createElement("div",{onClick:function(){g.current?f():window.setTimeout(()=>{!function(){if(i||e||g.current)return void f();if(f(),(!s||0===s.length)&&c)return void r();if(o===s[s.length-1]&&c)return void r();const t=s.findIndex(e=>e===o);if(-1===t)return;const n=s[t+1];l(n)}()},120)},onPointerCancel:f,onPointerDown:e=>{d&&m(e),h.current=window.setTimeout(()=>{g.current=!0},250)},onPointerMove:e=>{d&&p(e)},ref:a,"data-vaul-drawer-visible":u?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},$.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},t))});Xb.displayName="Drawer.Handle";const Zb={Root:Kb,NestedRoot:function({onDrag:e,onOpenChange:t,...n}){const{onNestedDrag:a,onNestedOpenChange:r,onNestedRelease:i}=yb();if(!a)throw new Error("Drawer.NestedRoot must be placed in another drawer");return $.createElement(Kb,{nested:!0,onClose:()=>{r(!1)},onDrag:(t,n)=>{a(t,n),null==e||e(t,n)},onOpenChange:e=>{e&&r(e)},onRelease:i,...n})},Content:Qb,Overlay:Gb,Trigger:E,Portal:function(e){const t=yb(),{container:n=t.container,...a}=e;return $.createElement(M,{container:n,...a})},Handle:Xb,Close:D,Title:P,Description:A},Jb=({shouldScaleBackground:e=!0,...t})=>n.jsx(Zb.Root,{shouldScaleBackground:e,...t});Jb.displayName="Drawer";const ew=Zb.Portal,tw=Zb.Close,nw=L.forwardRef(({className:e,...t},a)=>n.jsx(Zb.Overlay,{ref:a,className:G("fixed inset-0 z-50 bg-black/80",e),...t}));nw.displayName=Zb.Overlay.displayName;const aw=L.forwardRef(({className:e,children:t,...a},r)=>n.jsxs(ew,{children:[n.jsx(nw,{}),n.jsxs(Zb.Content,{ref:r,className:G("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",e),...a,children:[n.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),t]})]}));aw.displayName="DrawerContent";const rw=({className:e,...t})=>n.jsx("div",{className:G("grid gap-1.5 p-4 text-center sm:text-left",e),...t});rw.displayName="DrawerHeader";const iw=L.forwardRef(({className:e,...t},a)=>n.jsx(Zb.Title,{ref:a,className:G("text-lg font-semibold leading-none tracking-tight",e),...t}));iw.displayName=Zb.Title.displayName;L.forwardRef(({className:e,...t},a)=>n.jsx(Zb.Description,{ref:a,className:G("text-sm text-muted-foreground",e),...t})).displayName=Zb.Description.displayName;var sw=Object.defineProperty,ow=(e,t,n)=>((e,t,n)=>t in e?sw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const lw={x:0,y:0,width:0,height:0,unit:"px"},cw=(e,t,n)=>Math.min(Math.max(e,t),n),dw=(e,t)=>e===t||e.width===t.width&&e.height===t.height&&e.x===t.x&&e.y===t.y&&e.unit===t.unit;function uw(e,t,n){return"%"===e.unit?{...lw,...e,unit:"%"}:{unit:"%",x:e.x?e.x/t*100:0,y:e.y?e.y/n*100:0,width:e.width?e.width/t*100:0,height:e.height?e.height/n*100:0}}function mw(e,t,n){return e.unit?"px"===e.unit?{...lw,...e,unit:"px"}:{unit:"px",x:e.x?e.x*t/100:0,y:e.y?e.y*n/100:0,width:e.width?e.width*t/100:0,height:e.height?e.height*n/100:0}:{...lw,...e,unit:"px"}}function pw(e,t,n,a,r,i=0,s=0,o=a,l=r){const c={...e};let d=Math.min(i,a),u=Math.min(s,r),m=Math.min(o,a),p=Math.min(l,r);t&&(t>1?(d=s?s*t:d,u=d/t,m=o*t):(u=i?i/t:u,d=u*t,p=l/t)),c.y<0&&(c.height=Math.max(c.height+c.y,u),c.y=0),c.x<0&&(c.width=Math.max(c.width+c.x,d),c.x=0);const h=a-(c.x+c.width);h<0&&(c.x=Math.min(c.x,a-d),c.width+=h);const g=r-(c.y+c.height);if(g<0&&(c.y=Math.min(c.y,r-u),c.height+=g),c.width<d&&(("sw"===n||"nw"==n)&&(c.x-=d-c.width),c.width=d),c.height<u&&(("nw"===n||"ne"==n)&&(c.y-=u-c.height),c.height=u),c.width>m&&(("sw"===n||"nw"==n)&&(c.x-=m-c.width),c.width=m),c.height>p&&(("nw"===n||"ne"==n)&&(c.y-=p-c.height),c.height=p),t){const e=c.width/c.height;if(e<t){const e=Math.max(c.width/t,u);("nw"===n||"ne"==n)&&(c.y-=e-c.height),c.height=e}else if(e>t){const e=Math.max(c.height*t,d);("sw"===n||"nw"==n)&&(c.x-=e-c.width),c.width=e}}return c}const hw={capture:!0,passive:!1};let gw=0;const fw=class e extends L.PureComponent{constructor(){super(...arguments),ow(this,"docMoveBound",!1),ow(this,"mouseDownOnCrop",!1),ow(this,"dragStarted",!1),ow(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),ow(this,"componentRef",L.createRef()),ow(this,"mediaRef",L.createRef()),ow(this,"resizeObserver"),ow(this,"initChangeCalled",!1),ow(this,"instanceId","rc-"+gw++),ow(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),ow(this,"onCropPointerDown",e=>{const{crop:t,disabled:n}=this.props,a=this.getBox();if(!t)return;const r=mw(t,a.width,a.height);if(n)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const i=e.target.dataset.ord,s=!!i;let o=e.clientX,l=e.clientY,c=r.x,d=r.y;if(i){const t=e.clientX-a.x,n=e.clientY-a.y;let s=0,u=0;"ne"===i||"e"==i?(s=t-(r.x+r.width),u=n-r.y,c=r.x,d=r.y+r.height):"se"===i||"s"===i?(s=t-(r.x+r.width),u=n-(r.y+r.height),c=r.x,d=r.y):"sw"===i||"w"==i?(s=t-r.x,u=n-(r.y+r.height),c=r.x+r.width,d=r.y):("nw"===i||"n"==i)&&(s=t-r.x,u=n-r.y,c=r.x+r.width,d=r.y+r.height),o=c+a.x+s,l=d+a.y+u}this.evData={startClientX:o,startClientY:l,startCropX:c,startCropY:d,clientX:e.clientX,clientY:e.clientY,isResize:s,ord:i},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),ow(this,"onComponentPointerDown",e=>{const{crop:t,disabled:n,locked:a,keepSelection:r,onChange:i}=this.props,s=this.getBox();if(n||a||r&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const o=e.clientX-s.x,l=e.clientY-s.y,c={unit:"px",x:o,y:l,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:o,startCropY:l,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,i(mw(c,s.width,s.height),uw(c,s.width,s.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),ow(this,"onDocPointerMove",e=>{const{crop:t,disabled:n,onChange:a,onDragStart:r}=this.props,i=this.getBox();if(n||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,r&&r(e));const{evData:s}=this;let o;s.clientX=e.clientX,s.clientY=e.clientY,o=s.isResize?this.resizeCrop():this.dragCrop(),dw(t,o)||a(mw(o,i.width,i.height),uw(o,i.width,i.height))}),ow(this,"onComponentKeyDown",t=>{const{crop:n,disabled:a,onChange:r,onComplete:i}=this.props;if(a)return;const s=t.key;let o=!1;if(!n)return;const l=this.getBox(),c=this.makePixelCrop(l),d=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep;if("ArrowLeft"===s?(c.x-=d,o=!0):"ArrowRight"===s?(c.x+=d,o=!0):"ArrowUp"===s?(c.y-=d,o=!0):"ArrowDown"===s&&(c.y+=d,o=!0),o){t.cancelable&&t.preventDefault(),c.x=cw(c.x,0,l.width-c.width),c.y=cw(c.y,0,l.height-c.height);const e=mw(c,l.width,l.height),n=uw(c,l.width,l.height);r(e,n),i&&i(e,n)}}),ow(this,"onHandlerKeyDown",(t,n)=>{const{aspect:a=0,crop:r,disabled:i,minWidth:s=0,minHeight:o=0,maxWidth:l,maxHeight:c,onChange:d,onComplete:u}=this.props,m=this.getBox();if(i||!r)return;if("ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key)return;t.stopPropagation(),t.preventDefault();const p=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep,h=function(e,t,n,a){const r={...e};return"ArrowLeft"===t?"nw"===a?(r.x-=n,r.y-=n,r.width+=n,r.height+=n):"w"===a?(r.x-=n,r.width+=n):"sw"===a?(r.x-=n,r.width+=n,r.height+=n):"ne"===a?(r.y+=n,r.width-=n,r.height-=n):"e"===a?r.width-=n:"se"===a&&(r.width-=n,r.height-=n):"ArrowRight"===t&&("nw"===a?(r.x+=n,r.y+=n,r.width-=n,r.height-=n):"w"===a?(r.x+=n,r.width-=n):"sw"===a?(r.x+=n,r.width-=n,r.height-=n):"ne"===a?(r.y-=n,r.width+=n,r.height+=n):"e"===a?r.width+=n:"se"===a&&(r.width+=n,r.height+=n)),"ArrowUp"===t?"nw"===a?(r.x-=n,r.y-=n,r.width+=n,r.height+=n):"n"===a?(r.y-=n,r.height+=n):"ne"===a?(r.y-=n,r.width+=n,r.height+=n):"sw"===a?(r.x+=n,r.width-=n,r.height-=n):"s"===a?r.height-=n:"se"===a&&(r.width-=n,r.height-=n):"ArrowDown"===t&&("nw"===a?(r.x+=n,r.y+=n,r.width-=n,r.height-=n):"n"===a?(r.y+=n,r.height-=n):"ne"===a?(r.y+=n,r.width-=n,r.height-=n):"sw"===a?(r.x-=n,r.width+=n,r.height+=n):"s"===a?r.height+=n:"se"===a&&(r.width+=n,r.height+=n)),r}(mw(r,m.width,m.height),t.key,p,n),g=pw(h,a,n,m.width,m.height,s,o,l,c);if(!dw(r,g)){const e=uw(g,m.width,m.height);d(g,e),u&&u(g,e)}}),ow(this,"onDocPointerDone",e=>{const{crop:t,disabled:n,onComplete:a,onDragEnd:r}=this.props,i=this.getBox();this.unbindDocMove(),!n&&t&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,r&&r(e),a&&a(mw(t,i.width,i.height),uw(t,i.width,i.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),ow(this,"onDragFocus",()=>{var e;null==(e=this.componentRef.current)||e.scrollTo(0,0)})}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:n,width:a,height:r}=e.getBoundingClientRect();return{x:t,y:n,width:a,height:r}}componentDidUpdate(e){const{crop:t,onComplete:n}=this.props;if(n&&!e.crop&&t){const{width:e,height:a}=this.getBox();e&&a&&n(mw(t,e,a),uw(t,e,a))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,hw),this.document.addEventListener("pointerup",this.onDocPointerDone,hw),this.document.addEventListener("pointercancel",this.onDocPointerDone,hw),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,hw),this.document.removeEventListener("pointerup",this.onDocPointerDone,hw),this.document.removeEventListener("pointercancel",this.onDocPointerDone,hw),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),n=this.makePixelCrop(t),a=e.clientX-e.startClientX,r=e.clientY-e.startClientY;return n.x=cw(e.startCropX+a,0,t.width-n.width),n.y=cw(e.startCropY+r,0,t.height-n.height),n}getPointRegion(e,t,n,a){const{evData:r}=this,i=r.clientX-e.x,s=r.clientY-e.y;let o,l;return o=a&&t?"nw"===t||"n"===t||"ne"===t:s<r.startCropY,l=n&&t?"nw"===t||"w"===t||"sw"===t:i<r.startCropX,l?o?"nw":"sw":o?"ne":"se"}resolveMinDimensions(e,t,n=0,a=0){const r=Math.min(n,e.width),i=Math.min(a,e.height);return t&&(r||i)?t>1?r?[r,r/t]:[i*t,i]:i?[i*t,i]:[r,r/t]:[r,i]}resizeCrop(){const{evData:t}=this,{aspect:n=0,maxWidth:a,maxHeight:r}=this.props,i=this.getBox(),[s,o]=this.resolveMinDimensions(i,n,this.props.minWidth,this.props.minHeight);let l=this.makePixelCrop(i);const c=this.getPointRegion(i,t.ord,s,o),d=t.ord||c;let u=t.clientX-t.startClientX,m=t.clientY-t.startClientY;(s&&"nw"===d||"w"===d||"sw"===d)&&(u=Math.min(u,-s)),(o&&"nw"===d||"n"===d||"ne"===d)&&(m=Math.min(m,-o));const p={unit:"px",x:0,y:0,width:0,height:0};"ne"===c?(p.x=t.startCropX,p.width=u,n?(p.height=p.width/n,p.y=t.startCropY-p.height):(p.height=Math.abs(m),p.y=t.startCropY-p.height)):"se"===c?(p.x=t.startCropX,p.y=t.startCropY,p.width=u,p.height=n?p.width/n:m):"sw"===c?(p.x=t.startCropX+u,p.y=t.startCropY,p.width=Math.abs(u),p.height=n?p.width/n:m):"nw"===c&&(p.x=t.startCropX+u,p.width=Math.abs(u),n?(p.height=p.width/n,p.y=t.startCropY-p.height):(p.height=Math.abs(m),p.y=t.startCropY+m));const h=pw(p,n,c,i.width,i.height,s,o,a,r);return n||e.xyOrds.indexOf(d)>-1?l=h:e.xOrds.indexOf(d)>-1?(l.x=h.x,l.width=h.width):e.yOrds.indexOf(d)>-1&&(l.y=h.y,l.height=h.height),l.x=cw(l.x,0,i.width-l.width),l.y=cw(l.y,0,i.height-l.height),l}renderCropSelection(){const{ariaLabels:t=e.defaultProps.ariaLabels,disabled:n,locked:a,renderSelectionAddon:r,ruleOfThirds:i,crop:s}=this.props,o=this.getCropStyle();if(s)return $.createElement("div",{style:o,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!n&&!a&&$.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},$.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),$.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),$.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),$.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),$.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"nw"),role:"button"}),$.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"n"),role:"button"}),$.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"ne"),role:"button"}),$.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"e"),role:"button"}),$.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"se"),role:"button"}),$.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"s"),role:"button"}),$.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"sw"),role:"button"}),$.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"w"),role:"button"})),r&&$.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:e=>e.stopPropagation()},r(this.state)),i&&$.createElement($.Fragment,null,$.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),$.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){return mw({...lw,...this.props.crop||{}},e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:n,className:a,crop:r,disabled:i,locked:s,style:o,ruleOfThirds:l}=this.props,{cropIsActive:c,newCropIsBeingDrawn:d}=this.state,u=r?this.renderCropSelection():null,m=((...e)=>e.filter(e=>e&&"string"==typeof e).join(" "))("ReactCrop",a,c&&"ReactCrop--active",i&&"ReactCrop--disabled",s&&"ReactCrop--locked",d&&"ReactCrop--new-crop",r&&e&&"ReactCrop--fixed-aspect",r&&n&&"ReactCrop--circular-crop",r&&l&&"ReactCrop--rule-of-thirds",!this.dragStarted&&r&&!r.width&&!r.height&&"ReactCrop--invisible-crop",n&&"ReactCrop--no-animate");return $.createElement("div",{ref:this.componentRef,className:m,style:o},$.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),r?$.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},$.createElement("defs",null,$.createElement("mask",{id:`hole-${this.instanceId}`},$.createElement("rect",{width:"100%",height:"100%",fill:"white"}),n?$.createElement("ellipse",{cx:`${r.x+r.width/2}${r.unit}`,cy:`${r.y+r.height/2}${r.unit}`,rx:`${r.width/2}${r.unit}`,ry:`${r.height/2}${r.unit}`,fill:"black"}):$.createElement("rect",{x:`${r.x}${r.unit}`,y:`${r.y}${r.unit}`,width:`${r.width}${r.unit}`,height:`${r.height}${r.unit}`,fill:"black"}))),$.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,u)}};ow(fw,"xOrds",["e","w"]),ow(fw,"yOrds",["n","s"]),ow(fw,"xyOrds",["nw","ne","se","sw"]),ow(fw,"nudgeStep",1),ow(fw,"nudgeStepMedium",10),ow(fw,"nudgeStepLarge",100),ow(fw,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let xw=fw;var vw=["PageUp","PageDown"],yw=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],bw={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ww="Slider",[jw,Nw,_w]=R(ww),[kw,Sw]=h(ww,[_w]),[Cw,Ew]=kw(ww),Dw=L.forwardRef((e,t)=>{const{name:a,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:d=[r],value:u,onValueChange:m=()=>{},onValueCommit:p=()=>{},inverted:h=!1,form:g,...f}=e,v=L.useRef(new Set),y=L.useRef(0),b="horizontal"===o?Tw:Mw,[w=[],j]=N({prop:u,defaultProp:d,onChange:e=>{var t;null==(t=[...v.current][y.current])||t.focus(),m(e)}}),_=L.useRef(w);function k(e,t,{commit:n}={commit:!1}){const a=function(e){return(String(e).split(".")[1]||"").length}(s),o=function(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-r)/s)*s+r,a),l=I(o,[r,i]);j((e=[])=>{const a=function(e=[],t,n){const a=[...e];return a[n]=t,a.sort((e,t)=>e-t)}(e,l,t);if(function(e,t){if(t>0){const n=function(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}(e);return Math.min(...n)>=t}return!0}(a,c*s)){y.current=a.indexOf(l);const t=String(a)!==String(e);return t&&n&&p(a),t?a:e}return e})}return n.jsx(Cw,{scope:e.__scopeSlider,name:a,disabled:l,min:r,max:i,valueIndexToChangeRef:y,thumbs:v.current,values:w,orientation:o,form:g,children:n.jsx(jw.Provider,{scope:e.__scopeSlider,children:n.jsx(jw.Slot,{scope:e.__scopeSlider,children:n.jsx(b,{"aria-disabled":l,"data-disabled":l?"":void 0,...f,ref:t,onPointerDown:x(f.onPointerDown,()=>{l||(_.current=w)}),min:r,max:i,inverted:h,onSlideStart:l?void 0:function(e){const t=function(e,t){if(1===e.length)return 0;const n=e.map(e=>Math.abs(e-t)),a=Math.min(...n);return n.indexOf(a)}(w,e);k(e,t)},onSlideMove:l?void 0:function(e){k(e,y.current)},onSlideEnd:l?void 0:function(){const e=_.current[y.current];w[y.current]!==e&&p(w)},onHomeKeyDown:()=>!l&&k(r,0,{commit:!0}),onEndKeyDown:()=>!l&&k(i,w.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!l){const n=vw.includes(e.key)||e.shiftKey&&yw.includes(e.key)?10:1,a=y.current;k(w[a]+s*n*t,a,{commit:!0})}}})})})})});Dw.displayName=ww;var[Pw,Aw]=kw(ww,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Tw=L.forwardRef((e,t)=>{const{min:a,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:l,onSlideEnd:c,onStepKeyDown:d,...u}=e,[m,p]=L.useState(null),h=g(t,e=>p(e)),f=L.useRef(),x=j(i),v="ltr"===x,y=v&&!s||!v&&s;function b(e){const t=f.current||m.getBoundingClientRect(),n=Vw([0,t.width],y?[a,r]:[r,a]);return f.current=t,n(e-t.left)}return n.jsx(Pw,{scope:e.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:n.jsx(Rw,{dir:x,"data-orientation":"horizontal",...u,ref:h,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{const t=b(e.clientX);null==o||o(t)},onSlideMove:e=>{const t=b(e.clientX);null==l||l(t)},onSlideEnd:()=>{f.current=void 0,null==c||c()},onStepKeyDown:e=>{const t=bw[y?"from-left":"from-right"].includes(e.key);null==d||d({event:e,direction:t?-1:1})}})})}),Mw=L.forwardRef((e,t)=>{const{min:a,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:l,onStepKeyDown:c,...d}=e,u=L.useRef(null),m=g(t,u),p=L.useRef(),h=!i;function f(e){const t=p.current||u.current.getBoundingClientRect(),n=Vw([0,t.height],h?[r,a]:[a,r]);return p.current=t,n(e-t.top)}return n.jsx(Pw,{scope:e.__scopeSlider,startEdge:h?"bottom":"top",endEdge:h?"top":"bottom",size:"height",direction:h?1:-1,children:n.jsx(Rw,{"data-orientation":"vertical",...d,ref:m,style:{...d.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{const t=f(e.clientY);null==s||s(t)},onSlideMove:e=>{const t=f(e.clientY);null==o||o(t)},onSlideEnd:()=>{p.current=void 0,null==l||l()},onStepKeyDown:e=>{const t=bw[h?"from-bottom":"from-top"].includes(e.key);null==c||c({event:e,direction:t?-1:1})}})})}),Rw=L.forwardRef((e,t)=>{const{__scopeSlider:a,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:l,onStepKeyDown:c,...d}=e,u=Ew(ww,a);return n.jsx(f.span,{...d,ref:t,onKeyDown:x(e.onKeyDown,e=>{"Home"===e.key?(o(e),e.preventDefault()):"End"===e.key?(l(e),e.preventDefault()):vw.concat(yw).includes(e.key)&&(c(e),e.preventDefault())}),onPointerDown:x(e.onPointerDown,e=>{const t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():r(e)}),onPointerMove:x(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:x(e.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),s(e))})})}),Iw="SliderTrack",Ow=L.forwardRef((e,t)=>{const{__scopeSlider:a,...r}=e,i=Ew(Iw,a);return n.jsx(f.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:t})});Ow.displayName=Iw;var Lw="SliderRange",Fw=L.forwardRef((e,t)=>{const{__scopeSlider:a,...r}=e,i=Ew(Lw,a),s=Aw(Lw,a),o=L.useRef(null),l=g(t,o),c=i.values.length,d=i.values.map(e=>qw(e,i.min,i.max)),u=c>1?Math.min(...d):0,m=100-Math.max(...d);return n.jsx(f.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:l,style:{...e.style,[s.startEdge]:u+"%",[s.endEdge]:m+"%"}})});Fw.displayName=Lw;var Uw="SliderThumb",zw=L.forwardRef((e,t)=>{const a=Nw(e.__scopeSlider),[r,i]=L.useState(null),s=g(t,e=>i(e)),o=L.useMemo(()=>r?a().findIndex(e=>e.ref.current===r):-1,[a,r]);return n.jsx($w,{...e,ref:s,index:o})}),$w=L.forwardRef((e,t)=>{const{__scopeSlider:a,index:r,name:i,...s}=e,o=Ew(Uw,a),l=Aw(Uw,a),[c,d]=L.useState(null),u=g(t,e=>d(e)),m=!c||(o.form||!!c.closest("form")),p=b(c),h=o.values[r],v=void 0===h?0:qw(h,o.min,o.max),y=function(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}(r,o.values.length),w=null==p?void 0:p[l.size],j=w?function(e,t,n){const a=e/2,r=Vw([0,50],[0,a]);return(a-r(t)*n)*n}(w,v,l.direction):0;return L.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),n.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${v}% + ${j}px)`},children:[n.jsx(jw.ItemSlot,{scope:e.__scopeSlider,children:n.jsx(f.span,{role:"slider","aria-label":e["aria-label"]||y,"aria-valuemin":o.min,"aria-valuenow":h,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:u,style:void 0===h?{display:"none"}:e.style,onFocus:x(e.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),m&&n.jsx(Bw,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:h},r)]})});zw.displayName=Uw;var Bw=e=>{const{value:t,...a}=e,r=L.useRef(null),i=y(t);return L.useEffect(()=>{const e=r.current,n=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(n,"value").set;if(i!==t&&a){const n=new Event("input",{bubbles:!0});a.call(e,t),e.dispatchEvent(n)}},[i,t]),n.jsx("input",{style:{display:"none"},...a,ref:r,defaultValue:t})};function qw(e,t,n){return I(100/(n-t)*(e-t),[0,100])}function Vw(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const a=(t[1]-t[0])/(e[1]-e[0]);return t[0]+a*(n-e[0])}}var Hw=Dw,Ww=Ow,Yw=Fw,Kw=zw;const Gw=L.forwardRef(({className:e,...t},a)=>n.jsxs(Hw,{ref:a,className:G("relative flex w-full touch-none select-none items-center",e),...t,children:[n.jsx(Ww,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:n.jsx(Yw,{className:"absolute h-full bg-primary"})}),n.jsx(Kw,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Gw.displayName=Hw.displayName;const Qw=({isOpen:e,onClose:t,imageSrc:a,onCropComplete:r})=>{const[i,s]=L.useState(),[o,l]=L.useState(),[c,d]=L.useState(1),[u,m]=L.useState(!1),p=L.useRef(null),h=L.useRef(null),g=L.useCallback(e=>{const{naturalWidth:t,naturalHeight:n}=e.currentTarget,a=function(e,t,n){const a=mw(e,t,n);return a.x=(t-a.width)/2,a.y=(n-a.height)/2,"%"===e.unit?uw(a,t,n):a}(function(e,t,n,a){const r=mw(e,n,a);return e.width&&(r.height=r.width/t),e.height&&(r.width=r.height*t),r.y+r.height>a&&(r.height=a-r.y,r.width=r.height*t),r.x+r.width>n&&(r.width=n-r.x,r.height=r.width/t),"%"===e.unit?uw(r,n,a):r}({unit:"%",width:90},3,t,n),t,n);s(a),l(a)},[]),f=L.useCallback(()=>{if(!o||!p.current||!h.current)return;const e=p.current,t=h.current,n=t.getContext("2d");if(!n)return;e.naturalWidth,e.width,e.naturalHeight,e.height;const a=o.x/100*e.naturalWidth,r=o.y/100*e.naturalHeight,i=o.width/100*e.naturalWidth,s=o.height/100*e.naturalHeight;t.width=600,t.height=200,n.drawImage(e,a/c,r/c,i/c,s/c,0,0,t.width,t.height)},[o,c]);$.useEffect(()=>{f()},[f]);return n.jsx(Ot,{open:e,onOpenChange:e=>!e&&t(),children:n.jsxs(Lt,{className:"max-w-3xl bg-background border-border",children:[n.jsx(Ft,{children:n.jsx(Ut,{className:"text-foreground",children:"Position Your Cover Photo"})}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"relative bg-muted rounded-lg overflow-hidden flex items-center justify-center min-h-[300px]",children:n.jsx(xw,{crop:i,onChange:(e,t)=>s(t),onComplete:(e,t)=>l(t),aspect:3,className:"max-h-[400px]",children:n.jsx("img",{ref:p,src:a,alt:"Crop preview",onLoad:g,crossOrigin:"anonymous",style:{transform:`scale(${c})`,transformOrigin:"center"},className:"max-w-full max-h-[400px] object-contain"})})}),n.jsxs("div",{className:"flex items-center gap-4 px-2",children:[n.jsx(Sa,{size:18,className:"text-muted-foreground"}),n.jsx(Gw,{value:[c],onValueChange:([e])=>d(e),min:1,max:3,step:.1,className:"flex-1"}),n.jsx(ka,{size:18,className:"text-muted-foreground"}),n.jsxs("span",{className:"text-sm text-muted-foreground w-12",children:[c.toFixed(1),"x"]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm text-muted-foreground",children:"Preview (how it will appear):"}),n.jsx("div",{className:"bg-muted rounded-lg overflow-hidden",children:n.jsx("canvas",{ref:h,className:"w-full h-auto",style:{aspectRatio:"3/1"}})})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[n.jsxs(Q,{variant:"outline",onClick:t,disabled:u,children:[n.jsx(ae,{size:16,className:"mr-2"}),"Cancel"]}),n.jsx(Q,{onClick:async()=>{if(o&&p.current){m(!0);try{const e=p.current,t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("No canvas context");const a={x:o.x/100*e.naturalWidth,y:o.y/100*e.naturalHeight,width:o.width/100*e.naturalWidth,height:o.height/100*e.naturalHeight};t.width=1200,t.height=400,n.drawImage(e,a.x/c,a.y/c,a.width/c,a.height/c,0,0,t.width,t.height),t.toBlob(e=>{e&&r(e),m(!1)},"image/jpeg",.9)}catch(e){m(!1)}}},disabled:u,children:u?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground/30 border-t-primary-foreground rounded-full animate-spin mr-2"}),"Processing..."]}):n.jsxs(n.Fragment,{children:[n.jsx(Qt,{size:16,className:"mr-2"}),"Save Position"]})})]})]})]})})},Xw=({tripId:e,description:t,onUpdate:a,className:r="text-gray-300 text-lg leading-relaxed",maxLines:i=2,collapsible:s=!0,externalEditTrigger:o,hideInlineButtonOnLg:l=!1})=>{const[c,d]=L.useState(!1),[u,m]=L.useState(t),[p,h]=L.useState(!1),[g,f]=L.useState(!1);L.useEffect(()=>{d(!1),m(t),f(!1)},[e,t]),L.useEffect(()=>{"number"==typeof o&&o>0&&d(!0)},[o]);const x=async()=>{if(u.trim()!==t){h(!0);try{await Ue.updateTrip(e,{description:u.trim()})?(a(u.trim()),d(!1),ee.success("Description updated successfully")):ee.error("Failed to update description")}catch(n){ee.error("Failed to update description")}finally{h(!1)}}else d(!1)},v=()=>{m(t),d(!1)},y=e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)?x():"Escape"===e.key&&v()};if(c)return n.jsxs("div",{className:"space-y-3",children:[n.jsx("textarea",{value:u,onChange:e=>m(e.target.value),onKeyDown:y,className:"w-full p-3 bg-white/10 border border-white/20 rounded-xl text-gray-300 text-lg leading-relaxed resize-none min-h-[100px] focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50",placeholder:"Add a description for this trip...",autoFocus:!0,disabled:p}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:x,disabled:p,className:"flex items-center gap-1 px-3 py-1.5 bg-green-600 hover:bg-green-700 disabled:bg-green-600/50 text-white text-sm rounded-lg transition-colors",children:[n.jsx(Qt,{size:14}),p?"Saving...":"Save"]}),n.jsxs("button",{onClick:v,disabled:p,className:"flex items-center gap-1 px-3 py-1.5 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-600/50 text-white text-sm rounded-lg transition-colors",children:[n.jsx(ae,{size:14}),"Cancel"]}),n.jsx("span",{className:"text-xs text-gray-400",children:"Ctrl+Enter to save, Esc to cancel"})]})]});const b=s&&t.length>150,w=b&&!g?`line-clamp-${i}`:"";return n.jsxs("div",{className:"relative pb-8",children:[n.jsx("p",{className:`${r} ${w}`,children:t||"No description added yet. Click to add one."}),b&&n.jsx("button",{onClick:()=>f(!g),className:"text-xs text-gray-400 hover:text-white underline mt-1",children:g?"Read less":"Read more"}),n.jsx("button",{onClick:()=>d(!0),className:"absolute bottom-2 left-0 p-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg transition-all duration-200 text-gray-400 hover:text-white shadow-lg backdrop-blur-sm "+(l?"lg:hidden":""),title:"Edit description",children:n.jsx(xt,{size:14})})]})},Zw=(e,t)=>{const{user:n}=Y(),{isDemoMode:a}=X(),[r,i]=L.useState(t),[s,o]=L.useState(!1);L.useEffect(()=>{if(a){const t=he.getCoverPhoto(e);t&&i(t)}},[a,e]);return{coverPhoto:r,updateCoverPhoto:async t=>{if(t.startsWith("blob:")&&!a)return ee.error("Upload in progress, please wait..."),!1;if(a)return i(t),he.setCoverPhoto(e,t),ee.success("Cover photo updated (demo mode)"),!0;if(!n)return ee.error("Please sign in to update cover photos"),!1;o(!0);try{const{data:n,error:a}=await W.from("trips").update({cover_image_url:t}).eq("id",e).select("id").maybeSingle();if(a)throw a;return n?(i(t),ee.success("Cover photo updated"),!0):(ee.error("You don't have permission to update this trip's cover photo"),!1)}catch(r){return ee.error("Failed to update cover photo"),!1}finally{o(!1)}},removeCoverPhoto:async()=>{if(a)return i(void 0),he.removeCoverPhoto(e),ee.success("Cover photo removed (demo mode)"),!0;if(!n)return ee.error("Please sign in to remove cover photos"),!1;o(!0);try{const{data:t,error:n}=await W.from("trips").update({cover_image_url:null}).eq("id",e).select("id").maybeSingle();if(n)throw n;if(!t)return ee.error("You don't have permission to update this trip's cover photo"),!1;if(r&&r.includes("supabase")){const t=r.split("/").pop();t&&await W.storage.from("advertiser-assets").remove([`${e}/${t}`])}return i(void 0),ee.success("Cover photo removed"),!0}catch(t){return ee.error("Failed to remove cover photo"),!1}finally{o(!1)}},isUpdating:s}},Jw={"Sports â€“ Pro, Collegiate, Youth":{id:"Sports â€“ Pro, Collegiate, Youth",name:"Sports â€“ Pro, Collegiate, Youth",description:"Professional, collegiate, and youth sports teams, tournaments, and athletic events",roles:["Player","Coach","Crew","Medical","Security"],availableTabs:["chat","calendar","ai-chat","media","payments","places","polls","tasks","team"],requiredTabs:["team"],terminology:{teamLabel:"Team Roster",memberLabel:"Team Member",leaderLabel:"Team Captain"}},"Tour â€“ Music, Comedy, etc.":{id:"Tour â€“ Music, Comedy, etc.",name:"Tour â€“ Music, Comedy, etc.",description:"Music tours, comedy shows, podcast tours, creator events, and entertainment productions",roles:["Artist Team","Tour Manager","Crew","VIP","Security"],availableTabs:["chat","calendar","ai-chat","media","payments","places","polls","tasks","team"],requiredTabs:["team"],terminology:{teamLabel:"Tour Crew",memberLabel:"Crew Member",leaderLabel:"Tour Manager"}},"Business Travel":{id:"Business Travel",name:"Business Travel",description:"Corporate retreats, executive meetings, sales trips, recruiting events, and business travel",roles:[],availableTabs:["chat","calendar","ai-chat","media","payments","places","polls","tasks","team"],requiredTabs:["team"],terminology:{teamLabel:"Attendees",memberLabel:"Participant",leaderLabel:"Event Lead"}},"School Trip":{id:"School Trip",name:"School Trip",description:"Educational trips, academic competitions, and school-related events",roles:["Student","Chaperone","Teacher"],availableTabs:["chat","calendar","ai-chat","media","payments","places","polls","tasks","team"],requiredTabs:["team"],terminology:{teamLabel:"Group",memberLabel:"Participant",leaderLabel:"Lead Teacher"}},Content:{id:"Content",name:"Content",description:"Television shows, film productions, creator content, and media shoots",roles:["Talent","Crew","Security"],availableTabs:["chat","calendar","ai-chat","media","payments","places","polls","tasks","team"],requiredTabs:["team"],terminology:{teamLabel:"Cast & Crew",memberLabel:"Production Member",leaderLabel:"Producer"}},Other:{id:"Other",name:"Other",description:"All other types of professional trips and events not covered by the above categories",roles:[],availableTabs:["chat","calendar","ai-chat","media","payments","places","polls","tasks","team"],requiredTabs:["team"],terminology:{teamLabel:"Team",memberLabel:"Team Member",leaderLabel:"Team Lead"}}},ej=e=>Jw[e],tj=({category:e,tags:t,className:a=""})=>{const r=[ej(e).name,...t];return n.jsx("div",{className:`flex flex-wrap gap-2 ${a}`,children:r.map((e,t)=>n.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+(0===t?"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30":"bg-gray-700/50 text-gray-300 border border-gray-600/30"),children:e},t))})},nj=(e,t)=>{if(!e||"string"!=typeof e)return"Unknown";const n=e.trim().split(" ").filter(Boolean);if(0===n.length)return"Unknown";if(1===n.length)return n[0];if("consumer"===t){return`${n[0]} ${n[n.length-1][0].toUpperCase()}.`}return e},aj=({participants:e,countLabel:t,maxRows:a=1,minColWidth:r=140,onShowAll:i,tripType:s="consumer",displayContext:o="trip-detail"})=>{const l="event"!==s&&"trip-detail"===o,c=Math.max(52,Math.min(160,52*a));return n.jsxs("section",{"aria-labelledby":"collab-title",className:"relative",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"flex flex-wrap gap-2",style:{maxHeight:`${c}px`,overflow:"hidden"},role:"list","aria-label":"Collaborators",children:e.map(e=>n.jsxs("button",{className:"group inline-flex items-center gap-2 rounded-lg border border-white/10 bg-white/5 px-2 py-1.5 hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/20 transition w-auto shrink-0 max-w-[200px]",role:"listitem",title:e.role?`${e.name} â€¢ ${e.role}`:e.name,children:[l&&Tt(e.avatar)?n.jsx("img",{src:e.avatar,alt:e.name,className:"h-7 w-7 rounded-full object-cover border border-white/20 shrink-0",loading:"lazy"}):n.jsx("div",{className:"h-7 w-7 rounded-full bg-white/10 text-white/80 grid place-items-center text-[10px] font-semibold border border-white/20 shrink-0",children:St(e.name)}),n.jsxs("div",{className:"min-w-0 text-left",children:[n.jsx("div",{className:"truncate text-xs font-medium text-white",children:nj(e.name,s)}),e.role&&n.jsx("div",{className:"truncate text-[10px] text-gray-400",children:e.role})]})]},e.id))}),n.jsx("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 h-8 bg-gradient-to-t from-black/60 to-transparent rounded-b-lg"})]}),n.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[n.jsx("div",{className:"text-xs text-gray-400",children:t}),n.jsx("button",{className:"text-xs font-medium underline text-gray-200 hover:text-white",onClick:i,"aria-label":"Show all collaborators",children:"Show all"})]})]})},rj=({open:e,onOpenChange:t,participants:a,tripType:r="consumer",currentUserId:i,tripCreatorId:s,isAdmin:o=!1,onRemoveMember:l,pendingRequests:c=[],onApproveRequest:d,onRejectRequest:u,isProcessingRequest:m=!1,initialTab:p="members"})=>{const[h,g]=L.useState(null),[f,x]=L.useState(null),[v,y]=L.useState(p);$.useEffect(()=>{e&&y(p)},[e,p]);const b=(o||(!r||"consumer"===r))&&d&&u,w=c.length;return n.jsx(Ot,{open:e,onOpenChange:t,children:n.jsxs(Lt,{className:"max-w-2xl",children:[n.jsx(Ft,{children:n.jsx(Ut,{children:"All Collaborators"})}),n.jsxs("div",{className:"flex gap-1 p-1 bg-white/5 rounded-xl mt-2",children:[n.jsxs("button",{onClick:()=>y("members"),className:G("flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-lg text-sm font-medium transition-all","members"===v?"bg-white/10 text-white":"text-gray-400 hover:text-white hover:bg-white/5"),children:[n.jsx(ln,{size:16}),n.jsxs("span",{children:["Members (",a.length,")"]})]}),n.jsxs("button",{onClick:()=>y("requests"),className:G("flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-lg text-sm font-medium transition-all relative","requests"===v?"bg-white/10 text-white":"text-gray-400 hover:text-white hover:bg-white/5"),children:[n.jsx(Xn,{size:16}),n.jsx("span",{children:"Requests"}),w>0&&n.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] flex items-center justify-center bg-red-500 text-white text-xs font-bold rounded-full px-1",children:w})]})]}),n.jsx("div",{className:"mt-4 max-h-[60vh] overflow-auto pr-1",children:"members"===v?n.jsxs("div",{role:"list","aria-label":"All collaborators",children:[a.map(e=>{const t=e.id.toString(),a=t===s||e.isCreator,c=t===i,d=(e=>{if(!l)return!1;const t=e.toString();return t!==s&&(!!o||t===i)})(t);return n.jsxs("div",{role:"listitem",className:G("flex items-center gap-3 rounded-lg border border-white/10 bg-white/5 px-3 py-2 mb-2",h===t&&"opacity-50"),children:[Tt(e.avatar)?n.jsx("img",{src:e.avatar,alt:e.name,className:"h-9 w-9 rounded-full object-cover border border-white/20",loading:"lazy"}):n.jsx("div",{className:"h-9 w-9 rounded-full bg-white/10 text-white/80 grid place-items-center text-xs font-semibold border border-white/20",children:St(e.name)}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"truncate text-sm font-medium text-white",children:nj(e.name,r)}),a&&n.jsx("span",{title:"Trip Creator",children:n.jsx(Qn,{size:14,className:"text-yellow-500 flex-shrink-0"})}),c&&!a&&n.jsx("span",{className:"text-xs text-gray-400",children:"(you)"})]}),e.role&&n.jsx("div",{className:"truncate text-xs text-gray-400",children:e.role})]}),d&&n.jsx("button",{onClick:()=>(async(e,t)=>{if(!l)return;if(window.confirm(`Remove ${t} from this trip?`)){g(e);try{await l(e)}finally{g(null)}}})(t,e.name),disabled:h===t,className:"p-1.5 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors disabled:opacity-50",title:c?"Leave trip":"Remove from trip",children:n.jsx(Na,{size:16})})]},e.id)}),0===a.length&&n.jsx("div",{className:"text-center py-8 text-gray-400",children:"No members yet"})]}):n.jsx("div",{role:"list","aria-label":"Pending join requests",children:b?c.length>0?c.map(e=>{var t,a,r,i;const s=f===e.id,o=(null==(t=e.profile)?void 0:t.display_name)||(null==(a=e.profile)?void 0:a.email)||"Unknown User",l=Pn(new Date(e.requested_at),{addSuffix:!0});return n.jsxs("div",{role:"listitem",className:G("flex items-center gap-3 rounded-lg border border-white/10 bg-white/5 px-3 py-3 mb-2",s&&"opacity-50"),children:[Tt(null==(r=e.profile)?void 0:r.avatar_url)?n.jsx("img",{src:null==(i=e.profile)?void 0:i.avatar_url,alt:o,className:"h-10 w-10 rounded-full object-cover border border-white/20",loading:"lazy"}):n.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 text-white grid place-items-center text-sm font-semibold border border-white/20",children:St(o)}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-medium text-white truncate",children:o}),n.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[n.jsx(Kn,{size:12}),n.jsxs("span",{children:["Requested ",l]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>(async e=>{if(d&&!m){x(e);try{await d(e)}finally{x(null)}}})(e.id),disabled:s,className:"p-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 hover:text-green-300 rounded-lg transition-colors disabled:opacity-50",title:"Approve request",children:n.jsx(Qt,{size:18})}),n.jsx("button",{onClick:()=>(async e=>{if(u&&!m){x(e);try{await u(e)}finally{x(null)}}})(e.id),disabled:s,className:"p-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 hover:text-red-300 rounded-lg transition-colors disabled:opacity-50",title:"Reject request",children:n.jsx(ae,{size:18})})]})]},e.id)}):n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-4",children:n.jsx(Xn,{size:24,className:"text-gray-500"})}),n.jsx("p",{className:"text-gray-400 text-sm",children:"No pending requests"}),n.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"When someone requests to join, they'll appear here"})]}):n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-4",children:n.jsx(Xn,{size:24,className:"text-gray-500"})}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Join Requests"}),n.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Only trip admins can manage join requests for Pro/Event trips"})]})})})]})})},ij=(e,t)=>{try{const n=new Date(e),a=new Date(t);return n.getMonth()===a.getMonth()&&n.getFullYear()===a.getFullYear()||n.getFullYear()===a.getFullYear()?`${Nn(n,"MMM d")} - ${Nn(a,"MMM d, yyyy")}`:`${Nn(n,"MMM d, yyyy")} - ${Nn(a,"MMM d, yyyy")}`}catch(n){return"Invalid date range"}},sj=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function oj(e,t,n){const a=function(e){const{name:t}=e;if(t&&-1!==t.lastIndexOf(".")&&!e.type){const n=t.split(".").pop().toLowerCase(),a=sj.get(n);a&&Object.defineProperty(e,"type",{value:a,writable:!1,configurable:!1,enumerable:!0})}return e}(e),{webkitRelativePath:r}=e,i="string"==typeof t?t:"string"==typeof r&&r.length>0?r:`./${e.name}`;return"string"!=typeof a.path&&lj(a,"path",i),lj(a,"relativePath",i),a}function lj(e,t,n){Object.defineProperty(e,t,{value:n,writable:!1,configurable:!1,enumerable:!0})}const cj=[".DS_Store","Thumbs.db"];function dj(e){return"object"==typeof e&&null!==e}function uj(e){return e.filter(e=>-1===cj.indexOf(e.name))}function mj(e){if(null===e)return[];const t=[];for(let n=0;n<e.length;n++){const a=e[n];t.push(a)}return t}function pj(e){if("function"!=typeof e.webkitGetAsEntry)return gj(e);const t=e.webkitGetAsEntry();return t&&t.isDirectory?xj(t):gj(e,t)}function hj(e){return e.reduce((e,t)=>[...e,...Array.isArray(t)?hj(t):[t]],[])}function gj(e,t){return O(this,void 0,void 0,function*(){var n;if(globalThis.isSecureContext&&"function"==typeof e.getAsFileSystemHandle){const t=yield e.getAsFileSystemHandle();if(null===t)throw new Error(`${e} is not a File`);if(void 0!==t){const e=yield t.getFile();return e.handle=t,oj(e)}}const a=e.getAsFile();if(!a)throw new Error(`${e} is not a File`);return oj(a,null!==(n=null==t?void 0:t.fullPath)&&void 0!==n?n:void 0)})}function fj(e){return O(this,void 0,void 0,function*(){return e.isDirectory?xj(e):function(e){return O(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.file(n=>{const a=oj(n,e.fullPath);t(a)},e=>{n(e)})})})}(e)})}function xj(e){const t=e.createReader();return new Promise((e,n)=>{const a=[];!function r(){t.readEntries(t=>O(this,void 0,void 0,function*(){if(t.length){const e=Promise.all(t.map(fj));a.push(e),r()}else try{const t=yield Promise.all(a);e(t)}catch(yN){n(yN)}}),e=>{n(e)})}()})}var vj=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(",");if(0===n.length)return!0;var a=e.name||"",r=(e.type||"").toLowerCase(),i=r.replace(/\/.*$/,"");return n.some(function(e){var t=e.trim().toLowerCase();return"."===t.charAt(0)?a.toLowerCase().endsWith(t):t.endsWith("/*")?i===t.replace(/\/.*$/,""):r===t})}return!0};function yj(e){return function(e){if(Array.isArray(e))return kj(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_j(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function wj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bj(Object(n),!0).forEach(function(t){jj(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bj(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function jj(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,i=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(yN){o=!0,r=yN}finally{try{s||null==n.return||n.return()}finally{if(o)throw r}}return i}(e,t)||_j(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _j(e,t){if(e){if("string"==typeof e)return kj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kj(e,t):void 0}}function kj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Sj=vj,Cj=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(","),t=e.length>1?"one of ".concat(e.join(", ")):e[0];return{code:"file-invalid-type",message:"File type must be ".concat(t)}},Ej=function(e){return{code:"file-too-large",message:"File is larger than ".concat(e," ").concat(1===e?"byte":"bytes")}},Dj=function(e){return{code:"file-too-small",message:"File is smaller than ".concat(e," ").concat(1===e?"byte":"bytes")}},Pj={code:"too-many-files",message:"Too many files"};function Aj(e,t){var n="application/x-moz-file"===e.type||Sj(e,t);return[n,n?null:Cj(t)]}function Tj(e,t,n){if(Mj(e.size))if(Mj(t)&&Mj(n)){if(e.size>n)return[!1,Ej(n)];if(e.size<t)return[!1,Dj(t)]}else{if(Mj(t)&&e.size<t)return[!1,Dj(t)];if(Mj(n)&&e.size>n)return[!1,Ej(n)]}return[!0,null]}function Mj(e){return null!=e}function Rj(e){return"function"==typeof e.isPropagationStopped?e.isPropagationStopped():void 0!==e.cancelBubble&&e.cancelBubble}function Ij(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(e){return"Files"===e||"application/x-moz-file"===e}):!!e.target&&!!e.target.files}function Oj(e){e.preventDefault()}function Lj(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return t.some(function(t){return!Rj(e)&&t&&t.apply(void 0,[e].concat(a)),Rj(e)})}}function Fj(e){return"audio/*"===e||"video/*"===e||"image/*"===e||"text/*"===e||"application/*"===e||/\w+\/[-+.\w]+/g.test(e)}function Uj(e){return/^.*\.[\w]+$/.test(e)}var zj=["children"],$j=["open"],Bj=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],qj=["refKey","onChange","onClick"];function Vj(e){return function(e){if(Array.isArray(e))return Yj(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Wj(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,i=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(yN){o=!0,r=yN}finally{try{s||null==n.return||n.return()}finally{if(o)throw r}}return i}(e,t)||Wj(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wj(e,t){if(e){if("string"==typeof e)return Yj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yj(e,t):void 0}}function Yj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Kj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Gj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kj(Object(n),!0).forEach(function(t){Qj(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kj(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Qj(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xj(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Zj=L.forwardRef(function(e,t){var n=e.children,a=tN(Xj(e,zj)),r=a.open,i=Xj(a,$j);return L.useImperativeHandle(t,function(){return{open:r}},[r]),$.createElement(L.Fragment,null,n(Gj(Gj({},i),{},{open:r})))});Zj.displayName="Dropzone";var Jj={disabled:!1,getFilesFromEvent:function(e){return O(this,void 0,void 0,function*(){return dj(e)&&dj(e.dataTransfer)?function(e,t){return O(this,void 0,void 0,function*(){if(e.items){const n=mj(e.items).filter(e=>"file"===e.kind);if("drop"!==t)return n;return uj(hj(yield Promise.all(n.map(pj))))}return uj(mj(e.files).map(e=>oj(e)))})}(e.dataTransfer,e.type):function(e){return dj(e)&&dj(e.target)}(e)?function(e){return mj(e.target.files).map(e=>oj(e))}(e):Array.isArray(e)&&e.every(e=>"getFile"in e&&"function"==typeof e.getFile)?function(e){return O(this,void 0,void 0,function*(){return(yield Promise.all(e.map(e=>e.getFile()))).map(e=>oj(e))})}(e):[]})},maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};Zj.defaultProps=Jj,Zj.propTypes={children:Jn.func,accept:Jn.objectOf(Jn.arrayOf(Jn.string)),multiple:Jn.bool,preventDropOnDocument:Jn.bool,noClick:Jn.bool,noKeyboard:Jn.bool,noDrag:Jn.bool,noDragEventsBubbling:Jn.bool,minSize:Jn.number,maxSize:Jn.number,maxFiles:Jn.number,disabled:Jn.bool,getFilesFromEvent:Jn.func,onFileDialogCancel:Jn.func,onFileDialogOpen:Jn.func,useFsAccessApi:Jn.bool,autoFocus:Jn.bool,onDragEnter:Jn.func,onDragLeave:Jn.func,onDragOver:Jn.func,onDrop:Jn.func,onDropAccepted:Jn.func,onDropRejected:Jn.func,onError:Jn.func,validator:Jn.func};var eN={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function tN(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gj(Gj({},Jj),e),n=t.accept,a=t.disabled,r=t.getFilesFromEvent,i=t.maxSize,s=t.minSize,o=t.multiple,l=t.maxFiles,c=t.onDragEnter,d=t.onDragLeave,u=t.onDragOver,m=t.onDrop,p=t.onDropAccepted,h=t.onDropRejected,g=t.onFileDialogCancel,f=t.onFileDialogOpen,x=t.useFsAccessApi,v=t.autoFocus,y=t.preventDropOnDocument,b=t.noClick,w=t.noKeyboard,j=t.noDrag,N=t.noDragEventsBubbling,_=t.onError,k=t.validator,S=L.useMemo(function(){return function(e){if(Mj(e))return Object.entries(e).reduce(function(e,t){var n=Nj(t,2),a=n[0],r=n[1];return[].concat(yj(e),[a],yj(r))},[]).filter(function(e){return Fj(e)||Uj(e)}).join(",")}(n)},[n]),C=L.useMemo(function(){return function(e){return Mj(e)?[{description:"Files",accept:Object.entries(e).filter(function(e){var t=Nj(e,2),n=t[0],a=t[1],r=!0;return Fj(n)||(r=!1),Array.isArray(a)&&a.every(Uj)||(r=!1),r}).reduce(function(e,t){var n=Nj(t,2),a=n[0],r=n[1];return wj(wj({},e),{},jj({},a,r))},{})}]:e}(n)},[n]),E=L.useMemo(function(){return"function"==typeof f?f:aN},[f]),D=L.useMemo(function(){return"function"==typeof g?g:aN},[g]),P=L.useRef(null),A=L.useRef(null),T=Hj(L.useReducer(nN,eN),2),M=T[0],R=T[1],I=M.isFocused,O=M.isFileDialogActive,F=L.useRef("undefined"!=typeof window&&window.isSecureContext&&x&&"showOpenFilePicker"in window),U=function(){!F.current&&O&&setTimeout(function(){A.current&&(A.current.files.length||(R({type:"closeDialog"}),D()))},300)};L.useEffect(function(){return window.addEventListener("focus",U,!1),function(){window.removeEventListener("focus",U,!1)}},[A,O,D,F]);var z=L.useRef([]),$=function(e){P.current&&P.current.contains(e.target)||(e.preventDefault(),z.current=[])};L.useEffect(function(){return y&&(document.addEventListener("dragover",Oj,!1),document.addEventListener("drop",$,!1)),function(){y&&(document.removeEventListener("dragover",Oj),document.removeEventListener("drop",$))}},[P,y]),L.useEffect(function(){return!a&&v&&P.current&&P.current.focus(),function(){}},[P,v,a]);var B=L.useCallback(function(e){_&&_(e)},[_]),q=L.useCallback(function(e){e.preventDefault(),e.persist(),ne(e),z.current=[].concat(Vj(z.current),[e.target]),Ij(e)&&Promise.resolve(r(e)).then(function(t){if(!Rj(e)||N){var n=t.length,a=n>0&&function(e){var t=e.files,n=e.accept,a=e.minSize,r=e.maxSize,i=e.multiple,s=e.maxFiles,o=e.validator;return!(!i&&t.length>1||i&&s>=1&&t.length>s)&&t.every(function(e){var t=Nj(Aj(e,n),1)[0],i=Nj(Tj(e,a,r),1)[0],s=o?o(e):null;return t&&i&&!s})}({files:t,accept:S,minSize:s,maxSize:i,multiple:o,maxFiles:l,validator:k});R({isDragAccept:a,isDragReject:n>0&&!a,isDragActive:!0,type:"setDraggedFiles"}),c&&c(e)}}).catch(function(e){return B(e)})},[r,c,B,N,S,s,i,o,l,k]),V=L.useCallback(function(e){e.preventDefault(),e.persist(),ne(e);var t=Ij(e);if(t&&e.dataTransfer)try{e.dataTransfer.dropEffect="copy"}catch(n){}return t&&u&&u(e),!1},[u,N]),H=L.useCallback(function(e){e.preventDefault(),e.persist(),ne(e);var t=z.current.filter(function(e){return P.current&&P.current.contains(e)}),n=t.indexOf(e.target);-1!==n&&t.splice(n,1),z.current=t,t.length>0||(R({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Ij(e)&&d&&d(e))},[P,d,N]),W=L.useCallback(function(e,t){var n=[],a=[];e.forEach(function(e){var t=Hj(Aj(e,S),2),r=t[0],o=t[1],l=Hj(Tj(e,s,i),2),c=l[0],d=l[1],u=k?k(e):null;if(r&&c&&!u)n.push(e);else{var m=[o,d];u&&(m=m.concat(u)),a.push({file:e,errors:m.filter(function(e){return e})})}}),(!o&&n.length>1||o&&l>=1&&n.length>l)&&(n.forEach(function(e){a.push({file:e,errors:[Pj]})}),n.splice(0)),R({acceptedFiles:n,fileRejections:a,isDragReject:a.length>0,type:"setFiles"}),m&&m(n,a,t),a.length>0&&h&&h(a,t),n.length>0&&p&&p(n,t)},[R,o,S,s,i,l,m,p,h,k]),Y=L.useCallback(function(e){e.preventDefault(),e.persist(),ne(e),z.current=[],Ij(e)&&Promise.resolve(r(e)).then(function(t){Rj(e)&&!N||W(t,e)}).catch(function(e){return B(e)}),R({type:"reset"})},[r,W,B,N]),K=L.useCallback(function(){if(F.current){R({type:"openDialog"}),E();var e={multiple:o,types:C};window.showOpenFilePicker(e).then(function(e){return r(e)}).then(function(e){W(e,null),R({type:"closeDialog"})}).catch(function(e){var t;(t=e)instanceof DOMException&&("AbortError"===t.name||t.code===t.ABORT_ERR)?(D(e),R({type:"closeDialog"})):!function(e){return e instanceof DOMException&&("SecurityError"===e.name||e.code===e.SECURITY_ERR)}(e)?B(e):(F.current=!1,A.current?(A.current.value=null,A.current.click()):B(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided.")))})}else A.current&&(R({type:"openDialog"}),E(),A.current.value=null,A.current.click())},[R,E,D,x,W,B,C,o]),G=L.useCallback(function(e){P.current&&P.current.isEqualNode(e.target)&&(" "!==e.key&&"Enter"!==e.key&&32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),K()))},[P,K]),Q=L.useCallback(function(){R({type:"focus"})},[]),X=L.useCallback(function(){R({type:"blur"})},[]),Z=L.useCallback(function(){b||(!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return function(e){return-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident/")}(e)||function(e){return-1!==e.indexOf("Edge/")}(e)}()?K():setTimeout(K,0))},[b,K]),J=function(e){return a?null:e},ee=function(e){return w?null:J(e)},te=function(e){return j?null:J(e)},ne=function(e){N&&e.stopPropagation()},ae=L.useMemo(function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,n=void 0===t?"ref":t,r=e.role,i=e.onKeyDown,s=e.onFocus,o=e.onBlur,l=e.onClick,c=e.onDragEnter,d=e.onDragOver,u=e.onDragLeave,m=e.onDrop,p=Xj(e,Bj);return Gj(Gj(Qj({onKeyDown:ee(Lj(i,G)),onFocus:ee(Lj(s,Q)),onBlur:ee(Lj(o,X)),onClick:J(Lj(l,Z)),onDragEnter:te(Lj(c,q)),onDragOver:te(Lj(d,V)),onDragLeave:te(Lj(u,H)),onDrop:te(Lj(m,Y)),role:"string"==typeof r&&""!==r?r:"presentation"},n,P),a||w?{}:{tabIndex:0}),p)}},[P,G,Q,X,Z,q,V,H,Y,w,j,a]),re=L.useCallback(function(e){e.stopPropagation()},[]),ie=L.useMemo(function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,n=void 0===t?"ref":t,a=e.onChange,r=e.onClick,i=Xj(e,qj);return Gj(Gj({},Qj({accept:S,multiple:o,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:J(Lj(a,Y)),onClick:J(Lj(r,re)),tabIndex:-1},n,A)),i)}},[A,n,o,Y,a]);return Gj(Gj({},M),{},{isFocused:I&&!a,getRootProps:ae,getInputProps:ie,rootRef:P,inputRef:A,open:J(K)})}function nN(e,t){switch(t.type){case"focus":return Gj(Gj({},e),{},{isFocused:!0});case"blur":return Gj(Gj({},e),{},{isFocused:!1});case"openDialog":return Gj(Gj({},eN),{},{isFileDialogActive:!0});case"closeDialog":return Gj(Gj({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return Gj(Gj({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return Gj(Gj({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections,isDragReject:t.isDragReject});case"reset":return Gj({},eN);default:return e}}function aN(){}const rN=({tripId:e,currentPhoto:t,onPhotoUploaded:a,className:r=""})=>{const{user:i}=Y(),{isDemoMode:s}=X(),[o,l]=L.useState(!1),[c,d]=L.useState(!1),[u,m]=L.useState(!1),[p,h]=L.useState(""),g=L.useCallback(e=>{if(0===e.length)return;const t=e[0],n=URL.createObjectURL(t);h(n),m(!0)},[]),f=L.useCallback(()=>{t&&(h(t),m(!0))},[t]),x=L.useCallback(async t=>{m(!1),l(!0),p&&p.startsWith("blob:")&&URL.revokeObjectURL(p);try{if(s||!i){const e=URL.createObjectURL(t);return await a(e)&&(d(!0),setTimeout(()=>d(!1),2e3)),void l(!1)}const n=new File([t],`cover-${Date.now()}.jpg`,{type:"image/jpeg"}),r=new FormData;r.append("file",n),r.append("folder",`trips/${e}`);const o=3;let c=null,u=null;for(let e=1;e<=o;e++)try{const t=await W.functions.invoke("image-upload",{body:r});if(!t.error){u=t.data;break}if(c=new Error(t.error.message),e<o){await new Promise(t=>setTimeout(t,1e3*e));continue}}catch(ws){if(c=ws instanceof Error?ws:new Error(String(ws)),e<o){await new Promise(t=>setTimeout(t,1e3*e));continue}}if(!(null==u?void 0:u.url))throw c||new Error("No URL returned from upload");const m=`${u.url}?t=${Date.now()}`;await a(m)&&(d(!0),setTimeout(()=>d(!1),2e3))}catch(n){ee.error("Failed to upload photo. Please try again.")}finally{l(!1),h("")}},[i,s,e,a,p]),v=L.useCallback(()=>{m(!1),p&&p.startsWith("blob:")&&URL.revokeObjectURL(p),h("")},[p]),{getRootProps:y,getInputProps:b,isDragActive:w}=tN({onDrop:g,accept:{"image/*":[".png",".jpg",".jpeg",".gif"]},maxSize:10485760,multiple:!1});return n.jsxs(n.Fragment,{children:[t?n.jsxs("div",{className:`relative group overflow-hidden rounded-2xl ${r}`,children:[n.jsx("img",{src:t,alt:`Cover photo for trip ${e}`,className:"w-full h-full object-cover"}),n.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-2xl flex items-center justify-center gap-3",children:[n.jsxs("button",{onClick:f,disabled:o,className:"cursor-pointer bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl px-4 py-2 flex items-center gap-2 text-white hover:bg-white/30 transition-colors disabled:opacity-50",children:[n.jsx(oa,{size:16}),n.jsx("span",{className:"text-sm font-medium",children:"Adjust Position"})]}),n.jsxs("div",{...y(),className:"cursor-pointer bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl px-4 py-2 flex items-center gap-2 text-white hover:bg-white/30 transition-colors",children:[n.jsx("input",{...b()}),n.jsx(yn,{size:16}),n.jsx("span",{className:"text-sm font-medium",children:"Change Photo"})]})]}),o&&n.jsx("div",{className:"absolute inset-0 bg-black/60 rounded-2xl flex items-center justify-center",children:n.jsxs("div",{className:"text-white text-center",children:[n.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-2"}),n.jsx("span",{className:"text-sm",children:"Uploading..."})]})}),c&&n.jsx("div",{className:"absolute inset-0 bg-green-500/60 rounded-2xl flex items-center justify-center",children:n.jsxs("div",{className:"text-white text-center",children:[n.jsx(Qt,{size:32,className:"mx-auto mb-2"}),n.jsx("span",{className:"text-sm font-medium",children:"Photo Updated!"})]})})]}):n.jsxs("div",{...y(),className:`border-2 border-dashed border-white/30 rounded-2xl p-8 text-center cursor-pointer transition-all hover:border-white/50 hover:bg-white/5 min-h-[192px] ${w?"border-blue-400 bg-blue-400/10":""} ${r}`,children:[n.jsx("input",{...b()}),n.jsxs("div",{className:"text-white",children:[n.jsx(pn,{size:48,className:"mx-auto mb-4 text-white/70"}),n.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Upload Trip Cover Photo"}),n.jsx("p",{className:"text-gray-300 text-sm mb-4",children:w?"Drop your photo here...":"Drag & drop a photo here, or click to browse"}),n.jsx("p",{className:"text-gray-400 text-xs",children:"Supports PNG, JPG, GIF â€¢ Max 10MB"}),!i&&n.jsx("p",{className:"text-yellow-400 text-xs mt-2",children:"Demo mode: Photos will be shown temporarily. Sign in for full functionality."})]}),o&&n.jsxs("div",{className:"mt-4",children:[n.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-2"}),n.jsx("span",{className:"text-sm text-white",children:"Uploading..."})]})]}),p&&n.jsx(Qw,{isOpen:u,onClose:v,imageSrc:p,onCropComplete:x})]})},iN=({isOpen:e,onClose:t,trip:a,onUpdate:r})=>{const{user:i}=Y(),[s,o]=L.useState(!1),{coverPhoto:l,updateCoverPhoto:c}=Zw(a.id.toString(),a.coverPhoto),[d,u]=L.useState({name:"",destination:"",start_date:"",end_date:""});L.useEffect(()=>{if(e){const e=(e=>{try{const t=e.split(" - ");if(2!==t.length)throw new Error("Invalid date range format");const n=t[0].trim(),a=t[1].trim(),r=a.match(/, (\d{4})$/),i=r?r[1]:(new Date).getFullYear().toString(),s=a.replace(/, \d{4}$/,"").trim(),o=An(`${n}, ${i}`,"MMM d, yyyy",new Date),l=An(`${s}, ${i}`,"MMM d, yyyy",new Date);return{start:Nn(o,"yyyy-MM-dd"),end:Nn(l,"yyyy-MM-dd")}}catch(t){const e=Nn(new Date,"yyyy-MM-dd");return{start:e,end:e}}})(a.dateRange);u({name:a.title,destination:a.location,start_date:e.start,end_date:e.end})}},[e,a]);return e?n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",children:n.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl p-6 max-w-md w-full animate-scale-in relative",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-white",children:"Edit Trip Details"}),n.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors p-2",disabled:s,children:n.jsx(ae,{size:24})})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2",children:[n.jsx(fn,{size:16}),"Cover Photo ",a.trip_type&&"consumer"!==a.trip_type&&"(Background Overlay)"]}),n.jsx(rN,{tripId:a.id.toString(),currentPhoto:l,onPhotoUploaded:c,className:"h-48 w-full"}),"pro"===a.trip_type&&n.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"For Enterprise trips, your photo will appear subtly in the background of the header with a professional overlay."}),"event"===a.trip_type&&n.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"For Events, your photo will appear as a darker cinematic backdrop behind the event details for poster-style impact."})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2",children:[n.jsx(ja,{size:16}),"Trip Name"]}),n.jsx("input",{type:"text",value:d.name,onChange:e=>u({...d,name:e.target.value}),maxLength:100,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all",placeholder:"Enter trip name",disabled:s})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2",children:[n.jsx(Un,{size:16}),"Location"]}),n.jsx("input",{type:"text",value:d.destination,onChange:e=>u({...d,destination:e.target.value}),maxLength:200,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all",placeholder:"Enter destination",disabled:s})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2",children:[n.jsx(dn,{size:16}),"Start Date"]}),n.jsxs(Vt,{children:[n.jsx(Ht,{asChild:!0,children:n.jsxs("button",{disabled:s,className:G("w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all text-left flex items-center justify-between",!d.start_date&&"text-gray-500"),children:[d.start_date?Nn(new Date(d.start_date),"MMM d, yyyy"):"Pick a date",n.jsx(dn,{size:16,className:"opacity-50"})]})}),n.jsx(Wt,{className:"w-auto p-0 bg-gray-900 border-white/10",align:"start",children:n.jsx(Yt,{mode:"single",selected:d.start_date?new Date(d.start_date):void 0,onSelect:e=>e&&u({...d,start_date:Nn(e,"yyyy-MM-dd")}),initialFocus:!0,className:"pointer-events-auto"})})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2",children:[n.jsx(dn,{size:16}),"End Date"]}),n.jsxs(Vt,{children:[n.jsx(Ht,{asChild:!0,children:n.jsxs("button",{disabled:s,className:G("w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all text-left flex items-center justify-between",!d.end_date&&"text-gray-500"),children:[d.end_date?Nn(new Date(d.end_date),"MMM d, yyyy"):"Pick a date",n.jsx(dn,{size:16,className:"opacity-50"})]})}),n.jsx(Wt,{className:"w-auto p-0 bg-gray-900 border-white/10",align:"start",children:n.jsx(Yt,{mode:"single",selected:d.end_date?new Date(d.end_date):void 0,onSelect:e=>e&&u({...d,end_date:Nn(e,"yyyy-MM-dd")}),initialFocus:!0,className:"pointer-events-auto"})})]})]})]}),n.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-xl p-4",children:n.jsx("p",{className:"text-sm text-blue-300",children:i?"â„¹ï¸ All trip members can see these changes immediately":"â„¹ï¸ Changes save instantly in demo mode and sync when you log in"})})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:t,className:"flex-1 px-4 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-white font-medium transition-all",disabled:s,children:"Cancel"}),n.jsx("button",{onClick:async()=>{if(d.name.trim())if(d.destination.trim())if(new Date(d.end_date)<new Date(d.start_date))Ae({title:"Validation Error",description:"End date must be after start date",variant:"destructive"});else{o(!0);try{const e={name:d.name,destination:d.destination,start_date:d.start_date,end_date:d.end_date},n={title:d.name,location:d.destination,dateRange:ij(d.start_date,d.end_date),coverPhoto:l};if(!i)return localStorage.setItem(`trip_${a.id}_updates`,JSON.stringify(e)),r&&r(n),Ae({title:"Changes saved",description:"Trip details updated successfully (demo mode)"}),void t();if(!(await Ue.updateTrip(a.id.toString(),e)))throw new Error("Failed to update trip");r&&r(n),Ae({title:"Changes saved",description:"Trip details updated successfully"}),t()}catch(e){Ae({title:"Update failed",description:"Could not update trip details. Please try again.",variant:"destructive"})}finally{o(!1)}}else Ae({title:"Validation Error",description:"Location is required",variant:"destructive"});else Ae({title:"Validation Error",description:"Trip name is required",variant:"destructive"})},disabled:s,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl text-white font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:s?n.jsxs(n.Fragment,{children:[n.jsx(bn,{size:18,className:"animate-spin"}),"Saving..."]}):"Save Changes"})]})]})}):null},sN={1:[{id:"demo-request-1",trip_id:"1",user_id:"demo-user-123",invite_code:"SPRING2024",status:"pending",requested_at:new Date(Date.now()-3e5).toISOString(),profile:{display_name:"Alex Johnson",avatar_url:void 0,email:"alex@example.com"}},{id:"demo-request-2",trip_id:"1",user_id:"demo-user-456",invite_code:"SPRING2024",status:"pending",requested_at:new Date(Date.now()-18e5).toISOString(),profile:{display_name:"Jordan Smith",avatar_url:void 0,email:"jordan@example.com"}}],2:[{id:"demo-request-3",trip_id:"2",user_id:"demo-user-789",invite_code:"EURO2024",status:"pending",requested_at:new Date(Date.now()-72e5).toISOString(),profile:{display_name:"Taylor Williams",avatar_url:void 0,email:"taylor@example.com"}}],3:[{id:"demo-request-tokyo-1",trip_id:"3",user_id:"demo-user-tokyo-1",invite_code:"TOKYO2024",status:"pending",requested_at:new Date(Date.now()-27e5).toISOString(),profile:{display_name:"Kenji Watanabe",avatar_url:void 0,email:"kenji@example.com"}},{id:"demo-request-tokyo-2",trip_id:"3",user_id:"demo-user-tokyo-2",invite_code:"TOKYO2024",status:"pending",requested_at:new Date(Date.now()-72e5).toISOString(),profile:{display_name:"Yuki Tanaka",avatar_url:void 0,email:"yuki@example.com"}}],4:[{id:"demo-request-wedding-1",trip_id:"4",user_id:"demo-user-wedding-1",invite_code:"WEDDING2024",status:"pending",requested_at:new Date(Date.now()-9e5).toISOString(),profile:{display_name:"Michael Chen",avatar_url:void 0,email:"michael@example.com"}},{id:"demo-request-wedding-2",trip_id:"4",user_id:"demo-user-wedding-2",invite_code:"WEDDING2024",status:"pending",requested_at:new Date(Date.now()-36e5).toISOString(),profile:{display_name:"Emma Rodriguez",avatar_url:void 0,email:"emma@example.com"}},{id:"demo-request-wedding-3",trip_id:"4",user_id:"demo-user-wedding-3",invite_code:"WEDDING2024",status:"pending",requested_at:new Date(Date.now()-108e5).toISOString(),profile:{display_name:"David Park",avatar_url:void 0,email:"david@example.com"}}],"pro-1":[{id:"demo-request-pro-1",trip_id:"pro-1",user_id:"demo-user-pro-1",invite_code:"TEAM2024",status:"pending",requested_at:new Date(Date.now()-9e5).toISOString(),profile:{display_name:"Chris Martinez",avatar_url:void 0,email:"chris@example.com"}}]},oN=({tripId:e,enabled:t=!0,isDemoMode:n=!1})=>{const[a,r]=L.useState([]),[i,s]=L.useState(!0),[o,l]=L.useState(!1),c=L.useCallback(async()=>{if(t&&e){if(n)return r((e=>sN[e]||[])(e)),void s(!1);try{s(!0);const{data:t,error:n}=await W.from("trip_join_requests").select("id, trip_id, user_id, invite_code, status, requested_at, resolved_at, resolved_by").eq("trip_id",e).eq("status","pending").order("requested_at",{ascending:!1});if(n)throw n;const a=await Promise.all((t||[]).map(async e=>{const{data:t,error:n}=await W.from("profiles").select("display_name, avatar_url, email, first_name, last_name").eq("user_id",e.user_id).maybeSingle();let a=null;return t&&(a=t.display_name,a||(a=t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.first_name?t.first_name:t.last_name?t.last_name:t.email)),a=a||"Unknown User",{...e,profile:{display_name:a,avatar_url:null==t?void 0:t.avatar_url,email:null==t?void 0:t.email,first_name:null==t?void 0:t.first_name,last_name:null==t?void 0:t.last_name}}}));r(a)}catch(a){ee.error("Failed to load join requests")}finally{s(!1)}}else s(!1)},[e,t,n]);L.useEffect(()=>{c()},[c]),L.useEffect(()=>{if(!t||!e||n)return;const a=W.channel(`trip_join_requests:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"trip_join_requests",filter:`trip_id=eq.${e}`},()=>{c()}).subscribe();return()=>{W.removeChannel(a)}},[e,t,n,c]);const d=L.useCallback(async t=>{var i,s,o;if(l(!0),n){const n=a.find(e=>e.id===t);if(n){const{addMember:t}=Fe.getState();t(e,{id:n.user_id,name:(null==(i=n.profile)?void 0:i.display_name)||"New Member",avatar:null==(s=n.profile)?void 0:s.avatar_url,email:null==(o=n.profile)?void 0:o.email})}return r(e=>e.filter(e=>e.id!==t)),ee.success("âœ… Request approved - member added to trip!"),void l(!1)}try{const{data:e,error:n}=await W.rpc("approve_join_request",{_request_id:t});if(n)throw n;const a=e;if(a&&!a.success)throw new Error(a.message||"Failed to approve request");ee.success("âœ… Request approved"),await c()}catch(d){throw ee.error(d instanceof Error?d.message:"Failed to approve request"),d}finally{l(!1)}},[c,n,a,e]),u=L.useCallback(async e=>{if(l(!0),n)return r(t=>t.filter(t=>t.id!==e)),ee.success("Request rejected"),void l(!1);try{const{data:t,error:n}=await W.rpc("reject_join_request",{_request_id:e});if(n)throw n;const a=t;if(a&&!a.success)throw new Error(a.message||"Failed to reject request");ee.success("Request rejected"),await c()}catch(t){throw ee.error(t instanceof Error?t.message:"Failed to reject request"),t}finally{l(!1)}},[c,n]);return{requests:a,isLoading:i,isProcessing:o,approveRequest:d,rejectRequest:u,refetch:c}},lN=[],cN=({trip:e,onManageUsers:t,onDescriptionUpdate:a,onTripUpdate:r,onShowExport:i,category:s,tags:o=[],onCategoryChange:l})=>{const c=q(),[d,u]=V(),[m,p]=L.useState(!1),[h,g]=L.useState(!1),[f,x]=L.useState("members"),[v,y]=L.useState(!1),[b,w]=L.useState(!1),[j,N]=L.useState(!1),[_,k]=L.useState(0);L.useEffect(()=>{const e=d.get("showCollaborators");if("requests"===e||"members"===e){x(e),g(!0);const t=setTimeout(()=>{const e=new URLSearchParams(window.location.search);e.get("showCollaborators")&&(e.delete("showCollaborators"),u(e,{replace:!0}))},100);return()=>clearTimeout(t)}},[d,u]);const{variant:S,accentColors:C}=be(),{coverPhoto:E,updateCoverPhoto:D,isUpdating:P}=Zw(e.id.toString(),e.coverPhoto),{user:A}=Y(),{isDemoMode:T}=X(),{tripCreatorId:M,canRemoveMembers:R,removeMember:I,leaveTrip:O}=Uh(e.id.toString()),[F,U]=L.useState(!1),[z,B]=L.useState(!1),[H,K]=L.useState(null),{requests:Q,approveRequest:Z,rejectRequest:J,isProcessing:te}=oN({tripId:e.id.toString(),enabled:!0,isDemoMode:T}),[ne,ae]=L.useState(T);L.useEffect(()=>{if(T)return void ae(!0);if(!(null==A?void 0:A.id))return void ae(!1);if(e.created_by&&A.id===e.created_by)return void ae(!0);if(M&&A.id===M)return void ae(!0);if(void 0===M)return;(async()=>{const e=await R();ae(e)})()},[R,T,null==A?void 0:A.id,M,e.created_by]);const re=Fe(t=>T?t.addedMembers[e.id.toString()]??lN:lN),ie=$.useMemo(()=>{if(!T||0===re.length)return e.participants;const t=new Set(e.participants.map(e=>e.id.toString())),n=re.filter(e=>!t.has(e.id.toString())).map(e=>({id:e.id,name:e.name,avatar:e.avatar||"",role:e.role,email:e.email}));return[...e.participants,...n]},[e.participants,re,T]),se="pro"===S;(null==A?void 0:A.id)&&(A.id===M||(A.id,e.created_by));const oe="pro"===e.trip_type||"event"===e.trip_type,le="event"===e.trip_type,ce=Boolean(E),de=L.useRef(null);return n.jsxs(n.Fragment,{children:[!oe&&n.jsx("div",{className:"relative mb-8 rounded-3xl overflow-hidden",children:n.jsxs("div",{className:"aspect-[3/1] w-full bg-cover bg-center relative",style:{backgroundImage:E?`url(${E})`:void 0,backgroundColor:E?void 0:"#1a1a2e"},children:[n.jsx("div",{className:G("absolute inset-0",E?"bg-gradient-to-t from-black/60 via-black/20 to-transparent":"bg-gradient-to-t from-black/80 via-gray-900/90 to-gray-800/70")}),n.jsxs("div",{className:"absolute bottom-6 left-8 right-8 z-10",children:[n.jsx("div",{className:"flex items-center gap-3 mb-2",children:n.jsx("h1",{className:"text-4xl font-bold text-white",children:e.title})}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-white/90",children:[n.jsx(Un,{size:18}),n.jsx("span",{children:e.location})]}),n.jsxs("div",{className:"flex items-center gap-2 text-white/90",children:[n.jsx(dn,{size:18}),n.jsx("span",{children:e.dateRange})]})]})]}),!E&&n.jsxs("div",{className:"absolute top-4 right-4 z-10",children:[n.jsx("button",{onClick:()=>{var e;null==(e=de.current)||e.click()},disabled:P||F,className:"flex items-center gap-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 rounded-xl px-4 py-2 text-white/80 hover:text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Add cover photo",children:F?n.jsxs(n.Fragment,{children:[n.jsx(bn,{size:16,className:"animate-spin"}),n.jsx("span",{className:"text-sm font-medium",children:"Uploading..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(yn,{size:16}),n.jsx("span",{className:"text-sm font-medium",children:"Add Cover Photo"})]})}),n.jsx("input",{ref:de,type:"file",accept:"image/*",onChange:async e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];if(!n)return;if(!n.type.startsWith("image/"))return void ee.error("Please select an image file");if(n.size>10485760)return void ee.error("File size must be less than 10MB");const a=URL.createObjectURL(n);K(a),B(!0),de.current&&(de.current.value="")},className:"hidden"})]}),n.jsxs("div",{className:"absolute bottom-2 right-2 z-10 flex items-center gap-2",children:[E&&n.jsx("button",{onClick:()=>{E&&(K(E),B(!0))},disabled:P||F,className:"p-1.5 bg-black/40 hover:bg-black/60 backdrop-blur-sm border border-white/20 rounded-lg transition-all text-white/80 hover:text-white shadow-lg disabled:opacity-50",title:"Adjust cover photo position",children:n.jsx(oa,{size:14})}),n.jsx("button",{onClick:()=>y(!0),className:"p-1.5 bg-black/40 hover:bg-black/60 backdrop-blur-sm border border-white/20 rounded-lg transition-all text-white/80 hover:text-white shadow-lg",title:"Edit trip details",children:n.jsx(xt,{size:14})})]})]})}),n.jsxs("div",{className:G("relative rounded-3xl p-4 mb-3 overflow-hidden border border-white/20",ce&&oe?"shadow-2xl":"bg-white/10 backdrop-blur-md"),children:[ce&&oe&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-all duration-500",style:{backgroundImage:`url(${E})`,filter:le?"brightness(0.25)":"brightness(0.35)"}}),n.jsx("div",{className:G("absolute inset-0",le?"bg-gradient-to-t from-black/90 via-black/50 to-transparent":"bg-gradient-to-t from-black/70 via-black/40 to-transparent")})]}),n.jsxs("div",{className:G("grid grid-cols-1 lg:grid-cols-2 gap-6",ce&&oe&&"relative z-10"),children:[n.jsxs("div",{className:"space-y-4",children:[oe&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex items-center gap-3 mb-4",children:n.jsx("h1",{className:"text-4xl font-bold text-white",children:e.title})}),se&&s&&n.jsx("div",{className:"mb-4",children:n.jsx(tj,{category:s,tags:o})}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 mb-6",children:[n.jsxs("div",{className:G("flex items-center gap-2",E?"text-white/90":"text-gray-300"),children:[n.jsx(Un,{size:18,className:E?void 0:`text-${C.primary}`}),n.jsx("span",{children:e.location})]}),n.jsxs("div",{className:G("flex items-center gap-2",E?"text-white/90":"text-gray-300"),children:[n.jsx(dn,{size:18,className:E?void 0:`text-${C.primary}`}),n.jsx("span",{children:e.dateRange})]})]})]}),n.jsx(Xw,{tripId:e.id.toString(),description:e.description,onUpdate:a||(()=>{}),className:"text-gray-300 text-lg leading-relaxed",externalEditTrigger:_,hideInlineButtonOnLg:!0})]}),n.jsxs("div",{className:G("rounded-2xl p-3 pb-2 w-full border border-white/10 max-h-[240px]",ce&&oe?"bg-black/50 backdrop-blur-md":"bg-white/5 backdrop-blur-sm"),children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ln,{size:20,className:`text-${C.primary}`}),n.jsx("h3",{className:"text-white font-semibold text-sm",children:le?"Event Team":"Trip Collaborators"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-gray-400 text-sm",children:ie.length}),t&&n.jsx("button",{onClick:t,className:`text-gray-400 hover:text-${C.primary} transition-colors p-1 rounded-lg hover:bg-white/10`,title:"Manage users",children:n.jsx(gn,{size:16})})]})]}),se&&s&&n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"block text-gray-400 text-xs mb-1",children:"Trip Category"}),n.jsx("div",{className:"px-3 py-1.5 bg-white/5 border border-white/10 rounded-lg text-white text-sm",children:s})]}),n.jsx(aj,{participants:ie,countLabel:`${ie.length} collaborators`,onShowAll:()=>g(!0),maxRows:1,minColWidth:140,tripType:e.trip_type||"consumer"}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-1.5",children:[n.jsxs("button",{onClick:()=>p(!0),className:`flex items-center justify-center gap-1.5 bg-gradient-to-r ${C.gradient} hover:from-${C.primary}/80 hover:to-${C.secondary}/80 text-white text-xs font-medium py-1.5 px-2.5 rounded-lg transition-all duration-200 hover:scale-105`,title:"Invite people to this trip",children:[n.jsx(vn,{size:14}),n.jsx("span",{children:"Invite to Trip"})]}),n.jsxs("button",{onClick:()=>w(!0),className:"flex items-center justify-center gap-1.5 bg-red-600/20 hover:bg-red-600/30 border border-red-500/30 text-red-300 text-xs font-medium py-1.5 px-2.5 rounded-lg transition-all duration-200",title:"Leave this trip",children:[n.jsx(on,{size:14}),n.jsx("span",{children:"Exit Trip"})]}),n.jsxs("button",{onClick:()=>null==i?void 0:i(),disabled:!1,className:G("flex items-center justify-center gap-1.5 text-xs font-medium py-1.5 px-2.5 rounded-lg transition-all duration-200",`bg-gradient-to-r ${C.gradient} hover:from-${C.primary}/80 hover:to-${C.secondary}/80 text-white hover:scale-105`),title:"Export Trip to PDF","aria-label":"Export Trip to PDF",children:[n.jsx(Ge,{size:14}),n.jsx("span",{children:"Export to PDF"})]})]})]})]}),n.jsx("div",{className:"hidden lg:block absolute bottom-2 left-2 z-20",children:n.jsx("button",{onClick:()=>k(e=>e+1),className:G("p-1.5 border border-white/20 rounded-lg transition-all shadow-lg backdrop-blur-sm",ce&&oe?"bg-black/40 hover:bg-black/60 text-white/80 hover:text-white":"bg-white/10 hover:bg-white/20 text-gray-400 hover:text-white"),title:"Edit description",children:n.jsx(xt,{size:14})})}),oe&&n.jsx("div",{className:"absolute bottom-2 right-2 z-20",children:n.jsx("button",{onClick:()=>y(!0),className:G("p-1.5 border border-white/20 rounded-lg transition-all shadow-lg backdrop-blur-sm",ce&&oe?"bg-black/40 hover:bg-black/60 text-white/80 hover:text-white":"bg-white/10 hover:bg-white/20 text-gray-400 hover:text-white"),title:"Edit trip details",children:n.jsx(xt,{size:14})})})]}),n.jsx(Qe,{isOpen:m,onClose:()=>p(!1),tripName:e.title,tripId:e.id.toString()}),n.jsx(rj,{open:h,onOpenChange:e=>{g(e),e||x("members")},participants:ie,tripType:e.trip_type||"consumer",currentUserId:null==A?void 0:A.id,tripCreatorId:M,isAdmin:ne,onRemoveMember:I,pendingRequests:Q,onApproveRequest:Z,onRejectRequest:J,isProcessingRequest:te,initialTab:f}),n.jsx(iN,{isOpen:v,onClose:()=>y(!1),trip:e,onUpdate:e=>{r&&r(e)}}),H&&n.jsx(Qw,{isOpen:z,onClose:()=>{B(!1),(null==H?void 0:H.startsWith("blob:"))&&URL.revokeObjectURL(H),K(null)},imageSrc:H,onCropComplete:async t=>{if(B(!1),T){const e=URL.createObjectURL(t);return await D(e),(null==H?void 0:H.startsWith("blob:"))&&URL.revokeObjectURL(H),void K(null)}if(A){U(!0);try{const n=`${e.id}-${Date.now()}.jpg`,a=`trip-covers/${e.id}/${n}`,{error:r}=await W.storage.from("trip-media").upload(a,t,{cacheControl:"3600",upsert:!0,contentType:"image/jpeg"});if(r)return void ee.error(`Failed to upload: ${r.message}`);const{data:i}=W.storage.from("trip-media").getPublicUrl(a);if(!(null==i?void 0:i.publicUrl))return void ee.error("Failed to get image URL");const s=`${i.publicUrl}?t=${Date.now()}`;await D(s)}catch(n){ee.error("Failed to upload cover photo")}finally{U(!1),(null==H?void 0:H.startsWith("blob:"))&&URL.revokeObjectURL(H),K(null)}}else ee.error("Please sign in to upload cover photos")}}),b&&n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-md border border-white/20 rounded-3xl p-6 max-w-md w-full",children:[n.jsxs("div",{className:"flex items-center gap-3 text-red-400 mb-4",children:[n.jsx(Se,{size:24}),n.jsx("h3",{className:"text-xl font-bold text-white",children:"Leave Trip?"})]}),n.jsxs("p",{className:"text-gray-300 mb-6",children:['Are you sure you want to leave "',e.title,"\"? You'll lose access to all trip information, chat history, and won't receive updates.",oe&&n.jsxs("span",{className:"block mt-2 text-amber-400 text-sm",children:["Note: This is a ","event"===e.trip_type?"event":"Pro trip",". You'll need approval to rejoin even with the same invite link."]})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>w(!1),disabled:j,className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-xl transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:async()=>{if(T)return N(!0),await new Promise(e=>setTimeout(e,500)),N(!1),w(!1),ee.success(`You have left "${e.title}"`),void c("/");if(!(null==A?void 0:A.id))return void ee.error("You must be logged in to leave a trip");N(!0);const t=await O(e.title);N(!1),t&&(w(!1),ee.success(`You have left "${e.title}"`),c("/"))},disabled:j,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-xl transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[j?n.jsx(bn,{className:"animate-spin",size:18}):n.jsx(on,{size:18}),"Leave Trip"]})]})]})})]})},dN=Object.freeze(Object.defineProperty({__proto__:null,TripHeader:cN},Symbol.toStringTag,{value:"Module"})),uN=({trip:e,isOpen:t,onClose:a,onDescriptionUpdate:r,onShowExport:i,category:s,tags:o})=>n.jsx(Jb,{open:t,onOpenChange:e=>!e&&a(),children:n.jsxs(aw,{className:"bg-black border-t border-white/10 !mt-4 min-h-[70vh] flex flex-col",children:[n.jsx(rw,{className:"border-b border-white/10 !p-3 flex-shrink-0",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx(iw,{className:"text-white text-lg font-semibold",children:"Trip Details"}),n.jsx(tw,{asChild:!0,children:n.jsx("button",{onClick:()=>{bo.light(),a()},className:"p-2 rounded-lg hover:bg-white/10 active:scale-95 transition-all",children:n.jsx(ae,{size:20,className:"text-white"})})})]})}),n.jsx("div",{className:"px-4 py-3 flex-1 overflow-y-auto flex flex-col justify-center",children:n.jsx(cN,{trip:e,onDescriptionUpdate:r,onShowExport:i,category:s,tags:o})})]})}),mN=({isOpen:e,onClose:t,onShare:a,onExport:r,onInvite:i,onDelete:s,tripTitle:o="Trip"})=>{const l=e=>{bo.light(),t(),e&&setTimeout(e,150)};return n.jsx(Jb,{open:e,onOpenChange:e=>!e&&t(),children:n.jsxs(aw,{className:"bg-gray-900 border-gray-800",children:[n.jsx(rw,{className:"border-b border-gray-800 pb-4",children:n.jsx(iw,{className:"text-white text-center",children:o})}),n.jsxs("div",{className:"p-4 space-y-2",children:[a&&n.jsxs("button",{onClick:()=>l(a),className:"w-full flex items-center gap-4 p-4 rounded-xl bg-gray-800/50 hover:bg-gray-800 active:scale-[0.98] transition-all text-left",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center",children:n.jsx(ea,{size:20,className:"text-blue-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Share Trip"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Send trip details to friends"})]})]}),r&&n.jsxs("button",{onClick:()=>l(r),className:"w-full flex items-center gap-4 p-4 rounded-xl bg-gray-800/50 hover:bg-gray-800 active:scale-[0.98] transition-all text-left",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center",children:n.jsx(Ge,{size:20,className:"text-emerald-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Export to PDF"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Download trip summary"})]})]}),i&&n.jsxs("button",{onClick:()=>l(i),className:"w-full flex items-center gap-4 p-4 rounded-xl bg-gray-800/50 hover:bg-gray-800 active:scale-[0.98] transition-all text-left",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center",children:n.jsx(Xn,{size:20,className:"text-purple-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Invite"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Add people to this trip"})]})]}),s&&n.jsxs("button",{onClick:()=>l(s),className:"w-full flex items-center gap-4 p-4 rounded-xl bg-gray-800/50 hover:bg-gray-800 active:scale-[0.98] transition-all text-left",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center",children:n.jsx(ie,{size:20,className:"text-red-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-red-400 font-medium",children:"Delete for me"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Remove trip from your account"})]})]})]}),n.jsx("div",{className:"p-4 pt-0",children:n.jsx("button",{onClick:()=>l(),className:"w-full p-4 rounded-xl bg-gray-800 hover:bg-gray-700 active:scale-[0.98] transition-all text-gray-400 font-medium",children:"Cancel"})})]})})},pN=()=>{const e=q(),[t,a]=L.useState("all"),[r,i]=L.useState(""),s=[].filter(e=>"unread"===t?!e.isRead:"mentions"!==t||e.mentions&&e.mentions.length>0),o=e=>{const t=new Date(e),n=new Date,a=Math.floor((n.getTime()-t.getTime())/6e4);return a<60?`${a}m ago`:a<1440?`${Math.floor(a/60)}h ago`:t.toLocaleDateString()};return n.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl p-6",children:[n.jsx("div",{className:"flex items-center justify-between mb-6",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Ct,{size:24,className:"text-glass-orange"}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-semibold text-white",children:"Message Inbox"}),n.jsxs("p",{className:"text-slate-400 text-sm",children:[0," unread messages"]})]})]})}),n.jsxs("div",{className:"relative mb-6",children:[n.jsx($t,{size:20,className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"}),n.jsx("input",{type:"text",placeholder:"Search messages, people, or trips...",value:r,onChange:e=>i(e.target.value),className:"w-full bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl pl-12 pr-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-glass-orange"})]}),n.jsx("div",{className:"flex gap-2 mb-6",children:["all","unread","mentions"].map(e=>n.jsx("button",{onClick:()=>a(e),className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors "+(t===e?"bg-glass-orange text-white":"bg-white/10 text-gray-300 hover:bg-white/20"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),n.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:s.map(t=>{const a=(e=>e.tripName?e.tripName:e.tourName?e.tourName:e.tripId?"Trip":e.tourId?"Tour":null)(t),r=(e=>e.tripId&&e.tourId?"bg-purple-500/20 text-purple-400 border-purple-500/30":e.tripId?"bg-blue-500/20 text-blue-400 border-blue-500/30":e.tourId?"bg-glass-orange/20 text-glass-orange border-glass-orange/30":"bg-gray-500/20 text-gray-400 border-gray-500/30")(t);return n.jsx("div",{onClick:()=>(t=>{t.tripId?e(`/trip/${t.tripId}`):t.tourId&&e(`/tour/pro/${t.tourId}`)})(t),className:"p-4 rounded-xl cursor-pointer transition-all hover:bg-white/10 "+(t.isRead?"bg-white/2":"bg-white/5 border-l-4 border-glass-orange"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsxs(Vn,{className:"w-10 h-10 flex-shrink-0",children:[n.jsx(Hn,{src:t.senderAvatar,alt:t.senderName}),n.jsx(Wn,{className:"bg-muted text-muted-foreground text-sm font-semibold",children:St(t.senderName)})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-white font-medium",children:t.senderName}),a&&n.jsx("span",{className:`text-xs px-2 py-1 rounded-full border backdrop-blur-sm truncate max-w-32 ${r}`,children:a})]}),n.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs",children:[n.jsx(Kn,{size:12}),o(t.timestamp)]})]}),n.jsx("p",{className:"text-gray-300 text-sm truncate",children:t.content}),t.mentions&&t.mentions.includes("everyone")&&n.jsx("div",{className:"mt-2",children:n.jsxs("span",{className:"text-xs bg-red-500/20 text-red-400 px-2 py-1 rounded flex items-center gap-1 w-fit",children:[n.jsx(hn,{size:10}),"@everyone"]})})]}),!t.isRead&&n.jsx("div",{className:"w-2 h-2 bg-glass-orange rounded-full"})]})},t.id)})}),0===s.length&&n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Ct,{size:48,className:"text-slate-600 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"No messages found"}),n.jsx("p",{className:"text-slate-500 text-sm",children:r?"Try a different search term":"Your messages will appear here"})]})]})},hN=({tripId:e,tripName:t,users:a,currentUserId:r,onUserRemoved:i,onLeaveTrip:s})=>{Y();const[o,l]=L.useState(!1),[c,d]=L.useState(null),[u,m]=L.useState(null),p=a.find(e=>e.id===r),h="owner"===(null==p?void 0:p.role),g="admin"===(null==p?void 0:p.role)||h,f=e=>{switch(e){case"owner":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";case"admin":return"bg-blue-500/20 text-blue-300 border-blue-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-white",children:"Trip Members"}),n.jsxs("p",{className:"text-gray-400 text-sm",children:[a.length," people in this trip"]})]}),n.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 bg-red-600/20 hover:bg-red-600/30 border border-red-500/30 text-red-300 px-4 py-2 rounded-xl transition-colors",children:[n.jsx(on,{size:16}),n.jsx("span",{className:"hidden sm:inline",children:"Leave Trip"})]})]}),n.jsx("div",{className:"space-y-3",children:a.map(e=>{return n.jsxs("div",{className:"flex items-center justify-between bg-white/5 border border-white/10 rounded-xl p-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("img",{src:e.avatar,alt:e.name,className:"w-10 h-10 rounded-full border-2 border-white/20"}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-white font-medium",children:e.name}),e.id===r&&n.jsx("span",{className:"text-xs bg-glass-orange/20 text-glass-orange px-2 py-1 rounded",children:"You"})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.role&&n.jsx("span",{className:`text-xs px-2 py-1 rounded border ${f(e.role)}`,children:e.role}),n.jsxs("span",{className:"text-xs text-gray-400",children:["Joined ",new Date(e.joinedAt).toLocaleDateString()]})]})]})]}),(t=e,!(t.id===r||"owner"===t.role||!h&&(!g||"admin"===t.role))&&n.jsxs("div",{className:"relative",children:[n.jsx("button",{onClick:()=>m(u===e.id?null:e.id),className:"text-gray-400 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-colors",children:n.jsx(mn,{size:16})}),u===e.id&&n.jsx("div",{className:"absolute right-0 top-full mt-2 bg-gray-900/95 backdrop-blur-md border border-gray-700 rounded-xl shadow-xl z-10 min-w-[180px]",children:n.jsxs("button",{onClick:()=>d(e),className:"w-full flex items-center gap-3 px-4 py-3 text-red-300 hover:bg-red-500/10 rounded-xl transition-colors",children:[n.jsx(Na,{size:16}),"Remove from trip"]})})]}))]},e.id);var t})})]}),o&&n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl p-8 max-w-md w-full",children:[n.jsxs("div",{className:"flex items-center gap-3 text-red-400 mb-4",children:[n.jsx(Se,{size:24}),n.jsx("h3",{className:"text-xl font-bold text-white",children:"Leave Trip?"})]}),n.jsxs("p",{className:"text-gray-300 mb-6",children:['Are you sure you want to leave "',t,"\"? You'll lose access to all trip information and won't receive updates."]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>l(!1),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-xl transition-colors",children:"Cancel"}),n.jsx("button",{onClick:()=>{s(),l(!1)},className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-xl transition-colors",children:"Leave Trip"})]})]})}),c&&n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl p-8 max-w-md w-full",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[n.jsx(Na,{size:24}),n.jsx("h3",{className:"text-xl font-bold text-white",children:"Remove User?"})]}),n.jsx("button",{onClick:()=>d(null),className:"text-gray-400 hover:text-white",children:n.jsx(ae,{size:20})})]}),n.jsxs("div",{className:"flex items-center gap-3 bg-white/5 border border-white/10 rounded-xl p-4 mb-6",children:[n.jsx("img",{src:c.avatar,alt:c.name,className:"w-10 h-10 rounded-full border-2 border-white/20"}),n.jsxs("div",{children:[n.jsx("span",{className:"text-white font-medium",children:c.name}),c.role&&n.jsx("div",{className:`text-xs px-2 py-1 rounded border mt-1 inline-block ${f(c.role)}`,children:c.role})]})]}),n.jsxs("p",{className:"text-gray-300 mb-6",children:["Are you sure you want to remove ",c.name,' from "',t,"\"? They'll lose access to all trip information."]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>d(null),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-xl transition-colors",children:"Cancel"}),n.jsx("button",{onClick:()=>(i(c.id),d(null),void m(null)),className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-xl transition-colors",children:"Remove User"})]})]})}),u&&n.jsx("div",{className:"fixed inset-0 z-5",onClick:()=>m(null)})]})},gN=["Sports â€“ Pro, Collegiate, Youth","Tour â€“ Music, Comedy, etc.","Business Travel","School Trip","Content","Other"],fN=({isOpen:e,onClose:t,tripId:a,tripName:r,currentUserId:i})=>{const[s,o]=L.useState("users"),[l,c]=L.useState("Business Travel"),[d,u]=L.useState(""),[m,p]=L.useState(!1),[h,g]=L.useState([{id:"1",name:"Emma Wilson",avatar:Dt("Emma Wilson"),role:"owner",joinedAt:"2024-01-15"},{id:"2",name:"Jake Thompson",avatar:Dt("Jake Thompson"),role:"admin",joinedAt:"2024-01-16"},{id:"3",name:"Sarah Chen",avatar:Dt("Sarah Chen"),role:"member",joinedAt:"2024-01-18"},{id:"4",name:"You",avatar:Dt("You"),role:"member",joinedAt:"2024-01-20"}]);if(!e)return null;const f=[{id:"users",label:"Members",icon:ln},{id:"general",label:"General",icon:gn},{id:"danger",label:"Danger Zone",icon:ie}];return n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",children:n.jsxs("div",{className:"flex h-full",children:[n.jsxs("div",{className:"w-80 bg-white/5 backdrop-blur-md border-r border-white/10 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsx("h2",{className:"text-xl font-bold text-white",children:"Trip Settings"}),n.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-colors",children:n.jsx(ae,{size:20})})]}),n.jsx("div",{className:"space-y-2",children:f.map(e=>{const t=e.icon;return n.jsxs("button",{onClick:()=>o(e.id),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-colors "+(s===e.id?"bg-glass-orange/20 text-glass-orange border border-glass-orange/30":"text-gray-300 hover:text-white hover:bg-white/10"),children:[n.jsx(t,{size:20}),e.label]},e.id)})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:n.jsxs("div",{className:"p-8",children:["users"===s&&n.jsx(hN,{tripId:a,tripName:r,users:h,currentUserId:i,onUserRemoved:e=>{g(h.filter(t=>t.id!==e))},onLeaveTrip:()=>{t()}}),"general"===s&&n.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"General Settings"}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Trip Category"}),n.jsx("select",{value:m?"Other":l,onChange:e=>{var t;"Other"===(t=e.target.value)?(p(!0),c("")):(p(!1),c(t),u(""))},className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-glass-orange/50 focus:border-glass-orange/50",children:gN.map(e=>n.jsx("option",{value:e,children:e},e))}),m&&n.jsx("div",{className:"mt-3",children:n.jsx("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Enter custom category...",className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-glass-orange/50 focus:border-glass-orange/50"})}),n.jsx("button",{onClick:()=>{},className:"mt-3 bg-glass-orange hover:bg-glass-orange/80 text-white px-6 py-2 rounded-xl transition-colors font-medium",children:"Save Category"})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Trip Name"}),n.jsx("input",{type:"text",defaultValue:r,className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-glass-orange/50 focus:border-glass-orange/50"})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Description"}),n.jsx("textarea",{rows:4,placeholder:"Describe your trip...",className:"w-full bg-gray-800/50 border border-gray-600 text-white rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-glass-orange/50 focus:border-glass-orange/50 resize-none"})]})]}),"danger"===s&&n.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-red-500/20 rounded-2xl p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-red-300 mb-4",children:"Danger Zone"}),n.jsx("p",{className:"text-gray-400 mb-6",children:"These actions are irreversible."}),n.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-xl transition-colors",children:"Delete Trip"})]})]})})]})})},xN=({isOpen:e,onClose:t})=>{const{upgradeToTier:a,isLoading:r}=te(),[i,s]=L.useState("explorer"),[o,l]=L.useState("annual");if(!e)return null;return n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center "+("explorer"===i?"bg-gradient-to-r from-glass-orange to-glass-yellow":"bg-gradient-to-r from-purple-500 to-purple-600"),children:["explorer"===i&&n.jsx(sn,{size:24,className:"text-white"}),"frequent-chraveler"===i&&n.jsx(pt,{size:24,className:"text-white"})]}),n.jsxs("div",{children:[n.jsxs("h2",{className:"text-3xl font-bold text-white capitalize",children:["Upgrade to ",i]}),n.jsxs("p",{className:"text-gray-400",children:["explorer"===i&&"Never lose a trip memory","frequent-chraveler"===i&&"For travel pros and adventure enthusiasts"]})]})]}),n.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:n.jsx(ae,{size:24})})]}),n.jsx("div",{className:"flex justify-center gap-2 mb-6",children:["explorer","frequent-chraveler"].map(e=>n.jsx("button",{onClick:()=>s(e),className:"px-4 py-2 rounded-xl font-medium transition-all capitalize "+(i===e?"bg-gradient-to-r from-glass-orange to-glass-yellow text-white":"text-gray-300 hover:text-white bg-white/5"),children:"frequent-chraveler"===e?"Frequent Chraveler":e},e))}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[n.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-purple-500/10 border border-blue-500/20 rounded-2xl p-6",children:[n.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center mb-4",children:n.jsx(pt,{size:24,className:"text-white"})}),n.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Concierge"}),n.jsx("p",{className:"text-gray-300 text-sm",children:"Chat with AI for personalized recommendations based on your location and preferences."})]}),n.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-teal-500/10 border border-green-500/20 rounded-2xl p-6",children:[n.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-teal-500 rounded-xl flex items-center justify-center mb-4",children:n.jsx(gn,{size:24,className:"text-white"})}),n.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Smart Preferences"}),n.jsx("p",{className:"text-gray-300 text-sm",children:"Set dietary, vibe, budget, and time preferences to get tailored suggestions for your entire group."})]}),n.jsxs("div",{className:"bg-gradient-to-br from-orange-500/10 to-red-500/10 border border-orange-500/20 rounded-2xl p-6",children:[n.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl flex items-center justify-center mb-4",children:n.jsx(na,{size:24,className:"text-white"})}),n.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Basecamp Intelligence"}),n.jsx("p",{className:"text-gray-300 text-sm",children:"Get location-aware recommendations within walking distance or perfect travel time from your basecamp."})]}),n.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20 rounded-2xl p-6",children:[n.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mb-4",children:n.jsx(Ct,{size:24,className:"text-white"})}),n.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Contextual Chat"}),n.jsx("p",{className:"text-gray-300 text-sm",children:"Real-time assistance for planning activities, finding restaurants, and making the most of your trip."})]}),n.jsxs("div",{className:"bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/20 rounded-2xl p-6",children:[n.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center mb-4",children:n.jsx(yn,{size:24,className:"text-white"})}),n.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Photo Sharing"}),n.jsx("p",{className:"text-gray-300 text-sm",children:"Share and organize trip photos with your group in beautiful albums and memories."})]})]}),n.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-6 mb-8",children:[n.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Free vs. ","explorer"===i?"Explorer":"Frequent Chraveler"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-white font-medium mb-3",children:"Free Plan"}),n.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[n.jsx("li",{children:"â€¢ Up to 3 active trips"}),n.jsx("li",{children:"â€¢ Basic group chat"}),n.jsx("li",{children:"â€¢ Shared calendar (manual)"}),n.jsx("li",{children:"â€¢ Photo & video sharing"}),n.jsx("li",{children:"â€¢ 5 AI queries per user per trip"})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-white font-medium mb-3",children:"explorer"===i?"Explorer":"Frequent Chraveler"}),"explorer"===i?n.jsxs("ul",{className:"space-y-2 text-sm text-green-300",children:[n.jsx("li",{children:"â€¢ Unlimited saved trips"}),n.jsx("li",{children:"â€¢ 10 AI queries per trip"}),n.jsx("li",{children:"â€¢ Location-aware AI"}),n.jsx("li",{children:"â€¢ Custom trip categories"}),n.jsx("li",{children:"â€¢ Smart notifications"}),n.jsx("li",{children:"â€¢ Priority support"})]}):n.jsxs("ul",{className:"space-y-2 text-sm text-purple-300",children:[n.jsx("li",{children:"â€¢ Everything in Explorer"}),n.jsx("li",{children:"â€¢ Unlimited AI queries"}),n.jsx("li",{children:"â€¢ Calendar sync & PDF export"}),n.jsx("li",{children:"â€¢ 1 Chravel Pro trip/month"}),n.jsx("li",{children:"â€¢ Role-based channels"}),n.jsx("li",{children:"â€¢ Early feature access"})]})]})]})]}),n.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[n.jsx("span",{className:"text-sm "+("monthly"===o?"text-white font-medium":"text-gray-400"),children:"Monthly"}),n.jsx("button",{onClick:()=>l("monthly"===o?"annual":"monthly"),className:"relative w-12 h-6 bg-gray-700 rounded-full transition-colors",children:n.jsx("div",{className:"absolute top-1 w-4 h-4 bg-glass-orange rounded-full transition-transform "+("annual"===o?"translate-x-7":"translate-x-1")})}),n.jsx("span",{className:"text-sm "+("annual"===o?"text-white font-medium":"text-gray-400"),children:"Annual"}),"annual"===o&&n.jsx("div",{className:"bg-green-500/20 text-green-400 px-2 py-1 rounded-lg text-xs font-medium",children:"Save 17%"})]}),n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"bg-gradient-to-r from-glass-orange/20 to-glass-yellow/20 backdrop-blur-sm border border-glass-orange/30 rounded-2xl p-6 mb-6",children:[n.jsxs("div",{className:"text-4xl font-bold text-white mb-2",children:["$",(()=>{const e=Mt[i];return"monthly"===o?e.monthly:e.annual})(),"monthly"===o?"/month":"/year"]}),"annual"===o&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"text-sm text-gray-300 mb-1",children:["$",(Mt[i].annual/12).toFixed(2),"/month when billed annually"]}),n.jsxs("div",{className:"text-green-400 text-sm mb-2",children:["Save $",Mt[i].savings,"/year (17% off)"]})]}),n.jsx("p",{className:"text-gray-300 mb-4",children:"14-day free trial â€¢ Cancel anytime"}),n.jsx("div",{className:"text-sm text-glass-yellow",children:"No credit card required for trial"})]}),n.jsxs("div",{className:"flex gap-4 justify-center",children:[n.jsx("button",{onClick:t,className:"px-8 py-3 bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 text-white rounded-2xl transition-all duration-200 font-medium",children:"Maybe Later"}),n.jsx("button",{onClick:async()=>{await a(i,o),t()},disabled:r,className:"px-8 py-3 bg-gradient-to-r from-glass-orange to-glass-yellow hover:from-glass-orange/80 hover:to-glass-yellow/80 text-white font-medium rounded-2xl transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50",children:r?"Processing...":"Start Free Trial"})]})]})]})})},vN=({showSettings:e,onCloseSettings:t,showInvite:a,onCloseInvite:r,showAuth:i,onCloseAuth:s,showTripSettings:o,onCloseTripSettings:l,showTripsPlusModal:c,onCloseTripsPlusModal:d,tripName:u,tripId:m,userId:p})=>n.jsxs(n.Fragment,{children:[n.jsx(Rt,{isOpen:e,onClose:t}),n.jsx(Qe,{isOpen:a,onClose:r,tripName:u,tripId:m}),n.jsx(ta,{isOpen:i,onClose:s}),n.jsx(fN,{isOpen:o,onClose:l,tripId:m,tripName:u,currentUserId:p||"4"}),n.jsx(xN,{isOpen:c,onClose:d})]});export{Jy as A,nf as B,sa as C,rf as D,Wf as E,gb as F,da as G,hb as H,go as I,mb as J,bg as K,ga as L,xb as M,xo as N,ff as O,zy as P,$y as Q,eb as R,wa as S,vN as T,dN as U,_a as V,Ea as a,fb as b,uN as c,mN as d,pN as e,ag as f,ej as g,bo as h,oN as i,gf as j,yg as k,ya as l,cg as m,Mh as n,Ph as o,Zs as p,jf as q,Nf as r,to as s,no as t,Uh as u,Df as v,yf as w,xf as x,ps as y,lb as z};
